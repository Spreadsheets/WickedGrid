var jQuery=window.jQuery||{};var Sheet=(function(d,l,f,a,p,s,t,g,b,q){var k={defaultTheme:0,themeRollerTheme:0,bootstrapTheme:1,customTheme:2,excelSelectModel:0,googleDriveSelectModel:1,openOfficeSelectModel:2,defaultColumnWidth:120,defaultRowHeight:20,calcStack:0};k.Cell=(function(){var v=undefined;function w(x,A,z,y){if(w.cellLoading===null){w.cellLoading=z.msg.cellLoading}if(A!==undefined&&A!==null){this.td=A;A.jSCell=this}else{this.td=null}this.dependencies=[];this.formula="";this.cellType=null;this.value="";this.valueOverride=null;this.calcCount=0;this.sheetIndex=x;this.rowIndex=null;this.columnIndex=null;this.jS=(z!==undefined?z:null);this.state=[];this.needsUpdated=true;this.uneditable=false;this.id=null;this.loader=null;this.loadedFrom=null;this.cellHandler=y;this.waitingCallbacks=[];this.parsedFormula=null;this.defer=null}w.prototype={addDependency:function(x){if(x===undefined||x===null){return}if(x.type!==k.Cell){throw new Exception("Wrong Type")}if(this.dependencies.indexOf(x)<0&&this!==x){this.dependencies.push(x);if(this.loader!==null){this.loader.addDependency(this,x)}}},updateValue:function(B){if(!this.needsUpdated&&this.value.cell!==v&&this.defer===null){var G=(this.valueOverride!==null?this.valueOverride:this.value);this.displayValue();if(B!==v){B.call(this,G)}if(this.waitingCallbacks.length>0){while(this.waitingCallbacks.length>0){this.waitingCallbacks.pop().call(this,G)}}return}if(this.formula.length<1&&this.cellType===null&&this.defer===null){if(this.value!==undefined&&((this.value+"").length<1||!this.hasOperator.test(this.value))){if(this.td!==null){this.td.innerHTML=this.encode(this.value)}this.value=new p(this.value);this.value.cell=this;this.updateDependencies();this.needsUpdated=false;if(B!==v){B.call(this,this.value)}if(this.waitingCallbacks.length>0){while(this.waitingCallbacks.length>0){this.waitingCallbacks.pop().call(this,this.value)}}return}}var N,z=this,H,D,K=this.value,y=this.formula,L=this.cellType,x,A=this.defer,E=this.td,M,I,C,O,J=function(P){z.parsedFormula=P;z.resolveFormula(P,function(Q){if(Q!==v&&Q!==null){if(Q.cell!==v&&Q.cell!==z){Q=Q.valueOf()}k.calcStack--;if(L!==null&&(x=k.CellTypeHandlers[L])!==v){Q=x(z,Q)}F.call(z,Q)}else{F.call(z,null)}})},F=function(P){if(P===v||P===null){P=new p()}if(P.cell===v){switch(typeof(P)){case"object":break;case"undefined":P=new p();break;case"number":P=new s(P);break;case"boolean":P=new t(P);break;case"string":default:P=new p(P);break}P.cell=z}z.value=P;H=z.displayValue().valueOf();z.state.shift();if(z.loader!==null){z.loader.setCellAttributes(z.loadedFrom,{cache:(typeof H!=="object"?H:null),formula:z.formula,parsedFormula:z.parsedFormula,value:z.value+"",cellType:z.cellType,uneditable:z.uneditable}).setDependencies(z)}z.needsUpdated=false;O=z.valueOverride!==null?z.valueOverride:z.value;if(B!==v){B.call(z,O)}if(z.waitingCallbacks.length>0){while(z.waitingCallbacks.length>0){z.waitingCallbacks.pop().call(z,O)}}z.updateDependencies()};if(this.state.length>0){if(B!==v){this.waitingCallbacks.push(B)}return}if(A!==null){A.updateValue(function(P){P=P.valueOf();switch(typeof(P)){case"object":break;case"undefined":P=new p();break;case"number":P=new s(P);break;case"boolean":P=new t(P);break;case"string":default:P=new p(P);break}P.cell=this;this.updateDependencies();this.needsUpdated=false;if(B!==v){B.call(z,P)}if(z.waitingCallbacks.length>0){while(z.waitingCallbacks.length>0){z.waitingCallbacks.pop().call(z,P)}}});return}this.oldValue=K;this.state.unshift("updating");this.fnCount=0;this.valueOverride=null;this.calcCount++;if(y.length>0){if(y.charAt(0)==="="){z.formula=y=y.substring(1)}if(z.td!==null){z.td.innerHTML=w.cellLoading}k.calcStack++;if(this.parsedFormula!==null){J(this.parsedFormula)}else{z.parseFormula({formula:y,callback:J})}}else{if(K!==v&&K!==null&&L!==null&&(x=k.CellTypeHandlers[L])!==v){K=x(z,K);F(K)}else{switch(typeof K.valueOf()){case"string":N=z.startOperators[K.charAt(0)];if(N!==v){z.valueOverride=N.call(z,K)}else{N=z.endOperators[K.charAt(K.length-1)];if(N!==v){z.valueOverride=N.call(z,K)}}break;case"undefined":K="";break}F(K)}}},updateDependencies:function(){var z,x,y;z=this.dependencies;this.dependencies=[];y=z.length-1;if(y>-1){this.state.unshift("updatingDependencies");do{x=z[y];x.updateValue()}while(y-->0);this.state.shift()}if(this.dependencies.length===0){this.dependencies=z}},displayValue:function(){var y=this.value,A=this.td,z=typeof y,x=y.html;if(x===v){if(z==="string"||(y!==null&&z==="object"&&y.toUpperCase!==v)&&y.length>0){x=this.encode(y)}else{x=y}}if(A===v||A===null){return x}switch(typeof x){case"object":if(x===null){A.innerHTML=""}else{if(x.appendChild!==v){if(x.parentNode===null){A.innerHTML="";A.appendChild(x)}return""}}case"string":default:A.innerHTML=x}return A.innerHTML},resolveFormula:function(I,G){if(typeof I==="string"){G(I)}var F=this,B=[],z=0,C=I.length,A,H=this.cellHandler,E=[],D=function(K,M){var N=[],J,L=M.length-1;if(L<0){return}do{J=M[L];switch(typeof J){case"number":N[L]=E[J];break;case"string":N[L]=J;break;case"object":if(J instanceof Array){N[L]=y(J);break}default:N[L]=J}}while(L-->0);N.unshift(K);return N},y=function(L){var M=[],K=L.length-1,J;if(K<0){return}do{J=L[K];switch(typeof J){case"number":M[K]=E[J];break;case"string":M[K]=J;break;case"object":if(J.hasOwnProperty("args")){M[K]=J;M[K].a=y(J.a);break}else{if(J instanceof Array){M[K]=y(J);break}}default:M[K]=J}}while(K-->0);return M},x;if(F.jS.s.useStack){x=function(M){var L=w.thawIndex,N=w.thaws,K,J=(typeof N[L]==="undefined");if(J){K=w.thaws[L]=new Thaw([])}else{K=N[L]}w.thawIndex++;if(w.thawIndex>w.thawLimit){w.thawIndex=0}K.add(function(){if(B.length>0){B.shift()()}else{G(F.value=(M!==v?M:null))}})}}else{x=function(J){if(B.length>0){B.shift()()}else{G(F.value=(J!==v?J:null))}}}for(;z<C;z++){A=I[z];switch(A.t){case"m":(function(J,K){B.push(function(){x(E[K]=H[J.m].apply(H,D(F,J.a)))})})(A,z);break;case"l":(function(J,K){B.push(function(){var L=D(F,J.a);L.push(function(M){x(E[K]=M)});H[J.m].apply(H,L)})})(A,z);break;case"v":(function(J,K){B.push(function(){x(E[K]=J.v)})})(A,z);break;case"cell":(function(J,K){B.push(function(){E[K]=J;x()})})(A,z);break;case v:E[z]=A;break;default:E[z]=null;throw new q("Not implemented:"+A.t);break}}x()},recurseDependencies:function(A,C){if(C>w.maxRecursion){this.recurseDependenciesFlat(A);return this}var z=0,B=this.dependencies,y,x=B.length;if(C===undefined){C=0}for(;z<x;z++){y=B[z];A.call(y);y.recurseDependencies(A,C)}return this},recurseDependenciesFlat:function(B){var C=this.dependencies,z=C.length-1,y,x,A=[];if(z<0){return}do{A.push(C[z])}while(z-->0);do{y=A[A.length-1];A.length--;B.call(y);x=y.dependencies;z=x.length-1;if(z>-1){do{A.push(x[z])}while(z-->0)}}while(A.length>0)},getAllDependencies:function(){var x=[];this.recurseDependencies(function(){x.push(this)});return x},setNeedsUpdated:function(x){if(x!==v){this.needsUpdated=x}else{this.needsUpdated=true}this.recurseDependencies(function(){this.needsUpdated=true})},encode:function(x){switch(typeof x){case"object":if(x.getMonth!==v){return globalize.format(x,"d")}return x}if(!x){return x||""}if(!x.replace){return x||""}return x.replace(/&/gi,"&amp;").replace(/>/gi,"&gt;").replace(/</gi,"&lt;").replace(/\t/g,"&nbsp;&nbsp;&nbsp ").replace(/  /g,"&nbsp; ")},addClass:function(x){var B=this.td,z,y,A=this.loadedFrom;if(B!==v){if(B.classList){B.classList.add(x)}else{B.className+=" "+x}}if(A!==v){z=(this.loader.getCellAttribute(A,"class")||"");y=z.split(" ").indexOf(x);if(y<0){z+=" "+x;this.loader.setCellAttribute(A,"class",z)}}return this},removeClass:function(x){var B=this.td,z,y,A=this.loadedFrom;if(B!==v){if(B.classList){B.classList.remove(x)}else{z=(B.className+"").split(" ");y=z.indexOf(x);if(y>-1){z.splice(y,1);B.className=z.join(" ")}}}if(A!==v){z=(this.loader.getCellAttribute(A,"class")||"").split(" ");y=z.indexOf(x);if(y>-1){z.splice(y,1);this.loader.setCellAttribute(A,"class",z.join(" "))}}return this},hasOperator:/(^[$£])|([%]$)/,startOperators:{"$":function(y,x){return this.cellHandler.fn.DOLLAR.call(this,y.substring(1).replace(Globalize.culture().numberFormat[","],""),2,x||"$")},"£":function(x){return this.startOperators["$"].call(this,x,"£")}},endOperators:{"%":function(x){return x.substring(0,this.value.length-1)/100}},type:w,typeName:"Sheet.Cell",parseFormula:function(B){if(!this.jS.s.useMultiThreads){B.callback(this.cellHandler.formulaParser(k.calcStack).parse(B.formula));return}var z=w.threadIndex,A=w.threads,x,y=(typeof A[z]==="undefined");if(y){x=w.threads[z]=operative(function(C){if(typeof C==="string"){return parser.Formula().parse(C)}return null},[w.formulaParserUrl]);x.busy=false;x.stash=[]}else{x=A[z]}w.threadIndex++;if(w.threadIndex>w.threadLimit){w.threadIndex=0}if(x.busy){x.stash.push(function(){x.busy=true;x(B.formula,function(C){x.busy=false;B.callback(C);if(x.stash.length>0){x.stash.shift()()}})})}else{x.busy=true;x(B.formula,function(C){x.busy=false;B.callback(C);if(x.stash.length>0){x.stash.shift()()}})}}};w.threads=[];w.threadLimit=10;w.threadIndex=0;w.thaws=[];w.thawLimit=500;w.thawIndex=0;w.cellLoading=null;w.formulaParserUrl="../parser/formula/formula.js";w.maxRecursion=10;return w})();k.CellHandler=(function(w){function z(A){return !isNaN(A)}var v=undefined,x=NaN;function y(C,A,B){this.jS=C;this.jSE=A;this.fn=B;this.spareFormulaParsers={}}y.prototype={variable:function(G,E){if(arguments.length){var D=E[0],B=E[1],F=this.jS.s.formulaVariables,C,A;switch(D.toLowerCase()){case"true":A=new t(true);A.html="TRUE";A.cell=G;return A;case"false":A=new t(false);A.html="FALSE";A.cell=G;return A}if(C=F[D]&&!B){return C}else{if(C&&B){return C[B]}else{return""}}}},time:function(A,C,B){return i.fromString(C,B)},number:function(B,A){if(isNaN(A)||A===null){A=0}switch(typeof A){case"number":return A;case"string":if(z(A)){return A*1}case"object":if(A.getMonth){return e.toCentury(A)}}return A},invertNumber:function(D,C){if(isNaN(C)){C=0}var B=this.number(D,C),A=new s(B.valueOf()*-1);if(B.html){A.html=B.html}return A},performMath:function(A,H,G,F){if(G===v||G===null){G=0}if(F===v||F===null){F=0}var E,D,I=true,B=true,K=[],J,C=function(L){return L};if(G.hasOwnProperty("cell")){G.cell.addDependency(A)}if(F.hasOwnProperty("cell")){F.cell.addDependency(A)}switch(E=(typeof G.valueOf())){case"number":break;case"string":if(z(G)){G*=1}else{I=false}break;case"object":if(G.getMonth){G=e.toCentury(G);C=e.get}else{I=false}break;default:I=false}switch(D=(typeof F.valueOf())){case"number":break;case"string":if(z(F)){F*=1}else{B=false}break;case"object":if(F.getMonth){F=e.toCentury(F)}else{B=false}break;default:B=false}if(!I&&H!=="+"){K.push("not a number: "+G);G=0}if(!B){K.push("not a number: "+F);F=0}if(K.length){}switch(H){case"+":J=G+F;break;case"-":J=G-F;break;case"/":J=G/F;if(J==Infinity||J==x){J=0}break;case"*":J=G*F;break;case"^":J=w.pow(G,F);break}return C(J)},not:function(D,C,B){var A;if(C.valueOf()!=B.valueOf()){A=new t(true);A.html="TRUE";A.cell=D}else{A=new t(false);A.html="FALSE";A.cell=D}return A},concatenate:function(C,B,A){if(B===null){B=""}if(A===null){A=""}return B.toString()+A.toString()},cellValue:function(C,B,G){var E=this.jS,F=h.parseLocation(B.c,B.r),A,D;A=E.getCell(C.sheetIndex,F.row,F.col);if(A!==null){A.addDependency(C);A.updateValue(G)}else{if(G!==v){G.call(C,0)}}return this},cellRangeValue:function(B,D,A,C){return this.remoteCellRangeValue(B,B.sheetIndex,D,A,C)},remoteCellValue:function(A,F,C,H){var B=this.jSE,D=this.jS,E=B.parseLocation(C.c,C.r),I=B.parseSheetLocation(F),G;if(I<0){I=D.getSpreadsheetIndexByTitle(F)}G=D.getCell(I,E.row,E.col);if(G!==null){G.addDependency(A);G.updateValue(H)}else{if(H!==v){H.call(A,0)}}return this},remoteCellRangeValue:function(Y,E,F,B,G){var H=(typeof E==="string"?h.parseSheetLocation(E):E),Z=h.parseLocation(F.c,F.r),N=h.parseLocation(B.c,B.r),P=w.max(Z.row,N.row),D=w.min(Z.row,N.row),X=w.max(Z.col,N.col),C=w.min(Z.col,N.col),L=this.jS,Q=[],S,A,K,J=[],aa=H+"!"+F.c+F.r+":"+B.c+B.r,M=y.cellRangeCache[aa],W,V,U,O=this,R=((C-1)-X)*((D-1)-P),T=R+0,I=0;if(H<0){H=L.getSpreadsheetIndexByTitle(E)}if(H<0){Q=new p("");Q.html="#NAME?";G.call(Y,Q);return this}if(E===v){L.spreadsheets[H]=E={}}if(P>=D||X>=C){Q.rowCount=(D-P)+1;Q.columnCount=(C-X)+1;do{S=X;K=(E[P]!==v?E[P]:null);do{if(K===null||(A=K[S])===v){A=L.getCell(H,P,S)}else{A.sheetIndex=H;A.rowIndex=P;A.columnIndex=S}if(A!==null){A.addDependency(Y);A.updateValue(function(ab){Q.unshift(ab);R--;if(R<1){y.cellRangeCache[aa]=Q;G.call(Y,Q)}});I++}}while(S-->C)}while(P-->D)}return this},callFunction:function(D,C,B){C=C.toUpperCase();B=B||[];var E=this.fn[C],A;if(E!==v){D.fnCount++;A=E.apply(D,B)}else{A=new p();A.html="Function "+C+" Not Found"}return A},formulaParser:function(B){var A;if(B>-1){A=this.spareFormulaParsers[B];if(A===v){A=this.spareFormulaParsers[B]=Formula(this)}}else{A=this.jS.formulaParser}return A}};y.cellRangeCache={};return y})(g);k.CellTypeHandlers=(function(){var w=isNaN,v={percent:function(y,A){if(A!==A){return 0}var z=(w(A)?Globalize.parseFloat(A):A*1),x;if(!w(z)){x=new s(z);x.html=Globalize.format(z,"p");return x}return A},date:function(x,z){if(z!==z){return 0}var y=Globalize.parseDate(z);if(y===null){return z}else{x.valueOverride=y;x.html=Globalize.format(y,"d");return z}},time:function(x,z){if(z!==z){return 0}var y=Globalize.parseDate(z);if(y===null){return z}else{y.html=Globalize.format(y,"t");return y}},currency:function(y,A){if(A!==A){return 0}var z=(w(A)?Globalize.parseFloat(A):A*1),x;if(!w(z)){x=new s(z);x.html=Globalize.format(z,"c");return x}return A},number:function(y,A){if(A!==A){return 0}var z,x;if(!v.endOfNumber){z=Globalize.culture().numberFormat["."];v.endOfNumber=new b("(["+(z=="."?".":z)+"])([0-9]*?[1-9]+)?(0)*$")}if(!w(A)){x=new s(A);x.html=Globalize.format(A+"","n10").replace(v.endOfNumber,function(D,C,B){return(B?C:"")+(B||"")});return x}return A}};return v})();k.CellRange=(function(){function v(w){this.cells=w||[]}v.prototype={clone:function(){var A=[],y=this.cells,x=y.length,w,B;for(var z=0;z<x;z++){w=y[z];B={value:w.value,formula:w.formula,td:w.td,dependencies:w.dependencies,needsUpdated:w.needsUpdated,calcCount:w.calcCount,sheetIndex:w.sheetIndex,rowIndex:w.rowIndex,columnIndex:w.columnIndex,html:w.html,state:w.state,jS:w.jS,style:w.style,cl:w.cl,id:w.id,cellType:w.cellType,type:w.type,uneditable:w.uneditable};A.push(B)}return new v(A)},type:v,typeName:"Sheet.CellRange"};return v})();k.ActionUI=(function(v,y,w,x,z){var A=function(F,M,K,L,I){this.enclosure=F;this.pane=v.createElement("div");this.table=M;this.max=I;this.xIndex=0;this.yIndex=0;this.scrollAxisX={};this.scrollAxisY={};this.scrollSize={};this.hiddenColumns=[];if(!(this.frozenAt=L)){this.frozenAt={row:0,col:0}}this.frozenAt.row=w.max(this.frozenAt.row,0);this.frozenAt.col=w.max(this.frozenAt.col,0);this.scrolledArea={row:w.max(this.frozenAt.row,1),col:w.max(this.frozenAt.col,1)};this.foldArea={row:0,col:0};var G=this,C=this.pane,J=this.tBody=M.tBody,H="#"+M.getAttribute("id"),D=this.scrollUI=C.scrollOuter=v.createElement("div"),E=C.scrollInner=v.createElement("div"),B=this.scrollAxisX.scrollStyle=C.scrollStyleX=this.scrollStyleX=new k.StyleUpdater(function(O,P){if(G.xIndex===O){return false}if(O===undefined||O===null){O=G.xIndex}var R=O+G.maximumVisibleColumns,S=c.ofSet(G.hiddenColumns,O),Q=c.ofSet(G.hiddenColumns,R);if(S!==null){O=S.end+(O-S.start)}if(Q!==null){R=Q.end+(R-Q.start)}G.xIndex=O;if(P===undefined){var N=G.frozenAt.col;P=H+" tr > *:nth-child(-n+"+O+") {display: none;}"+H+" col:nth-child(-n+"+O+") {display: none;}"+H+" tr > *:nth-child(-n+"+(N+1)+") {display: table-cell;}"+H+" col:nth-child(-n+"+(N+1)+") {display: table-column;}"+H+" tr > *:nth-child("+(R)+") ~ * {display: none;}"+H+" col:nth-child("+(R)+") ~ col {display: none;}"}this.setStyle(P);G.scrolledArea.col=w.max(O||1,1);G.foldArea.col=R;return true},I);this.yDetacher=new k.Detacher(J);D.setAttribute("class",K);D.appendChild(E);z(D).disableSelectionSpecial();D.addEventListener("scroll",function(){var N=D.scrollTop+D.clientHeight;if(N>=(E.clientHeight-(D.clientHeight/2))){E.style.height=(E.clientHeight+(D.clientHeight*2))+"px"}N=D.scrollLeft+D.clientWidth;if(N>=(E.clientWidth-(D.clientWidth/2))){E.style.width=(E.clientWidth+(D.clientWidth*2))+"px"}});C.appendChild(B.styleElement);new MouseWheel(C,D)};A.prototype={putTdInView:function(G){var C=0,B=0,F=0,E,D;this.xIndex=0;this.yIndex=0;while((E=this.directionToSeeTd(G))!==null){D=this.scrolledArea;if(E.left){B--;this.scrollTo("x",0,D.col-1)}else{if(E.right){B++;this.scrollTo("x",0,D.col+1)}}if(E.up){F--;this.scrollTo("y",0,D.row-1)}else{if(E.down){F++;this.scrollTo("y",0,D.row+1)}}C++;if(C<25){break}}},directionToSeeTd:function(C){var B=this.pane,L={top:0,bottom:B.clientHeight,left:0,right:B.clientWidth},H=C.clientWidth,F=C.clientHeight,J={top:C.offsetTop,bottom:C.offsetTop+F,left:C.offsetLeft,right:C.offsetLeft+H},D=C.parentNode,I=this.scrolledArea;if(!C.col){return null}var K=C.barTop.cellIndex<I.col,E=D.rowIndex<I.row,G={up:E,down:J.bottom>L.bottom&&F<=B.clientHeight,left:K,right:J.right>L.right&&H<=B.clientWidth};if(G.up||G.down||G.left||G.right){return G}return null},redraw:function(){var B=this.pane.style;B.opacity=0.9999;setTimeout(function(){B.opacity=1},0)},hide:function(D,C){var F="#"+this.table.getAttribute("id"),E=this.pane,B=this;if(this.toggleHideStyleX===null){this.toggleHideStyleX=new k.StyleUpdater(function(){var G=this.nthCss("col",F,B.hiddenColumns,0)+this.nthCss("> td",F+" tr",B.hiddenColumns,0)+this.nthCss("> th",F+" tr",B.hiddenColumns,0);this.setStyle(G)})}E.appendChild(this.toggleHideStyleX.styleElement);this.hiddenColumns=(C!==null?C:[]);if(D.length>0){D.sort();this.toggleHideRowRange(D[0],D[D.length-1],true)}if(this.hiddenColumns.length>0){this.hiddenColumns.sort();this.toggleHideStyleX.update()}},toggleHideRow:function(I){var C,J=this.tBody,H=this.yDetacher,D=H.hidden,K=H.hidden[I],E=H.detachedAbove,F=H.detachedBelow,B=E.length,G=B+J.length;if(K===undefined){if(I<B){D[I]=E[I]}else{if(I>G){D[I]=F[I-G]}else{C=I-B;if(C>=J.children.length){D[I]=null}else{J.removeChild(D[I]=J.children[C])}}}}else{delete D[I]}},toggleHideRowRange:function(N,H,I){if(!N){return}if(!H){H=N}var C,M=this.tBody,L=N,K=this.yDetacher,D=K.hidden,E=K.detachedAbove,G=K.detachedBelow,F=((I===true)||(D[N]===u)),B=E.length-1,J=B+M.length;for(;L<H;L++){if(F){if(L<B){D[L]=E[L]}else{if(L>J){D[L]=G[L-J]}else{C=L-B;if(C>=M.children.length){D[L]=null}else{M.removeChild(D[L]=M.children[C])}}}}}},rowShowAll:function(){this.toggleHideStyleY.setStyle("");this.hiddenRows={}},toggleHideColumn:function(B){var C;if((C=this.hiddenColumns.indexOf(B))>-1){this.hiddenColumns.splice(C,1)}else{this.hiddenColumns.push(B)}this.hiddenColumns.sort();this.toggleHideStyleX.update()},toggleHideColumnRange:function(I,H){if(!I){return}if(!H){H=I}var G=this.hiddenColumns,E=[],D=G.length,C,F=0,B=null;for(;F<D;F++){C=G[F];if(C>=I&&C<=H){if(B===null){B=true}}else{E.push(C)}}if(B===null){for(F=I;F<=H;F++){E.push(F)}}E.sort();this.hiddenColumns=E;this.toggleHideStyleX.update()},columnShowAll:function(){this.toggleHideStyleX.setStyle("");this.hiddenColumns=[]},remove:function(){},scrollToPixelX:function(C){var E=this.scrollAxisX,B,D,F=(C/this.pixelScrollDensity)>>1,G=c.indexOfNearestLessThan(this.hiddenColumns,F)+1;if(G>0){F+=G}B=E.max;E.value=F;D=F>B?B:F;return E.scrollStyle.update(D)},scrollToPixelY:function(C,E){var D=(C/this.pixelScrollDensity)>>1,B=this.yDetacher;this.yIndex=D;this.scrolledArea.row=w.max(D||1,1);if(E===true){B.attachAboveAfter(D).detachBelowAfter(D+this.maximumVisibleRows+1)}else{B.detachAboveBefore(D).attachBelowBefore(D+this.maximumVisibleRows+1)}return B.aboveChanged||B.belowChanged},scrollToCell:function(B,C){throw new q("Not yet implemented")},toggleHideStyleX:null,toggleHideStyleY:null,pixelScrollDensity:30,maximumVisibleRows:65,maximumVisibleColumns:20};return A})(l,f,g,s,d);k.SpreadsheetUI=(function(){var v=[];function w(y,A,z,x){x=x||{};this.i=y;this.ui=A;this.table=z;this.isLast=x.lastIndex===y;this.enclosure=null;this.pane=null;this.spreadsheet=null;this.sizeCheck=x.sizeCheck||function(){};this.initChildren=x.initChildren||function(){};this.done=x.done||function(){};this.sizeCheck(this)}w.prototype={load:function(){var x=this.table;this.initChildren(this.ui,x,this.i);x.pane.ui=this.ui;this.enclosure=x.enclosure;this.pane=x.pane;this.spreadsheet=x.spreadsheet;v.push(this.i);if(this.isLast){this.loaded()}},loaded:function(){this.done(v,this)}};return w})();k.Theme=(function(v){function w(x){x=x||k.defaultTheme;switch(x){case k.customTheme:this.cl=w.customClasses;break;case k.bootstrapTheme:this.cl=w.bootstrapClasses;break;default:case k.themeRollerTheme:this.cl=w.themeRollerClasses;break}v.extend(this,this.cl)}w.themeRollerClasses={autoFiller:"ui-state-active",bar:"ui-widget-header",barHighlight:"ui-state-active",barHandleFreezeLeft:"ui-state-default",barHandleFreezeTop:"ui-state-default",barMenuTop:"ui-state-default",tdActive:"ui-state-active",tdHighlighted:"ui-state-highlight",control:"ui-widget-header ui-corner-top",controlTextBox:"ui-widget-content",fullScreen:"ui-widget-content ui-corner-all",inPlaceEdit:"ui-state-highlight",menu:"ui-widget-header",menuFixed:"",menuUl:"ui-widget-header",menuLi:"ui-widget-header",menuHover:"ui-state-highlight",pane:"ui-widget-content",parent:"ui-widget-content ui-corner-all",table:"ui-widget-content",tab:"ui-widget-header",tabActive:"ui-state-highlight",barResizer:"ui-state-highlight",barFreezer:"ui-state-highlight",barFreezeIndicator:"ui-state-highlight"};w.bootstrapClasses={autoFiller:"btn-info",bar:"bg-primary",barHighlight:"label-info",barHandleFreezeLeft:"bg-warning",barHandleFreezeTop:"bg-warning",barMenuTop:"bg-warning",tdActive:"active",tdHighlighted:"bg-info",control:"bg-primary",controlTextBox:"form-control",fullScreen:"",inPlaceEdit:"form-control",menu:"panel panel-default",menuFixed:"nav navbar-nav",menuUl:"panel-info",menuLi:"active",menuHover:"bg-primary active",pane:"well",parent:"panel panel-default",table:"table table-bordered table-condensed",tab:"btn-default btn-xs",tabActive:"active",barResizer:"bg-info",barFreezer:"bg-warning",barFreezeIndicator:"bg-warning"};w.customClasses={autoFiller:"",bar:"",barHighlight:"",barHandleFreezeLeft:"",barHandleFreezeTop:"",barMenuTop:"",tdActive:"",tdHighlighted:"",control:"",controlTextBox:"",fullScreen:"",inPlaceEdit:"",menu:"",menuFixed:"",menuUl:"",menuLi:"",menuHover:"",pane:"",parent:"",table:"",tab:"",tabActive:"",barResizer:"",barFreezer:"",barFreezeIndicator:""};return w})(jQuery);k.Highlighter=(function(v,w,x){var y=function(A,C,z,B){this.cssClass=A;this.cssClassBars=C;this.cssClassTabs=z;this.callBack=B||function(){};this.last=x([]);this.lastTop=x([]);this.lastLeft=x([]);this.lastTab=x([]);this.start={row:0,col:0};this.end={row:0,col:0}};y.prototype={set:function(B){if(B.parentNode!==undefined){B=[B]}var z,A=this.last;if(A&&A.length>0){z=A.length-1;do{A[z].isHighlighted=false}while(z-->0)}if(B.length>0){z=B.length-1;do{if(!B[z].isHighlighted){B[z].isHighlighted=true;if(!B[z].className.match(this.cssClass)){B[z].className+=" "+this.cssClass}}}while(z-->0)}this.clear(A);this.last=B;this.callBack();return this},is:function(){return this.last.length>0},clear:function(A){if(this.is()){A=A||this.last;if(A&&A.length){var z=A.length-1;do{if(!A[z].isHighlighted){A[z].className=A[z].className.replace(this.cssClass,"");A[z].isHighlighted=false}}while(z-->0)}}this.last=x([]);return this},setBar:function(z,A){switch(z){case"top":this.lastTop.removeClass(this.cssClassBars);this.lastTop=x(A).addClass(this.cssClassBars);break;case"left":this.lastLeft.removeClass(this.cssClassBars);this.lastLeft=x(A).addClass(this.cssClassBars);break}return this},clearBar:function(){this.lastTop.removeClass(this.cssClassBars);this.lastTop=x([]);this.lastLeft.removeClass(this.cssClassBars);this.lastLeft=x([]);return this},setTab:function(z){this.clearTab();this.lastTab=z.addClass(this.cssClassTabs);return this},clearTab:function(){this.lastTab.removeClass(this.cssClassTabs);return this},setStart:function(z){this.start=z;return this},setEnd:function(z){this.end=z;return this}};return y})(l,f,jQuery);k.ColumnAdder=(function(){function v(){this.qty=-1;this.addedFinishedFn=null;this.createBarFn=null;this.createCellFn=null}v.prototype={setQty:function(y,x){var w=d.sheet.max;if(w){if(w>x.cols&&w<=x.cols+y){this.qty=w-x.cols}else{if(w&&w<=x.cols+y){return false}}}else{this.qty=y}return true},setAddedFinishedFn:function(w){this.addedFinishedFn=w},setCreateBarFn:function(w){this.createBarFn=w},setCreateCellFn:function(w){this.createCellFn=w},createCells:function(B,E,A){var z=(A?0:1),w=E.rows||1,y=B+this.qty,D,x=B,C;for(;x<y;x++){C=this.createBarFn(x+z);for(D=1;D<=w;D++){this.createCellFn(D,x+z,C)}}if(this.addedFinishedFn!==null){this.addedFinishedFn({row:0,col:this.qty})}}};return v})();k.RowAdder=(function(){function v(){this.qty=-1;this.addedFinishedFn=null;this.createBar=null;this.createCell=null;this.hidden=null}v.prototype={setQty:function(z,x,y){var w=d.sheet.max;if(w){if(w>x.rows&&w<=x.rows+z){this.qty=w-x.rows}else{if(w&&w<=x.rows+z){return false}}}else{this.qty=z}return true},setAddedFinishedFn:function(w){this.addedFinishedFn=w},setCreateBarFn:function(w){this.createBar=w},setCreateCellFn:function(w){this.createCell=w},setHidden:function(w){this.hidden=w},createCells:function(C,F,B){var A=(B?0:1),w=C+this.qty,G=0,z=F.cols||1,D,x,E=C,y;for(;(E-G)<w;E++){if(x=this.hidden[E+A]!==undefined){G++}D=this.createBar(E+A,x);for(y=1;y<=z;y++){this.createCell(E+A,y,D,x)}}if(this.addedFinishedFn!==null){this.addedFinishedFn({row:this.qty,col:0})}}};return v})();(function(y){var x=undefined;function w(z){this.detachedAbove=[];this.detachedBelow=[];this.hidden={};this.parent=z;this.aboveChanged=false;this.belowChanged=false;this.hasInitialDetach=false}function v(G,C){var D=G.parent,B=D.children,F=G.detachedAbove.length,A,z=0,E=G.hidden;if(C<F){return}while((A=(z+F+(B.length-1)))>C){if(E[A]===x){G.detachedBelow.unshift(D.lastChild);D.removeChild(D.lastChild)}else{z++}}}w.prototype={detachAboveBefore:function(C){var B,D=this.parent,A=D.children,z=this.detachedAbove;this.aboveChanged=false;while(z.length-1<C){B=A[1];if(B===x){break}z.push(B);D.removeChild(B);this.aboveChanged=true}return this},detachBelowAfter:function(B){if(!this.hasInitialDetach){this.hasInitialDetach=true;v(this,B)}var A,D=this.parent,z=this.detachedAbove.length,C=D.children;this.belowChanged=false;while(z+C.length>B){this.detachedBelow.unshift(A=D.lastChild);D.removeChild(A);this.belowChanged=true}return this},attachAboveAfter:function(A){var E=this.parent,G=l.createDocumentFragment(),D,C=0,z=this.detachedAbove,B,F=this.hidden;this.aboveChanged=false;while((B=z.length+C)>A){D=z.pop();if(F[B-1]===x){G.insertBefore(D,G.firstChild)}else{C++}this.aboveChanged=true}if(this.aboveChanged){E.insertBefore(G,E.children[1])}return this},attachBelowBefore:function(A){if(!this.hasInitialDetach){this.hasInitialDetach=true;v(this,A)}var z,F=this.parent,G=l.createDocumentFragment(),E=G.children,B=this.detachedAbove.length+F.children.length,H=0,C,D=this.hidden;this.belowChanged=false;while((C=H+B+E.length)<A&&this.detachedBelow.length>0){z=this.detachedBelow.shift();if(D[C-1]===x){G.appendChild(z)}else{H++}this.belowChanged=true}if(this.belowChanged){F.appendChild(G)}return this},isAboveActive:function(){return this.detachedAbove.length>0},isBelowActive:function(){return this.detachedBelow.length>0}};y.Detacher=w})(k);k.StyleUpdater=(function(v){function w(x){var y=this.styleElement=v.createElement("style");y.styleUpdater=this;this._update=x}w.prototype={setStyle:null,getStyle:null,nthCss:function(x,D,z,B,A){var C=[],y=z.length;A=A||"{display: none;}";do{if(z[y]>B){C.unshift(D+" "+x+":nth-child("+(z[y]+1)+")")}}while(y--);if(C.length){return C.join(",")+A}return""},repeat:function(z,y){var x="";while(y>0){if(y&1){x+=z}y>>=1;z+=z}return x},update:function(){return this._update.apply(this,arguments)}};if(v.createElement("style").styleSheet){w.prototype.setStyle=function(y){var z=this.styleElement,x=z.styleSheet;x.disabled=false;if(!x.disabled){x.cssText=y}};w.prototype.getStyle=function(){var y=this.styleElement,x=y.styleSheet;x.disabled=false;if(!x.disabled){return x.cssText}return""}}else{w.prototype.setStyle=function(x){this.styleElement.innerHTML=x};w.prototype.getStyle=function(){return this.styleElement.innerHTML}}return w})(l);k.JSONLoader=(function(x,v,w){function y(z){if(z!==undefined){this.json=z;this.count=z.length}else{this.json=[];this.count=0}this.cellIds={};this.jS=null;this.handler=null}y.prototype={bindJS:function(z){this.jS=z;return this},bindHandler:function(z){this.handler=z;return this},size:function(C){var B={cols:0,rows:0},A=this.json,E,D,F,z;if((E=A[C])===undefined){return B}if((D=E.rows)===undefined){return B}if((F=D[0])===undefined){return B}if((z=F.columns)===undefined){return B}return{rows:D.length,cols:z.length}},getWidth:function(z,D){var B=this.json,F=B[z]||{},A=F.metadata||{},E=A.widths||[],C=E[D]||k.defaultColumnWidth;return C},getHeight:function(A,F){var B=this.json,D=B[A]||{},C=D.rows||[],E=C[F]||{},z=E.height||k.defaultRowHeight;return z},isHidden:function(z){var B=this.json,C=B[z]||{},A=C.metadata||{};return A.hidden===true},setMetadata:function(z,C){var B=this.json,E=B[z]||{},D=E.metadata||(E.metadata={});var A;for(A in C){if(C.hasOwnProperty(A)){D[A]=C[A]}}return this},setupCell:function(A,F,C){var E=v.createElement("td"),z=this.jitCell(A,F,C),D,B;if(z===null){return z}D=z.loadedFrom;if(D===null){return null}if(z.hasOwnProperty("formula")){E.setAttribute("data-formula",z.formula||"");if(D.hasOwnProperty("cache")){if(D.cache!==null&&D.cache!==""){E.innerHTML=D.cache}}}else{if(D.cellType!==undefined){E.setAttribute("data-celltype",D.cellType);z.cellType=D.cellType;if(D.hasOwnProperty("cache")){E.innerHTML=D.cache}}else{E.innerHTML=z.value}}if(D["class"]!==undefined){E.className=D["class"]}if(D.style!==undefined){E.setAttribute("style",D.style)}if(D.rowspan!==undefined){E.setAttribute("rowspan",D.rowspan)}if(D.colspan!==undefined){E.setAttribute("colspan",D.colspan)}if(D.uneditable!==undefined){E.setAttribute("data-uneditable",D.uneditable)}if(D.id!==undefined){E.setAttribute("id",D.id);z.id=D.id}E.jSCell=z;z.td=E;z.sheetIndex=A;z.rowIndex=F;z.columnIndex=C;return z},getCell:function(A,G,C){var B=this.json,E,D,F,z;if((E=B[A])===undefined){return null}if((D=E.rows)===undefined){return null}if((F=D[G-1])===undefined){return null}if((z=F.columns[C-1])===undefined){return null}return z},jitCell:function(G,J,V){var H=this.getCell(G,J,V);if(H===null){return null}if(H.getCell!==undefined){return H.getCell()}var U,T,N,S,P,L,z,B,Q,X,O,K,F,W,D,C,E,M,R,A,I;N=H.id;P=H.value;L=H.cache;z=H.formula;B=H.parsedFormula;Q=H.cellType;X=H.uneditable;K=H.dependencies;W=(N!==undefined&&N!==null);D=(P!==undefined&&P!==null);C=(L!==undefined&&L!==null&&(L+"").length>0);E=(z!==undefined&&z!==null&&z!=="");M=(B!==undefined&&B!==null);R=(Q!==undefined&&Q!==null);A=(X!==undefined&&X!==null);I=(K!==undefined&&K!==null);U=new k.Cell(G,null,this.jS,this.handler);U.rowIndex=J;U.columnIndex=V;U.loadedFrom=H;U.loader=this;if(W){U.id=N}if(E){U.formula=z}if(M){U.parsedFormula=B}if(R){U.cellType=Q}if(A){U.uneditable=X}if(D){U.value=new w(P)}else{U.value=new w()}if(C){U.value.html=L;U.needsUpdated=false}else{U.needsUpdated=(E||R||U.hasOperator.test(P))}if(I){S=K.length;for(T=0;T<S;T++){F=K[T];O=this.jitCell(F.s,F.r,F.c);if(O!==null){U.dependencies.push(O)}}}U.value.cell=U;H.getCell=function(){return U};return U},jitCellById:function(z){if(this.cellIds[z]!==undefined){return this.cellIds[z].requestCell()}var F=this,H=this.json,G=H.length-1,D,E,J,I,C,B,A;if(G<0){return null}do{D=H[G];J=D.rows;E=J.length-1;do{I=J[E];B=I.columns;C=B.length-1;do{A=B[C];if(typeof A.id=="string"){this.cellIds[z]={cell:A,sheetIndex:G,rowIndex:E,columnIndex:C,requestCell:function(){return F.jitCell(this.sheetIndex,this.rowIndex,this.columnIndex)}}}}while(C-->0)}while(E-->0)}while(G-->0);if(this.cellIds[z]!==undefined){return this.cellIds[z].requestCell()}return this.cellIds[z]=null},title:function(z){var A=this.json,B;if((B=A[z])===undefined){return""}return B.title||""},hiddenRows:function(C){var E=this.json[C].metadata||{},B=E.hiddenRows||[],A=B.length,z=[],D=0;for(;D<A;D++){z.push(B[D])}return z},hiddenColumns:function(B){var D=this.json[B].metadata||{},E=D.hiddenColumns||[],A=E.length,z=[],C=0;for(;C<A;C++){z.push(E[C])}return z},hasSpreadsheetAtIndex:function(z){return(this.json[z]!==undefined)},getSpreadsheetIndexByTitle:function(D){var B=this.json,z=this.count,A=0,C;D=D.toLowerCase();for(;A<z;A++){if(B[A]!==undefined){C=B[A].title;if(C!==undefined&&C!==null&&C.toLowerCase()==D){return A}}}return -1},addSpreadsheet:function(A,z){if(z===undefined){this.json.push(A)}else{this.json.splice(z,0,A)}this.count=this.json.length},getCellAttribute:function(z,A){return z[A]},setCellAttribute:function(z,A,B){z[A]=B},setCellAttributes:function(z,A){var B;for(B in A){if(A.hasOwnProperty(B)){z[B]=A[B]}}return this},setDependencies:function(A){if(A.dependencies.length>y.maxStoredDependencies){delete A.loadedFrom.dependencies;return this}var D=0,F=A.loadedFrom,E=A.dependencies,C,z=E.length,B=F.dependencies=[];for(;D<z;D++){C=E[D];B.push({s:C.sheetIndex,r:C.rowIndex,c:C.columnIndex})}return this},addDependency:function(z,A){var B=z.loadedFrom;if(B.dependencies===undefined){B.dependencies=[]}B.dependencies.push({s:A.sheetIndex,r:A.rowIndex,c:A.columnIndex});return this},cycleCells:function(F,E){var G=this.json,C,I,A,z,H,D,B;if((C=G[F])===undefined){return}if((D=(I=C.rows).length)<1){return}if(I[0].columns.length<1){return}D--;do{H=I[D];A=H.columns;B=A.length-1;do{z=A[B];E.call(z,F,D+1,B+1)}while(B-->0)}while(D-->0);return this},cycleCellsAll:function(B){var A=this.json,z=A.length-1;if(z<0){return}do{this.cycleCells(z,B)}while(z-->0);return this},toTables:function(){var T=this.json,S=this.count,I=x([]),E,K,F,B,C,M,L,O,z,V,H,N,U,J,D,A,G,R=0,Q,P;for(;R<S;R++){E=T[R];U=x(v.createElement("table"));if(E.title){U.attr("title",E.title||"")}I=I.add(U);K=E.rows;for(Q=0;Q<K.length;Q++){F=K[Q];if(N=(F.height+"").replace("px","")){A=x(v.createElement("tr")).attr("height",N).css("height",N+"px").appendTo(U)}B=F.columns;for(P=0;P<B.length;P++){C=B[P];G=x(v.createElement("td")).appendTo(A);if(C["class"]){G.attr("class",C["class"]||"")}if(C.style){G.attr("style",C.style||"")}if(C.formula){G.attr("data-formula",(C.formula?"="+C.formula:""))}if(C.cellType){G.attr("data-celltype",C.cellType||"")}if(C.value){G.html(C.value||"")}if(C.uneditable){G.html(C.uneditable||"")}if(C.rowspan){G.attr("rowspan",C.rowspan||"")}if(C.colspan){G.attr("colspan",C.colspan||"")}if(C.id){G.attr("id",C.id||"")}if(C.cache){G.html(C.cache)}}}if(M=E.metadata){if(L=M.widths){J=x(v.createElement("colgroup")).prependTo(U);for(P=0;P<L.length;P++){O=(L[P]+"").replace("px","");D=x(v.createElement("col")).attr("width",O).css("width",O+"px").appendTo(J)}}if(z=M.frozenAt){if(z.row){U.attr("data-frozenatrow",z.row)}if(z.col){U.attr("data-frozenatcol",z.col)}}if(V=M.hiddenRows){U.attr("data-hiddenrows",V.join(","))}if(H=M.hiddenColumns){U.attr("data-hiddencolumns",H.join(","))}}}return I},fromSheet:function(D){D=(D==undefined?false:D);var L=[],I=this.jS,R=1*I.i,N,E=I.spreadsheets.length-1,S,G,H,C,J,Q,B,z,O,K,M,P,F,A;if(E<0){return L}do{P=false;I.i=E;I.evt.cellEditDone();N=I.obj.pane();S={title:(I.obj.table().attr("title")||""),rows:[],metadata:{widths:[],frozenAt:{row:N.actionUI.frozenAt.row,col:N.actionUI.frozenAt.col}}};L.unshift(S);G=I.spreadsheets[E];H=G.length-1;do{F=G[H][1].td[0].parentNode;A=F.style.height;Q={columns:[],height:(A?A.replace("px",""):I.s.colMargin)};C=G[H].length-1;do{z=G[H][C];B={};O=z.td[0].attributes;if(D||P||O["class"]||z.formula||z.value||O.style){P=true;K=(O["class"]?x.trim((O["class"].value||"").replace(I.cl.uiCellActive,"").replace(I.cl.uiCellHighlighted,"")):"");M=z.td[0].parentNode;Q.columns.unshift(B);if(!Q.height){Q.height=(M.style.height?M.style.height.replace("px",""):I.s.colMargin)}if(z.formula){B.formula=z.formula}if(z.cellType){B.cellType=z.cellType}if(z.value){B.value=z.value}if(z.uneditable){B.uneditable=z.uneditable}if(z.cache){B.cache=z.cache}if(z.id){B.id=z.id}if(O.style&&O.style.value){B.style=O.style.value}if(K.length){B["class"]=K}if(O.rowspan){B.rowspan=O.rowspan.value}if(O.colspan){B.colspan=O.colspan.value}if(H*1==1){S.metadata.widths.unshift(x(I.col(null,C)).css("width").replace("px",""))}}}while(C-->1);if(P){S.rows.unshift(Q)}}while(H-->1)}while(E--);I.i=R;return this.json=L},type:y,typeName:"Sheet.JSONLoader",clearCaching:function(){var I=this.json,B,J,K,C,D,H=0,G,F,E=I.length,z,A;for(;H<E;H++){B=I[H];K=B.rows;z=K.length;for(G=0;G<z;G++){J=K[G];D=J.columns;A=D.length;for(F=0;F<A;F++){C=D[F];delete C.cache;delete C.dependencies;delete C.parsedFormula}}}return this},download:function(G){G=G||500;var M=f.open(),F,L,N=this.json,D=0,K=N.length-1,A;if(M!==undefined){F=M.document;F.write('<html>	<head id="head"></head>	<body>		<div id="entry">		</div>	</body></html>');L=x(F.getElementById("entry"));while(D<=K){A=N[D];if(A.rows.length>G){var J={title:A.title,metadata:A.metadata,rows:[]},E=[],I=0,P,O=A.rows,H=O.length,C=1,z=0,B=function(R,Q){L.append(v.createElement("br"));L.append(x(v.createElement("a")).attr("download",A.title+"-part"+Q+".json").attr("href",URL.createObjectURL(new Blob([JSON.stringify(R)],{type:"application/json"}))).text(A.title+" - part "+Q))};B(J,C);while(I<H){if(z===G){z=0;C++;B(E,C);E=[]}E.push(O[I]);z++;I++}if(E.length>0){C++;B(E,C)}}else{L.append(v.createElement("br")).append(x(v.createElement("a")).attr("download",A.title+".json").attr("href",URL.createObjectURL(new Blob([JSON.stringify(A)],{type:"application/json"}))).text(A.title))}D++}F.close();M.focus()}}};y.maxStoredDependencies=100;return y})(jQuery,l,p);k.XMLLoader=(function(w,v){function x(y){if(y!==undefined){this.xml=w.parseXML(y);this.spreadsheets=this.xml.getElementsByTagName("spreadsheets")[0].getElementsByTagName("spreadsheet");this.count=this.xml.length}else{this.xml=null;this.spreadsheets=null;this.count=0}}x.prototype={size:function(A){var y=this.xml[A],B=y.rows,C=B[0],z=C.columns;return{rows:B.length,cols:z.length}},setWidth:function(G,D,B){var C=this.spreadsheets,F=C[G],E=F.getElementsByTagName("metadata")[0]||{},z=E.getElementsByTagName("width")||[],A=z[D],y=(A.textContent||A.text);B.style.width=y+"px"},setRowHeight:function(z,F,D){var B=this.spreadsheets,A,C,E,y;if((A=B[z])===undefined){return}if((C=A.getElementsByTagName("rows")[0].getElementsByTagName("row"))===undefined){return}if((E=C[F])===undefined){return}if((y=E.attributes.height.nodeValue)===undefined){return}D.style.height=y+"px"},setupCell:function(G,B,A,y,C){var z=this.spreadsheets,F,H,D,E;if((F=z[G])===undefined){return false}if((H=F.getElementsByTagName("rows")[0].getElementsByTagName("row")[B-1])===undefined){return false}if((D=H.getElementsByTagName("columns")[0].getElementsByTagName("column")[A-1])===undefined){return false}y.cellType=D.attributes.cellType.nodeValue||"";if((E=D.jitCell)!==undefined){y.html=E.html;y.state=E.state;y.cellType=E.cellType;y.value=E.value;y.uneditable=E.uneditable;y.sheet=E.sheet;y.dependencies=E.dependencies}if(D.attributes.formula){y.formula=D.attributes.formula.nodeValue||"";C.setAttribute("data-formula",D.attributes.formula.nodeValue||"")}else{C.innerHTML=y.value=D.attributes.value.nodeValue||""}C.className=D.attributes["class"].nodeValue||"";C.setAttribute("style",D.attributes.style.nodeValue||"");if(D.attributes.rowspan){C.setAttribute("rowspan",D.attributes.rowspan.nodeValue||"")}if(D.attributes.colspan){C.setAttribute("colspan",D.attributes.colspan.nodeValue||"")}return true},getCell:function(y,A,z){return null},jitCell:function(z,E,C){var B=this.spreadsheets,A,D,y;if((A=B[z])===undefined){return false}if((D=A.getElementsByTagName("rows")[0].getElementsByTagName("row")[E-1])===undefined){return false}if((y=D.getElementsByTagName("columns")[0].getElementsByTagName("column")[C-1])===undefined){return false}return{td:{cellIndex:C,parentNode:{rowIndex:E},html:function(){}},html:[],state:[],cellType:y.attributes.cellType.nodeValue||"",formula:y.attributes.formula.nodeValue||"",value:y.attributes.value.nodeValue||"",type:"cell",sheet:z,id:null}},title:function(z){var A=this.spreadsheets,y;if((y=A[z])===undefined){return""}return(y.attributes.title?y.attributes.title.nodeValue:"")},getSpreadsheetIndexByTitle:function(y){},addSpreadsheet:function(y,z){if(z===undefined){this.spreadsheets.append.push(jsonSpreadsheet)}else{this.json.splice(z,0,jsonSpreadsheet)}this.count=this.json.length},setCellAttribute:function(y,z,A){},toTables:function(){var F=this.xml,J=w([]),D=F.getElementsByTagName("spreadsheets")[0].getElementsByTagName("spreadsheet"),G,N,H,B,E,W,Q,ac,P,M,O,T,R;for(var Z=0;Z<D.length;Z++){G=D[Z];var ab=w(v.createElement("table")).attr("title",(G.attributes.title?G.attributes.title.nodeValue:"")),L=w(v.createElement("colgroup")).appendTo(ab),z=w(v.createElement("tbody")).appendTo(ab);J=J.add(ab);N=G.getElementsByTagName("rows")[0].getElementsByTagName("row");Q=G.getElementsByTagName("metadata")[0];for(var X=0;X<N.length;X++){H=N[X];var A=w(v.createElement("tr")).appendTo(z);if(R=H.attributes.height){R=(R.nodeValue||"").replace("px","");A.css("height",R).attr("height",R+"px")}B=H.getElementsByTagName("columns")[0].getElementsByTagName("column");for(var V=0;V<B.length;V++){E=B[V];var I=w(v.createElement("td")).appendTo(A),y=E.getElementsByTagName("formula")[0],Y=E.getElementsByTagName("cellType")[0],U=E.getElementsByTagName("value")[0],aa=E.getElementsByTagName("style")[0],K=E.getElementsByTagName("class")[0],ad=E.getElementsByTagName("rowspan")[0],C=E.getElementsByTagName("colspan")[0],S=E.getElementsByTagName("id")[0];if(y){I.attr("data-formula","="+(y.textContent||y.text))}if(Y){I.attr("data-celltype",Y.textContent||Y.text)}if(U){I.html(U.textContent||U.text)}if(aa){I.attr("style",aa.textContent||aa.text)}if(K){I.attr("class",K.textContent||K.text)}if(ad){I.attr("rowspan",ad.textContent||ad.text)}if(C){I.attr("colspan",C.textContent||C.text)}if(S){I.attr("id",S.textContent||S.text)}}}O=Q.getElementsByTagName("width");for(var X=0;X<O.length;X++){T=(O[X].textContent||O[X].text).replace("px","");w(v.createElement("col")).attr("width",T).css("width",T+"px").appendTo(L)}ac=Q.getElementsByTagName("frozenAt")[0];if(ac){M=ac.getElementsByTagName("col")[0];P=ac.getElementsByTagName("row")[0];if(M){ab.attr("data-frozenatcol",(M.textContent||M.text)*1)}if(P){ab.attr("data-frozenatrow",(P.textContent||P.text)*1)}}}return J},fromSheet:function(K,E,F){E=(E==undefined?false:E);var N="",U=1*K.i,G=K.spreadsheets.length-1,z,I,J,D,L,S,T,B,A,Q,M,O,y,R,P,H,C;if(G<0){return N}do{R=false;K.i=G;K.evt.cellEditDone();y=w.extend({},K.obj.pane().actionUI.frozenAt);P=[];I=K.spreadsheets[G];J=I.length-1;S="";do{B="";D=I[J].length-1;do{T="";A=I[J][D];Q=A.td[0].attributes;M=(Q["class"]?w.trim((Q["class"].value||"").replace(K.cl.uiCellActive,"").replace(K.cl.uiCellHighlighted,"")):"");if(E||R||M||A.formula||A.value||Q.style){R=true;T+="<column>";if(A.formula){T+="<formula>"+A.formula+"</formula>"}if(A.cellType){T+="<cellType>"+A.cellType+"</cellType>"}if(A.value){T+="<value>"+A.value+"</value>"}if(Q.style){T+="<style>"+Q.style.value+"</style>"}if(M){T+="<class>"+M+"</class>"}if(Q.rowspan){T+="<rowspan>"+Q.rowspan.value+"</rowspan>"}if(Q.colspan){T+="<colspan>"+Q.colspan.value+"</colspan>"}if(Q.id){T+="<id>"+Q.id.value+"</id>"}T+="</column>";B=T+B;if(J*1==1){P[D]="<width>"+w(K.col(null,D)).css("width").replace("px","")+"</width>"}}}while(D-->1);if(B){H=I[J][1].td[0].parentNode;C=H.style.height;S='<row height="'+(C?C.replace("px",""):K.s.colMargin)+'"><columns>'+B+"</columns></row>"+S}}while(J-->1);z='<spreadsheet title="'+(K.obj.table().attr("title")||"")+'"><rows>'+S+"</rows><metadata>"+(y.row||y.col?"<frozenAt>"+(y.row?"<row>"+y.row+"</row>":"")+(y.col?"<col>"+y.col+"</col>":"")+"</frozenAt>":"")+"<widths>"+P.join("")+"</widths></metadata></spreadsheet>";N=z+N}while(G--);K.i=U;N='<?xml version="1.0" encoding="UTF-8"?><spreadsheets xmlns="http://www.w3.org/1999/xhtml">'+N+"</spreadsheets>";if(F!==true){this.xml=w.parseXML(N)}return N},type:x,typeName:"Sheet.XMLLoader"};return x})(jQuery,l);d.fn.extend({sheet:function(w){var x=isNaN,v=d.sheet.events;d(this).each(function(){var B=d(this),D=d.extend({},d.sheet.defaults,w||{}),C=this.jS;D.useStack=(f.thaw===undefined?false:D.useStack);D.useMultiThreads=(f.operative===undefined?false:D.useMultiThreads);if(C){var z=B.children().detach();C.kill();B.html(z);for(var A in v){if(v.hasOwnProperty(A)){B.unbind(v[A])}}}D.parent=B;if((this.className||"").match(/\bnot-editable\b/i)!=null){D.editable=false}for(var y in v){if(v.hasOwnProperty(y)){B.bind(v[y],D[v[y]])}}if(!d.sheet.instance.length){d.sheet.instance=[]}this.jS=C=d.sheet.createInstance(D,d.sheet.instance.length);d.sheet.instance.push(C)});return this},disableSelectionSpecial:function(){this.each(function(){this.onselectstart=function(){return false};this.unselectable="on";this.style["-moz-user-select"]="none"});return this},getSheet:function(){var v=this[0],w=(v.jS||{});return w},getCellValue:function(w,B,x,A){var y=this[0],z=(y.jS||{}),v;if(z.getCell){v=z.getCell(w,B,x);if(v!==null){v.updateValue(A)}}return this},setCellValue:function(z,y,A,D,C){var x=this[0],v=(x.jS||{}),B;D=(D||0);if(v.getCell&&(B=v.getCell(D,y,A))){try{if((z+"").charAt(0)=="="){B.valueOverride=B.value="";B.formula=z.substring(1)}else{B.value=z;B.valueOverride=B.formula=""}B.updateValue(C)}catch(w){}}return this},setCellFormula:function(x,z,A,D,C){var y=this[0],v=(y.jS||{}),B;D=(D||0);if(v.getCell){try{B=v.getCell(D,z,A);if(B!==null){B.formula=x;B.valueOverride=B.value="";B.updateValue(C)}}catch(w){}}return this},isSheetFullScreen:function(){var v=this[0],w=(v.jS||{});if(w.obj){return w.obj.fullScreen().is(":visible")}return false},serializeCellInputs:function(w){var x=this[0],y=(x.jS||{}),v=y.obj.tables().find(":input");if(w){return v.serializeArray()}else{return v.serialize()}},viewSource:function(v){var w="";d(this).each(function(){if(v){w+=d(this).toPrettySource()}else{w+=d(this).toCompactSource()}});d.printSource(w);return w},toCompactSource:function(){var z=this[0];var w="";if(z.nodeType==1){w+="<"+z.tagName.toLowerCase();var B=z.attributes.length;for(var y=0;y<B;y++){var x=z.attributes[y].name,A=z.getAttribute(x);if(A){if(x=="contentEditable"&&A=="inherit"){continue}if(typeof(A)=="string"){w+=" "+x+'="'+A.replace(/"/g,"'")+'"'}else{if(x=="style"&&A.cssText){w+=' style="'+A.cssText+'"'}}}}if(z.tagName=="COL"){w+="/>"}else{w+=">";var v="";d(z.childNodes).each(function(){v+=d(this).toCompactSource()});w+=v;w+="</"+z.tagName.toLowerCase()+">"}}else{if(z.nodeType==3){w+=z.data.replace(/^\s*(.*)\s*$/g,"$1")}}return w},toPrettySource:function(A){var z=this[0],C,y;A=A||"";var w="";if(z.nodeType==1){w+="\n"+A+"<"+z.tagName.toLowerCase();C=z.attributes.length;for(y=0;y<C;y++){var x=z.attributes[y].name,B=z.getAttribute(x);if(B){if(x=="contentEditable"&&B=="inherit"){continue}if(typeof(B)=="string"){w+=" "+x+'="'+d.trim(B.replace(/"/g,"'"))+'"'}else{if(x=="style"&&B.cssText){w+=' style="'+d.trim(B.cssText)+'"'}}}}if(z.childNodes.length<=0){if(z.tagName=="COL"){w+="/>"}else{w+="></"+z.tagName.toLowerCase()+">"}}else{w+=">";var v="";C=z.childNodes.length;for(y=0;y<C;y++){v+=d(z.childNodes[y]).toPrettySource(A+"  ")}w+=v;if(v.indexOf("\n")>=0){w+="\n"+A}w+="</"+z.tagName.toLowerCase()+">"}}else{if(z.nodeType==3){w+=z.data.replace(/^\s*(.*)\s*$/g,"$1")}}return w}});d.sheet={defaults:{editable:true,editableNames:true,barMenus:true,freezableCells:true,allowToggleState:true,menuLeft:null,menuRight:null,newColumnWidth:120,title:null,calcOff:false,lockFormulas:false,parent:null,colMargin:20,boxModelCorrection:2,formulaFunctions:{},formulaVariables:{},cellSelectModel:k.excelSelectModel,autoAddCells:true,resizableCells:true,resizableSheet:true,autoFiller:true,minSize:{rows:1,cols:1},error:function(v){return v.error},endOfNumber:false,frozenAt:[],contextmenuTop:{"Insert column after":function(v){v.controlFactory.addColumn(v.colLast);return false},"Insert column before":function(v){v.controlFactory.addColumn(v.colLast,true);return false},"Add column to end":function(v){v.controlFactory.addColumn();return false},"Delete this column":function(v){v.deleteColumn();return false},"Hide column":function(v){v.toggleHideColumn();return false},"Show all columns":function(v){v.columnShowAll()},"Toggle freeze columns to here":function(x){var v=x.getTdLocation(x.obj.tdActive()).col,w=x.obj.pane().actionUI;w.frozenAt.col=(w.frozenAt.col==v?0:v)}},contextmenuLeft:{"Insert row after":function(v){v.controlFactory.addRow(v.rowLast);return false},"Insert row before":function(v){v.controlFactory.addRow(v.rowLast,true);return false},"Add row to end":function(v){v.controlFactory.addRow();return false},"Delete this row":function(v){v.deleteRow();return false},"Hide row":function(v){v.toggleHideRow();return false},"Show all rows":function(v){v.rowShowAll()},"Toggle freeze rows to here":function(w){var x=w.getTdLocation(w.obj.tdActive()).row,v=w.obj.pane().actionUI;v.frozenAt.row=(v.frozenAt.row==x?0:x)}},contextmenuCell:{"Insert row after":function(v){v.controlFactory.addRow(v.rowLast);return false},"Insert row before":function(v){v.controlFactory.addRow(v.rowLast,true);return false},"Add row to end":function(v){v.controlFactory.addRow();return false},"Delete this row":function(v){v.deleteRow();return false},line2:"line","Insert column after":function(v){v.controlFactory.addColumn(v.colLast);return false},"Insert column before":function(v){v.controlFactory.addColumn(v.colLast,true);return false},"Add column to end":function(v){v.controlFactory.addColumn();return false},"Delete this column":function(v){v.deleteColumn();return false},line3:"line","Add spreadsheet":function(v){v.addSheet()},"Delete spreadsheet":function(v){v.deleteSheet()}},hiddenRows:[],hiddenColumns:[],alert:function(v){alert(v)},prompt:function(w,x,v){x(prompt(w,v))},confirm:function(x,v,w){if(confirm(x)){v()}else{if(w){w()}}},initCalcRows:1,initCalcCols:10,initScrollRows:0,initScrollCols:0,loader:null,useStack:true,useMultiThreads:true},instance:[],dependencies:{coreCss:{css:"jquery.sheet.css"},jQueryUI:{script:"jquery-ui/jquery-ui.min.js",thirdParty:true},jQueryUIThemeRoller:{css:"jquery-ui/themes/smoothness/jquery-ui.min.css",thirdParty:true},globalize:{script:"globalize/lib/globalize.js",thirdParty:true},nearest:{script:"jquery-nearest/src/jquery.nearest.min.js",thirdParty:true},mousewheel:{script:"MouseWheel/MouseWheel.js",thirdParty:true},operative:{script:"operative/dist/operative.js",thirdParty:true}},optional:{advancedFn:{script:"plugins/jquery.sheet.advancedfn.js"},financeFn:{script:"plugins/jquery.sheet.financefn.js"},colorPicker:{css:"really-simple-color-picker/colorPicker.css",script:"really-simple-color-picker/jquery.colorPicker.min.js",thirdParty:true},elastic:{script:"jquery-elastic/jquery.elastic.source.js",thirdParty:true},globalizeCultures:{script:"globalize/lib/cultures/globalize.cultures.js",thirdParty:true},raphael:{script:"raphael/raphael-min.js",thirdParty:true,async:false},gRaphael:{script:"graphael/g.raphael.js",thirdParty:true,async:false},gRaphaelBar:{script:"graphael/g.bar.js",thirdParty:true,async:false},gRaphaelDot:{script:"graphael/g.dot.js",thirdParty:true,async:false},gRaphaelLine:{script:"graphael/g.line.js",thirdParty:true,async:false},gRaphaelPie:{script:"graphael/g.pie.js",thirdParty:true,async:false},thaw:{script:"thaw.js/thaw.js",thirdParty:true},undoManager:{script:"Javascript-Undo-Manager/js/undomanager.js",thirdParty:true},zeroClipboard:{script:"zeroclipboard/dist/ZeroClipboard.min.js",thirdParty:true}},events:["sheetAddRow","sheetAddColumn","sheetSwitch","sheetRename","sheetTabSortStart","sheetTabSortUpdate","sheetCellEdit","sheetCellEdited","sheetCalculation","sheetAdd","sheetDelete","sheetDeleteRow","sheetDeleteColumn","sheetOpen","sheetAllOpened","sheetSave","sheetFullScreen","sheetFormulaKeydown"],preLoad:function(A,y){A=A||"";y=d.extend({skip:["globalizeCultures"],thirdPartyDirectory:"bower_components/"},y);var z=l.getElementsByTagName("script")[0],x=z.parentNode,w=function(){var B;if(this.script!==undefined){B=l.createElement("script");B.async=this.hasOwnProperty("async")?this.async:true;B.src=A+(this.thirdParty?y.thirdPartyDirectory:"")+this.script;x.insertBefore(B,z)}if(this.css!==undefined){B=l.createElement("link");B.rel="stylesheet";B.type="text/css";B.href=A+(this.thirdParty?y.thirdPartyDirectory:"")+this.css;x.insertBefore(B,z)}};for(var v in y.skip){if(this.dependencies[y.skip[v]]){delete this.dependencies[y.skip[v]]}if(this.optional[y.skip[v]]){delete this.optional[y.skip[v]]}}d.each(this.dependencies,function(){w.call(this)});d.each(this.optional,function(){w.call(this)})},createInstance:function(M,F){var L=this,C=function(O,I){var N=I.parentNode;if(N.lastchild==I){N.appendChild(O)}else{N.insertBefore(O,I.nextSibling)}},v=d(f),x=d(l),D=l.body,z=d(D),G=function(){},K=undefined,E=g,w=isNaN,J=NaN,A=f.thaw,B={version:"4.x",i:0,I:F,sheetCount:0,spreadsheets:[],controls:{autoFiller:[],bar:{helper:[],corner:[],x:{controls:[],handleFreeze:[],menu:[],menuParent:[],parent:[],th:[],ths:function(){var N=[],P=0,O=this.th[B.i],I=O.length;for(;P<I;P++){N.push(O[P])}return N}},y:{controls:[],handleFreeze:[],menu:[],parent:[],th:[],ths:function(){var N=[],P=0,O=this.th[B.i],I=O.length;for(;P<I;P++){N.push(O[P])}return N}}},barMenuLeft:[],barMenuTop:[],barLeft:[],barTop:[],barTopParent:[],chart:[],tdMenu:[],cellsEdited:[],enclosure:[],enclosures:null,formula:null,fullScreen:null,header:null,inPlaceEdit:[],inputs:[],label:null,menuLeft:[],menuRight:[],menus:[],pane:[],panes:null,scrolls:null,sheetAdder:null,table:[],tables:null,tab:[],tabContainer:null,tabs:null,title:null,toggleHide:{x:[],y:[]},ui:null},obj:{autoFiller:function(){return B.controls.autoFiller[B.i]||d([])},barCorner:function(){return B.controls.bar.corner[B.i]||d([])},barHelper:function(){return B.controls.bar.helper[B.i]||(B.controls.bar.helper[B.i]=d([]))},barLeft:function(I){return(B.controls.bar.y.th[B.i]&&B.controls.bar.y.th[B.i][I]?B.controls.bar.y.th[B.i][I]:[])},barLeftControls:function(){return B.controls.bar.y.controls[B.i]||d([])},barLefts:function(){return B.controls.bar.y.ths()},barHandleFreezeLeft:function(){return B.controls.bar.y.handleFreeze[B.i]||d([])},barMenuLeft:function(){return B.controls.bar.y.menu[B.i]||d([])},barTop:function(I){return(B.controls.bar.x.th[B.i]&&B.controls.bar.x.th[B.i][I]?B.controls.bar.x.th[B.i][I]:[])},barTopControls:function(){return B.controls.bar.x.controls[B.i]||d([])},barTops:function(){return B.controls.bar.x.ths()},barTopParent:function(){return B.controls.bar.x.parent[B.i]||d([])},barHandleFreezeTop:function(){return B.controls.bar.x.handleFreeze[B.i]||d([])},barMenuParentTop:function(){return B.controls.bar.x.menuParent[B.i]||d([])},barMenuTop:function(){return B.controls.bar.x.menu[B.i]||d([])},tdActive:function(){return B.cellLast.td||null},tdMenu:function(){return B.controls.tdMenu[B.i]||d([])},cellsEdited:function(){return(B.controls.cellsEdited!==K?B.controls.cellsEdited:B.controls.cellsEdited=[])},chart:function(){return B.controls.chart[B.i]||d([])},enclosure:function(){return B.controls.enclosure[B.i]||d([])},enclosures:function(){return B.controls.enclosures||d([])},formula:function(){return B.controls.formula||d([])},fullScreen:function(){return B.controls.fullScreen||d([])},header:function(){return B.controls.header||d([])},highlighted:function(){return B.highlighter.last||d([])},menuRight:function(){return B.controls.menuRight[B.i]||d([])},inPlaceEdit:function(){return B.controls.inPlaceEdit[B.i]||d([])},inputs:function(){return B.controls.inputs[B.i]||d([])},label:function(){return B.controls.label||d([])},menus:function(){return B.controls.menus[B.i]||d([])},menuLeft:function(){return B.controls.menuLeft[B.i]||d([])},pane:function(){return B.controls.pane[B.i]||{}},panes:function(){return B.controls.panes||d([])},parent:function(){return M.parent},scrolls:function(){return B.controls.scrolls||d([])},sheetAdder:function(){return B.controls.sheetAdder||d([])},table:function(){return B.controls.table[B.i]||d([])},tables:function(){return B.controls.tables||d([])},tab:function(){return B.controls.tab[B.i]||d([])},tabs:function(){return B.controls.tabs||d([])},tabContainer:function(){return B.controls.tabContainer||d([])},title:function(){return B.controls.title||d([])}},id:"jS_"+F+"_",cl:{autoFiller:"jSAutoFiller",autoFillerHandle:"jSAutoFillerHandle",autoFillerCover:"jSAutoFillerCover",barCorner:"jSBarCorner",barController:"jSBarController",barControllerChild:"jSBarControllerChild",barHelper:"jSBarHelper",barLeft:"jSBarLeft",barHandleFreezeLeft:"jSBarHandleFreezeLeft",barTop:"jSBarTop",barTopMenuButton:"jSBarTopMenuButton",barHandleFreezeTop:"jSBarHandleFreezeTop",barTopParent:"jSBarTopParent",chart:"jSChart",formula:"jSFormula",formulaParent:"jSFormulaParent",header:"jSHeader",fullScreen:"jSFullScreen",inPlaceEdit:"jSInPlaceEdit",menu:"jSMenu",menuFixed:"jSMenuFixed",parent:"jSParent",scroll:"jSScroll",sheetAdder:"jSSheetAdder",table:"jS",label:"jSLoc",pane:"jSEditPane",tab:"jSTab",tabContainer:"jSTabContainer",tabContainerScrollable:"jSTabContainerScrollable",tdMenu:"jSTdMenu",title:"jSTitle",enclosure:"jSEnclosure",ui:"jSUI"},msg:{addRowMulti:"How many rows would you like to add?",addColumnMulti:"How many columns would you like to add?",cellFind:"What are you looking for in this spreadsheet?",cellNoFind:"No results found.",dragToFreezeCol:"Drag to freeze column",dragToFreezeRow:"Drag to freeze row",addSheet:"Add a spreadsheet",openSheet:"Are you sure you want to open a different sheet?  All unsaved changes will be lost.",toggleHideRow:"No row selected.",toggleHideColumn:"No column selected.",loopDetected:"Loop Detected",newSheetTitle:"What would you like the sheet's title to be?",notFoundColumn:"Column not found",notFoundRow:"Row not found",notFoundSheet:"Sheet not found",setCellRef:"Enter the name you would like to reference the cell by.",sheetTitleDefault:"Spreadsheet {index}",maxRowsBrowserLimitation:"You've reached the maximum amount of rows this browser supports. Try using Chrome, FireFox, or Internet Explorer 9+",maxColsBrowserLimitation:"You've reached the maximum amount of columns this browser supports. Try using Chrome, FireFox, or Internet Explorer 9+",maxSizeBrowserLimitationOnOpen:"The spreadsheet you are loading is larger than the maximum size of cells this browser supports. Try using Chrome, Firefox, or Internet Explorer 9+. You can an proceed, but the spreadsheet may not work as intended.",cellLoading:"Loading..."},kill:function(){if(!B){return false}d(l).unbind("keydown");this.obj.fullScreen().remove();(this.obj.inPlaceEdit().destroy||G)();M.parent.trigger("sheetKill").removeClass(B.theme.parent).html("");delete M.parent[0].jS;this.obj.menus().remove();var I=d.sheet.events.length;for(var N=0;N<I;N++){M.parent.unbind(d.sheet.events[N])}d.sheet.instance.splice(F,1);return true},trigger:function(I,N){N=N||[];return M.parent.triggerHandler(I,[B].concat(N))},spreadsheetsToArray:function(I){if(I||B.spreadsheets.length==0){B.cycleCellsAll(function(O,P,N){B.createCell(O,P,N)})}return B.spreadsheets},spreadsheetToArray:function(N,I){I=(I?I:B.i);if(!B.spreadsheets[I]){B.cycleCells(function(P,Q,O){B.createCell(P,Q,O)})}return B.spreadsheets[I]},createCell:function(R,U,W,ab){var O,S,V,Z,ad,Y,P,Q,N,T,af,ae,I,aa,ac,ag,X;if((O=B.spreadsheets[R])===K){O=B.spreadsheets[R]=[]}if((S=O[U])===K){S=O[U]=[]}if((ad=B.controls.tables[R])===K){return null}if((Q=ad.tBody)===K){return null}if((N=Q.children[U])===K){return null}if((T=N.children[W])===K){return null}V=S[W]=T.jSCell=new k.Cell(R,T,B,B.cellHandler);I=T.getAttribute("data-formula");aa=T.getAttribute("data-celltype");ag=T.getAttribute("data-uneditable");X=T.getAttribute("id");if(I!==null){V.formula=I}if(aa!==null){V.cellType=aa;ac=true}if(ag!==null){V.uneditable=ag}if(X!==null){V.id=X}Z=T.textContent||T.innerText;switch(typeof(Z)){case"object":break;case"undefined":Z=new p();break;case"number":V.value=new s(Z);break;case"boolean":V.value=new t(Z);break;case"string":default:V.value=new p(Z);break}V.value.cell=V;V.calcCount=ab||0;V.needsUpdated=V.formula.length>0||ac;if(V.formula.length>0&&V.formula.charAt(0)=="="){V.formula=V.formula.substring(1)}Y=ad.colGroup;if((P=Y.children[W])===K){P=l.createElement("col");P.setAttribute("style","width:"+B.s.newColumnWidth+"px;");Y.appendChild(P)}if((ae=B.controls.bar.y.th[R])===K){ae=B.controls.bar.y.th[R]=[]}if(ae[U]===K){ae[U]=N.children[0]}if((af=B.controls.bar.x.th[R])===K){af=B.controls.bar.x.th[R]=[]}if(af[W]!==K){af[W]=Q.children[0].children[W]}return V},getCell:function(O,R,P){var N,Q,I;if((N=B.spreadsheets[O])===K||(Q=N[R])===K||(I=Q[P])===K){if(M.loader!==null){I=M.loader.jitCell(O,R,P)}}if(I===K||I===null){return null}I.sheetIndex=O;I.rowIndex=R;I.columnIndex=P;return I},getCellById:function(Q,N,R){var P=M.loader!==null,I,O;if(typeof N==="function"){O=-1;R=N}else{O=N;if(typeof O==="sting"){O=M.loader.getSpreadsheetIndexByTitle(O)}}if(P){I=M.loader.jitCellById(Q,O);if(R!==K&&I!==null){R.call(I);return this}return I}return null},getCells:function(I,S){var O=0,P=I.length,N=P-1,Q,U,R,T=[];for(;O<P;O++){Q=I[O];if(typeof Q==="string"){R=B.getCellById(Q)}else{U=Q;R=B.getCell(U.sheet,U.rowIndex,U.columnIndex)}if(R!==null){T.push(R)}}return T},updateCells:function(I,T){var O=0,P=I.length,N=P-1,Q,U,S,R=[];for(;O<P;O++){Q=I[O];if(typeof Q==="string"){S=B.getCellById(Q)}else{U=Q;S=B.getCell(U.sheet,U.rowIndex,U.columnIndex)}if(S!==null){if(T!==K){(function(V,W){V.updateValue(function(X){N--;R[W]=X;if(N<0){T.apply(B,R)}})})(S,O)}}else{N--}}},nav:false,setNav:function(O){var I=d.sheet.instance;for(var N=0;N<I.length;N++){(I[N]||{}).nav=false}B.nav=O},controlFactory:{addRowMulti:function(P,S,O,I,R){var N=(R?"row-init":"row");function Q(T){if(T){if(!w(T)){B.controlFactory.addCells(P,O,parseInt(T),N,I);B.trigger("sheetAddRow",[P,O,T])}}}if(!S){M.prompt(B.msg.addRowMulti,Q)}else{Q(S)}},addColumnMulti:function(P,S,O,I,R){var N=(R?"col-init":"col");function Q(T){if(T){if(!w(T)){B.controlFactory.addCells(P,O,parseInt(T),N,I);B.trigger("sheetAddColumn",[P,O,T])}}}if(!S){M.prompt(B.msg.addColumnMulti,Q)}else{Q(S)}},rowAdder:new k.RowAdder(),columnAdder:new k.ColumnAdder(),addCells:function(al,ar,Y,Q,ac){B.autoFillerHide();B.setDirty(true);B.setChanged(true);B.obj.barHelper().remove();var R,aa=B.obj.table(),ap=aa[0],aj=ap.pane,W=aj.actionUI,T=ap.tBody,am=ap.colGroup,ab=false,ah=B.obj.tdActive(),V=B.spreadsheets[B.i]||(B.spreadsheets[B.i]=[]),ak,U,af=B.cl.barLeft+" "+B.theme.bar,aq=B.cl.barTop+" "+B.theme.bar,X,Z=(M.loader!==null?M.loader:null),O=(Z!==null?function(au,at){return Z.getWidth(au,at)}:function(){return M.newColumnWidth}),ae=(Z!==null?function(at,au){return Z.getHeight(at,au)}:function(){return M.colMargin}),ag=(Z!==null?Z.setupCell:function(au,ax,av,at){var aw=l.createElement("td");return new k.Cell(B.i,aw,B,B.cellHandler)}),P=B.controls.bar.x.th[B.i]||(B.controls.bar.x.th[B.i]=[]),N=B.controls.bar.y.th[B.i]||(B.controls.bar.y.th[B.i]=[]),ad=aj.size(),ao=ap.size(),I=l.createDocumentFragment(),ai=0,S=W.yDetacher,an=false;Y=Y||1;Q=Q||"col";switch(Q){case"row-init":case"row":ai=S.detachedAbove.length-1;ai=ai>0?ai:0;if(al===K||al===null){al=ao.rows+ai;ab=true}if(al>ad.rows){al=ad.rows;ab=true}R=al;if(R>ao.rows){R=ao.rows}else{if(al===0){ar=false}}if(ab){an=S.isBelowActive();if(an){al+=S.detachedBelow.length-1}}X={row:al,col:0};ak=this.rowAdder;if(ak.setQty(Y,ao)===false){if(!B.isBusy()){M.alert(B.msg.maxRowsBrowserLimitation)}return}ak.setCreateBarFn(function(au,aw){var av=l.createElement("tr"),ax=l.createElement("th");ax.className=af;ax.entity="left";ax.type="bar";ax.style.height=ae(B.i,au)+"px";ax.innerHTML=ax.label=au;av.appendChild(ax);if(aw){S.hidden[au]=av}else{if(an){S.detachedBelow.push(av)}else{I.appendChild(av)}}if(V.length===0){N[au]=ax;V[au]=[]}else{N.splice(au,0,ax);V.splice(au,0,[])}return av});ak.setCreateCellFn(function(az,aw,av,ax){var au=ag.call(Z,B.i,az,aw,B),aA,ay=V[az];if(au===null){return}aA=au.td;aA.jSCell=au;if(ay.length===0){ay[aw]=au}else{ay.splice(aw,0,au)}au.updateValue();av.insertBefore(aA,av.children[aw])});ak.setHidden(S.hidden);ak.setAddedFinishedFn(function(at){T.insertBefore(I,ar?T.children[R]:T.children[R].nextSibling);U=at});break;case"col":case"col-init":if(al===K||al===null){al=ao.cols;ab=true}if(al>ad.cols){al=ad.cols;ab=true}R=al;if(R>ao.cols){R=ao.cols}else{if(al===0){ar=false}}X={row:0,col:al};ak=this.columnAdder;if(ak.setQty(Y,ao)===false){if(!B.isBusy()){M.alert(B.msg.maxColsBrowserLimitation)}return}ak.setCreateBarFn(function(aw){var ax=T.children[0],ay=l.createElement("col"),az=l.createElement("th"),av,au=T.children[1];ay.style.width=O(B.i,aw)+"px";az.entity="top";az.type="bar";az.innerHTML=az.label=h.columnLabelString(aw);az.className=aq;if(au===K){av=l.createElement("th");av.setAttribute("class",af);av.entity="left";av.type="bar";au=l.createElement("tr");au.style.height=ae(B.i,aw)+"px";au.appendChild(av);T.appendChild(au);av.innerHTML=au.rowIndex;N.splice(0,0,av)}am.insertBefore(ay,am.children[aw]);ax.insertBefore(az,ax.children[aw]);if(P.length===0){P[aw]=az}else{P.splice(aw,0,az)}return{bar:az,col:ay,barParent:ax}});ak.setCreateCellFn(function(az,aw,ax){var av=ag.call(Z,B.i,az,aw,B),aA,au,ay=V[az];if((S.detachedAbove.length-1)>=az){au=S.detachedAbove[az-1]}else{if(S.detachedAbove.length+T.children.length<az){au=S.detachedBelow[az-(S.detachedAbove.length+T.children.length)]}else{au=T.children[az]}}if(av===null){return}aA=av.td;if(ay===K){V[az]=ay=[]}if(ay.length===0){ay[aw]=av}else{ay.splice(aw,0,av)}av.updateValue();au.insertBefore(aA,au.children[aw])});ak.setAddedFinishedFn(function(at){B.refreshColumnLabels(al);U=at});break}ak.createCells(al,ao,ar);if(!ac&&ab!=true){B.offsetFormulas(X,U,ar)}if(aj.inPlaceEdit){aj.inPlaceEdit.goToTd()}if(ah&&ah[0]&&ah[0].cellIndex&&ah[0].parentNode){B.colLast=ah[0].cellIndex;B.rowLast=ah[0].parentNode.rowIndex+ai}return true},addRow:function(N,I){B.controlFactory.addCells(N,I,1,"row");B.trigger("sheetAddRow",[N,I,1])},addColumn:function(N,I){B.controlFactory.addCells(N,I,1,"col");B.trigger("sheetAddColumn",[N,I,1])},barLeft:function(P){var Q=P.tBody.children,O,N=Q.length-1,I=B.controls.bar.y.th[B.i]=[];if(N>0){do{O=l.createElement("th");I[N]=O;Q[N].insertBefore(O,Q[N].children[0])}while(N-->1)}},barTop:function(W){var N=W.colGroup,V=N.children,Q,O=W.tBody.children[0],S=l.createElement("col"),T=l.createElement("th"),R=l.createElement("tr"),P=0,U=B.controls.bar.x.th[B.i]=[];if(O===K){N.innerHTML=""}else{P=O.children.length;while(V.length>P){N.removeChild(V[V.length-1])}}S.style.width=S.style.minWidth=M.colMargin+"px";N.insertBefore(S,N.children[0]);R.appendChild(T);R.className=B.cl.barTopParent;W.tBody.insertBefore(R,W.tBody.children[0]);W.barTopParent=R;W.corner=T;T.col=S;B.controls.barTopParent[B.i]=d(R);Q=g.min(P,M.initCalcCols);if(Q>0){do{var I=l.createElement("th");U[Q]=I;if(!V[Q]){V[Q]=l.createElement("col");N.insertBefore(V[Q],S.nextSibling)}V[Q].bar=I;I.col=V[Q];R.insertBefore(I,T.nextSibling)}while(Q-->1)}W.barTop=B.controls.barTopParent[B.i].children();return R},barHandleFreeze:{top:function(O){if(B.isBusy()){return false}var I=B.obj.pane().actionUI,Y=I.frozenAt,U=I.scrolledArea;if(!(U.col<=(Y.col+1))){return false}B.obj.barHelper().remove();var Z=O.table,X=Z.tBody,P=X.children[0],R=P.children,T=d(R[Y.col+1]),W=T.position(),V,Q=d(O).offset(),S=l.createElement("div"),N=O.freezeHandleTop=d(S).appendTo(O).addClass(B.theme.barHandleFreezeTop+" "+B.cl.barHelper+" "+B.cl.barHandleFreezeTop).height(T.height()).css("left",(W.left-S.clientWidth)+"px").attr("title",B.msg.dragToFreezeCol);B.controls.bar.helper[B.i]=B.obj.barHelper().add(S);B.controls.bar.x.handleFreeze[B.i]=N;B.draggable(N,{axis:"x",start:function(){B.setBusy(true);V=d(l.createElement("div")).appendTo(O).css("position","absolute").addClass(B.theme.barFreezeIndicator+" "+B.cl.barHelper).height(O.table.corner.clientHeight).fadeTo(0,0.33)},drag:function(){var aa=B.nearest(N,R).prev();if(aa.length&&aa.position){V.width(aa.position().left+aa.width())}},stop:function(ac,aa){V.remove();B.setBusy(false);B.setDirty(true);var ab=B.nearest(N,R);B.obj.barHelper().remove();U.col=I.frozenAt.col=B.getTdLocation(ab[0]).col-1;B.autoFillerHide()},containment:[Q.left,Q.top,E.min(Q.left+O.table.clientWidth,Q.left+O.clientWidth-f.scrollBarSize.width),Q.top]});return true},left:function(O){if(B.isBusy()){return false}var O=B.obj.pane(),I=O.actionUI,X=I.frozenAt,T=I.scrolledArea;if(!(T.row<=(X.row+1))){return false}B.obj.barHelper().remove();var Y=O.table,W=Y.tBody,S=d(W.children[X.row+1].children[0]),V=S.position(),U,P=d(O).offset(),R=l.createElement("div"),Q=W.children,N=O.freezeHandleLeft=d(R).appendTo(O).addClass(B.theme.barHandleFreezeLeft+" "+B.cl.barHelper+" "+B.cl.barHandleFreezeLeft).width(S.width()).css("top",(V.top-R.clientHeight+1)+"px").attr("title",B.msg.dragToFreezeRow);B.controls.bar.helper[B.i]=B.obj.barHelper().add(R);B.controls.bar.y.handleFreeze[B.i]=N;B.draggable(N,{axis:"y",start:function(){B.setBusy(true);U=d(l.createElement("div")).appendTo(O).css("position","absolute").addClass(B.theme.barFreezeIndicator+" "+B.cl.barHelper).width(R.clientWidth).fadeTo(0,0.33)},drag:function(){var Z=B.nearest(N,Q).prev();if(Z.length&&Z.position){U.height(Z.position().top+Z.height())}},stop:function(ab,Z){U.remove();B.setBusy(false);B.setDirty(true);var aa=B.nearest(N,Q);B.obj.barHelper().remove();T.row=I.frozenAt.row=E.max(B.getTdLocation(aa.children(0)[0]).row-1,0);B.autoFillerHide()},containment:[P.left,P.top,P.left,E.min(P.top+O.table.clientHeight,P.top+O.clientHeight-f.scrollBarSize.height)]});return true},corner:function(){}},menu:function(O,I){var R,N=d([]),Q=B.theme.menuHover;switch(O){case"top":R=d(l.createElement("div")).addClass(B.theme.menu+" "+B.cl.tdMenu);B.controls.bar.x.menu[B.i]=R;break;case"left":R=d(l.createElement("div")).addClass(B.theme.menu+" "+B.cl.tdMenu);B.controls.bar.y.menu[B.i]=R;break;case"cell":R=d(l.createElement("div")).addClass(B.theme.menu+" "+B.cl.tdMenu);B.controls.tdMenu[B.i]=R;break}B.controls.menus[B.i]=B.obj.menus().add(R);R.mouseleave(function(){R.hide()}).bind("contextmenu",function(){return false}).appendTo(z).hide().disableSelectionSpecial();for(var P in I){if(I[P]){if(d.isFunction(I[P])){N.pushStack(d(l.createElement("div")).text(P).data("msg",P).click(function(){I[d(this).data("msg")].call(this,B);R.hide();return false}).appendTo(R).hover(function(){N.removeClass(Q);d(this).addClass(Q)},function(){d(this).removeClass(Q)}))}else{if(I[P]=="line"){d(l.createElement("hr")).appendTo(R)}}}}return R},barMenu:{top:function(O,I,N){if(B.isBusy()){return false}var Q=B.obj.barMenuTop().hide();if(!Q.length){Q=B.controlFactory.menu("top",M.contextmenuTop)}B.obj.menus().hide();if(!N){Q.css("left",(O.pageX-5)+"px").css("top",(O.pageY-5)+"px").show();return Q}var P=B.obj.barMenuParentTop().hide();if(!P.length){P=d(l.createElement("div")).addClass(B.theme.barMenuTop+" "+B.cl.barHelper+" "+B.cl.barTopMenuButton).append(d(l.createElement("span")).addClass("ui-icon ui-icon-triangle-1-s")).mousedown(function(R){P.parent().mousedown().mouseup();var S=P.offset();Q.css("left",(R.pageX-5)+"px").css("top",(R.pageY-5)+"px").show()}).blur(function(){if(Q){Q.hide()}});P.get(0).destroy=function(){P.remove();B.controls.bar.x.menuParent[B.i]=null};B.controls.bar.x.menuParent[B.i]=P}P.prependTo(N).show()},left:function(N,I){if(B.isBusy()){return false}B.obj.barMenuLeft().hide();if(I){B.obj.barHandleFreezeLeft().remove()}var O;O=B.obj.barMenuLeft();if(!O.length){O=B.controlFactory.menu("left",M.contextmenuLeft)}B.obj.menus().hide();O.css("left",(N.pageX-5)+"px").css("top",(N.pageY-5)+"px").show();return true},corner:function(){}},tdMenu:function(I){if(B.isBusy()){return false}B.obj.tdMenu().hide();var N=B.obj.tdMenu();if(!N.length){N=B.controlFactory.menu("cell",M.contextmenuCell)}B.obj.menus().hide();N.css("left",(I.pageX-5)+"px").css("top",(I.pageY-5)+"px").show();return true},header:function(){B.obj.header().remove();B.obj.sheetAdder().remove();B.obj.tabContainer().remove();var U=l.createElement("div"),O=l.createElement("table"),R=l.createElement("tr"),X,P,Y=l.createElement("td"),Z,Q,N,V,I;U.appendChild(O);O.appendChild(R);U.className=B.cl.header+" "+B.theme.control;B.controls.header=d(U);if(M.title){if(d.isFunction(M.title)){M.title=B.title(B,F)}Y.className=B.cl.title;B.controls.title=d(Y).html(M.title)}else{d(Y).hide()}R.appendChild(Y);function W(ab){if(d.isFunction(ab)){ab=d(ab.call(B))}else{ab=d(ab)}if(ab.is("ul")){ab.find("ul").hide().addClass(B.theme.menuUl);ab.find("li").addClass(B.theme.menuLi).hover(function(){d(this).find("ul:first").hide().show()},function(){d(this).find("ul:first").hide()})}return ab}if(B.isSheetEditable()){if(M.menuLeft){Q=l.createElement("td");Q.className=B.cl.menu+" "+B.cl.menuFixed+" "+B.theme.menuFixed;R.insertBefore(Q,Y);B.controls.menuLeft[B.i]=d(Q).append(W(M.menuLeft)).children().addClass(B.theme.menuFixed);B.controls.menuLeft[B.i].find("img").load(function(){B.sheetSyncSize()})}if(M.menuRight){N=l.createElement("td");N.className=B.cl.menu+" "+B.cl.menuFixed;R.appendChild(N);B.controls.menuRight[B.i]=d(N).append(W(M.menuRight)).children().addClass(B.theme.menuFixed);B.controls.menuRight[B.i].find("img").load(function(){B.sheetSyncSize()})}Z=l.createElement("td");Z.className=B.cl.label+" "+B.theme.control;B.controls.label=d(Z);V=l.createElement("textarea");V.className=B.cl.formula+" "+B.theme.controlTextBox;V.onkeydown=B.evt.formula.keydown;V.onkeyup=function(){B.obj.inPlaceEdit().value=this.value};V.onchange=function(){B.obj.inPlaceEdit().value=this.value};V.onpaste=B.evt.pasteOverCells;V.onfocus=function(){B.setNav(false)};V.onfocusout=function(){B.setNav(true)};V.onblur=function(){B.setNav(true)};B.controls.formula=d(V);var T=l.createElement("span");T.appendChild(V);X=l.createElement("table");P=l.createElement("tr");X.appendChild(P);U.appendChild(X);I=l.createElement("td");I.className=B.cl.formulaParent;I.appendChild(T);P.appendChild(Z);P.appendChild(I);P.appendChild(l.createElement("td"));B.resizableSheet(d(T),{minHeight:B.controls.formula.height(),maxHeight:78,handles:"s",resize:function(ac,ab){B.controls.formula.height(ab.size.height)},stop:function(){B.sheetSyncSize()}});var aa=d.sheet.instance;for(var S=0;S<aa.length;S++){(aa||{}).nav=false}B.setNav(true);d(l).keydown(B.evt.document.keydown)}return U},ui:function(){var I=l.createElement("div");I.setAttribute("class",B.cl.ui);B.obj.ui=I;return I},sheetAdder:function(){var I=l.createElement("span");if(B.isSheetEditable()){I.setAttribute("class",B.cl.sheetAdder+" "+B.cl.tab+" "+B.theme.tab);I.setAttribute("title",B.msg.addSheet);I.innerHTML="+";I.onmousedown=function(){B.addSheet();return false};I.i=-1}return B.controls.sheetAdder=d(I)},tabContainer:function(){var I=l.createElement("span"),N;I.setAttribute("class",B.cl.tabContainer);I.onmousedown=function(P){P=P||f.event;var O=(P.target||P.srcElement).i;if(O>=0){B.trigger("sheetSwitch",[O])}return false};I.ondblclick=function(P){P=P||f.event;var O=(P.target||P.srcElement).i;if(O>=0){B.trigger("sheetRename",[O])}return false};if(B.isSheetEditable()&&d.fn.sortable){return B.controls.tabContainer=d(I).sortable({placeholder:"ui-state-highlight",axis:"x",forceHelperSize:true,forcePlaceholderSize:true,opacity:0.6,start:function(P,O){N=O.item.index();B.trigger("sheetTabSortStart",[P,O])},update:function(P,O){B.trigger("sheetTabSortUpdate",[P,O,N])}})}return B.controls.tabContainer=d(I)},sheetUI:function(W,X,Q){B.i=Q;B.tuneTableForSheetUse(X);B.readOnly[Q]=(X.className||"").match(/\breadonly\b/i)!=null;var S=X.tBody.children.length>0,R=B.controlFactory.enclosure(X),P=B.s,N=P.hiddenRows[Q],V=P.hiddenColumns[Q],O=R.pane,I=d(O),T=function(ab){ab=ab||f.event;if(B.isBusy()){return false}if(B.isBar(ab.target)){var Z=ab.target.entity,aa=B.getBarIndex[Z](ab.target);if(aa<0){return false}if(B.evt.barInteraction.first==B.evt.barInteraction.last){B.controlFactory.barMenu[Z](ab,aa)}}else{B.controlFactory.tdMenu(ab)}return false};W.appendChild(R);B.controlFactory.barTop(X);B.controlFactory.barLeft(X);O.appendChild(X);if(B.isSheetEditable()){B.controlFactory.autoFiller(O)}if(B.isSheetEditable()){var U=B.obj.formula(),Y="";I.mousedown(function(Z){B.setNav(true);if(B.isBusy()){return false}if(B.isCell(Z.target)){if(Z.button==2){T.call(this,Z);B.evt.cellOnMouseDown(Z);return true}B.evt.cellOnMouseDown(Z);return false}if(B.isBar(Z.target)){if(Z.button==2){T.call(this,Z)}Y=Z.target.entity;B.evt.barInteraction.select(Z.target);return false}return true});O.onmouseup=function(){Y=""};O.onmouseover=function(ad){ad=ad||f.event;var ac=ad.target||ad.srcElement;if(B.isBusy()){return false}if(!B.isBar(ac)){return false}var ab=d(ac),Z=ac.entity,aa=B.getBarIndex[Z](ac);if(aa<0){return false}if(B.evt.barInteraction.selecting&&Z==Y){B.evt.barInteraction.last=aa;B.cellSetActiveBar(Z,B.evt.barInteraction.first,B.evt.barInteraction.last)}else{B.resizeBar[Z](ab,aa,O,X);if(B.isSheetEditable()){B.controlFactory.barHandleFreeze[Z](O);if(Z=="top"){B.controlFactory.barMenu[Z](ad,aa,ab)}}}return true};O.ondblclick=B.evt.cellOnDblClick;I.bind("contextmenu",T).disableSelectionSpecial().bind("cellEdit",B.evt.cellEdit)}B.createSpreadsheet(X,Q);if(P.loader!==null){N=P.loader.hiddenRows(Q);V=P.loader.hiddenColumns(Q)}else{if(N===K||N.length<1){N=X.getAttribute("data-hiddenrows");if(N!==null){N=c.toNumbers(N.split(","))}}if(V===K||V.length<1){V=X.getAttribute("data-hiddencolumns");if(V!==null){V=c.toNumbers(V.split(","))}}}R.actionUI.hide(N,V);B.checkMinSize(X);B.controlFactory.tab();B.setChanged(true)},enclosure:function(aa){var V=l.createElement("div"),R=d(V),I=new k.ActionUI(V,aa,B.cl.scroll,B.s.frozenAt[B.i],d.sheet.max),Z=I.scrollUI,O=I.pane,Y=aa.tBody,ab=Y.children,Q=aa.colGroup.children,U,T=0,W=0,P,N,X,S;aa.size=function(){return B.tableSize(aa)};O.size=function(){return B.sheetSize(aa)};O.scrollToX=function(){if(S){return}X=false;P=Z.scrollLeft;if(T!==P){T=P;X=I.scrollToPixelX(P)}};O.scrollToY=function(){S=false;N=Z.scrollTop;if(W!==N){S=I.scrollToPixelY(N,W>N);W=N}};O.updateX=function(){if(S){return}if(X){B.calcVisibleCol(I)}};O.updateY=function(){if(S){B.calcVisibleRow(I);B.updateYBarWidthToCorner(I)}};O.finishScroll=function(){if(X||S){B.obj.barHelper().remove();B.autoFillerGoToTd();if(O.inPlaceEdit){O.inPlaceEdit.goToTd()}}};U=[O.updateY,O.scrollToY,O.updateX,O.scrollToX,O.finishScroll];Z.onscroll=function(){this.scrollTop=0;this.scrollLeft=0;Z.onscroll=function(){if(B.isBusy()){return}A(U)}};Z.onmousedown=function(){B.obj.barHelper().remove()};V.actionUI=O.actionUI=I;V.scrollUI=O.scrollUI=Z;V.appendChild(Z);Z.scrollTop=0;Z.scrollLeft=0;O.setAttribute("class",B.cl.pane+" "+B.theme.pane);V.appendChild(O);V.setAttribute("class",B.cl.enclosure);V.pane=O;V.table=aa;O.table=aa;O.enclosure=V;O.$enclosure=R;aa.pane=O;aa.enclosure=V;aa.$enclosure=R;B.controls.pane[B.i]=O;B.controls.panes=B.obj.panes().add(O);B.controls.enclosure[B.i]=R;B.controls.enclosures=B.obj.enclosures().add(V);return V},tab:function(){var I=l.createElement("span"),N=B.controls.tab[B.i]=d(I).appendTo(B.obj.tabContainer());I.setAttribute("class",B.cl.tab+" "+B.theme.tab);B.sheetTab(true,function(O){I.innerHTML=O});I.i=B.i;B.controls.tabs=B.obj.tabs().add(N);return I},customTab:function(O){var I=l.createElement("span"),N=d(I).appendTo(B.obj.tabContainer());I.setAttribute("class",B.cl.tab+" "+B.theme.tab);I.innerHTML=O;return N},inPlaceEdit:function(S,N){S=S||B.obj.tdActive();if(S===null){S=B.rowTds(null,1)[1];B.cellEdit(S)}if(S===null){return}(B.obj.inPlaceEdit().destroy||G)();var R=B.obj.formula(),O=R.val(),I,Q,P=B.obj.pane();if(!S.isHighlighted){return}I=l.createElement("textarea");Q=d(I);P.inPlaceEdit=I;I.i=B.i;I.className=B.cl.inPlaceEdit+" "+B.theme.inPlaceEdit;I.td=S;I.goToTd=function(){this.offset=d(S).position();if(!this.offset.left&&!this.offset.right){d(I).hide()}else{this.setAttribute("style","left:"+(this.offset.left-1)+"px;top:"+(this.offset.top-1)+"px;width:"+this.td.clientWidth+"px;height:"+this.td.clientHeight+"px;min-width:"+this.td.clientWidth+"px;min-height:"+this.td.clientHeight+"px;")}};I.goToTd();I.onkeydown=B.evt.inPlaceEdit.keydown;I.onchange=I.onkeyup=function(){R[0].value=I.value};I.onfocus=function(){B.setNav(false)};I.onblur=I.onfocusout=function(){B.setNav(true)};I.onpaste=B.evt.pasteOverCells;I.destroy=function(){P.inPlaceEdit=null;B.cellLast.isEdit=(I.value!=O);I.parentNode.removeChild(I);B.controls.inPlaceEdit[I.i]=false};P.appendChild(I);I.onfocus();B.controls.inPlaceEdit[B.i]=I;Q.focus().val("").val(R[0].value);if(N){Q.select()}if(d.fn.elastic){d(I).elastic()}},autoFiller:function(P){if(!M.autoFiller){return false}var N=l.createElement("div"),I=l.createElement("div"),O=l.createElement("div");N.i=B.i;N.className=B.cl.autoFiller+" "+B.theme.autoFiller;I.className=B.cl.autoFillerHandle;O.className=B.cl.autoFillerCover;N.onmousedown=function(){var R=B.obj.tdActive();if(R){var Q=B.getTdLocation(R);B.cellSetActive(R,Q,true,B.autoFillerNotGroup,function(){var T=B.highlighted(),S=B.getTdLocation(T.last());B.fillUpOrDown(S.row<Q.row||S.col<Q.col);B.autoFillerGoToTd(R);B.autoFillerNotGroup=false})}return false};P.autoFiller=B.controls.autoFiller[B.i]=d(N);P.appendChild(N);return true}},autoFillerNotGroup:true,tsv:new TSV(),updateCellsAfterPasteToFormula:function(V){var U=0,T=B.obj.formula(),X=new a();V=V||T.val();var S={row:B.cellLast.row,col:B.cellLast.col},N=T.val(),P=N;if((S.row==0&&S.col==0)||N.length===0){return false}var Y=B.tsv.parse(N);if(!d.isArray(Y)){T.val(Y);B.fillUpOrDown(false,Y);return true}for(var R=0;R<Y.length;R++){B.cellLast.isEdit=true;var I=Y[R];for(var Q=0;Q<I.length;Q++){U++;var O=B.getTd(-1,R+S.row,Q+S.col);if(O===null){continue}O.row=S.row;O.col=S.col;if(O.length){if(!B.spreadsheets[B.i]||!B.spreadsheets[B.i][R+S.row]||!B.spreadsheets[B.i][R+S.row][Q+S.col]){continue}var W=B.spreadsheets[B.i][R+S.row][Q+S.col];if(W){M.parent.one("sheetPreCalculation",function(){if((I[Q]+"").charAt(0)=="="){W.formula=I[Q].substring(1);W.value="";O.setAttribute("data-formula",I[Q])}else{W.formula="";W.value=I[Q];O.removeData("formula")}});B.resolveCell(W);if(R==0&&Q==0){P=I[Q]}}}}}if(N!=P){T.val(P)}B.fillUpOrDown(false,P);B.evt.cellEditDone(true);return true},evt:{inPlaceEdit:{enter:function(I){if(I.shiftKey){return true}return B.evt.cellSetActiveFromKeyCode(I,true)},tab:function(I){if(I.shiftKey){return true}return B.evt.cellSetActiveFromKeyCode(I,true)},keydown:function(I){I=I||f.event;B.trigger("sheetFormulaKeydown",[true]);switch(I.keyCode){case r.ENTER:return B.evt.inPlaceEdit.enter(I);break;case r.TAB:return B.evt.inPlaceEdit.tab(I);break;case r.ESCAPE:B.evt.cellEditAbandon();return false;break}}},formula:{keydown:function(I){I=I||f.event;if(B.readOnly[B.i]){return false}if(B.cellLast.row<0||B.cellLast.col<0){return false}B.trigger("sheetFormulaKeydown",[false]);switch(I.keyCode){case r.C:if(I.ctrlKey){return B.evt.document.copy(I)}case r.X:if(I.ctrlKey){return B.evt.document.cut(I)}case r.Y:if(I.ctrlKey){B.evt.document.redo(I);return false}break;case r.Z:if(I.ctrlKey){B.evt.document.undo(I);return false}break;case r.ESCAPE:B.evt.cellEditAbandon();return true;break;case r.ENTER:B.evt.cellSetActiveFromKeyCode(I,true);return false;break;case r.UNKNOWN:return false}B.cellLast.isEdit=true},If:function(N,I){if(N){d(B.obj.tdActive()).dblclick();return true}return false}},document:{enter:function(I){if(!B.cellLast.isEdit&&!I.ctrlKey){d(B.obj.tdActive()).dblclick()}return false},tab:function(I){B.evt.cellSetActiveFromKeyCode(I)},findCell:function(I){if(I.ctrlKey){B.cellFind();return false}return true},redo:function(I){if(I.ctrlKey&&!B.cellLast.isEdit){B.undo.manager.redo();return false}return true},undo:function(I){if(I.ctrlKey&&!B.cellLast.isEdit){B.undo.manager.undo();return false}return true},copy:function(Q,N){var P=B.highlighted(true),R=B.obj.formula(),O=R.val(),I=B.toTsv(P,N);R.val(I).focus().select();x.one("keyup",function(){if(N){R.val("")}else{R.val(O)}});return true},cut:function(I){return this.copy(I,true)},pageUpDown:function(I){var P=B.sheetSize(),T=B.obj.pane(),O=T.clientHeight,Q=0,R=0,S,N;if(I){for(N=B.cellLast.row;N>0&&Q<O;N--){S=B.getTd(-1,N,1);if(S!==null&&!S.getAttribute("data-hidden")&&d(S).is(":hidden")){d(S).show()}Q+=S.parentNode.clientHeight}}else{for(N=B.cellLast.row;N<P.rows&&Q<O;N++){S=B.getTd(-1,N,1);if(S===null){continue}Q+=S.parentNode.clientHeight}}B.cellEdit(S);return false},keydown:function(I){I=I||f.event;if(B.readOnly[B.i]){return false}if(B.cellLast.row<0||B.cellLast.col<0){return false}var N=B.cellLast.td;if(B.nav){switch(I.keyCode){case r.DELETE:B.toTsv(null,true);B.obj.formula().val("");break;case r.TAB:B.evt.document.tab(I);break;case r.ENTER:B.evt.cellSetActiveFromKeyCode(I);break;case r.LEFT:case r.UP:case r.RIGHT:case r.DOWN:(I.shiftKey?B.evt.cellSetHighlightFromKeyCode(I):B.evt.cellSetActiveFromKeyCode(I));break;case r.PAGE_UP:B.evt.document.pageUpDown(true);break;case r.PAGE_DOWN:B.evt.document.pageUpDown();break;case r.HOME:case r.END:B.evt.cellSetActiveFromKeyCode(I);break;case r.V:if(I.ctrlKey){return B.evt.formula.If(!B.evt.pasteOverCells(I),I)}else{d(N).trigger("cellEdit");return true}break;case r.Y:if(I.ctrlKey){B.evt.document.redo(I);return false}else{d(N).trigger("cellEdit");return true}break;case r.Z:if(I.ctrlKey){B.evt.document.undo(I);return false}else{d(N).trigger("cellEdit");return true}break;case r.ESCAPE:B.evt.cellEditAbandon();break;case r.F:if(I.ctrlKey){return B.evt.formula.If(B.evt.document.findCell(I),I)}else{d(N).trigger("cellEdit");return true}break;case r.CAPS_LOCK:case r.SHIFT:case r.ALT:break;case r.CONTROL:B.obj.formula().focus().select();return true;break;default:if(B.obj.inPlaceEdit().td!==N){d(N).trigger("cellEdit")}return true;break}return false}}},pasteOverCells:function(N){N=N||f.event;if(N.ctrlKey||N.type=="paste"){var I=function(){B.updateCellsAfterPasteToFormula()};var O=x.one("keyup",function(){I();I=function(){};O.mouseup()}).one("mouseup",function(){I();I=function(){};O.keyup()});B.setDirty(true);B.setChanged(true);return true}return false},cellEditDone:function(I){var N=B.obj.inPlaceEdit(),O=d(N).is(":focus");(B.obj.inPlaceEdit().destroy||G)();if(B.cellLast.isEdit||I){var R=(O?d(N):B.obj.formula()),P=B.obj.tdActive();if(B.isFormulaEditable(P)){if(P&&B.cellLast.row>0&&B.cellLast.col>0){var U=R.val(),V=P.jSCell,Q=0,T=M.loader,S;if(!V.edited){V.edited=true;B.obj.cellsEdited().push(V)}M.parent.one("sheetPreCalculation",function(){V.parsedFormula=null;if(U.charAt(0)=="="){P.setAttribute("data-formula",U);V.formula=U}else{P.removeAttribute("data-formula");V.value=U;V.formula="";if((S=V.loadedFrom)!==K){T.setCellAttributes(S,{cache:K,formula:"",value:U})}}V.setNeedsUpdated()});B.resolveCell(V);B.cellLast.isEdit=false;B.trigger("sheetCellEdited",[V])}}}},cellEditAbandon:function(I){(B.obj.inPlaceEdit().destroy||G)();B.highlighter.clearBar().clear();if(!I){B.calc()}B.cellLast.td=null;B.cellLast.row=0;B.cellLast.col=0;B.rowLast=0;B.colLast=0;B.highlighter.start={row:0,col:0};B.highlighter.end={row:0,col:0};B.labelUpdate("",true);B.obj.formula().val("").blur();B.autoFillerHide();return false},cellSetHighlightFromKeyCode:function(Q){var P=B.highlightedLastOrdered(),O=B.sheetSize(),T=B.obj.tdActive(),R=B.getTdLocation(T),S=P.start,I=P.end,N=B.highlighter;switch(Q.keyCode){case r.UP:if(S.row<R.row){S.row--;S.row=E.max(S.row,1);break}I.row--;I.row=E.max(I.row,1);break;case r.DOWN:if(S.row===S.end){S.row++;S.row=E.min(S.row,O.rows);break}if(S.row<R.row){S.row++;S.row=E.max(S.row,1);break}I.row++;I.row=E.min(I.row,O.rows);break;case r.LEFT:if(S.col<R.col){S.col--;S.col=E.max(S.col,1);break}I.col--;I.col=E.max(I.col,1);break;case r.RIGHT:if(S.col<R.col){S.col++;S.col=E.min(S.col,O.cols);break}I.col++;I.col=E.min(I.col,O.cols);break}B.highlighter.start=S;B.highlighter.end=I;B.cycleCellArea(function(U){N.set(U.td)},S,I);return false},cellSetActiveFromKeyCode:function(Q,I){var R={row:B.cellLast.row,col:B.cellLast.col},P=false,O,N=false;switch(Q.keyCode){case r.UP:R.row--;break;case r.DOWN:R.row++;break;case r.LEFT:R.col--;break;case r.RIGHT:R.col++;break;case r.ENTER:R=B.evt.incrementAndStayInGrid(B.highlightedLastOrdered(),R,"row","col",Q.shiftKey);P=true;O=B.highlighted();if(O.length>1){N=true}else{if(!I){R.row+=(Q.shiftKey?-1:1)}if(M.autoAddCells&&R.row>B.sheetSize().rows){B.controlFactory.addRow()}}break;case r.TAB:R=B.evt.incrementAndStayInGrid(B.highlightedLastOrdered(),R,"col","row",Q.shiftKey);P=true;O=B.highlighted();if(O.length>1){N=true}else{if(!I){R.col+=(Q.shiftKey?-1:1)}if(M.autoAddCells&&R.col>B.sheetSize().cols){B.controlFactory.addColumn()}}break;case r.HOME:R.col=1;break;case r.END:R.col=B.obj.tdActive().parentNode.children.length-2;break}R.col=R.col||1;R.row=R.row||1;if(!B.cellLast.isEdit||P){var S=B.getTd(-1,R.row,R.col);if(S!==null){B.cellEdit(S,null,N);return false}}return true},incrementAndStayInGrid:function(P,Q,N,I,O){if(O){Q[N]--;if(Q[N]<P.start[N]){Q[N]=P.end[N];Q[I]--}if(Q[I]<P.start[I]){Q[I]=P.end[I]}}else{Q[N]++;if(Q[N]>P.end[N]){Q[N]=P.start[N];Q[I]++}if(Q[I]>P.end[I]){Q[I]=P.start[I]}}return Q},cellOnMouseDown:function(I){B.obj.formula().blur();if(I.shiftKey){B.getTdRange(I,B.obj.formula().val())}else{B.cellEdit(I.target,true)}},cellOnDblClick:function(I){if(B.isBusy()){return false}B.controlFactory.inPlaceEdit();return true},cellEdit:function(I){if(B.isBusy()){return false}B.controlFactory.inPlaceEdit(null,true);return true},barInteraction:{first:0,last:0,selecting:false,select:function(O){if(!O){return}if(!O.type=="bar"){return}var I=O.entity,N=B.getBarIndex[I](O);if(N<0){return false}B[I+"Last"]=N;B.evt.barInteraction.last=B.evt.barInteraction.first=N;B.cellSetActiveBar(I,B.evt.barInteraction.first,B.evt.barInteraction.last);B.evt.barInteraction.first=B.evt.barInteraction.last=B[I+"Last"]=N;B.evt.barInteraction.selecting=true;x.one("mouseup",function(){B.evt.barInteraction.selecting=false});return false}}},refreshColumnLabels:function(R){R=R||0;var N=B.obj.barMenuParentTop();if((N)&&(N.length)){var Q=N.get(0);if(d.isFunction(Q.destroy)){Q.destroy()}}var I=B.controls.bar.x.th[B.i],P;if(!I){return}for(var O=g.max(R,0);O<I.length;O++){if(O>0){P=I[O];P.innerHTML=P.label=h.columnLabelString(P.cellIndex)}}},refreshRowLabels:function(Q,I){Q=Q||0;var N=B.controls.bar.y.th[B.i],P;if(!N){return}I=I||N.length;for(var O=Q;O<I;O++){if(O>0){P=N[O];P.innerHTML=P.label=P.parentNode.rowIndex}}},isCell:function(I){if(I&&I.jSCell!==K){return true}return false},isBar:function(I){if(I&&I.tagName&&I.tagName=="TH"&&I.type&&I.type=="bar"){return true}return false},readOnly:[],isSheetEditable:function(I){I=I||B.i;return(M.editable==true&&!B.readOnly[I])},isFormulaEditable:function(I){if(M.lockFormulas){if(I.data("formula")!==K){return false}}return true},toggleFullScreen:function(){if(!B){return}B.evt.cellEditDone();var O=B.obj.fullScreen(),R=B.obj.pane();if(O.is(":visible")){v.unbind("jSResize");z.removeClass("bodyNoScroll");M.parent=O[0].origParent;M.parent.prepend(O.children());O.remove();B.sheetSyncSize();if(R.inPlaceEdit){R.inPlaceEdit.goToTd()}B.trigger("sheetFullScreen",[false])}else{z.addClass("bodyNoScroll");var P=d(M.parent),O=l.createElement("div"),N=d._data(M.parent[0],"events");O.className=B.cl.fullScreen+" "+B.theme.fullScreen+" "+B.cl.parent;O.origParent=P;M.parent=B.controls.fullScreen=d(O).append(P.children()).appendTo(z);v.bind("resize",function(){v.trigger("jSResize")}).bind("jSResize",function(){this.w=v.width();this.h=v.height();M.parent.width(this.w).height(this.h);B.sheetSyncSize();if(R.inPlaceEdit){R.inPlaceEdit.goToTd()}}).trigger("jSResize");P.trigger("sheetFullScreen",[true]);for(var Q in N){for(var I=0;I<N[Q].length;I++){M.parent.bind(Q,N[Q][I].handler)}}}},renameSheet:function(I){if(w(I)){return false}if(I>-1){B.sheetTab()}return true},switchSheet:function(I){if(w(I)){return false}if(I==-1){B.addSheet()}else{if(I!=B.i){B.setActiveSheet(I);if(M.loader===null){B.calc(I)}}}return true},tuneTableForSheetUse:function(O){var N=d(O);B.controls.table[B.i]=N.addClass(B.cl.table).addClass(B.theme.table).attr("id",B.id+B.i).attr("border","1px").attr("cellpadding","0").attr("cellspacing","0");O.spreadsheetIndex=B.i;B.formatTable(O);B.sheetDecorateRemove(false,N);B.controls.tables=B.obj.tables().add(O);var P=N.attr("data-frozenatrow")*1,I=N.attr("data-frozenatcol")*1;if(!B.s.frozenAt[B.i]){B.s.frozenAt[B.i]={row:0,col:0}}if(P){B.s.frozenAt[B.i].row=P}if(I){B.s.frozenAt[B.i].col=I}},createSpreadsheet:function(N,I){this.createSpreadsheetForArea(N,I)},createSpreadsheetForArea:function(ah,af,V,ae,aa,O,P){var X=B.rows(ah),Z,ai,Y=(M.loader!==null?M.loader:null),Q=M.colMargin+"px",ag=(Y!==null?Y.setRowHeight:function(ak,ao,an){var am,al,aj=Q;if((am=an.nextSibling)===K){return aj}if((al=am.style)===K){return aj}if(al.height!==K){aj=al.height}an.style.height=aj}),ab=0,ac=ah.pane,S,W,I,N,T=ac.actionUI,R=T.yDetacher,ad=R.isBelowActive();ab=ac.actionUI.yDetacher.detachedAbove.length;V=V||0;ae=ae||X.length-1;aa=aa||0;O=O||X[0].children.length-1;if(V===0&&aa===0){ah.spreadsheet=B.spreadsheets[af]=[]}Z=ae;if(Z<0){return}do{I=X[Z];ai=O;if(I===K){if(P){S=ab+X.length-1;if(ad){S+=R.detachedBelow.length-1}W=Z-S;B.controlFactory.addCells(null,false,W,"row-init");I=X[Z-ab]}else{continue}}do{if(I===K){if((I=R.detachedAbove[Z])===K){continue}}var U=I.children[ai];if(U===K){if(P){B.controlFactory.addCells(null,false,ai-(X[0].children.length-1),"col-init");U=I.children[ai]}else{continue}}if(Z>0&&ai>0){if(U===K){return}if(!U.jSCell){B.createCell(af,Z,ai)}}else{if(ai==0&&Z>0){U.type="bar";U.entity="left";U.innerHTML=row;U.className=B.cl.barLeft+" "+B.cl.barLeft+"_"+B.i+" "+B.theme.bar;ag.call(Y,af,Z,U)}if(Z==0&&ai>0){U.type="bar";U.entity="top";U.innerHTML=h.columnLabelString(ai);U.className=B.cl.barTop+" "+B.cl.barTop+"_"+B.i+" "+B.theme.bar}if(Z==0&&ai==0){U.type="bar";U.entity="corner";U.className=B.theme.bar+" "+B.cl.barCorner;B.controls.bar.corner[B.i]=U}}}while(ai-->aa)}while(Z-->V)},updateYBarWidthToCorner:function(I){var R=I.scrolledArea,W=I.table,T=W.tBody,U=W.corner,Q=g.min(M.initCalcRows+R.row,R.row+20,T.lastChild.rowIndex),S=T.children[Q],N,V,P,O=U.col;if(S===K){return}N=S.children[0];if(N.label===K){return}V=N.label+"";P=f.defaultCharSize.width*V.length;if(P!==O._width||O._width===K){O._width=P;O.style.width=(P)+"px"}},toggleHideRow:function(I){I=I||B.rowLast;if(!I){return}var N=B.obj.pane().actionUI;N.toggleHideRow(I);B.autoFillerGoToTd()},toggleHideRowRange:function(O,N){var I=B.obj.pane().actionUI;I.toggleHideRowRange(O,N);B.autoFillerGoToTd()},toggleHideColumn:function(I){I=I||B.colLast;if(!I){return}var N=B.obj.pane().actionUI;N.toggleHideColumn(I);B.autoFillerGoToTd()},toggleHideColumnRange:function(O,N){var I=B.obj.pane().actionUI;I.toggleHideColumnRange(O,N);B.autoFillerGoToTd()},rowShowAll:function(){B.obj.pane().actionUI.rowShowAll()},columnShowAll:function(){B.obj.pane().actionUI.columnShowAll()},merge:function(S){S=S||B.highlighted();if(!S.length){return}var Q=[],I=S[0],P=S[S.length-1],X=B.getTdLocation(I),N=B.getTdLocation(P),Z={},V={},U=0,W=0,R=S.length-1,Y,aa,O,T;if(X.row){B.setDirty(true);B.setChanged(true);if(X.row<N.row){Z.row=X.row;V.row=N.row;O=I}else{Z.row=N.row;V.row=X.row;O=P}if(O.getAttribute("rowSpan")||O.getAttribute("colSpan")){return false}if(X.col<N.col){Z.col=X.col;V.col=N.col}else{Z.col=N.col;V.col=X.col}W=(V.row-Z.row)+1;U=(V.col-Z.col)+1;T=B.getTdLocation(O);do{aa=S[R];Y=aa.jSCell;if(Y.formula||Y.value){Q.unshift(Y.formula?"("+Y.formula.substring(1)+")":Y.value)}M.parent.one("sheetPreCalculation",function(){if(aa.cellIndex!=T.col||aa.parentNode.rowIndex!=T.row){Y.formula=null;Y.value="";Y.defer=O.jSCell;aa.removeAttribute("data-formula");aa.removeAttribute("data-celltype");aa.innerHTML="";aa.style.display="none";aa.colSpan=U-(aa.cellIndex-O.cellIndex);aa.rowSpan=W-(aa.parentNode.rowIndex-O.parentNode.rowIndex)}});B.resolveCell(Y)}while(R--);O.jSCell.value=Q.join(" ");O.jSCell.formula=(O.jSCell.formula?Q.join(" "):"");O.style.display="";O.setAttribute("rowSpan",W);O.setAttribute("colSpan",U);B.resolveCell(O.jSCell);B.evt.cellEditDone();B.autoFillerGoToTd(O);B.cellSetActive(O,T)}return true},unmerge:function(N){N=N||B.highlighted();if(!N){return}var R=B.getTdLocation(N),S=new a(),U=E.max(N.getAttribute("rowSpan")*1,1)-1,I=E.max(N.getAttribute("colSpan")*1,1)-1,Q=U+R.row,O,T,P=[];if(U==0&&I==0){return false}do{O=R.col+I;do{T=B.getTd(-1,Q,O);if(T===null){continue}T.style.display="";T.removeAttribute("colSpan");T.removeAttribute("rowSpan");T.jSCell.defer=null;B.resolveCell(T.jSCell,S);P.push(T)}while(O-->R.col)}while(Q-->R.row);B.evt.cellEditDone();B.autoFillerGoToTd(N);B.cellSetActive(N,R);B.highlighter.set(P);return true},fillUpOrDown:function(T,U,W){B.evt.cellEditDone();W=W||B.highlighted(true);if(W.length<1){return false}var Q=B.obj.tdActive();if(W.length<1){return false}var R=B.getTdLocation(W[0].td),X=B.getTdLocation(W[W.length-1].td),I=B.getTdLocation(Q),O={row:0,col:0},N=U||Q.jSCell.value,V=false,P=W.length-1,S=function(){};U=U||Q.jSCell.value;if(P>=0){if(U.charAt&&U.charAt(0)=="="){if(P>=0){do{if(!T){O.row=I.row-X.row;O.col=I.col-X.col}else{O.row=I.row-R.row;O.col=I.col-R.col}N=B.reparseFormula(U,O);M.parent.one("sheetPreCalculation",function(){W[P].formula=N;W[P].value="";W[P].td.setAttribute("data-formula",N)});B.resolveCell(W[P])}while(P--);return true}}else{if((V=!w(N))||N.length>0){if(V&&N!=""){N*=1;if(T){N-=W.length-1}S=function(){N++}}}do{M.parent.one("sheetPreCalculation",function(){W[P].formula="";W[P].value=N+"";W[P].td.removeAttribute("data-formula")});B.resolveCell(W[P]);S()}while(P--);return true}}return false},toTsv:function(W,P,U){W=W||B.highlighted(true);if(W.type){W=[W]}U=U||function(Z,Y){if(P){M.parent.one("sheetPreCalculation",function(){Y.formula="";Y.value=""});B.resolveCell(Y)}};var S=[],V,R,N={},O=W.length-1,X,I;if(O>=0){V=B.getTdLocation(W[0].td);R=B.getTdLocation(W[W.length-1].td);N.row=E.min(V.row,R.row);N.col=E.min(V.col,R.col);do{var Q=B.getTdLocation(W[O].td),T=(W[O].formula?"="+W[O].formula:W[O].value);X=E.abs(Q.row-N.row);I=E.abs(Q.col-N.col);if(!S[X]){S[X]=[]}if((T+="").match(/\n/)){T='"'+T+'"'}S[X][I]=(T||"");U.call(W[O].td,Q,W[O])}while(O-->0);O=S.length-1;do{S[O]=S[O].join("\t")}while(O-->0);return S.join("\n")}return""},offsetFormulas:function(S,R,O,Q){var N=B.sheetSize(),P={first:{row:1,col:1},last:{row:N.rows,col:N.cols}},I=[];B.cycleCells(function(){var T=this;if(this.formula&&typeof this.formula=="string"&&B.isFormulaEditable(this.td)){this.formula=B.reparseFormula(this.formula,R,S,O,Q);this.td.setAttribute("data-formula","="+this.formula)}I.push(function(){B.resolveCell(T,true)})},P.first,P.last);while(I.length){I.pop()()}B.evt.cellEditDone()},reparseFormula:function(Q,P,O,I,N){return Q.replace(h.regEx.cell,function(S,T,X,Y){if(T=="SHEET"){return S}P=P||{loc:0,row:0};var R={row:X*1,col:h.columnLabelIndex(T)},W,V,U={row:X,col:T,use:false};if(O){if(N){if(I){if(R.col&&R.col==O.col-1){U.col="#REF!";U.use=true}if(R.row&&R.row==O.row-1){U.row="#REF!";U.use=true}if(R.col>=O.col){W=true}if(R.row>=O.row){V=true}}else{if(O.col&&R.col==O.col){U.col="#REF!";U.use=true}if(O.row&&R.row==O.row){U.row="#REF!";U.use=true}if(O.col&&R.col>O.col){W=true}if(O.row&&R.row>O.row){V=true}}if(U.use){return U.col+U.row}if(W){R.col+=P.col;return B.makeFormula(R)}if(V){R.row+=P.row;return B.makeFormula(R)}}else{if(I){if(O.col&&R.col>=O.col){W=true}if(O.row&&R.row>=O.row){V=true}}else{if(O.col&&R.col>O.col){W=true}if(O.row&&R.row>O.row){V=true}}if(W){R.col+=P.col;return B.makeFormula(R)}if(V){R.row+=P.row;return B.makeFormula(R)}}}else{return B.makeFormula(R,P)}return S})},makeFormula:function(N,I){I=d.extend({row:0,col:0},I);N.col+=I.col;N.row+=I.row;if(N.col<0){N.col=0}if(N.row<0){N.row=0}return h.parseCellName(N.col,N.row)},cycleCells:function(Q,T,O,N){N=N||B.i;T=T||{row:1,col:1};if(!O){var V=B.sheetSize();O={row:V.rows,col:V.cols}}var I=B.spreadsheets[N],P=O.row,S,U,R;if(P<T.row){return}do{S=O.col;U=I[P];do{R=U[S];Q.call(R,N,P,S)}while(S-->T.col)}while(P-->T.row)},cycleCellsAll:function(P){var Q=B.i,O,N,I;for(O=0;O<=B.sheetCount;O++){B.i=O;N=B.sheetSize();I={row:N.rows,col:N.cols};B.cycleCells(P,{row:0,col:0},I,O)}B.i=Q},cycleCellArea:function(U,Y,R,Q,V){var I={start:{},end:{}},T,X,Z,W,P=B.i,N={cell:[],td:[]},S=B.spreadsheets[P],O=(V?"unshift":"push");if(Q){I.start=Y;I.end=R}else{I.start.row=E.max(E.min(Y.row,R.row),1);I.start.col=E.max(E.min(Y.col,R.col),1);I.end.row=E.max(Y.row,R.row,1);I.end.col=E.max(Y.col,R.col,1)}T=I.end.row;do{X=I.end.col;Z=S[T]||null;do{if(Z){W=Z[X]||null;if(W){N.cell[O](W);N.td[O](W.td)}}}while(X-->I.start.col)}while(T-->I.start.row);if(U){U(N)}},formatTable:function(Z){var X=M.newColumnWidth+"px",S=M.colMargin+"px",N=Z.children,Q=N.length-1,P,O,V,I,T,Y,R,W=(M.loader!==null?M.loader:null),U=(W!==null?W.getWidth:function(aa,ab){return M.newColumnWidth});if(Q>-1){do{switch(N[Q].nodeName){case"TBODY":Y=true;V=N[Q];break;case"COLGROUP":R=true;I=N[Q];break}}while(Q--)}else{}if(!V){V=l.createElement("tbody");if(N.length>0){do{V.appendChild(N[0])}while(N.length)}}if(!I||I.children.length<1){I=l.createElement("colgroup");Z.appendChild(I);Z.appendChild(V);if(V.children.length>0){T=V.children[0];for(Q=0,P=g.min(T.children.length,M.initCalcCols);Q<P;Q++){O=l.createElement("col");O.style.width=U(B.i,Q)+"px";I.appendChild(O)}for(Q=0,P=g.min(V.children.length,M.initCalcRows);Q<P;Q++){V.children[Q].style.height=S}}}Z.tBody=V;Z.colGroup=I;Z.removeAttribute("width");Z.style.width=""},checkMinSize:function(Q){var O=B.tableSize(Q),R=M.minSize.rows||0,I=M.minSize.cols||0,P=B.obj.pane().actionUI,N=P.frozenAt;R=g.max((N.row>R?N.row+1:R),1,M.initScrollRows);I=g.max((N.col>I?N.col+1:I),1,M.initScrollCols);if(O.cols<I){I-=O.cols;if(P.hiddenColumns.length>0){I+=c.indexOfNearestLessThan(P.hiddenColumns,I)+1}B.controlFactory.addColumnMulti(null,I,false,true,true)}O=B.tableSize(Q);if(O.rows<R){R-=O.rows;B.controlFactory.addRowMulti(null,R,false,true,true)}},theme:null,highlighter:null,resizable:function(N,I){if(!N.data("resizable")){N.resizable(I)}},busy:[],setBusy:function(I){if(I){B.busy.push(I)}else{B.busy.pop()}},isBusy:function(){return(B.busy.length>0)},draggable:function(N,I){if(!N.data("jSdraggable")){N.data("jSdraggable",true).draggable(I)}},nearest:function(N,I){return d(N).nearest(I)},resizeBar:{top:function(R,O,T,N){B.obj.barTopControls().remove();var P=l.createElement("div"),S=d(P).addClass(B.cl.barController+" "+B.theme.barResizer).width(R.width()).prependTo(R),I,Q;B.controls.bar.x.controls[B.i]=B.obj.barTopControls().add(S);B.resizableCells(S,{handles:"e",start:function(V,U){B.autoFillerHide();B.setBusy(true);I=B.col(N,O);if(T.freezeHandleTop){T.freezeHandleTop.remove()}I.removeAttribute("width")},resize:function(V,U){I.style.width=U.size.width+"px";if(T.inPlaceEdit){T.inPlaceEdit.goToTd()}},stop:function(V,U){B.setBusy(false);if(T.inPlaceEdit){T.inPlaceEdit.goToTd()}B.followMe();B.setDirty(true)},minWidth:32});Q=P.children[0];Q.style.height=R.outerHeight()+"px";Q.style.position="absolute"},left:function(P,S,O,W){B.obj.barLeftControls().remove();var R=P.offset(),X=l.createElement("div"),U=d(X).addClass(B.cl.barController+" "+B.theme.barResizer).prependTo(P).offset({top:R.top,left:R.left}),V=P[0],Q=P.next()[0],Y=Q.parentNode,N=l.createElement("div"),I=d(N).addClass(B.cl.barControllerChild).height(P.height()).prependTo(U),T;B.controls.bar.y.controls[B.i]=B.obj.barLeftControls().add(U);B.resizableCells(I,{handles:"s",start:function(){B.autoFillerHide();B.setBusy(true);if(O.freezeHandleLeft){O.freezeHandleLeft.remove()}Y.removeAttribute("height");V.removeAttribute("height");Q.removeAttribute("height")},resize:function(aa,Z){X.style.height=Q.style.height=V.style.height=Y.style.height=Z.size.height+"px";if(O.inPlaceEdit){O.inPlaceEdit.goToTd()}},stop:function(aa,Z){B.setBusy(false);if(O.inPlaceEdit){O.inPlaceEdit.goToTd()}B.followMe();B.setDirty(true)},minHeight:15});T=N.children[0];T.style.width=P.outerWidth()+"px";T.style.position="absolute"},corner:function(){}},sheetDecorateRemove:function(N,I){I=I||B.obj.tables();I=(N?I.clone():I);I.find("td."+B.theme.tdActive).removeClass(B.theme.tdActive);I.find("td."+B.theme.tdHighlighted).removeClass(B.theme.tdHighlighted);return I},labelUpdate:function(N,I){if(!I){N=h.parseCellName(N.col,N.row);if(N){B.obj.label().text(N)}}else{B.obj.label().text(N)}},cellEdit:function(R,P,O){B.autoFillerNotGroup=true;B.evt.cellEditDone();if(R===null){return}var Q=B.getTdLocation(R),I=R.jSCell,N;if(I===K||I===null){return}if(I.uneditable){return}B.trigger("sheetCellEdit",[I]);if(R!==B.cellLast.td){B.followMe(R)}else{B.autoFillerGoToTd(R)}B.labelUpdate(Q);if(I.formula.length>0){N="="+I.formula}else{N=I.value}B.obj.formula().val(N).blur();B.cellSetActive(R,Q,P,false,null,O)},cellSetActive:function(Q,S,N,U,R,O){S=S||B.getTdLocation(Q);if(S.col!=K){B.cellLast.td=Q;B.cellLast.row=B.rowLast=S.row;B.cellLast.col=B.colLast=S.col;if(!O){B.highlighter.set(Q).setStart(S).setEnd(S)}if(Q===null){return}B.highlighter.setBar("left",Q.parentNode.firstChild).setBar("top",Q.parentNode.parentNode.firstChild.children[Q.cellIndex]);var T,V;switch(M.cellSelectModel){case k.excelSelectModel:case k.googleDriveSelectModel:T=function(){};V=function(){};break;case k.openOfficeSelectModel:T=function(W){if(B.isCell(W)){B.cellEdit(W)}};V=function(){};break}if(N){var I={},P=B.obj.pane();I.last=S;P.onmousemove=function(ae){ae=ae||f.event;var af=ae.target||ae.srcElement;if(B.isBusy()){return false}var W=B.highlighter.end=B.getTdLocation(af),ag=true,ah=B.highlighter;if(W.col<1||W.row<1||W.col==J||W.row==J){return false}if(U){ag=false;if(S.col==W.col||S.row==W.row){ag=true}}if((I.last.col!=W.col||I.last.row!=W.row)&&ag){T(af);B.cycleCellArea(function(aj){ah.set(aj.td)},S,W,false,true)}B.followMe(af);var Z=ae.clientY,aa=ae.clientX,ab=P.$enclosure.offset(),ai=B.getTdLocation(af),ac=ai.row,Y=ai.col,X=false,ad;if(w(ac)||w(Y)){return false}if(Z>ab.top){X=true;ac--}if(aa>ab.left){X=true;Y--}if(X){if(ac<1||Y<1){return false}ad=B.spreadsheets[B.i][ac][Y];B.followMe(ad.td,true)}I.last=W;return true};l.onmouseup=function(){P.onmousemove=null;P.onmousemove=null;P.onmouseup=null;l.onmouseup=null;if(R){R()}}}}},colLast:0,rowLast:0,cellLast:{td:[],row:0,col:0,isEdit:false},highlightedLastOrdered:function(){var N=this.highlighter,I={start:{},end:{}};I.start.row=g.min(N.start.row,N.end.row);I.start.col=g.min(N.start.col,N.end.col);I.end.row=g.max(N.start.row,N.end.row);I.end.col=g.max(N.start.col,N.end.col);return I},cellStyleToggle:function(S,R,P){P=P||B.highlighted();if(P.length<1){return false}B.setDirty(true);var T,Q,O=P.length-1,I=B.obj.cellsEdited(),N;if(O>=0){N=P[0].className.match(S);do{T=P[O];Q=d(T);if(R){Q.removeClass(R)}if(N){Q.removeClass(S)}else{Q.addClass(S)}if(!T.jSCell.edited){T.jSCell.edited=true;I.push(T.jSCell)}}while(O--);return true}return false},cellTypeToggle:function(Q,O){O=O||B.highlighted(true);if(O.length<1){return}var P=O.length-1,N=O[P].cellType==Q,I;if(P>=0){do{I=O[P];if(N){I.cellType=null}else{I.cellType=Q}I.updateValue()}while(P--)}},fontReSize:function(R,Q){Q=Q||B.highlighted();if(Q.length<1){return false}var N=0;switch(R){case"up":N=1;break;case"down":N=-1;break}var T,S,P=Q.length-1,O,I=B.obj.cellsEdited();if(P>=0){do{T=Q[P];S=d(T);O=(S.css("font-size")+"").replace("px","")*1;S.css("font-size",((O||10)+N)+"px");if(!T.jSCell.edited){T.jSCell.edited=true;I.push(T.jSCell)}}while(P--);return true}return false},cellHandler:null,calc:function(O,Q){O=(O===K?B.i:O);if(B.readOnly[O]||B.isChanged(O)===false&&!Q){return false}var N=M.loader,I;if(N!==null){N.cycleCells(O,function(R,T,S){I=N.jitCell(R,T,S);I.updateValue()})}else{var P=B.spreadsheetToArray(null,O);h.calc(O,P);B.trigger("sheetCalculation",[{which:"spreadsheet",sheet:P,index:O}])}B.setChanged(false);return true},calcAll:function(O){var N=0,I;if(M.loader!==null){I=M.loader.count;for(;N<I;N++){B.calc(N,O)}}else{I=B.spreadsheets.length;for(;N<I;N++){B.calc(N,O)}}},calcVisiblePos:{row:-1,col:-1},calcVisibleInit:function(W){W=W||B.i;var N=B.spreadsheetToArray(null,W)||[],P=g.min,Q=M.initCalcRows,I=M.initCalcCols,U=P(N.length-1,Q),X,R,T={row:-1,col:-1},S=[],V=function(){this.cell.rowIndex=this.rowIndex;this.cell.columnIndex=this.columnIndex;this.cell.updateValue()},O=function(){S.length=0;B.trigger("sheetCalculation",[{which:"spreadsheet",sheet:N,index:W}])};if(U>0){T.row=U;do{if(U>0&&(X=N[U])!==K){T.col=R=P(X.length-1,I);if(R>0){do{S.push({cell:X[R],rowIndex:U,columnIndex:R})}while(R-->1)}}}while(U-->1)}A(S,{each:V,done:O});this.calcVisiblePos=T;B.setChanged(false)},calcVisibleRow:function(X,U){U=U||B.i;var S=B.spreadsheetToArray(null,U)||[],Y=X.scrolledArea,ac=X.pane.size(),Z=M.initCalcRows,ab=M.initCalcCols,Q=g.max((Y.row+Z)-1,X.foldArea.row),O=g.max((Y.col+ab)-1,X.foldArea.col),aa=1,T,W,ae,af,ag=this.calcVisiblePos,N={row:Q,col:ag.col},I,V=[],P=function(){if(this.row===K){while(S[this.rowIndex]===K){B.createSpreadsheetForArea(X.table,U,this.rowIndex,this.rowIndex,this.colIndex,this.colIndex,true)}}else{if((this.cell=this.row[this.colIndex])===K){B.createCell(B.i,this.rowIndex,this.colIndex);this.cell=S[this.rowIndex][this.colIndex]}}if(this.cell!==K){this.cell.updateValue()}},ad=function(){V.length=0;B.trigger("sheetCalculation",[{which:"spreadsheet",sheet:S,index:U}])},R,ah=X.yDetacher.hidden;T=Q<ac.rows?Q:ac.rows;af=O<ac.cols?O:ac.cols;aa=ag.row;for(;aa<=T;aa++){ae=1;if(ah[aa]!==K){T++;N.row++}for(;ae<af;ae++){R=aa;W=S[aa];I=W!==K?W[ae]:K;V.push({row:W,cell:I,rowIndex:aa,colIndex:ae})}}this.calcVisiblePos=N;A(V,{each:P,done:ad});B.setChanged(false)},calcVisibleCol:function(I,ab){ab=ab||B.i;var R=B.spreadsheetToArray(null,ab)||[],O=I.scrolledArea,N=I.pane.size(),U=M.initCalcRows,P=M.initCalcCols,Q=g.max((O.row+U)-1,I.foldArea.row),T=g.max((O.col+P)-1,I.foldArea.col),X,ac,aa,Z,S=this.calcVisiblePos,V={row:S.row,col:S.col},W=[],Y=function(){if(this.row===K||this.cell===K){B.createSpreadsheetForArea(I.table,ab,this.rowIndex,this.rowIndex,this.colIndex,this.colIndex,true);this.row=R[this.rowIndex]}if(this.row===K){return}Z=this.row[this.colIndex];if(Z===K){return}Z.updateValue()};Q=Q<N.rows?Q:N.rows;T=T<N.cols?T:N.cols;X=Q;if(X>0&&T>0){do{aa=T;ac=R[X];W.push({row:ac,cell:ac!==K?ac[aa]:K,rowIndex:X,colIndex:aa})}while(X-->1)}this.calcVisiblePos=V;A(W,{each:Y});B.trigger("sheetCalculation",[{which:"spreadsheet",sheet:R,index:ab}]);B.setChanged(false)},resolveCell:function(I,N){var O=!I.needsUpdated;if(!N){B.undo.createCells([I],function(P){B.trigger("sheetPreCalculation",[{which:"cell",cell:I}]);B.setDirty(true);B.setChanged(true);I.updateValue(function(){B.trigger("sheetCalculation",[{which:"cell",cell:I}]);if(O){I.updateDependencies()}});return P})}else{B.trigger("sheetPreCalculation",[{which:"cell",cell:I}]);B.setDirty(true);B.setChanged(true);I.updateValue(function(){B.trigger("sheetCalculation",[{which:"cell",cell:I}]);if(O){I.updateDependencies()}})}},addSheet:function(I){I=I||{rows:25,cols:10};B.evt.cellEditAbandon();B.setDirty(true);B.controlFactory.sheetUI(B.obj.ui,d.sheet.makeTable(I),B.sheetCount);B.setActiveSheet(B.sheetCount);B.sheetCount++;B.sheetSyncSize();var N=B.obj.pane();if(N.inPlaceEdit){N.inPlaceEdit.goToTd()}B.trigger("sheetAdd",[B.i])},insertSheet:null,deleteSheet:function(N){var Q=N||B.i,P=B.controls.enclosures.toArray(),I;P.splice(Q,1);B.obj.barHelper().remove();B.obj.enclosure().remove();B.controls.enclosures=d(P);B.obj.menus().remove();B.obj.tabContainer().children().eq(B.i).remove();B.spreadsheets.splice(Q,1);B.controls.autoFiller.splice(Q,1);B.controls.bar.helper.splice(Q,1);B.controls.bar.corner.splice(Q,1);B.controls.bar.x.controls.splice(Q,1);B.controls.bar.x.handleFreeze.splice(Q,1);B.controls.bar.x.controls.splice(Q,1);B.controls.bar.x.menu.splice(Q,1);if(B.controls.bar.x.menuParent&&B.controls.bar.x.menuParent[Q]){B.controls.bar.x.menuParent.splice(Q,1)}B.controls.bar.x.parent.splice(Q,1);B.controls.bar.x.th.splice(Q,1);B.controls.bar.y.controls.splice(Q,1);B.controls.bar.y.handleFreeze.splice(Q,1);B.controls.bar.y.controls.splice(Q,1);B.controls.bar.y.menu.splice(Q,1);if(B.controls.bar.y.menuParent&&B.controls.bar.y.menuParent[Q]){B.controls.bar.y.menuParent.splice(Q,1)}B.controls.bar.y.parent.splice(Q,1);B.controls.bar.y.th.splice(Q,1);B.controls.barMenuLeft.splice(Q,1);B.controls.barMenuTop.splice(Q,1);B.controls.barLeft.splice(Q,1);B.controls.barTop.splice(Q,1);B.controls.barTopParent.splice(Q,1);B.controls.chart.splice(Q,1);B.controls.tdMenu.splice(Q,1);B.controls.enclosure.splice(Q,1);B.controls.fullScreen=null;B.controls.inPlaceEdit.splice(Q,1);B.controls.menus.splice(Q,1);B.controls.menuLeft.splice(Q,1);B.controls.menuRight.splice(Q,1);B.controls.pane.splice(Q,1);B.controls.tables.splice(Q,1);B.controls.table.splice(Q,1);for(I=Q+1;I<B.controls.tab.length;++I){var O=B.controls.tab[I].get(0);O.i--}B.controls.tab.splice(Q,1);B.controls.toggleHide.x.splice(Q,1);B.controls.toggleHide.y.splice(Q,1);B.readOnly.splice(Q,1);B.i=0;B.sheetCount--;B.sheetCount=E.max(B.sheetCount,0);if(B.sheetCount==0){B.addSheet()}B.setActiveSheet(B.i);B.setDirty(true);B.setChanged(true);B.trigger("sheetDelete",[Q])},deleteRow:function(S,R){var Q,I,P,U,W=B.sheetSize(),V,N=B.obj.pane(),T=N.table.tBody,O;if(S){I=P=S}else{I=E.min(B.highlighter.start.row,B.highlighter.end.row);P=E.max(B.highlighter.start.row,B.highlighter.end.row)}U=(P-I)+1;if(I<1||W.cols<2||U>=W.rows){return}Q=P;do{O=B.getTd(-1,Q,1);if(O===null){continue}V=O.parentNode;T.removeChild(V)}while(I<Q--);B.controls.bar.y.th[B.i].splice(I,U);B.spreadsheets[B.i].splice(I,U);B.refreshRowLabels(I);B.setChanged(true);B.offsetFormulas({row:I,col:0},{row:-U,col:0},false,true);B.setDirty(true);B.evt.cellEditAbandon();if(N.inPlaceEdit){N.inPlaceEdit.goToTd()}B.trigger("sheetDeleteRow",Q)},deleteColumn:function(S){var R,I,Q,U,W=B.sheetSize(),V,P,O=B.obj.pane();if(S){I=Q=S}else{I=E.min(B.highlighter.start.col,B.highlighter.end.col);Q=E.max(B.highlighter.start.col,B.highlighter.end.col)}U=(Q-I)+1;if(I<1||W.cols<2||U>=W.cols){return}R=Q;B.obj.barHelper().remove();do{var T=B.obj.table(),N=B.col(T[0],R);d(B.obj.barTop(R)).remove();d(N).remove()}while(I<R--);B.controls.bar.x.th[B.i].splice(I,U);P=B.spreadsheets[B.i].length-U;do{V=B.spreadsheets[B.i][P].splice(I,U);while(V.length>0){d(V.pop().td).remove()}}while(P-->1);B.refreshColumnLabels(I);B.setChanged(true);B.offsetFormulas({row:0,col:I},{row:0,col:-U},false,true);B.setDirty(true);B.evt.cellEditAbandon();if(O.inPlaceEdit){O.inPlaceEdit.goToTd()}B.trigger("sheetDeleteColumn",R)},sheetTab:function(N,P){var I="",O;if(N){O=B.obj.table();I=O.attr("title")||B.msg.sheetTitleDefault.replace(/[{]index[}]/gi,B.i+1);if(P){O.attr("title",I);P(I)}return I}else{if(B.isSheetEditable()&&M.editableNames){M.prompt(B.msg.newSheetTitle,function(Q){if(!Q){I=B.obj.table().attr("title");Q=(I?I:B.msg.sheetTitleDefault.replace(/[{]index[}]/gi,B.i+1))}else{B.setDirty(true);B.obj.table().attr("title",Q);B.obj.tab().html(Q);I=Q}if(P){P(d(l.createElement("div")).text(I).html())}},B.sheetTab(true));return null}}},followMe:function(P,I){P=P||B.obj.tdActive();if(P===null){return}var O=B.obj.pane(),N=O.actionUI;B.setBusy(true);N.putTdInView(P);B.setBusy(false);if(!I){B.autoFillerGoToTd(P)}},autoFillerGoToTd:function(P,N,I){if(!M.autoFiller){return}if(P===K){P=B.obj.tdActive()}if(P&&P.type=="cell"){N=N||P.clientHeight;I=I||P.clientWidth;if(!P.offsetHeight||!P.offsetWidth||!P.clientHeight||!P.clientWidth){B.autoFillerHide();return}var O=d(P).position();B.obj.autoFiller().show().css("top",((O.top+(N||P.clientHeight)-3)+"px")).css("left",((O.left+(I||P.clientWidth)-3)+"px"))}},autoFillerHide:function(){if(!M.autoFiller){return}B.obj.autoFiller().hide()},setActiveSheet:function(P,I){if(I!==K){P=I.i}else{P=P||0}if(B.cellLast.row>0||B.cellLast.col>0){B.evt.cellEditDone();B.obj.formula().val("")}var O=B.obj.enclosures(),N=O.length-1,Q,R;B.autoFillerHide();if(N>0){do{if(P!=N){Q=O[N];Q._scrollLeft=Q._scrollLeft||Q.scrollUI.scrollLeft;Q._scrollTop=Q._scrollTop||Q.scrollUI.scrollTop;Q.style.display="none"}}while(N-->0)}B.i=P;if(I!==K){Q=I.enclosure}else{Q=B.controls.enclosure[P][0]}Q.style.display="";B.highlighter.setTab(B.obj.tab());B.readOnly[P]=(Q.table.className||"").match(/\breadonly\b/i)!=null;R=Q.pane;if(R.inPlaceEdit){R.inPlaceEdit.goToTd()}Q.scrollUI.scrollLeft=Q._scrollLeft||Q.scrollUI.scrollLeft;Q.scrollUI.scrollTop=Q._scrollTop||Q.scrollUI.scrollTop;Q._scrollLeft=Q._scrollTop=null;Q.scrollUI.onscroll()},getSpreadsheetIndexByTitle:function(R){if(M.loader!==null){var Q=M.loader.getSpreadsheetIndexByTitle(R);return Q}var O=B.obj.tables(),I=O.length,P,N=0;for(;N<I;N++){P=O[N];if(P.getAttribute("title")==R){return P.spreadsheetIndex}}return null},openSheet:function(N){var O=N.length-1,I=function(){B.setBusy(true);var V=B.controlFactory.header(),U=B.controlFactory.ui(),P=B.controlFactory.sheetAdder(),R=B.controlFactory.tabContainer(),T,S={sizeCheck:function(W){if(d.sheet.max){var X=B.tableSize(W.table);if(X.rows>d.sheet.max||X.cols>d.sheet.max){B.trigger("sheetMaxSize",[W.table,W.i]);M.confirm(B.msg.maxSizeBrowserLimitationOnOpen,function(){W.load()})}else{W.load()}}else{W.load()}},initChildren:function(Y,X,W){B.controlFactory.sheetUI(Y,X,W);B.trigger("sheetOpened",[W])},done:function(W){B.sheetSyncSize();B.setActiveSheet(0);B.setDirty(false);B.setBusy(false);while(W.length>0){B.calcVisibleInit(B.i=W.pop())}B.trigger("sheetAllOpened")},lastIndex:O},Q;V.ui=U;V.tabContainer=R;U.header=V;U.sheetAdder=P;U.tabContainer=R;R.header=V;R.ui=U;M.parent.append(V).append(U).append(P).append(R);B.resizableSheet(M.parent,{minWidth:M.parent.width()*0.1,minHeight:M.parent.height()*0.1,start:function(){B.setBusy(true);B.obj.enclosure().hide();U.sheetAdder.hide();U.tabContainer.hide()},stop:function(){B.obj.enclosure().show();U.sheetAdder.show();U.tabContainer.show();B.setBusy(false);B.sheetSyncSize();var W=B.obj.pane();if(W.inPlaceEdit){W.inPlaceEdit.goToTd()}}});if(M.loader===null){for(T=0;T<N.length;T++){new k.SpreadsheetUI(T,U,N[T],S);B.sheetCount++}}else{B.insertSheet=function(aa,W,Z,Y){B.sheetCount++;aa=aa||null;Y=Y||l.createElement("table");Z=Z!==K?Z:true;W=W||B.sheetCount-1;if(aa!==null){loader.addSpreadsheet(aa)}if(!Y.hasAttribute("title")){Y.setAttribute("title",loader.title(W))}var ab=function(){B.obj.enclosure().hide();B.setBusy(true);var ac=new k.SpreadsheetUI(W,U,Y,S);B.setActiveSheet(-1,ac);B.calcVisibleInit(W);B.setBusy(false);B.sheetSyncSize()},X;if(Z){ab();return}X=B.controlFactory.customTab(Y.getAttribute("title")).mousedown(function(){ab();B.obj.tab().insertBefore(this);d(this).remove();return false});if(M.loader.isHidden(W)){X.hide()}};Q=new k.SpreadsheetUI(0,U,N[0],S);B.sheetCount++;if(N.length>1){for(T=1;T<N.length;T++){B.insertSheet(null,T,false,N[T])}B.i=0;Q.loaded()}}};if(B.isDirty){M.confirm(B.msg.openSheet,I)}else{I()}},newSheet:function(){M.parent.html(d.sheet.makeTable()).sheet(M)},sheetSyncSize:function(){var W=M.parent,S=W[0],Y=S.clientHeight,T=S.clientWidth,X=B.obj.tabContainer(),Z=X[0],I=Z.style,ac=f.scrollBarSize.width,N,ab,V,U,Q=B.obj.ui.style,R,ad,P,aa,O;if(!Y){Y=400;W.height(Y)}else{if(Y<200){Y=200;W.height(Y)}}O=Z.scrollLeft;I.width="";N=Z.clientWidth;ab=(T-(M.colMargin+ac));V=(T-M.colMargin*2)+"px";U=((M.colMargin+ac)+"px");if(N>ab){I.height=U;X.addClass(B.cl.tabContainerScrollable);Y-=ac}else{I.height=null;X.removeClass(B.cl.tabContainerScrollable)}I.width=V;Z.scrollLeft=O;Y-=B.obj.header().outerHeight()+M.boxModelCorrection;Y-=Z.clientHeight+M.boxModelCorrection;R=(Y-f.scrollBarSize.height-M.boxModelCorrection)+"px";ad=(T-f.scrollBarSize.width)+"px";P=(Y+"px");aa=(T+"px");B.obj.panes().each(function(){var ag=this.style,af=this.actionUI.scrollUI.style,ae=this.enclosure.style;ag.height=R;ag.width=ad;ae.height=af.height=P;ae.width=af.width=aa});Q.height=P;Q.width=aa},showSheets:function(){B.obj.tabContainer().children().each(function(I){d(this).show();if(M.loader!==null){M.loader.setMetadata(I,{hidden:false})}})},showSheet:function(I){B.obj.tabContainer().children().eq(I).show();if(M.loader!==null){M.loader.setMetadata(I,{hidden:false})}},hideSheet:function(I){B.obj.tabContainer().children().eq(I).hide();if(M.loader!==null){M.loader.setMetadata(I,{hidden:true})}},cellChangeStyle:function(O,P,I){I=I||B.highlighted(true);if(I.length<1){return false}B.setDirty(this);var N=I.length-1;if(N>=0){B.undo.createCells(I,function(Q){do{Q[N].td.css(O,P)}while(N--);return Q});return true}return false},cellFind:function(I){function N(P){var O=B.obj.table().children("tbody").children("tr");if(P){var Q=O.children('td:contains("'+P+'")');if(Q.length<1){Q=O.children('td:contains("'+P.toLowerCase()+'")')}if(Q.length<1){Q=O.children('td:contains("'+P.toUpperCase()+'")')}Q=Q.eq(0);if(Q.length>0){B.cellEdit(Q)}else{M.alert(B.msg.cellNoFind)}}}if(!I){M.prompt(B.msg.cellFind,N)}else{N(I)}},cellSetActiveBar:function(V,O,Q){var aa=B.sheetSize(),S=E.min(O,Q),X=E.max(O,Q),I={},W={},Z=function(ab){switch(M.cellSelectModel){case k.openOfficeSelectModel:this.row=(ab?I.row:W.row);this.col=(ab?I.col:W.col);this.td=B.getTd(-1,this.row,this.col);if(this.td!==null&&this.td!==B.cellLast.td){B.cellEdit(this.td,false,true)}break;default:this.row=(ab?W.row:I.row);this.col=(ab?W.col:I.col);this.td=B.getTd(-1,this.row,this.col);if(this.td!==null&&this.td!==B.cellLast.td){B.cellEdit(this.td,false,true)}break}},R=[],T=B.obj.pane().actionUI.scrolledArea,U=B.obj.table(),N,Y,P;switch(V){case"top":I.row=T.row;I.col=S;W.row=T.row;W.col=X;B.highlighter.start.row=1;B.highlighter.start.col=S;B.highlighter.end.row=aa.rows;B.highlighter.end.col=X;N=X;do{R.push(B.col(U[0],N))}while(N-->S);break;case"left":I.row=S;I.col=T.col;W.row=X;W.col=T.col;B.highlighter.start.row=S;B.highlighter.start.col=1;B.highlighter.end.row=X;B.highlighter.end.col=aa.cols;Y=X;do{P=B.getTd(-1,Y,1);if(P===null){continue}R.push(P.parentNode)}while(Y-->S);break;case"corner":I.row=1;I.col=1;W.col=aa.cols;W.row=aa.rows;R.push(U[0]);break}new Z(O>Q);B.highlighter.set(R)},getTdRange:function(P,U,S,T){B.cellLast.isEdit=true;var N=function(W){if(W.first.col>W.last.col||W.first.row>W.last.row){return{first:h.parseCellName(W.last.col,W.last.row),last:h.parseCellName(W.first.col,W.first.row)}}else{return{first:h.parseCellName(W.first.col,W.first.row),last:h.parseCellName(W.last.col,W.last.row)}}},R=function(Z){var W=N(Z),Y=U+"";Y=(Y.match(/=/)?Y:"="+Y);if(S||Y.charAt(Y.length-1)!="("){Y=Y+(S?S:"")+"("}var aa,X="";if(W.first!=W.last){aa=W.first+":"+W.last}else{aa=W.first}if(Y.charAt(Y.length-1)=="("){X=")"}return Y+aa+X},I="",O,Q,V;if(P){O={first:B.getTdLocation([P.target])};Q=B.obj.table().mousemove(function(W){O.last=B.getTdLocation([W.target]);I=R(O);if(!T){B.obj.formula().val(I);B.obj.inPlaceEdit().val(I)}});x.one("mouseup",function(){Q.unbind("mousemove");return I})}else{V=B.highlighted().not(B.obj.tdActive());if(V.length){O={first:B.getTdLocation(V.first()),last:B.getTdLocation(V.last())};I=R(O);if(!T){B.obj.formula().val(I);B.obj.inPlaceEdit().val(I)}return I}else{return""}}return""},getTd:function(Q,S,N){var O=(Q>-1?B.obj.tables()[Q]:B.obj.table()[0]),I,P,R;if(!O||!(I=O.tBody)||!(P=I.children[S])||!(R=P.children[N])){return null}return R},getTdLocation:function(P){var I={col:0,row:0},N=0,O=B.obj.pane();if(P===K||P===null){return I}if(P.parentNode===K||(P.parentNode.rowIndex+N)<0){return I}return{col:P.cellIndex,row:P.parentNode.rowIndex+N}},getBarIndex:{left:function(I){I=I||{};if(!I.parentNode||w(I.parentNode.rowIndex)){return -1}else{return I.parentNode.rowIndex}},top:function(I){I=I||{};if(w(I.cellIndex)){return -1}else{return I.cellIndex}},corner:function(){return 0}},time:{now:new a(),last:new a(),diff:function(){return E.abs(E.ceil(this.last.getTime()-this.now.getTime())/1000).toFixed(5)},set:function(){this.last=this.now;this.now=new a()},get:function(){return this.now.getHours()+":"+this.now.getMinutes()+":"+this.now.getSeconds()}},changed:[],isChanged:function(I){return B.changed[I||B.i]},setChanged:function(I){B.changed[B.i]=I},isDirty:false,setDirty:function(I){B.dirty=I},appendToFormula:function(I){var O=B.obj.formula(),N=O.val();if(N.charAt(0)!="="){N="="+N}O.val(N+I)},undo:{manager:(f.UndoManager?new UndoManager():{undo:G,redo:G,register:G}),cells:[],id:-1,createCells:function(I,N,Q){if(Q===K){B.undo.id++;Q=B.undo.id}var O=(new k.CellRange(I)).clone().cells,P=(N!==K?(new k.CellRange(N(I)).clone()).cells:O);O.id=Q;P.id=Q;B.undo.manager.add({undo:function(){B.undo.removeCells(O,Q)},redo:function(){B.undo.createCells(P,null,Q)}});if(Q!==B.undo.id){B.undo.draw(P)}return true},removeCells:function(N,P){var O=0,I=-1;if(N.id===P){I=O}if(I!==-1){B.undo.cells.splice(I,1)}B.undo.draw(N)},draw:function(O){var N,R,Q,I,P;for(N=0;N<O.length;N++){Q=O[N];P=B.getTdLocation(Q.td);I=B.spreadsheets[Q.sheetIndex][P.row][P.col];I.value=Q.value;I.formula=Q.formula;R=I.td=Q.td;I.dependencies=Q.dependencies;I.needsUpdated=Q.needsUpdated;I.calcCount=Q.calcCount;I.sheetIndex=Q.sheetIndex;I.rowIndex=P.row;I.columnIndex=P.col;I.state=Q.state;I.jS=Q.jS;R.setAttribute("style",Q.style);R.setAttribute("class",Q.cl);I.setNeedsUpdated();I.updateValue()}}},cols:function(I){I=I||B.obj.table()[0];if(!I){return[]}if(!I.colGroup){return[]}if(!I.colGroup.children){return[]}return I.colGroup.children},tables:function(V,Q){V=V||B.obj.tables();var U=[],O=V.length-1,N,X,T,I,Y,P,W,R,S;do{X=(Q?l.body.removeChild(V[O]):V[O].cloneNode(true));if((I=X.children[0])&&(Y=I.children[0])){I.removeChild(Y)}if(T=X.children[1]){R=T.children;W=R[0];T.removeChild(W);N=R.length-1;do{S=R[N];P=S.children[0];S.removeChild(P)}while(N-->0)}U[O]=X}while(O-->0);return B.sheetDecorateRemove(false,d(U))},col:function(N,I){N=N||B.obj.table()[0];var O=B.cols(N);if(I===K){I=O.length-1}return O[I]},rowTds:function(N,I){N=N||B.obj.table();var O=B.rows(N);if(!O.length){return[]}if(I==K){I=O.length-1}if(!O[I]){return[]}if(!O[I].children){return[]}return O[I].children},rows:function(I){I=I||B.obj.table()[0];if(I===K){return[]}if(I.tBody===K){return[]}if(I.tBody.children===K){return[]}return I.tBody.children},highlighted:function(N){var P=B.highlighter.last||d([]),Q=[],I,O;if(!(I=P)||!P.length||!(I=I[0])||!I.tagName){return N?Q:d(Q)}switch(I.tagName){case"TD":O=P.length-1;do{Q.unshift(N?P[O].jSCell:P[O])}while(O-->0);break;case"TR":O=P.length-1;do{if(P[O].tds){Q=Q.concat(N?P[O].jSCells:P[O].tds)}}while(O-->0);break;case"COL":P=P.filter("col");O=P.length-1;do{if(P[O].tds){Q=Q.concat(N?P[O].jSCells:P[O].tds)}}while(O-->0);break;case"TABLE":Q=(N?I.jSCells:I.tds);break}return N?Q:d(Q)},sheetSize:function(O){var N,R,I={},P=M.minSize||{rows:1,cols:1},Q;O=O||B.obj.table()[0];if((I.cols=M.initScrollCols)>0&&(I.rows=M.initScrollRows)>0){}else{N=B.rowTds(O);R=B.getTdLocation(N[N.length-1]);I.cols=R.col;I.rows=R.row}if(M.loader!==null){Q=M.loader.size(O.spreadsheetIndex);I.rows=g.max(Q.rows,I.rows,P.rows);I.cols=g.max(Q.cols,I.cols,P.cols)}return I},sortVerticalSelectAscending:function(){if(confirm("Do you want to extend your selection?")){B.sortVertical();return true}else{B.sortVerticalSingle(false);return true}},sortVerticalSelectDescending:function(){if(confirm("Do you want to extend your selection?")){B.sortVertical();return false}else{B.sortVerticalSingle(true);return false}},sortVertical:function(V){var T=B.highlighted(true),Q=T[0].td.parent().prev(),I=T.length,O=new a(),S=true,W=[],Y=[],R,U=0,X,N,P;while(U<I){X=T[U];P=X.td;if(!isNaN(X.value)){N=(new s(X.value.valueOf()))}else{S=false;N=(new p(X.value.valueOf()))}N.loc=B.getTdLocation(P);N.row=P.parentNode;N.col=P;N.cell=X;W.push(N);U++}if(V){if(S==false){W.sort(function(aa,Z){return Z-aa})}else{W.sort();W.reverse()}}else{if(S==true){W.sort(function(aa,Z){return aa-Z})}else{W.sort()}}B.undo.createCells(T);while(R=W.length){N=W.pop();Y=B.spreadsheets[B.i].splice(N.row.rowIndex,1);X=N.cell;X.value=N.valueOf();N.row.parentNode.removeChild(N.row);Q.after(N.row);N.row.children[0].innerHTML=Q[0].rowIndex+R;B.spreadsheets[B.i].splice(Q[0].rowIndex+1,0,Y[0]);B.track.call(X,true)}B.undo.createCells(T)},sortVerticalSingle:function(R){var P=B.highlighted(true),Q=P.length,O=0,N=[],I;while(O<Q){N.push(P[O].value);O++}if(R){N.sort(function(T,S){return S-T})}else{N.sort(function(T,S){return T-S})}while(P.length){I=P.pop();I.value=N[P.length];I.updateValue()}},sortHorizontalSelectAscending:function(){if(confirm("Do you want to extend your selection?")){B.sortHorizontal();return true}else{B.sortHorizontalSingle(false);return true}},sortHorizontalSelectDescending:function(){if(confirm("Do you want to extend your selection?")){B.sortHorizontal();return false}else{B.sortHorizontalSingle(true);return false}},sortHorizontal:function(V){var T=B.highlighted(true),ab=T[0].td[0],X=ab.cellIndex,I=ab.table.colGroup,ac=B.sheetSize().rows,N=T.length,P=new a(),S=true,Y=[],R,U=0,Z,aa,O,W,Q;while(U<N){Z=0;aa=T[U];Q=aa.td;if(!isNaN(aa.value)){O=new s(aa.value.valueOf())}else{S=false;O=new p(aa.value.valueOf())}O.tds=[];O.loc=B.getTdLocation(Q);O.tr=Q.parentNode;O.td=Q;O.cell=aa;while(Z<=ac){O.tds.push(B.obj.pane().table.children[1].children[Z].children[Q.cellIndex]);Z++}Y.push(O);U++}if(V){if(S==false){Y.sort(function(ae,ad){return ad-ae})}else{Y.sort();Y.reverse()}}else{if(S==true){Y.sort(function(ae,ad){return ae-ad})}else{Y.sort()}}B.undo.createCells(T);while(Y.length){O=Y.pop();while(O.tds.length>1){Q=O.tds.pop();W=Q.parentNode;aa=B.spreadsheets[B.i][W.rowIndex].splice(Q.cellIndex,1);W.insertBefore(Q,W.children[X]);Q.col=I.children[Y.length+Q.cellIndex-1];Q.barTop=Q.col.bar;aa.value=Q.jSCell.value;B.spreadsheets[B.i][W.rowIndex].splice(Q.cellIndex,0,aa[0]);B.resolveCell(aa,true)}}B.undo.createCells(T)},sortHorizontalSingle:function(R){var P=B.highlighted(true),Q=P.length,O=0,N=[],I;while(O<Q){N.push(P[O].value);O++}if(R){N.sort(function(T,S){return S-T})}else{N.sort(function(T,S){return T-S})}while(P.length){I=P.pop();I.value=N[P.length];I.updateValue()}},tableSize:function(V,S){var U,O,T,I,Q,N=V.pane,W=0,P=0,R=0;V=V||B.obj.table()[0];if((U=V.tBody)!==K&&(O=U.children)!==K&&(T=O[O.length-1])!==K&&(I=T.children)!==K&&(Q=I[I.length-1])!==K){if(S===true){W=T.rowIndex}else{W=T.rowIndex+R}P=Q.cellIndex}else{return{}}return{cols:P,rows:W}},toggleState:function(I){if(M.allowToggleState){var N=I||B.tables();if(M.editable){B.evt.cellEditAbandon();B.trigger("sheetSave",[N])}B.setDirty(false);B.setChanged(true);M.editable=!M.editable;B.kill();M.parent.html(N).sheet(M);M=null}},setCellRef:function(O){function N(Q){if(Q){B.s.formulaVariables[Q]=I.updateValue()}}var P=B.obj.tdActive(),I=P.jSCell;if(O){N(O)}else{M.prompt(B.msg.setCellRef,N)}},formulaParser:null,print:function(I,N){I=I||B.i;var P=f.open(),O;if(P!==K){O=P.document;O.write('<html>	<head id="head"></head>	<body>		<div id="entry" class="'+B.cl.parent+'" style="overflow: show;">		</div>	</body></html>');if(N!==true){d(O.getElementById("head")).append(d("style,link").clone())}d(O.getElementById("entry")).append(B.obj.pane().cloneNode(true));O.close();P.focus();P.print()}}},y=[],H;B.setBusy(true);M.parent[0].jS=B;if(!f.console){f.console={log:function(){}}}if(f.scrollBarSize===K){f.scrollBarSize=m()}if(f.defaultCharSize===K){f.defaultCharSize=j()}B.cellHandler=new k.CellHandler(B,h,d.sheet.fn);B.theme=new k.Theme(M.theme);B.highlighter=new k.Highlighter(B.theme.tdHighlighted,B.theme.barHighlight,B.theme.tabActive,function(){B.obj.pane().actionUI.redraw()});M.origHtml=M.parent.children().detach();M.parent.addClass(B.cl.parent);M.parent.bind("sheetSwitch",function(O,N,I){B.switchSheet(I)}).bind("sheetRename",function(O,N,I){B.renameSheet(I)});M.width=(M.width?M.width:M.parent.width());M.height=(M.height?M.height:M.parent.height());if(!d.nearest){B.nearest=G}B.resizableCells=B.resizableSheet=B.resizable;if(!d.ui){B.resizable=B.resizableCells=B.resizableSheet=B.draggable=G}else{if(!M.resizableCells){B.resizableCells=G}if(!M.resizableSheet){B.resizableSheet=G}}if(!d.support.boxModel){M.boxModelCorrection=0}if(!M.barMenus){B.controlFactory.barMenuTop=B.controlFactory.barMenuLeft=G}if(!M.freezableCells){B.controlFactory.barHandleFreeze.top=B.controlFactory.barHandleFreeze.left=G}if(M.calcOff){B.calc=G}if(!f.Raphael){h.chart=G}v.resize(function(){if(B&&!B.isBusy()){M.width=M.parent.width();M.height=M.parent.height();B.sheetSyncSize()}}).unload(function(){var O=k.Cell.threads,N=0,I=O.length;for(;N<I;N++){O[N].terminate()}});if(d.sheet.fn){d.sheet.fn=d.extend(d.sheet.fn,M.formulaFunctions);if(d.sheet.advancedfn){d.sheet.fn=d.extend(d.sheet.fn,d.sheet.advancedfn)}if(d.sheet.financefn){d.sheet.fn=d.extend(d.sheet.fn,d.sheet.financefn)}}M.title=M.title||M.parent.attr("title")||"";B.s=M;M.parent.addClass(B.theme.parent);if(M.origHtml.length){B.openSheet(M.origHtml)}else{if(M.loader!==null){M.loader.bindJS(B).bindHandler(B.cellHandler);while(y.length<M.loader.count){H=l.createElement("table");H.setAttribute("title",M.loader.title(y.length)||B.msg.sheetTitleDefault.replace(/[{]index[}]/gi,y.length+1));y.push(H)}B.openSheet(y)}else{B.openSheet([l.createElement("table")])}}B.setBusy(false);return B},makeTable:function(H,x,v){var F=l;H=H||{rows:25,cols:10};x=x||120;v=v||15;var G=l.createElement("table"),w=l.createElement("colgroup"),E=l.createElement("tbody"),B="width:"+x+"px;",z="height:"+v+"px;",D,y,C,A;C=H.cols;do{y=l.createElement("col");y.setAttribute("style",B);w.appendChild(y)}while(C-->1);C=H.rows;do{D=l.createElement("tr");D.setAttribute("style",z);A=H.cols;do{D.appendChild(l.createElement("td"))}while(A-->1);E.appendChild(D)}while(C-->1);G.appendChild(w);G.appendChild(E);return G},killAll:function(){if(d.sheet){var v=d.sheet.instance;if(v){for(var w=0;w<v.length;w++){if(v[w]&&v[w].kill){v[w].kill()}}d.sheet.instance=[]}}},scrollLocker:function(w){var v=d.sheet.instance;v[w].obj.panes().each(function(x){var y;d(y=this.scrollUI).scroll(function(A){var z=v.length-1,B;if(z>-1){do{B=v[z].controls.enclosure[x][0].scrollUI;if(this!==B){B.scrollLeft=y.scrollLeft;B.scrollTop=y.scrollTop}}while(z--)}})})},switchSheetLocker:function(v){d.each(d.sheet.instance,function(){this.s.parent.bind("sheetSwitch",function(y,x,w){d.each(d.sheet.instance,function(){this.setActiveSheet(w)})})})},I:function(){var v=0;if(this.instance){v=(this.instance.length===0?0:this.instance.length-1)}else{this.instance=[]}return v}};var h=d.sheet.engine={calc:function(y,w,z){w=w||[];var B=w.length-1,A,x,v;if(B>0){do{if(B>0&&w[B]){A=w[B];x=A.length-1;if(x>0){do{v=A[x];v.updateValue()}while(x-->1)}}}while(B-->1)}},parseLocation:function(v,w){return{row:parseInt(w),col:h.columnLabelIndex(v)}},parseSheetLocation:function(w){var v=((w+"").replace(/SHEET/i,"")*1)-1;return isNaN(v)?-1:v},parseCellName:function(v,w){return h.columnLabelString(v)+(w||"")},alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ".split(""),columnLabels:{},columnLabelIndex:function(v){return this.columnLabels[v.toUpperCase()]},columnIndexes:[],columnLabelString:function(y){if(!this.columnIndexes.length){var A="",z,x,w,v;z=x=w=-1;for(v=1;v<16385;++v){A="";++w;if(w==26){w=0;++x;if(x==26){x=0;++z}}if(z>=0){A+=this.alphabet[z]}if(x>=0){A+=this.alphabet[x]}if(w>=0){A+=this.alphabet[w]}this.columnIndexes[v]=A;this.columnLabels[A]=v}}return this.columnIndexes[y]||""},regEx:{n:/[\$,\s]/g,cell:/(\$?[a-zA-Z]+|[#]REF[!])(\$?[0-9]+|[#]REF[!])/gi,range:/(\$?[a-zA-Z]+)\$?([0-9]+):(\$?[a-zA-Z]+)(\$?[0-9]+)/gi,remoteCell:/\$?(SHEET+)(\$?[0-9]+)[:!](\$?[a-zA-Z]+)(\$?[0-9]+)/gi,remoteCellRange:/\$?(SHEET+)(\$?[0-9]+)[:!](\$?[a-zA-Z]+)(\$?[0-9]+):(\$?[a-zA-Z]+)(\$?[0-9]+)/gi,sheet:/SHEET/i,amp:/&/g,gt:/</g,lt:/>/g,nbsp:/&nbsp;/g},chart:function(x){var A=this.jS,D=l.createElement("div"),z=this.td,C,B=l.body;B.appendChild(D);function y(F,G){if(!F){if(G){F=0}else{F=""}}else{if(G){F=c.toNumbers(F)}else{F=c.flatten(F)}}return F}x=d.extend({x:{legend:"",data:[0]},y:{legend:"",data:[0]},title:"",data:[0],legend:""},x);D.className=A.cl.chart;D.onmousedown=function(){d(z).mousedown()};D.onmousemove=function(){d(z).mousemove();return false};A.controls.chart[A.i]=A.obj.chart().add(D);x.data=y(x.data,true);x.x.data=y(x.x.data,true);x.y.data=y(x.y.data,true);x.legend=y(x.legend);x.x.legend=y(x.x.legend);x.y.legend=y(x.y.legend);x.legend=(x.legend?x.legend:x.data);var w,E,v=Raphael(D);if(z.clientHeight>0){w=g.max(z.clientWidth,100);E=g.max(z.clientHeight,50)}if(x.title){v.text(w/2,10,x.title).attr({"font-size":20})}switch(x.type){case"bar":C=v.barchart(w/8,E/8,w*0.8,E*0.8,x.data,x.legend).hover(function(){this.flag=v.popup(this.bar.x,this.bar.y,this.bar.value||"0").insertBefore(this)},function(){this.flag.animate({opacity:0},300,function(){this.remove()})});break;case"hbar":C=v.hbarchart(w/8,E/8,w*0.8,E*0.8,x.data,x.legend).hover(function(){this.flag=v.popup(this.bar.x,this.bar.y,this.bar.value||"0").insertBefore(this)},function(){this.flag.animate({opacity:0},300,function(){this.remove()})});break;case"line":C=v.linechart(w/8,E/8,w*0.8,E*0.8,x.x.data,x.y.data,{nostroke:false,axis:"0 0 1 1",symbol:"circle",smooth:true}).hoverColumn(function(){this.tags=v.set();if(this.symbols.length){for(var F=0,G=this.y.length;F<G;F++){this.tags.push(v.tag(this.x,this.y[F],this.values[F],160,10).insertBefore(this).attr([{fill:"#fff"},{fill:this.symbols[F].attr("fill")}]))}}},function(){this.tags&&this.tags.remove()});break;case"pie":C=v.piechart(w/2,E/2,(w<E?w:E)/2,x.data,{legend:x.legend}).hover(function(){this.sector.stop();this.sector.scale(1.1,1.1,this.cx,this.cy);if(this.label){this.label[0].stop();this.label[0].attr({r:7.5});this.label[1].attr({"font-weight":800})}},function(){this.sector.animate({transform:"s1 1 "+this.cx+" "+this.cy},500,"bounce");if(this.label){this.label[0].animate({r:5},500,"bounce");this.label[1].attr({"font-weight":400})}});break;case"dot":C=v.dotchart(w/8,E/8,w*0.8,E*0.8,x.x.data,x.y.data,x.data,{symbol:"o",max:10,heat:true,axis:"0 0 1 1",axisxstep:x.x.data.length-1,axisystep:x.y.data.length-1,axisxlabels:(x.x.legend?x.x.legend:x.x.data),axisylabels:(x.y.legend?x.y.legend:x.y.data),axisxtype:" ",axisytype:" "}).hover(function(){this.marker=this.marker||v.tag(this.x,this.y,this.value,0,this.r+2).insertBefore(this);this.marker.show()},function(){this.marker&&this.marker.hide()});break}C.mousedown(function(){d(z).mousedown().mouseup()});B.removeChild(D);return D}};var n=d.sheet.fn={ISNUMBER:function(x){var w;if(!isNaN(x.valueOf())){w=new t(true);w.html="TRUE";return w}w=new t(false);w.html="FALSE";return w},N:function(w){if(w==null){return 0}if(w instanceof a){return w.getTime()}if(typeof(w)=="object"){w=w.toString()}if(typeof(w)=="string"){w=parseFloat(w.replace(h.regEx.n,""))}if(isNaN(w)){return 0}if(typeof(w)=="number"){return w}if(w==true){return 1}return 0},VERSION:function(){return this.jS.version},ABS:function(w){return g.abs(n.N(w))},CEILING:function(w,v){v=v||1;return(parseInt(w/v)*v)+v},EVEN:function(w){w=g.round(w);var x=(w%2==0);if(!x){if(w>0){w++}else{w--}}return w},EXP:function(w){return g.exp(w)},FLOOR:function(x,w){w=w||1;if((x<0&&w>0)||(x>0&&w<0)){var v=new s(0);v.html="#NUM";return v}if(x>=0){return g.floor(x/w)*w}else{return g.ceil(x/w)*w}},INT:function(w){return g.floor(n.N(w))},LN:function(w){return g.log(w)},LOG:function(w,x){x=x||10;return g.log(w)/g.log(x)},LOG10:function(w){return n.LOG(w)},MOD:function(v,z){var w=v%z;if(z<0){w*=-1}return w},ODD:function(w){var y=false;if(w>0){w=g.floor(g.round(w));y=true}else{w=g.ceil(w)}var x=g.abs(w);if((x%2)==0){x++}if(y){return x}else{return -x}},PI:function(){return g.PI},POWER:function(v,w){return g.pow(v,w)},SQRT:function(w){return g.sqrt(w)},RAND:function(){return g.random()},RND:function(){return g.random()},ROUND:function(y,x){var w=g.pow(10,x||0);return g.round(y*w)/w},ROUNDDOWN:function(x,w){var y=(x<0);x=g.abs(x);w=w||0;x=g.floor(x*g.pow(10,w))/g.pow(10,w);return(y?-x:x)},ROUNDUP:function(x,w){var y=(x<0);x=g.abs(x);w=w||0;x=g.ceil(x*g.pow(10,w))/g.pow(10,w);return(y?-x:x)},SUM:function(){var C=0,A=arguments,w,y,B=A.length-1,z,x,D=isNaN;if(B<0){return 0}do{w=A[B];z=w.length-1;do{y=w[z];if(y===null||y===undefined){continue}y=y.valueOf();if(!D(y)){switch(typeof y){case"string":C+=(y*1);break;default:C+=y}}}while(z-->0)}while(B-->0);return C},TRUNC:function(v,w){w=w||0;v=v+"";if(w==0){return v.split(".").shift()}if(v.match(".")){if(w==1){v=v.substr(0,v.length-1)}else{if(w==-1){v=v.split(".").shift();v=v.substr(0,v.length-1)+"0"}}}return v},AVERAGE:function(){return n.SUM.apply(this,arguments)/n.COUNT.apply(this,arguments)},AVG:function(){return n.AVERAGE.apply(this,arguments)},COUNT:function(){var y=0,w=c.toNumbers(arguments),x=w.length-1;if(x<0){return y}do{if(w[x]!==null){y++}}while(x--);return y},COUNTA:function(){var y=0,w=c.flatten(arguments),x=w.length-1;if(x<0){return y}do{if(w[x]){y++}}while(x--);return y},MAX:function(){var x=c.toNumbers(arguments),w=x[0],y=x.length-1;if(y<0){return 0}do{w=(x[y]>w?x[y]:w)}while(y--);return w},MIN:function(){var w=c.toNumbers(arguments),y=w[0],x=w.length-1;if(x<0){return 0}do{y=(w[x]<y?w[x]:y)}while(x--);return y},ASC:function(w){return w.charCodeAt(0)},CHAR:function(w){return p.fromCharCode(w)},CLEAN:function(w){var x=new b("[cG\x1BcLcJcMcIcK\x07\x1B\f\n\r\t\v]","g");return w.replace(x,"")},CODE:function(w){return n.ASC(w)},CONCATENATE:function(){var x=c.flatten(arguments),w="",v=this;jQuery.each(x,function(y){w+=x[y]});return w},DOLLAR:function(y,x,A){x=x||2;A=A||"$";var w=new s(y),z=n.FIXED(y,x,false);if(y>=0){w.html=A+z}else{w.html="("+A+z.slice(1)+")"}return w},FIXED:function(z,y,x){y=(y===undefined?2:y);var A=g.pow(10,y),w,z=g.round(z*A)/A;w=new p(z.toFixed(y));w.html=Globalize.format(z,"n"+y);if(x){w.html=w.html.replace(Globalize.culture().numberFormat[","],"")}return w},LEFT:function(w,x){w=w.valueOf().toString();x=x||1;return w.substring(0,x)},LEN:function(w){if(!w){return 0}return w.length},LOWER:function(w){return w.toLowerCase()},MID:function(y,z,x){if(!y||!z||!x){var w=new s(0);w.html="ERROR";return w}return y.substring(z-1,x+z-1)},REPLACE:function(w,z,x,y){if(!w||!z||!x||!y){var v=new p("");v.html="ERROR";return v}var v=w.split("");v.splice(z-1,x);v.splice(z-1,0,y);return v.join("")},REPT:function(x,z){var w="";for(var y=0;y<z;y++){w+=x}return w},RIGHT:function(w,x){x=x||1;return w.substring(w.length-x,w.length)},SEARCH:function(y,w,z){z=z||0;if(z){w=w.split("");w.splice(0,z-1);w=w.join("")}var x=w.search(y);if(x<0){var v=new p("");v.html="#VALUE!";return v}return z+(z?0:1)+x},SUBSTITUTE:function(y,v,x,z){z=z||0;v=new b(v,"g");var w=1;y=y.replace(v,function(B,D,E,C){var A=B;if(z){if(w>=z){A=x}}else{A=x}w++;return A});return y},TEXT:function(w,v){return w},UPPER:function(w){return w.toUpperCase()},VALUE:function(x){if(jQuery.isNumeric(x)){return x*=1}else{var w=new p("");w.html="#VALUE!";return w}},NOW:function(){var v=new a();v.html=e.toString(v);return v},TODAY:function(){var w=new a(),v=new s(e.toCentury(w)-1);v.html=e.toString(w,"d");return v},WEEKENDING:function(w){var v=new a();v=new a(v.getFullYear(),v.getMonth(),v.getDate()+5-v.getDay()-((w||0)*7));v.html=e.toString(v,"d");return v},WEEKDAY:function(w,x){w=e.get(w);var v=w.getDay();x=(x?x:1);switch(x){case 3:switch(v){case 0:return 7;case 1:return 1;case 2:return 2;case 3:return 3;case 4:return 4;case 5:return 5;case 6:return 6}break;case 2:switch(v){case 0:return 6;case 1:return 0;case 2:return 1;case 3:return 2;case 4:return 3;case 5:return 4;case 6:return 5}break;case 1:v++;break}return v},WEEKNUM:function(v){v=e.get(v);return e.week(v)+1},YEAR:function(v){v=e.get(v);return v.getFullYear()},DAYSFROM:function(w,x,v){return g.floor((new a()-new a(w,(x-1),v))/e.dayDiv)},DAYS:function(z,x){var w=e.get(z),v=e.get(x),y=1000*60*60*24;return g.round(g.abs(w.getTime()-v.getTime())/y)},DAY:function(v){v=e.get(v);return v.getDate()},DAYS360:function(A,x,C){A=e.get(A);x=e.get(x);var v=A.getDate(),z=x.getDate(),y=e.isLastDayOfMonth(A),B=e.isLastDayOfMonth(x),w=e.diffMonths(A,x);if(C){v=g.min(v,30);z=g.min(z,30)}else{if(y){v=30}if(B){if(v<30){w++;z=1}else{z=30}}}return(w*30)+(z-v)},DATE:function(y,z,w){var x=new a(y,z-1,w),v=new s(e.toCentury(x));v.html=e.toString(x,"d");return v},DATEVALUE:function(w){w=e.get(w);var v=new s(e.toCentury(w));v.html=e.toString(w,"d");return v},EDATE:function(x,w){x=e.get(x);x.setMonth(x.getMonth()+w);var v=new s(e.toCentury(x));v.html=e.toString(x,"d");return v},EOMONTH:function(x,w){x=e.get(x);x.setMonth(x.getMonth()+w+1);x=new a(x.getFullYear(),x.getMonth(),0);var v=new s(e.toCentury(x));v.html=e.toString(x,"d");return v},HOUR:function(v){v=i.fromMath(v);return v.hour},MINUTE:function(v){return i.fromMath(v).minute},MONTH:function(v){v=e.get(v);return v.getMonth()+1},SECOND:function(v){return i.fromMath(v).second},TIME:function(v,A,w){w=(w?w:0);A=(A?A:0);v=(v?v:0);if(w&&w>60){var x=(((w/60)+"").split(".")[0])*1;w=w-(x*60);A+=x}if(A&&A>60){var z=(((A/60)+"").split(".")[0])*1;A=A-(z*60);v+=z}var y=(v*60*60*1000)+(A*60*1000)+(w*1000);return y/e.dayDiv},TIMEVALUE:function(v){if(!isNaN(v)){return v}if(/([0]?[1-9]|1[0-2])[:][0-5][0-9]([:][0-5][0-9])?[ ]?(AM|am|aM|Am|PM|pm|pM|Pm)/.test(v)){return i.fromString(v,true)}else{if(/([0]?[0-9]|1[0-9]|2[0-3])[:][0-5][0-9]([:][0-5][0-9])?/.test(v)){return i.fromString(v)}}return 0},WORKDAY:function(w,z,y){var A={1:true,2:true,3:true,4:true,5:true},w=e.get(w),z=(z&&!isNaN(z)?z:0),B=0,x=0,v=w,D;if(y){if(!jQuery.isArray(y)){y=[y]}y=c.flatten(y);var C={};jQuery.each(y,function(E){if(y[E]){C[e.toString(e.get(y[E]),"d")]=true}});y=C}else{y={}}while(x<z){v=new a(v.setDate(v.getDate()+1));if(A[v.getDay()]){if(!y[e.toString(v,"d")]){x++}}B++}D=new s(e.toCentury(v));D.html=e.toString(v,"d");return D},YEARFRAC:function(w,A,z){w=e.get(w);A=e.get(A);if(!w||!A){var v=new p("");v.html="#VALUE!";return v}z=(z?z:0);this.html=[];var y=e.diff(w,A,z),x=e.calcAnnualBasis(w,A,z);return y/x},AND:function(){var w,x=0,v=arguments.length;for(;x<v;x++){w=arguments[x];if(w===undefined||(w.valueOf!==undefined&&w.valueOf()!=true)||w!=true){return n.FALSE()}}return n.TRUE()},FALSE:function(){var v=new t(false);v.html="FALSE";return v},IF:function(z,x,w){var v=z.valueOf(),y;switch(typeof v){case"boolean":if(v===true){return x}else{return w}break;case"number":if(v!==0){return x}else{return w}break;case"string":y=v.toUpperCase();if(y==="TRUE"){return x}else{if(y==="FALSE"){return w}else{if(y.replace(/ /g,"").length>0){return x}}}break}if(v){return x}return x},NOT:function(x){var w;if(!x.valueOf()){w=new t(true);w.html="TRUE"}else{w=new t(false);w.html="FALSE"}return w},OR:function(){var y=arguments,w,z=y.length-1,x;if(z>-1){do{x=y[z].valueOf();if(x){w=new t(true);w.html="TRUE";return w}}while(z--)}w=new t(false);w.html="FALSE";return w},TRUE:function(){var v=new t(true);v.html="TRUE";return v},GREATER:function(x,w){var v;if(x>w){v=new t(true);v.html="TRUE"}else{v=new t(false);v.html="FALSE"}return v},LESS:function(x,w){var v;if(x<w){v=new t(true);v.html="TRUE"}else{v=new t(false);v.html="FALSE"}return v},EQUAL:function(y,x){var v,z,w;if(y===undefined||y===null){y=""}if(x===undefined||x===null){x=""}z=y+"";w=x+"";if(z==w){v=new t(true);v.html="TRUE"}else{v=new t(false);v.html="FALSE"}return v},GREATER_EQUAL:function(x,w){var v;if(x>=w){v=new t(true);v.html="TRUE"}else{v=new t(false);v.html="FALSE"}return v},LESS_EQUAL:function(x,w){var v;if(x<=w){v=new t(true);v.html="TRUE"}else{v=new t(false);v.html="FALSE"}return v},IMG:function(x){var w=new p("");w.html=d(l.createElement("img")).attr("src",x);return w},TRIM:function(w){if(typeof(w)=="string"){w=d.trim(w)}return w},HYPERLINK:function(w,x){x=x||"LINK";var v=new p(x.valueOf()),y=l.createElement("a");y.setAttribute("href",w);y.setAttribute("target","_new");y.innerText=y.textContent=x;v.html=y;return v},DROPDOWN:function(){var G=this,B=this.jS,y=this.td,E,F,A,D,x,H,z=0,C;if(y!==null){d(y).children().detach();A=G.value.html}if(A===undefined||G.needsUpdated||A.length<1){F=c.flatten(arguments);F=c.unique(F);if(this.id!==null){x=this.id+"-dropdown"}else{if(y!==null){x="dropdown"+this.sheetIndex+"_"+this.rowIndex+"_"+this.columnIndex+"_"+B.I}}D=l.createElement("select");D.setAttribute("name",x);D.setAttribute("id",x);D.className="jSDropdown";D.cell=this;D.onmouseup=function(){if(this.cell.td!==null){B.cellEdit(this.cell.td)}};D.onchange=function(){E=new p(this.value);E.html=D;E.cell=G;G.value=E;G.setNeedsUpdated(false);B.resolveCell(G);B.trigger("sheetCellEdited",[G])};C=(F.length<=50?F.length:50);for(;z<C;z++){if(F[z]){var w=l.createElement("option");w.setAttribute("value",F[z]);w.text=w.innerText=F[z];D.appendChild(w)}}if(!B.s.editable){D.setAttribute("disabled",true)}else{B.s.parent.bind("sheetKill",function(){y.innerText=y.textContent=G.value=D.value})}D.value=G.value||F[0]}if(typeof G.value!=="object"){H=new p(G.value)}else{H=G.value}H.html=D;return H},RADIO:function(){var I=this,C=this.jS,z=this.td,H,G,B,D,w,y,x,J;if(z!==null){B=I.value.html;d(z).children().detach()}if(B===undefined||B.length<1||I.needsUpdated){H=c.flatten(arguments);H=c.unique(H);D=[];if(this.id!==null){x=this.id+"-radio"}else{if(z!==null){x="radio"+this.sheetIndex+"_"+this.rowIndex+"_"+this.columnIndex+"_"+C.I}}B=l.createElement("span");B.className="jSRadio";B.onmousedown=function(){if(this.cell.td!==null){C.cellEdit(this.cell.td)}};B.cell=I;for(var A=0;A<(H.length<=25?H.length:25);A++){if(H[A]){var F=l.createElement("input"),E=l.createElement("span");F.setAttribute("type","radio");F.setAttribute("name",x);F.className=x;F.value=H[A];F.onchange=function(){G=new p(this.value);G.html=B;G.cell=I;I.value=G;I.setNeedsUpdated(false);C.resolveCell(I);C.trigger("sheetCellEdited",[I])};D.push(F);if(H[A]==I.value){F.setAttribute("checked","true")}E.textContent=E.innerText=H[A];B.appendChild(F);B.input=F;E.onclick=function(){d(this).prev().click()};B.appendChild(E);B.appendChild(l.createElement("br"))}}w=d(D);if(!C.s.editable){I.value=w.filter(":checked").val();w.attr("disabled",true)}else{C.s.parent.bind("sheetKill",function(){I.value=w.filter(":checked").val();z.textContent=z.innerText=I.value})}}if(typeof I.value!=="object"){J=new p(I.value)}else{J=I.value}J.html=B;return J},CHECKBOX:function(D){if(d.isArray(D)){D=D[0]}var E=this,z=this.jS,x=this.td,y,B,A,w,C,F;if(x!==null){y=E.value.html;d(x).children().detach()}if(y===undefined||y.length<1||E.needsUpdated){if(this.id!==null){w=this.id+"-checkbox"}else{if(x!==null){w="checkbox"+this.sheet+"_"+this.rowIndex+"_"+this.columnIndex+"_"+z.I}}A=l.createElement("input");A.setAttribute("type","checkbox");A.setAttribute("name",w);A.setAttribute("id",w);A.className=w;A.value=D;A.onchange=function(){if(d(this).is(":checked")){C=new p(D)}else{C=new p("")}C.html=y;C.cell=E;E.value=C;E.setNeedsUpdated(false);z.resolveCell(E);z.trigger("sheetCellEdited",[E])};if(!z.s.editable){A.setAttribute("disabled","true")}else{z.s.parent.bind("sheetKill",function(){E.value=(E.value=="true"||d(A).is(":checked")?D:"");if(E.td!==null){E.td.innerText=E.td.textContent=E.cell.value}})}y=l.createElement("span");y.className="jSCheckbox";y.appendChild(A);B=l.createElement("span");B.textContent=B.innerText=D;y.appendChild(B);y.appendChild(l.createElement("br"));y.onmousedown=function(){if(this.cell.td!==null){z.cellEdit(this.cell.td)}};y.cell=E;if(D==E.value||E.value==="true"){A.checked=true}}if(E.value==="true"||d(A).is(":checked")){F=new p(D)}else{F=new p("")}F.html=y;return F},BARCHART:function(w,x,y){var v=new p("");v.html=h.chart.call(this,{type:"bar",data:w,legend:x,title:y});return v},HBARCHART:function(w,x,y){var v=new p("");v.html=h.chart.call(this,{type:"hbar",data:w,legend:x,title:y});return v},LINECHART:function(x,w){var v=new p("");v.html=h.chart.call(this,{type:"line",x:{data:x},y:{data:w},title:""});return v},PIECHART:function(w,x,y){var v=new p("");v.html=h.chart.call(this,{type:"pie",data:w,legend:x,title:y});return v},DOTCHART:function(B,z,w,y,x,A){var v=new p("");v.html=h.chart.call(this,{type:"dot",data:(w?w:B),x:{data:B,legend:y},y:{data:(z?z:B),legend:(x?x:y)},title:A});return v},CELLREF:function(w){return(this.jS.spreadsheets[w]?this.jS.spreadsheets[w]:"Cell Reference Not Found")},CALCTIME:function(y,w){y=y||"";w=w||"";var v=this,x=this.jS;this.jS.s.parent.one("sheetCalculation",function(){x.time.last=x.calcLast;v.td.text(y+x.time.diff()+w)});return""},HLOOKUP:function(B,y,x,D){if(B===undefined){return null}var z=this.jS,C,v,E="",w=0,A=y.length;x=x||1;D=D!==undefined?D:true;if(B!==undefined||((isNaN(B)&&B!="#REF!")||B.length===0)){for(;w<A;w++){if(y[w].toString()==B){C=y[w];break}}}else{c.getClosestNum(B,y,function(G,F){if(D){C=G}else{if(G==B){C=G}}})}if(C!==undefined){v=C.cell;v=z.getCell(v.sheetIndex,x,v.columnIndex);if(v!==null){E=v.updateValue()}else{E=""}}else{E=new p();E.html="#N/A"}return E},VLOOKUP:function(B,y,x,D){if(B===undefined){return null}var z=this.jS,C,v,E,w=0,A=y.length;D=D!==undefined?D:true;if((isNaN(B)&&B!="#REF!")||B.length===0){for(;w<A;w++){if(y[w].toString()==B){C=y[w];break}}}else{c.getClosestNum(B,y,function(G,F){if(D){C=G}else{if(G==B){C=G}}})}if(C!==undefined){v=C.cell;v=z.getCell(v.sheetIndex,v.rowIndex,x);if(v!==null){E=v.value}else{E=""}}else{E=new p();E.html="#N/A"}return E},TRANSPOSE:function(H){var N=0,C=this.jS,B=this.sheetIndex,F=H[0],x=F.cell,y=H[H.length-1],J=y.cell,v=x.rowIndex,A=x.columnIndex,E,O,w,z=[],M,G,D=[],I,L=H.length,K,P=false;for(;N<L;N++){I=H[N];w=I.cell;E=this.rowIndex+(w.columnIndex-A);O=this.columnIndex+(w.rowIndex-v);G=C.getCell(this.sheetIndex,E,O);if(G!==null&&G!==this){if(G.value!=""){P=true}D.push(G);z.push(w)}}if(P){K=new p("");K.html="#REF!";return K}N=0;L=D.length;for(;N<L;N++){G=D[N];if(G!==this){w=z[N];G.defer=w;G.setNeedsUpdated();M=G.updateValue();G.addDependency(this);G.td.innerHTML=M}}return F},THISROWCELL:function(v){var w=this.jS;if(isNaN(v)){v=h.columnLabelIndex(v)}return w.getCell(this.sheetIndex,this.rowIndex,v).updateValue()},THISCOLCELL:function(w){var v=this.jS;return v.getCell(this.sheetIndex,w,this.columnIndex).updateValue()}};var r={BACKSPACE:8,CAPS_LOCK:20,COMMA:188,CONTROL:17,ALT:18,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,INSERT:45,LEFT:37,NUMPAD_ADD:107,NUMPAD_DECIMAL:110,NUMPAD_DIVIDE:111,NUMPAD_ENTER:108,NUMPAD_MULTIPLY:106,NUMPAD_SUBTRACT:109,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SHIFT:16,SPACE:32,TAB:9,UP:38,C:67,F:70,V:86,X:88,Y:89,Z:90,UNKNOWN:229};var c=f.arrHelpers={math:g,toNumbers:function(v){v=this.flatten(v);var w=v.length-1;if(w<0){return[]}do{if(v[w]){v[w]=d.trim(v[w]);if(isNaN(v[w])){v[w]=0}else{v[w]=v[w]*1}}else{v[w]=0}}while(w--);return v},unique:function(v){var z={},x,w=v.length,y=[];for(x=0;x<w;x+=1){z[v[x]]=v[x]}for(x in z){y.push(z[x])}return y},flatten:function(w){var z=[],y,x=0,v=w.length;for(;x<v;x++){y=w[x];if(y instanceof Array){z=z.concat(this.flatten(y))}else{z=z.concat(y)}}return z},insertAt:function(v,x,w){d(x).each(function(){if(w>-1&&w<=v.length){v.splice(w,0,this)}});return v},indexOfNearestLessThan:function(B,A){if(B.length===0){return -1}var y=B.length-1,v=0,w,x,z=-1;if(B[y]<A){return y}while(v<=y){w=(v+y)>>1;x=B[w];if(x>A){y=w-1}else{if(x<A){z=w;v=w+1}else{z=v;break}}}return z},ofSet:function(E,y){if(E.length===0){return null}var w=E.length-1,B=w,x=E[w],C=E[0],F=0,G,H,D=-1,A,z=-1,v=-1;if(E[w]<y||E[0]>y){return null}else{while(F<=w){G=(F+w)>>1;H=E[G];if(H>y){D=G;w=G-1}else{if(H<y){F=G+1}else{D=w;break}}}}if(D>-1){A=D;while(A<=B){if(E[A]+1===E[A+1]){A++}else{z=E[A];break}}if(z===-1){z=x}A=D;while(A>=0){if(E[A]-1===E[A-1]){A--}else{v=E[A];break}}if(v===-1){v=C}}return{start:v,end:z}},closest:function(A,w,x,v){x=x||0;v=v||A.length-1;var z,y;while(true){z=((x+v)>>1);y=A[z];if((z===v||z===x)&&y!==w){return y}if(y>w){v=z}else{if(y<w){x=z}else{return y}}}},getClosestNum:function(x,v,z){var y=0,w,C,B,A;if(v.length){C=v[0];w=y;for(y;y<v.length;y++){B=g.abs(x-C);A=g.abs(x-v[y]);if(A<B){w=y;C=v[y]}B=null;A=null}if(z){return z(C,w)}return C}return false},levenshtein:(function(){var v=[];return function(F,E){if(F===E){return 0}else{var C=F.length,A=E.length;if(C&&A){var x=0,w=0,D,B,z,y,G=v;while(x<C){G[x]=++x}while(w<A){y=E.charCodeAt(w);D=w;++w;B=w;for(x=0;x<C;++x){z=D+(F.charCodeAt(x)===y?0:1);D=G[x];B=B<D?(B<z?B+1:z):(D<z?D+1:z);G[x]=B}}return B}else{return C+A}}}})(),lSearch:function(w,A){var x=0,y,v=w.length,z=-1,B;for(;x<v;x++){y=w[x];B=new s(this.levenshtein(y,A));B.item=y;if(B<z){z=B}}return(B!==undefined?B.item:null)}};var e={dayDiv:86400000,math:g,toCentury:function(v,w){w=w||86400000;return this.math.round(this.math.abs((new a(1900,0,-1))-v)/w)},get:function(w,x){x=x||86400000;if(w.getMonth){return w}else{if(isNaN(w)){return new a(Globalize.parseDate(w))}else{w*=x;var v=(new a(1900,0,-1))*1;w+=v;w=new a(w);return w}}},week:function(v,x){x=x||86400000;var w=new a(v.getFullYear(),0,1);return this.math.ceil((((v-w)/x)+w.getDay()+1)/7)},toString:function(v,w){if(!w){return Globalize.format(v)}return Globalize.format(v,Globalize.culture().calendar.patterns[w])},diff:function(z,w,y,x){x=x||86400000;switch(y){case 0:return this.days360Nasd(z,w,0,true);case 1:case 2:case 3:var v=this.math.abs(w-z)/x;return v;case 4:return this.days360Euro(z,w)}return 0},diffMonths:function(x,w){var v;v=(w.getFullYear()-x.getFullYear())*12;v-=x.getMonth()+1;v+=w.getMonth()+1;return v},days360:function(x,A,y,w,v,z){return((A-x)*360)+((w-y)*30)+(z-v)},days360Nasd:function(w,z,v,x){var y=w.getDate(),D=w.getMonth(),C=w.getFullYear(),B=z.getDate(),A=z.getMonth(),E=z.getFullYear();if((A==2&&this.isEndOfMonth(B,A,E))&&((D==2&&this.isEndOfMonth(y,D,C))||v==3)){B=30}if(B==31&&(y>=30||v==3)){B=30}if(y==31){y=30}if(x&&D==2&&this.isEndOfMonth(y,D,C)){y=30}return this.days360(C,E,D,A,y,B)},days360Euro:function(C,x){var v=C.getDate(),z=C.getMonth(),y=C.getFullYear(),A=x.getDate(),w=x.getMonth(),B=x.getFullYear();if(v==31){v=30}if(A==31){A=30}return this.days360(y,B,z,w,v,A)},isEndOfMonth:function(v,x,w){return v==(new a(w,x+1,0,23,59,59)).getDate()},isLeapYear:function(v){return new a(v,1,29).getMonth()==1},calcAnnualBasis:function(v,x,B){switch(B){case 0:case 2:case 4:return 360;case 3:return 365;case 1:var w=v.getDate(),D=v.getMonth(),A=v.getFullYear(),y=x.getDate(),z=x.getMonth(),E=x.getFullYear(),F=0;if(A==E){if(this.isLeapYear(A)){F=366}else{F=365}}else{if(((E-1)==A)&&((D>z)||((D==z)&&w>=y))){if(this.isLeapYear(A)){if(D<2||(D==2&&w<=29)){F=366}else{F=365}}else{if(this.isLeapYear(E)){if(z>2||(z==2&&y==29)){F=366}else{F=365}}else{F=365}}}else{for(var C=A;C<=E;C++){if(this.isLeapYear(C)){F+=366}else{F+=365}}F=F/(E-A+1)}}return F}return 0},lastDayOfMonth:function(v){v.setDate(0);return v.getDate()},isLastDayOfMonth:function(v){return(v.getDate()==this.lastDayOfMonth(v))}};var i=f.times={math:g,fromMath:function(x){var v={},w=this;v.hour=((x*24)+"").split(".")[0]*1;v.minute=function(y){y=w.math.round(y*24*100)/100;y=(y+"").split(".");var z=0;if(y[1]){if(y[1].length<2){y[1]+="0"}z=y[1]*0.6}return w.math.round(z)}(x);v.second=function(B){B=w.math.round(B*24*10000)/10000;B=(B+"").split(".");var z=0;if(B[1]){for(var A=0;A<4;A++){if(!B[1].charAt(A)){B[1]+="0"}}var y=((B[1]*0.006)+"").split(".");if(y[1]){if(y[1]&&y[1].length>2){y[1]=y[1].substr(0,2)}return w.math.round(y[1]*0.6)}}return z}(x);return v},fromString:function(x,B){var y=new a(),C=x,v,A,z,w,D;if(B){D=C.substr(-2).toLowerCase();C=C.replace(/(am|pm)/i,"")}C=C.split(":");A=C[0]*1;z=C[1]*1;w=(C[2]?C[2]:0)*1;if(B&&D=="pm"){A+=12}return n.TIME(A,z,w)}};d.extend(g,{log10:function(v){return g.log(v)/2.302585092994046},signum:function(v){return(v/g.abs(v))||v},log1p:function(v){var w=0,z=50;if(v<=-1){return"-INF"}if(v<0||v>1){return g.log(1+v)}for(var y=1;y<z;y++){if((y%2)===0){w-=g.pow(v,y)/y}else{w+=g.pow(v,y)/y}}return w}});var m=function(){var B=l,E=d(l.createElement("p")).css({width:"100%",height:"100%"}),D=d(l.createElement("div")).css({position:"absolute",width:"100px",height:"100px",top:"0",left:"0",visibility:"hidden",overflow:"hidden"}).append(E);d(l.body).append(D);var y=E.width(),A=E.height();D.css("overflow","scroll");var v=E.width(),z=E.height();if(y==v&&D[0].clientWidth){v=D[0].clientWidth}if(A==z&&D[0].clientHeight){z=D[0].clientHeight}D.detach();var C=y-v,x=A-z;return{width:C||15,height:x||15}};var j=function(){var v="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789",x=d(l.createElement("span")).html(v).appendTo("body"),w={width:x.width()/v.length,height:x.height()};x.remove();return w};var o=function(v,C,z,w,B){w=w||"#"+g.floor(g.random()*16777215).toString(16);if(z){var A=d([]);A=A.add(o(z.left,z.top,null,w,"top-left"));A=A.add(o(z.right,z.top,null,w,"top-right"));A=A.add(o(z.left,z.bottom,null,w,"bottom-left"));A=A.add(o(z.right,z.bottom,null,w,"bottom-right"));return A}return d('<div style="width: 10px; height: 10px; position: absolute;"></div>').css("top",(C-5)+"px").css("left",(v+5)+"px").css("background-color",w).click(function(){console.log(B||"none")}).appendTo("body")};d.printSource=function(x){var v=win.open();v.document.write("<html><body><xmp>"+x+"\n</xmp></body></html>");v.document.close()};if(!Object.getPrototypeOf){Object.getPrototypeOf=function(v){return v||{}}}if(!Array.prototype.indexOf){d.sheet.max=60;Array.prototype.indexOf=function(x,y){for(var w=(y||0),v=this.length;w<v;w++){if(this[w]===x){return w}}return -1}}return k})(jQuery,document,window,Date,String,Number,Boolean,Math,RegExp,Error);var parser=(function(){var T=function(X,W,Y,V){for(Y=Y||{},V=X.length;V--;Y[X[V]]=W){}return Y},m=[1,5],l=[1,6],k=[1,8],j=[1,9],i=[1,10],h=[1,13],f=[1,11],d=[1,12],c=[1,14],b=[1,15],S=[1,20],R=[1,18],Q=[1,21],P=[1,22],O=[1,17],N=[1,24],M=[1,25],L=[1,26],K=[1,27],J=[1,28],I=[1,29],H=[1,30],G=[1,31],F=[1,32],E=[4,13,14,15,17,18,19,20,21,22,23,35,36],D=[1,35],C=[1,36],A=[1,37],z=[4,13,14,15,17,18,19,20,21,22,23,35,36,38],y=[4,13,14,15,17,18,19,20,21,22,23,35,36,39],x=[4,13,14,15,17,18,19,20,21,22,23,29,35,36],w=[4,14,15,17,18,19,20,35,36],v=[1,71],t=[4,14,17,18,19,35,36],s=[4,14,15,17,18,19,20,21,22,35,36],r=[17,35,36];var B={trace:function q(){},yy:{},symbols_:{error:2,expressions:3,EOF:4,expression:5,variableSequence:6,TIME_AMPM:7,TIME_24:8,number:9,STRING:10,ESCAPED_STRING:11,LETTERS:12,"&":13,"=":14,"+":15,"(":16,")":17,"<":18,">":19,"-":20,"*":21,"/":22,"^":23,E:24,FUNCTION:25,expseq:26,cellRange:27,cell:28,":":29,SHEET:30,"!":31,NUMBER:32,"$":33,REF:34,";":35,",":36,VARIABLE:37,DECIMAL:38,"%":39,"$accept":0,"$end":1},terminals_:{2:"error",4:"EOF",7:"TIME_AMPM",8:"TIME_24",10:"STRING",11:"ESCAPED_STRING",12:"LETTERS",13:"&",14:"=",15:"+",16:"(",17:")",18:"<",19:">",20:"-",21:"*",22:"/",23:"^",24:"E",25:"FUNCTION",29:":",30:"SHEET",31:"!",32:"NUMBER",33:"$",34:"REF",35:";",36:",",37:"VARIABLE",38:"DECIMAL",39:"%"},productions_:[0,[3,1],[3,2],[5,1],[5,1],[5,1],[5,1],[5,1],[5,1],[5,1],[5,3],[5,3],[5,3],[5,3],[5,4],[5,4],[5,4],[5,3],[5,3],[5,3],[5,3],[5,3],[5,3],[5,2],[5,2],[5,1],[5,3],[5,4],[5,1],[27,1],[27,3],[27,3],[27,5],[28,2],[28,3],[28,3],[28,4],[28,1],[28,2],[28,2],[28,2],[28,3],[28,3],[28,3],[28,3],[28,3],[28,3],[28,4],[28,4],[28,4],[26,1],[26,2],[26,2],[26,3],[26,3],[6,1],[6,3],[9,1],[9,3],[9,2]],performAction:function p(X,Z,o,aa,ac,ad,V){var W=ad.length-1;switch(ac){case 1:return null;break;case 2:var Y=aa.types;aa.types=[];return Y;break;case 3:var ab={t:"m",m:"variable",a:[ad[W]]};this.$=aa.types.length;aa.types.push(ab);break;case 4:var ab={t:"m",m:"time",a:[ad[W],true]};this.$=aa.types.length;aa.types.push(ab);break;case 5:var ab={t:"m",m:"time",a:[ad[W]]};this.$=aa.types.length;aa.types.push(ab);break;case 6:var ab={t:"m",m:"number",a:[ad[W]]};this.$=aa.types.length;aa.types.push(ab);break;case 7:var ab={t:"v",v:aa.escape(ad[W].substring(1,ad[W].length-1))};this.$=aa.types.length;aa.types.push(ab);break;case 8:var ab={t:"v",v:aa.escape(ad[W].substring(2,ad[W].length-2))};this.$=aa.types.length;aa.types.push(ab);break;case 9:var ab={t:"v",v:ad[W]};aa.types.push(ab);break;case 10:var ab={t:"m",m:"concatenate",a:[ad[W-2],ad[W]]};this.$=aa.types.length;aa.types.push(ab);break;case 11:var ab={t:"m",m:"callFunction",a:["EQUAL",[ad[W-2],ad[W]]]};this.$=aa.types.length;aa.types.push(ab);break;case 12:var ab={t:"m",m:"performMath",a:["+",ad[W-2],ad[W]]};this.$=aa.types.length;aa.types.push(ab);break;case 13:this.$=ad[W-1];break;case 14:var ab={t:"m",m:"callFunction",a:["LESS_EQUAL",[ad[W-3],ad[W]]]};this.$=aa.types.length;aa.types.push(ab);break;case 15:var ab={t:"m",m:"callFunction",a:["GREATER_EQUAL",[ad[W-3],ad[W]]]};this.$=aa.types.length;aa.types.push(ab);break;case 16:var ab={t:"m",m:"not",a:[ad[W-3],ad[W]]};this.$=aa.types.length;aa.types.push(ab);break;case 17:var ab={t:"m",m:"callFunction",a:["GREATER",[ad[W-2],ad[W]]]};this.$=aa.types.length;aa.types.push(ab);break;case 18:var ab={t:"m",m:"callFunction",a:["LESS",[ad[W-2],ad[W]]]};this.$=aa.types.length;aa.types.push(ab);break;case 19:var ab={t:"m",m:"performMath",a:["-",ad[W-2],ad[W]]};this.$=aa.types.length;aa.types.push(ab);break;case 20:var ab={t:"m",m:"performMath",a:["*",ad[W-2],ad[W]]};this.$=aa.types.length;aa.types.push(ab);break;case 21:var ab={t:"m",m:"performMath",a:["/",ad[W-2],ad[W]]};this.$=aa.types.length;aa.types.push(ab);break;case 22:var ab={t:"m",m:"performMath",a:["^",ad[W-2],ad[W]]};this.$=aa.types.length;aa.types.push(ab);break;case 23:var ab={t:"m",m:"invertNumber",a:[ad[W]]};this.$=aa.types.length;aa.types.push(ab);break;case 24:var ab={t:"m",m:"number",a:[ad[W]]};this.$=aa.types.length;aa.types.push(ab);break;case 25:break;case 26:var ab={t:"m",m:"callFunction",a:[ad[W-2]]};this.$=aa.types.length;aa.types.push(ab);break;case 27:var ab={t:"m",m:"callFunction",a:[ad[W-3],ad[W-1]]};this.$=aa.types.length;aa.types.push(ab);break;case 29:var ab={t:"l",m:"cellValue",a:[ad[W]]};this.$=aa.types.length;aa.types.push(ab);break;case 30:var ab={t:"l",m:"cellRangeValue",a:[ad[W-2],ad[W]]};this.$=aa.types.length;aa.types.push(ab);break;case 31:var ab={t:"l",m:"remoteCellValue",a:[ad[W-2],ad[W]]};this.$=aa.types.length;aa.types.push(ab);break;case 32:var ab={t:"l",m:"remoteCellRangeValue",a:[ad[W-4],ad[W-2],ad[W]]};this.$=aa.types.length;aa.types.push(ab);break;case 33:var ab={t:"cell",c:ad[W-1],r:ad[W]};this.$=aa.types.length;aa.types.push(ab);break;case 34:var ab={t:"cell",c:ad[W-1],r:ad[W]};this.$=aa.types.length;aa.types.push(ab);break;case 35:case 36:var ab={t:"cell",c:ad[W-2],r:ad[W]};this.$=aa.types.length;aa.types.push(ab);break;case 37:case 38:case 39:case 40:case 41:case 42:case 43:case 44:case 45:case 46:case 47:case 48:case 49:return"#REF!";break;case 50:this.$=[ad[W]];break;case 53:ad[W-2].push(ad[W]);this.$=ad[W-2];break;case 54:ad[W-2].push(ad[W]);this.$=ad[W-2];break;case 55:this.$=[ad[W]];break;case 56:this.$=(ad[W-2] instanceof Array?ad[W-2]:[ad[W-2]]);this.$.push(ad[W]);break;case 57:this.$=ad[W];break;case 58:this.$=(ad[W-2]+"."+ad[W])*1;break;case 59:this.$=ad[W-1]*0.01;break}},table:[{3:1,4:[1,2],5:3,6:4,7:m,8:l,9:7,10:k,11:j,12:i,15:h,16:f,20:d,24:c,25:b,27:16,28:19,30:S,32:R,33:Q,34:P,37:O},{1:[3]},{1:[2,1]},{4:[1,23],13:N,14:M,15:L,18:K,19:J,20:I,21:H,22:G,23:F},T(E,[2,3],{38:[1,33]}),T(E,[2,4]),T(E,[2,5]),T(E,[2,6],{39:[1,34]}),T(E,[2,7]),T(E,[2,8]),T(E,[2,9],{32:D,33:C,34:A}),{5:38,6:4,7:m,8:l,9:7,10:k,11:j,12:i,15:h,16:f,20:d,24:c,25:b,27:16,28:19,30:S,32:R,33:Q,34:P,37:O},{5:39,6:4,7:m,8:l,9:7,10:k,11:j,12:i,15:h,16:f,20:d,24:c,25:b,27:16,28:19,30:S,32:R,33:Q,34:P,37:O},{5:40,6:4,7:m,8:l,9:7,10:k,11:j,12:i,15:h,16:f,20:d,24:c,25:b,27:16,28:19,30:S,32:R,33:Q,34:P,37:O},T(E,[2,25]),{16:[1,41]},T(E,[2,28]),T(z,[2,55]),T(y,[2,57],{38:[1,42]}),T(E,[2,29],{29:[1,43]}),{31:[1,44]},{12:[1,45],34:[1,46]},T(x,[2,37],{32:[1,47],33:[1,49],34:[1,48]}),{1:[2,2]},{5:50,6:4,7:m,8:l,9:7,10:k,11:j,12:i,15:h,16:f,20:d,24:c,25:b,27:16,28:19,30:S,32:R,33:Q,34:P,37:O},{5:51,6:4,7:m,8:l,9:7,10:k,11:j,12:i,15:h,16:f,20:d,24:c,25:b,27:16,28:19,30:S,32:R,33:Q,34:P,37:O},{5:52,6:4,7:m,8:l,9:7,10:k,11:j,12:i,15:h,16:f,20:d,24:c,25:b,27:16,28:19,30:S,32:R,33:Q,34:P,37:O},{5:55,6:4,7:m,8:l,9:7,10:k,11:j,12:i,14:[1,53],15:h,16:f,19:[1,54],20:d,24:c,25:b,27:16,28:19,30:S,32:R,33:Q,34:P,37:O},{5:57,6:4,7:m,8:l,9:7,10:k,11:j,12:i,14:[1,56],15:h,16:f,20:d,24:c,25:b,27:16,28:19,30:S,32:R,33:Q,34:P,37:O},{5:58,6:4,7:m,8:l,9:7,10:k,11:j,12:i,15:h,16:f,20:d,24:c,25:b,27:16,28:19,30:S,32:R,33:Q,34:P,37:O},{5:59,6:4,7:m,8:l,9:7,10:k,11:j,12:i,15:h,16:f,20:d,24:c,25:b,27:16,28:19,30:S,32:R,33:Q,34:P,37:O},{5:60,6:4,7:m,8:l,9:7,10:k,11:j,12:i,15:h,16:f,20:d,24:c,25:b,27:16,28:19,30:S,32:R,33:Q,34:P,37:O},{5:61,6:4,7:m,8:l,9:7,10:k,11:j,12:i,15:h,16:f,20:d,24:c,25:b,27:16,28:19,30:S,32:R,33:Q,34:P,37:O},{37:[1,62]},T(y,[2,59]),T(x,[2,33]),{32:[1,63],34:[1,64]},T(x,[2,39]),{13:N,14:M,15:L,17:[1,65],18:K,19:J,20:I,21:H,22:G,23:F},T(w,[2,23],{13:N,21:H,22:G,23:F}),T(w,[2,24],{13:N,21:H,22:G,23:F}),{5:68,6:4,7:m,8:l,9:7,10:k,11:j,12:i,15:h,16:f,17:[1,66],20:d,24:c,25:b,26:67,27:16,28:19,30:S,32:R,33:Q,34:P,37:O},{32:[1,69]},{12:v,28:70,33:Q,34:P},{12:v,28:72,33:Q,34:P},{32:[1,73],33:[1,74],34:[1,75]},{32:[1,76],33:[1,78],34:[1,77]},T(x,[2,38]),T(x,[2,40]),{32:[1,79],34:[1,80]},T([4,17,35,36],[2,10],{13:N,14:M,15:L,18:K,19:J,20:I,21:H,22:G,23:F}),T([4,14,17,35,36],[2,11],{13:N,15:L,18:K,19:J,20:I,21:H,22:G,23:F}),T(w,[2,12],{13:N,21:H,22:G,23:F}),{5:81,6:4,7:m,8:l,9:7,10:k,11:j,12:i,15:h,16:f,20:d,24:c,25:b,27:16,28:19,30:S,32:R,33:Q,34:P,37:O},{5:82,6:4,7:m,8:l,9:7,10:k,11:j,12:i,15:h,16:f,20:d,24:c,25:b,27:16,28:19,30:S,32:R,33:Q,34:P,37:O},T(t,[2,18],{13:N,15:L,20:I,21:H,22:G,23:F}),{5:83,6:4,7:m,8:l,9:7,10:k,11:j,12:i,15:h,16:f,20:d,24:c,25:b,27:16,28:19,30:S,32:R,33:Q,34:P,37:O},T(t,[2,17],{13:N,15:L,20:I,21:H,22:G,23:F}),T(w,[2,19],{13:N,21:H,22:G,23:F}),T(s,[2,20],{13:N,23:F}),T(s,[2,21],{13:N,23:F}),T([4,14,15,17,18,19,20,21,22,23,35,36],[2,22],{13:N}),T(z,[2,56]),T(x,[2,35]),T(x,[2,45]),T(E,[2,13]),T(E,[2,26]),{17:[1,84],35:[1,85],36:[1,86]},T(r,[2,50],{13:N,14:M,15:L,18:K,19:J,20:I,21:H,22:G,23:F}),T(y,[2,58]),T(E,[2,30]),{32:D,33:C,34:A},T(E,[2,31],{29:[1,87]}),T(x,[2,34]),{32:[1,88]},T(x,[2,42]),T(x,[2,41]),T(x,[2,43]),{32:[1,89],34:[1,90]},T(x,[2,44]),T(x,[2,46]),T(t,[2,14],{13:N,15:L,20:I,21:H,22:G,23:F}),T(t,[2,16],{13:N,15:L,20:I,21:H,22:G,23:F}),T(t,[2,15],{13:N,15:L,20:I,21:H,22:G,23:F}),T(E,[2,27]),T(r,[2,51],{6:4,9:7,27:16,28:19,5:91,7:m,8:l,10:k,11:j,12:i,15:h,16:f,20:d,24:c,25:b,30:S,32:R,33:Q,34:P,37:O}),T(r,[2,52],{6:4,9:7,27:16,28:19,5:92,7:m,8:l,10:k,11:j,12:i,15:h,16:f,20:d,24:c,25:b,30:S,32:R,33:Q,34:P,37:O}),{12:v,28:93,33:Q,34:P},T(x,[2,36]),T(x,[2,47]),T(x,[2,49]),T(r,[2,53],{13:N,14:M,15:L,18:K,19:J,20:I,21:H,22:G,23:F}),T(r,[2,54],{13:N,14:M,15:L,18:K,19:J,20:I,21:H,22:G,23:F}),T(E,[2,32])],defaultActions:{2:[2,1],23:[2,2]},parseError:function g(V,o){if(o.recoverable){this.trace(V)}else{throw new Error(V)}},parse:function n(ag){var ao=this,ad=[0],an=[],az=[null],ai=[],aB=this.table,W="",ah=0,ax=0,Y=0,af=2,am=1;var Z=ai.slice.call(arguments,1);var o=Object.create(this.lexer);var aA={yy:{}};for(var aw in this.yy){if(Object.prototype.hasOwnProperty.call(this.yy,aw)){aA.yy[aw]=this.yy[aw]}}o.setInput(ag,aA.yy);aA.yy.lexer=o;aA.yy.parser=this;if(typeof o.yylloc=="undefined"){o.yylloc={}}var X=o.yylloc;ai.push(X);var aa=o.options&&o.options.ranges;if(typeof aA.yy.parseError==="function"){this.parseError=aA.yy.parseError}else{this.parseError=Object.getPrototypeOf(this).parseError}function al(aE){ad.length=ad.length-2*aE;az.length=az.length-aE;ai.length=ai.length-aE}_token_stack:function ak(){var aE;aE=o.lex()||am;if(typeof aE!=="number"){aE=ao.symbols_[aE]||aE}return aE}var av,aq,ac,au,aD,aj,at={},ap,ay,V,ae;while(true){ac=ad[ad.length-1];if(this.defaultActions[ac]){au=this.defaultActions[ac]}else{if(av===null||typeof av=="undefined"){av=ak()}au=aB[ac]&&aB[ac][av]}_handle_error:if(typeof au==="undefined"||!au.length||!au[0]){var ab;var ar="";function aC(aF){var aE=ad.length-1;var aG=0;for(;;){if((af.toString()) in aB[aF]){return aG}if(aF===0||aE<2){return false}aE-=2;aF=ad[aE];++aG}}if(!Y){ab=aC(ac);ae=[];for(ap in aB[ac]){if(this.terminals_[ap]&&ap>af){ae.push("'"+this.terminals_[ap]+"'")}}if(o.showPosition){ar="Parse error on line "+(ah+1)+":\n"+o.showPosition()+"\nExpecting "+ae.join(", ")+", got '"+(this.terminals_[av]||av)+"'"}else{ar="Parse error on line "+(ah+1)+": Unexpected "+(av==am?"end of input":("'"+(this.terminals_[av]||av)+"'"))}return this.parseError(ar,{text:o.match,token:this.terminals_[av]||av,line:o.yylineno,loc:X,expected:ae,recoverable:(ab!==false)})}else{if(aq!==am){ab=aC(ac)}}if(Y==3){if(av===am||aq===am){throw new Error(ar||"Parsing halted while starting to recover from another error.")}ax=o.yyleng;W=o.yytext;ah=o.yylineno;X=o.yylloc;av=ak()}if(ab===false){throw new Error(ar||"Parsing halted. No suitable error recovery rule available.")}al(ab);aq=(av==af?null:av);av=af;ac=ad[ad.length-1];au=aB[ac]&&aB[ac][af];Y=3}if(au[0] instanceof Array&&au.length>1){throw new Error("Parse Error: multiple actions possible at state: "+ac+", token: "+av)}switch(au[0]){case 1:ad.push(av);az.push(o.yytext);ai.push(o.yylloc);ad.push(au[1]);av=null;if(!aq){ax=o.yyleng;W=o.yytext;ah=o.yylineno;X=o.yylloc;if(Y>0){Y--}}else{av=aq;aq=null}break;case 2:ay=this.productions_[au[1]][1];at.$=az[az.length-ay];at._$={first_line:ai[ai.length-(ay||1)].first_line,last_line:ai[ai.length-1].last_line,first_column:ai[ai.length-(ay||1)].first_column,last_column:ai[ai.length-1].last_column};if(aa){at._$.range=[ai[ai.length-(ay||1)].range[0],ai[ai.length-1].range[1]]}aj=this.performAction.apply(at,[W,ax,ah,aA.yy,au[1],az,ai].concat(Z));if(typeof aj!=="undefined"){return aj}if(ay){ad=ad.slice(0,-1*ay*2);az=az.slice(0,-1*ay);ai=ai.slice(0,-1*ay)}ad.push(this.productions_[au[1]][0]);az.push(at.$);ai.push(at._$);V=aB[ad[ad.length-2]][ad[ad.length-1]];ad.push(V);break;case 3:return true}}return true}};var e=function(W){var X=function(){};X.prototype=B.lexer;var V=function(){this.lexer=new X();this.yy={types:[],escape:function(Y){return Y.replace(/&/gi,"&amp;").replace(/>/gi,"&gt;").replace(/</gi,"&lt;").replace(/\n/g,"\n<br>").replace(/\t/g,"&nbsp;&nbsp;&nbsp ").replace(/  /g,"&nbsp; ")},parseError:function(aa,Z){this.done=true;var Y=new String();Y.html="<pre>"+aa+"</pre>";Y.hash=Z;return Y}}};V.prototype=B;var o=new V();return o};if(typeof(window)!=="undefined"){window.Formula=e}else{B.Formula=e}var U=(function(){var W=({EOF:1,parseError:function X(af,ae){if(this.yy.parser){this.yy.parser.parseError(af,ae)}else{throw new Error(af)}},setInput:function(ae,af){this.yy=af||this.yy||{};this._input=new a.InputReader(ae);this._more=this._backtrack=this.done=false;this.yylineno=this.yyleng=0;this.yytext=this.match="";this.conditionStack=["INITIAL"];this.yylloc={first_line:1,first_column:0,last_line:1,last_column:0};if(this.options.ranges){this.yylloc.range=[0,0]}this.offset=0;return this},input:function(){var af=this._input.ch();this.yytext+=af;this.yyleng++;this.offset++;this.match+=af;var ae=af.match(/(?:\r\n?|\n).*/g);if(ae){this.yylineno++;this.yylloc.last_line++}else{this.yylloc.last_column++}if(this.options.ranges){this.yylloc.range[1]++}return af},unput:function(ag){var ae=ag.length;var af=ag.split(/(?:\r\n?|\n)/g);this._input.unCh(ae,ag);this.yytext=this.yytext.substr(0,this.yytext.length-ae);this.offset-=ae;var ai=this.match.split(/(?:\r\n?|\n)/g);this.match=this.match.substr(0,this.match.length-1);if(af.length-1){this.yylineno-=af.length-1}var ah=this.yylloc.range;this.yylloc={first_line:this.yylloc.first_line,last_line:this.yylineno+1,first_column:this.yylloc.first_column,last_column:af?(af.length===ai.length?this.yylloc.first_column:0)+ai[ai.length-af.length].length-af[0].length:this.yylloc.first_column-ae};if(this.options.ranges){this.yylloc.range=[ah[0],ah[0]+this.yyleng-ae]}this.yyleng=this.yytext.length;return this},more:function(){this._more=true;return this},reject:function(){if(this.options.backtrack_lexer){this._backtrack=true}else{return this.parseError("Lexical error on line "+(this.yylineno+1)+". You can only invoke reject() in the lexer when the lexer is of the backtracking persuasion (options.backtrack_lexer = true).\n"+this.showPosition(),{text:"",token:null,line:this.yylineno})}return this},less:function(ae){this.unput(this.match.slice(ae))},pastInput:function(){var ae=this._input.toString();var af=ae.substr(0,ae.length-this.match.length);return(af.length>20?"...":"")+af.substr(-20).replace(/\n/g,"")},upcomingInput:function(){var ae=this._input.input.substr(this._input.position,this._input.input.length-1);return(ae.substr(0,20)+(ae.length>20?"...":"")).replace(/\n/g,"")},showPosition:function(){var ae=this.pastInput();var af=new Array(ae.length+1).join("-");return ae+this.upcomingInput()+"\n"+af+"^"},test_match:function(ai,ag){var aj,ae,ah,af;if(this.options.backtrack_lexer){ah={yylineno:this.yylineno,yylloc:{first_line:this.yylloc.first_line,last_line:this.last_line,first_column:this.yylloc.first_column,last_column:this.yylloc.last_column},yytext:this.yytext,match:this.match,matches:this.matches,yyleng:this.yyleng,offset:this.offset,_more:this._more,yy:this.yy,conditionStack:this.conditionStack.slice(0),done:this.done};if(this.options.ranges){ah.yylloc.range=this.yylloc.range.slice(0)}}ae=ai.match(/(?:\r\n?|\n).*/g);if(ae){this.yylineno+=ae.length}this.yylloc={first_line:this.yylloc.last_line,last_line:this.yylineno+1,first_column:this.yylloc.last_column,last_column:ae!==null?ae[ae.length-1].length-ae[ae.length-1].match(/\r?\n?/)[0].length:this.yylloc.last_column+ai.length};this.yytext+=ai;this.match+=ai;this.matches=ai;this.yyleng=this.yytext.length;if(this.options.ranges){this.yylloc.range=[this.offset,this.offset+=this.yyleng]}this._more=false;this._backtrack=false;this._input.addMatch(ai);aj=this.performAction.call(this,this.yy,this,ag,this.conditionStack[this.conditionStack.length-1]);if(this.done&&!this._input.done){this.done=false}if(aj){return aj}else{if(this._backtrack){for(af in ah){if(ah.hasOwnProperty(af)){this[af]=ah[af]}}return null}}return null},next:function(){if(this.done){return this.EOF}if(this._input.done){this.done=true}var ai,ag,ae,af;if(!this._more){this.yytext="";this.match=""}var aj=this._currentRules();for(var ah=0;ah<aj.length;ah++){ae=this._input.match(this.rules[aj[ah]]);if(ae!==null&&(ag===undefined||ae[0].length>ag.length)){ag=ae[0];af=ah;if(this.options.backtrack_lexer){ai=this.test_match(ae[0],aj[ah]);if(ai!==null){return ai}else{if(this._backtrack){ag=undefined;continue}else{return null}}}else{if(!this.options.flex){break}}}}if(ag!==undefined){ai=this.test_match(ag,aj[af]);if(ai!==null){return ai}return null}if(this._input.done){return this.EOF}else{return this.parseError("Lexical error on line "+(this.yylineno+1)+". Unrecognized text.\n"+this.showPosition(),{text:"",token:null,line:this.yylineno})}},lex:function o(){var ae=this.next();if(ae!==null){return ae}else{return this.lex()}},begin:function V(ae){this.conditionStack.push(ae)},popState:function Y(){var ae=this.conditionStack.length-1;if(ae>0){return this.conditionStack.pop()}else{return this.conditionStack[0]}},_currentRules:function ad(){if(this.conditionStack.length&&this.conditionStack[this.conditionStack.length-1]){return this.conditions[this.conditionStack[this.conditionStack.length-1]].rules}else{return this.conditions.INITIAL.rules}},topState:function ab(ae){ae=this.conditionStack.length-1-Math.abs(ae||0);if(ae>=0){return this.conditionStack[ae]}else{return"INITIAL"}},pushState:function aa(ae){this.begin(ae)},stateStackSize:function Z(){return this.conditionStack.length},options:{},performAction:function ac(ai,af,ah,ae){var ag=ae;switch(ah){case 0:break;case 1:return 25;break;case 2:return 7;break;case 3:return 8;break;case 4:return 30;break;case 5:af.yytext=af.yytext.substring(1,af.yytext.length-1);return 30;break;case 6:return 10;break;case 7:return 10;break;case 8:return 11;break;case 9:return 11;break;case 10:return 12;break;case 11:return 37;break;case 12:return 37;break;case 13:return 32;break;case 14:return 33;break;case 15:return 13;break;case 16:return" ";break;case 17:return 38;break;case 18:return 29;break;case 19:return 35;break;case 20:return 36;break;case 21:return 21;break;case 22:return 22;break;case 23:return 20;break;case 24:return 15;break;case 25:return 23;break;case 26:return 16;break;case 27:return 17;break;case 28:return 19;break;case 29:return 18;break;case 30:return"PI";break;case 31:return 24;break;case 32:return'"';break;case 33:return"'";break;case 34:return'"';break;case 35:return"'";break;case 36:return"!";break;case 37:return 14;break;case 38:return 39;break;case 39:return 34;break;case 40:return"#";break;case 41:return 4;break}},rules:[/^(?:\s+)/,/^(?:([A-Za-z]{1,})([A-Za-z_0-9]+)?(?=[(]))/,/^(?:([0]?[1-9]|1[0-2])[:][0-5][0-9]([:][0-5][0-9])?[ ]?(AM|am|aM|Am|PM|pm|pM|Pm))/,/^(?:([0]?[0-9]|1[0-9]|2[0-3])[:][0-5][0-9]([:][0-5][0-9])?)/,/^(?:(([A-Za-z0-9]+))(?=[!]))/,/^(?:((['](\\[']|[^'])*['])|(["](\\["]|[^"])*["]))(?=[!]))/,/^(?:((['](\\[']|[^'])*['])))/,/^(?:((["](\\["]|[^"])*["])))/,/^(?:(([\\]['].+?[\\]['])))/,/^(?:(([\\]["].+?[\\]["])))/,/^(?:[A-Z]+(?=[0-9$]))/,/^(?:[A-Za-z]{1,}[A-Za-z_0-9]+)/,/^(?:[A-Za-z_]+)/,/^(?:[0-9]+)/,/^(?:\$)/,/^(?:&)/,/^(?: )/,/^(?:[.])/,/^(?::)/,/^(?:;)/,/^(?:,)/,/^(?:\*)/,/^(?:\/)/,/^(?:-)/,/^(?:\+)/,/^(?:\^)/,/^(?:\()/,/^(?:\))/,/^(?:>)/,/^(?:<)/,/^(?:PI\b)/,/^(?:E\b)/,/^(?:")/,/^(?:')/,/^(?:\\")/,/^(?:\\')/,/^(?:!)/,/^(?:=)/,/^(?:%)/,/^(?:#REF!)/,/^(?:[#])/,/^(?:$)/],conditions:{INITIAL:{rules:[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41],inclusive:true}}});return W})();B.lexer=U;function a(){this.yy={}}a.prototype=B;a.InputReader=(function(W,V,Z){var Y=RegExp.prototype.sticky!==undefined,ah,ae,af,aa;function ai(aj){this.done=false;this.input=aj;this.length=aj.length;this.matches=[];this.position=0}if(Y){ai.prototype={addMatch:function ag(aj){this.matches.push(aj);this.position+=aj.length;this.done=(this.position>=this.length)},ch:function o(){var aj=this.input[this.position];this.addMatch(aj);return aj},unCh:function ad(aj){this.position-=aj;this.position=W.max(0,this.position);this.done=(this.position>=this.length)},substring:function ac(ak,aj){ak=(ak!=0?this.position+ak:this.position);aj=(aj!=0?ak+aj:this.length);return this.input.substring(ak,aj)},match:function ab(ak){var aj;ak.lastIndex=this.position;if((aj=ak.exec(this.input))!==null){return aj}return null},toString:function X(){return this.matches.join("")}};ah=Z.rules;af=ah.length;aa=0;for(;aa<af;aa++){ae=ah[aa];ah[aa]=new RegExp(ae.source.substring(1),"y")}}else{ai.prototype={addMatch:function ag(aj){this.input=this.input.slice(aj.length);this.matches.push(aj);this.position+=aj.length;this.done=(this.position>=this.length)},ch:function o(){var aj=this.input[0];this.addMatch(aj);return aj},unCh:function ad(ak,aj){this.position-=ak;this.position=W.max(0,this.position);this.input=aj+this.input;this.done=(this.position>=this.length)},substring:function ac(ak,aj){ak=(ak!=0?this.position+ak:this.position);aj=(aj!=0?ak+aj:this.length);return this.input.substring(ak,aj)},match:function ab(al){var ak,aj=this.input;if((ak=aj.match(al))!==null){return ak}return null},toString:function X(){return this.matches.join("")}}}return ai})(Math,B,U);B.Parser=a;return new a})();if(typeof require!=="undefined"&&typeof exports!=="undefined"){exports.parser=parser;exports.Parser=parser.Parser;exports.parse=function(){return parser.parse.apply(parser,arguments)};exports.main=function commonjsMain(a){if(!a[1]){console.log("Usage: "+a[0]+" FILE");process.exit(1)}var b=require("fs").readFileSync(require("path").normalize(a[1]),"utf8");return exports.parser.parse(b)};if(typeof module!=="undefined"&&require.main===module){exports.main(process.argv.slice(1))}}var parser=(function(){var n=function(x,w,y,t){for(y=y||{},t=x.length;t--;y[x[t]]=w){}return y},l=[1,10],j=[1,11],i=[1,12],h=[1,13],g=[5,7,8,9,10],f=[1,19],c=[1,20],a=[5,7,8,9,10,12,13],s=[1,21],r=[5,7,8,9,10,12,13,14,16];var k={trace:function p(){},yy:{},symbols_:{error:2,grid:3,rows:4,EOF:5,row:6,END_OF_LINE:7,END_OF_LINE_WITH_EMPTY_NEXT_FIRST_COLUMN:8,END_OF_LINE_WITH_NO_COLUMNS:9,END_OF_LINE_WITH_EMPTY_COLUMN:10,string:11,COLUMN_EMPTY:12,COLUMN_STRING:13,CHAR:14,QUOTE_ON:15,QUOTE_OFF:16,"$accept":0,"$end":1},terminals_:{2:"error",5:"EOF",7:"END_OF_LINE",8:"END_OF_LINE_WITH_EMPTY_NEXT_FIRST_COLUMN",9:"END_OF_LINE_WITH_NO_COLUMNS",10:"END_OF_LINE_WITH_EMPTY_COLUMN",12:"COLUMN_EMPTY",13:"COLUMN_STRING",14:"CHAR",15:"QUOTE_ON",16:"QUOTE_OFF"},productions_:[0,[3,2],[3,1],[4,1],[4,1],[4,1],[4,1],[4,1],[4,2],[4,2],[4,2],[4,2],[4,3],[4,3],[4,3],[4,3],[6,1],[6,1],[6,2],[6,3],[6,1],[6,2],[6,3],[11,1],[11,2],[11,3]],performAction:function e(o,w,x,A,z,v,y){var t=v.length-1;switch(z){case 1:return v[t-1];break;case 2:return[[""]];break;case 3:this.$=[v[t]];break;case 4:this.$=[];break;case 5:this.$=[""];break;case 6:this.$=[""];break;case 7:this.$=[""];break;case 8:this.$=v[t-1];break;case 9:v[t-1].push([""]);this.$=v[t-1];break;case 10:v[t-1].push([""]);this.$=v[t-1];break;case 11:v[t-1][v[t-1].length-1].push("");this.$=v[t-1];break;case 12:v[t-2].push(v[t]);this.$=v[t-2];break;case 13:v[t].unshift("");v[t-2].push(v[t]);this.$=v[t-2];break;case 14:v[t-2].push([""]);v[t-2].push(v[t]);this.$=v[t-2];break;case 15:v[t-2][v[t-2].length-1].push("");v[t-2].push(v[t]);this.$=v[t-2];break;case 16:this.$=[v[t].join("")];break;case 17:this.$=[""];break;case 18:v[t-1].push("");this.$=v[t-1];break;case 19:v[t-2].push("");v[t-2].push(v[t].join(""));this.$=v[t-2];break;case 20:break;case 21:break;case 22:v[t-2].push(v[t].join(""));this.$=v[t-2];break;case 23:this.$=[v[t]];break;case 24:v[t-1].push(v[t]);this.$=v[t-1];break;case 25:this.$=v[t-1];break}},table:[{3:1,4:2,5:[1,3],6:4,7:[1,5],8:[1,6],9:[1,7],10:[1,8],11:9,12:l,13:j,14:i,15:h},{1:[3]},{5:[1,14],7:[1,15],8:[1,16],9:[1,17],10:[1,18]},{1:[2,2]},n(g,[2,3],{12:f,13:c}),n(g,[2,4]),n(g,[2,5]),n(g,[2,6]),n(g,[2,7]),n(a,[2,16],{14:s}),n(a,[2,17]),n(a,[2,20]),n(r,[2,23]),{11:22,14:i,15:h},{1:[2,1]},n(g,[2,8],{11:9,6:23,12:l,13:j,14:i,15:h}),n(g,[2,9],{11:9,6:24,12:l,13:j,14:i,15:h}),n(g,[2,10],{11:9,6:25,12:l,13:j,14:i,15:h}),n(g,[2,11],{11:9,6:26,12:l,13:j,14:i,15:h}),n(a,[2,18],{11:27,14:i,15:h}),n(a,[2,21],{11:28,14:i,15:h}),n(r,[2,24]),{14:s,16:[1,29]},n(g,[2,12],{12:f,13:c}),n(g,[2,13],{12:f,13:c}),n(g,[2,14],{12:f,13:c}),n(g,[2,15],{12:f,13:c}),n(a,[2,19],{14:s}),n(a,[2,22],{14:s}),n(r,[2,25])],defaultActions:{3:[2,2],14:[2,1]},parseError:function q(t,o){if(o.recoverable){this.trace(t)}else{throw new Error(t)}},parse:function m(E){var M=this,B=[0],L=[],W=[null],G=[],Y=this.table,v="",F=0,U=0,x=0,D=2,K=1;var y=G.slice.call(arguments,1);var o=Object.create(this.lexer);var X={yy:{}};for(var T in this.yy){if(Object.prototype.hasOwnProperty.call(this.yy,T)){X.yy[T]=this.yy[T]}}o.setInput(E,X.yy);X.yy.lexer=o;X.yy.parser=this;if(typeof o.yylloc=="undefined"){o.yylloc={}}var w=o.yylloc;G.push(w);var z=o.options&&o.options.ranges;if(typeof X.yy.parseError==="function"){this.parseError=X.yy.parseError}else{this.parseError=Object.getPrototypeOf(this).parseError}function J(aa){B.length=B.length-2*aa;W.length=W.length-aa;G.length=G.length-aa}_token_stack:function I(){var aa;aa=o.lex()||K;if(typeof aa!=="number"){aa=M.symbols_[aa]||aa}return aa}var S,O,A,R,Z,H,Q={},N,V,t,C;while(true){A=B[B.length-1];if(this.defaultActions[A]){R=this.defaultActions[A]}else{if(S===null||typeof S=="undefined"){S=I()}R=Y[A]&&Y[A][S]}if(typeof R==="undefined"||!R.length||!R[0]){var P="";C=[];for(N in Y[A]){if(this.terminals_[N]&&N>D){C.push("'"+this.terminals_[N]+"'")}}if(o.showPosition){P="Parse error on line "+(F+1)+":\n"+o.showPosition()+"\nExpecting "+C.join(", ")+", got '"+(this.terminals_[S]||S)+"'"}else{P="Parse error on line "+(F+1)+": Unexpected "+(S==K?"end of input":"'"+(this.terminals_[S]||S)+"'")}this.parseError(P,{text:o.match,token:this.terminals_[S]||S,line:o.yylineno,loc:w,expected:C})}if(R[0] instanceof Array&&R.length>1){throw new Error("Parse Error: multiple actions possible at state: "+A+", token: "+S)}switch(R[0]){case 1:B.push(S);W.push(o.yytext);G.push(o.yylloc);B.push(R[1]);S=null;if(!O){U=o.yyleng;v=o.yytext;F=o.yylineno;w=o.yylloc;if(x>0){x--}}else{S=O;O=null}break;case 2:V=this.productions_[R[1]][1];Q.$=W[W.length-V];Q._$={first_line:G[G.length-(V||1)].first_line,last_line:G[G.length-1].last_line,first_column:G[G.length-(V||1)].first_column,last_column:G[G.length-1].last_column};if(z){Q._$.range=[G[G.length-(V||1)].range[0],G[G.length-1].range[1]]}H=this.performAction.apply(Q,[v,U,F,X.yy,R[1],W,G].concat(y));if(typeof H!=="undefined"){return H}if(V){B=B.slice(0,-1*V*2);W=W.slice(0,-1*V);G=G.slice(0,-1*V)}B.push(this.productions_[R[1]][0]);W.push(Q.$);G.push(Q._$);t=Y[B[B.length-2]][B[B.length-1]];B.push(t);break;case 3:return true}}return true}};if(typeof GLOBAL!=="undefined"){GLOBAL.window=GLOBAL}if(typeof window.TSV==="undefined"){var m=k.parse;k.parse=function(o){var t=this.lexer.setInput;this.lexer.setInput=function(v){t.call(this,v);this.begin("BOF");return this};this.parse=m;return m.call(this,o)};window.TSV=function(t){var w=function(){};w.prototype=k.lexer;var v=function(){this.lexer=new w();this.yy={}};v.prototype=k;var o=new v;o.setObj=function(x){o.yy.obj=x};o.yy.handler=t;return o}}var b=(function(){var v=({EOF:1,parseError:function w(E,D){if(this.yy.parser){this.yy.parser.parseError(E,D)}else{throw new Error(E)}},setInput:function(D,E){this.yy=E||this.yy||{};this._input=D;this._more=this._backtrack=this.done=false;this.yylineno=this.yyleng=0;this.yytext=this.matched=this.match="";this.conditionStack=["INITIAL"];this.yylloc={first_line:1,first_column:0,last_line:1,last_column:0};if(this.options.ranges){this.yylloc.range=[0,0]}this.offset=0;return this},input:function(){var E=this._input[0];this.yytext+=E;this.yyleng++;this.offset++;this.match+=E;this.matched+=E;var D=E.match(/(?:\r\n?|\n).*/g);if(D){this.yylineno++;this.yylloc.last_line++}else{this.yylloc.last_column++}if(this.options.ranges){this.yylloc.range[1]++}this._input=this._input.slice(1);return E},unput:function(F){var D=F.length;var E=F.split(/(?:\r\n?|\n)/g);this._input=F+this._input;this.yytext=this.yytext.substr(0,this.yytext.length-D);this.offset-=D;var H=this.match.split(/(?:\r\n?|\n)/g);this.match=this.match.substr(0,this.match.length-1);this.matched=this.matched.substr(0,this.matched.length-1);if(E.length-1){this.yylineno-=E.length-1}var G=this.yylloc.range;this.yylloc={first_line:this.yylloc.first_line,last_line:this.yylineno+1,first_column:this.yylloc.first_column,last_column:E?(E.length===H.length?this.yylloc.first_column:0)+H[H.length-E.length].length-E[0].length:this.yylloc.first_column-D};if(this.options.ranges){this.yylloc.range=[G[0],G[0]+this.yyleng-D]}this.yyleng=this.yytext.length;return this},more:function(){this._more=true;return this},reject:function(){if(this.options.backtrack_lexer){this._backtrack=true}else{return this.parseError("Lexical error on line "+(this.yylineno+1)+". You can only invoke reject() in the lexer when the lexer is of the backtracking persuasion (options.backtrack_lexer = true).\n"+this.showPosition(),{text:"",token:null,line:this.yylineno})}return this},less:function(D){this.unput(this.match.slice(D))},pastInput:function(){var D=this.matched.substr(0,this.matched.length-this.match.length);return(D.length>20?"...":"")+D.substr(-20).replace(/\n/g,"")},upcomingInput:function(){var D=this.match;if(D.length<20){D+=this._input.substr(0,20-D.length)}return(D.substr(0,20)+(D.length>20?"...":"")).replace(/\n/g,"")},showPosition:function(){var D=this.pastInput();var E=new Array(D.length+1).join("-");return D+this.upcomingInput()+"\n"+E+"^"},test_match:function(H,F){var I,D,G;if(this.options.backtrack_lexer){G={yylineno:this.yylineno,yylloc:{first_line:this.yylloc.first_line,last_line:this.last_line,first_column:this.yylloc.first_column,last_column:this.yylloc.last_column},yytext:this.yytext,match:this.match,matches:this.matches,matched:this.matched,yyleng:this.yyleng,offset:this.offset,_more:this._more,_input:this._input,yy:this.yy,conditionStack:this.conditionStack.slice(0),done:this.done};if(this.options.ranges){G.yylloc.range=this.yylloc.range.slice(0)}}D=H[0].match(/(?:\r\n?|\n).*/g);if(D){this.yylineno+=D.length}this.yylloc={first_line:this.yylloc.last_line,last_line:this.yylineno+1,first_column:this.yylloc.last_column,last_column:D?D[D.length-1].length-D[D.length-1].match(/\r?\n?/)[0].length:this.yylloc.last_column+H[0].length};this.yytext+=H[0];this.match+=H[0];this.matches=H;this.yyleng=this.yytext.length;if(this.options.ranges){this.yylloc.range=[this.offset,this.offset+=this.yyleng]}this._more=false;this._backtrack=false;this._input=this._input.slice(H[0].length);this.matched+=H[0];I=this.performAction.call(this,this.yy,this,F,this.conditionStack[this.conditionStack.length-1]);if(this.done&&this._input){this.done=false}if(I){return I}else{if(this._backtrack){for(var E in G){this[E]=G[E]}return false}}return false},next:function(){if(this.done){return this.EOF}if(!this._input){this.done=true}var H,F,D,E;if(!this._more){this.yytext="";this.match=""}var I=this._currentRules();for(var G=0;G<I.length;G++){D=this._input.match(this.rules[I[G]]);if(D&&(!F||D[0].length>F[0].length)){F=D;E=G;if(this.options.backtrack_lexer){H=this.test_match(D,I[G]);if(H!==false){return H}else{if(this._backtrack){F=false;continue}else{return false}}}else{if(!this.options.flex){break}}}}if(F){H=this.test_match(F,I[E]);if(H!==false){return H}return false}if(this._input===""){return this.EOF}else{return this.parseError("Lexical error on line "+(this.yylineno+1)+". Unrecognized text.\n"+this.showPosition(),{text:"",token:null,line:this.yylineno})}},lex:function o(){var D=this.next();if(D){return D}else{return this.lex()}},begin:function t(D){this.conditionStack.push(D)},popState:function x(){var D=this.conditionStack.length-1;if(D>0){return this.conditionStack.pop()}else{return this.conditionStack[0]}},_currentRules:function C(){if(this.conditionStack.length&&this.conditionStack[this.conditionStack.length-1]){return this.conditions[this.conditionStack[this.conditionStack.length-1]].rules}else{return this.conditions.INITIAL.rules}},topState:function A(D){D=this.conditionStack.length-1-Math.abs(D||0);if(D>=0){return this.conditionStack[D]}else{return"INITIAL"}},pushState:function z(D){this.begin(D)},stateStackSize:function y(){return this.conditionStack.length},options:{},performAction:function B(H,E,G,D){var F=D;switch(G){case 0:return 14;break;case 1:this.popState();return 16;break;case 2:if(E.yytext==this.quoteChar){this.popState();this.begin("STRING");return 16}else{return 14}break;case 3:this.popState();this.begin("STRING");return 14;break;case 4:this.popState();this.quoteChar=E.yytext.substring(0);this.begin("QUOTE");return 15;break;case 5:this.quoteChar=E.yytext;this.popState();this.begin("QUOTE");return 15;break;case 6:this.begin("PRE_QUOTE");return 13;break;case 7:this.begin("PRE_QUOTE");return 7;break;case 8:return 14;break;case 9:this.popState();return 8;break;case 10:this.popState();return 9;break;case 11:this.popState();return 7;break;case 12:this.popState();return 13;break;case 13:return 14;break;case 14:this.popState();break;case 15:return"BUFFIN";break;case 16:return 9;break;case 17:return 10;break;case 18:return 12;break;case 19:return 7;break;case 20:this.begin("STRING");return 14;break;case 21:return 5;break}},rules:[/^(?:(\n|\\n))/,/^(?:([\'\"])(?=$))/,/^(?:([\'\"]))/,/^(?:(?=(\t)))/,/^(?:([\'\"]))/,/^(?:([\'\"]))/,/^(?:(\t|\\t)(?=[\'\"]))/,/^(?:(\n|\\n)(?=[\'\"]))/,/^(?:([a-zA-Z0-9_ ]+|.))/,/^(?:(\n\t|\\n\\t))/,/^(?:(\n\n|\\n\\n))/,/^(?:(\n|\\n))/,/^(?:(\t|\\t))/,/^(?:([a-zA-Z0-9_ ]+|.))/,/^(?:)/,/^(?:(\n\t|\\n\\t)(?=.))/,/^(?:(\n\n|\\n\\n))/,/^(?:(\t\n))/,/^(?:(\t))/,/^(?:(\n))/,/^(?:([a-zA-Z0-9_ ]+|.))/,/^(?:$)/],conditions:{BOF:{rules:[4,6,7,14,15,16,17,18,19,20,21],inclusive:true},PRE_QUOTE:{rules:[5,6,7,15,16,17,18,19,20,21],inclusive:true},QUOTE:{rules:[0,1,2,3,6,7,8,15,16,17,18,19,20,21],inclusive:true},STRING:{rules:[6,7,9,10,11,12,13,15,16,17,18,19,20,21],inclusive:true},INITIAL:{rules:[6,7,15,16,17,18,19,20,21],inclusive:true}}});return v})();k.lexer=b;function d(){this.yy={}}d.prototype=k;k.Parser=d;return new d})();if(typeof require!=="undefined"&&typeof exports!=="undefined"){exports.parser=parser;exports.Parser=parser.Parser;exports.parse=function(){return parser.parse.apply(parser,arguments)};exports.main=function commonjsMain(a){if(!a[1]){console.log("Usage: "+a[0]+" FILE");process.exit(1)}var b=require("fs").readFileSync(require("path").normalize(a[1]),"utf8");return exports.parser.parse(b)};if(typeof module!=="undefined"&&require.main===module){exports.main(process.argv.slice(1))}};