var WickedGrid=function(e,t,i,r,l,o,a,h,c,u,d){"use strict";function f(){}function p(t){this.settings=t,this.element=t.element,this.$element=e(t.element),this.tsv=new TSV,this.cellEvents=new p.event.Cell(this),this.documentEvents=new p.event.Document(this),this.formulaEvents=new p.event.Formula(this),this.cl=p.cl,this.msg=p.msg,this.undo=new p.Undo(this),this.controls={autoFiller:[],bar:{helper:[],corner:[],x:{controls:[],handleFreeze:[],menu:[],menuParent:[],parent:[],th:[],ths:function(){for(var e=[],t=0,n=this.th[wickedGrid.i],i=n.length;t<i;t++)e.push(n[t]);return e}},y:{controls:[],handleFreeze:[],menu:[],parent:[],th:[],ths:function(){for(var e=[],t=0,n=this.th[wickedGrid.i],i=n.length;t<i;t++)e.push(n[t]);return e}}},barMenuLeft:[],barMenuTop:[],barLeft:[],barTop:[],barTopParent:[],chart:[],menu:[],cellsEdited:[],enclosures:[],formula:null,header:null,inPlaceEdit:[],inputs:[],label:null,headerMenu:[],menus:[],pane:[],panes:null,scrolls:null,sheetAdder:null,tab:[],tabContainer:null,tabs:null,title:null,toggleHide:{x:[],y:[]},ui:null},this.i=0,this.sheetCount=0,this.spreadsheets=[];var n=this,r=this.element,l=this.$element,s=[],o=e(i),a=d;p.defaults.useStack&&i.thaw!==a?i.thaw:function(e,t){t=t||{};var n,i=0,r=e.length,l=t.each||function(){},s=t.done||function(){};if(e[0].call!==a)for(;i<r;i++)(n=e[i])();else{for(;i<r;i++)n=e[i],l.apply(n);s()}};for(this.setBusy(!0),i.scrollBarSize===a&&(i.scrollBarSize=g()),this.cellHandler=new p.CellHandler(this,p.functions),this.theme=new p.Theme(t.theme),this.highlighter=new p.Highlighter(this.theme.tdHighlighted,this.theme.barHighlight,this.theme.tabActive,function(){});null!==r.firstChild;)s.push(r.removeChild(r.firstChild));r.className+=" "+p.cl.element,l.bind("sheetSwitch",function(e,t,i){n.switchSheet(i)}).bind("sheetRename",function(e,t,i){n.renameSheet(i)}),this.width=t.width||r.clientWidth,this.height=t.height||r.clientHeight,e.nearest||(e.nearest=f),this.resizableCells=this.resizableSheet=this.resizable,e.ui?(t.resizableCells||(this.resizableCells=f),t.resizableSheet||(this.resizableSheet=f)):this.resizable=this.resizableCells=this.resizableSheet=this.draggable=f,e.support.boxModel||(t.boxModelCorrection=0),o.resize(function(){n.isBusy()||(n.width=r.clientWidth,n.height=parent.clientHeight,n.sheetSyncSize())}).unload(function(){p.thread.kill()}),p.fn=e.extend(p.functions,t.formulaFunctions),p.plugin.finance&&(p.fn=e.extend(p.functions,p.plugin.finance)),t.title=t.title||r.getAttribute("title")||"",this.parseFormula=t.useMultiThreads?this.parseFormulaAsync:this.parseFormulaSync,r.className+=" "+this.theme.parent,null===t.loader&&(t.loader=new p.loader.HTML(s)),this.loader=t.loader.bindWickedGrid(this).bindHandler(this.cellHandler),this.cellContextMenu=null,this.columnMenu=null,this.columnContextMenu=null,this.rowContextMenu=null,this.setupMenus(),this.openSheet().setBusy(!1)}function m(e,t){var n;for(n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);return e}function g(){var n=e(t.createElement("p")).css({width:"100%",height:"100%"}),i=e(t.createElement("div")).css({position:"absolute",width:"100px",height:"100px",top:"0",left:"0",visibility:"hidden",overflow:"hidden"}).append(n);e(t.body).append(i);var r=n.width(),l=n.height();i.css("overflow","scroll");var s=n.width(),o=n.height();r==s&&i[0].clientWidth&&(s=i[0].clientWidth),l==o&&i[0].clientHeight&&(o=i[0].clientHeight),i.detach();var a=r-s,h=l-o;return{width:a||15,height:h||15}}function w(e){var n=null,i=w.parser||(w.parser=t.createElement("span"));for(i.innerHTML=e;null!==i.lastChild;)n=i.removeChild(i.lastChild);return n}function y(e){e.onselectstart=function(){return!1},e.unselectable="on",e.style["-moz-user-select"]="none"}var v=d;p.prototype={cl:p.cl,msg:p.msg,setupMenus:function(){var e=this.settings;return this.cellContextMenu=new p.CellContextMenu(this,p.menu(this,e.cellContextMenuButtons)),this.columnMenu=new p.ColumnMenu(this,p.menu(this,e.columnMenuButtons)),this.columnContextMenu=new p.ColumnContextMenu(this,p.menu(this,e.columnContextMenuButtons)),this.rowContextMenu=new p.RowContextMenu(this,p.menu(this,e.rowContextMenuButtons)),this},autoFiller:function(){return this.controls.autoFiller[this.i]||null},corner:function(){return this.controls.bar.corner[this.i]||e([])},barHelper:function(){return this.controls.bar.helper[this.i]||(this.controls.bar.helper[this.i]=e([]))},barLeft:function(e){return this.controls.bar.y.th[this.i]&&this.controls.bar.y.th[this.i][e]?this.controls.bar.y.th[this.i][e]:[]},barLeftControls:function(){return this.controls.bar.y.controls[this.i]||e([])},barLefts:function(){return this.controls.bar.y.ths()},barHandleFreezeLeft:function(){return this.controls.bar.y.handleFreeze[this.i]||e([])},barMenuLeft:function(){return this.controls.bar.y.menu[this.i]||e([])},barTop:function(e){return this.controls.bar.x.th[this.i]&&this.controls.bar.x.th[this.i][e]?this.controls.bar.x.th[this.i][e]:[]},barTopControls:function(){return this.controls.bar.x.controls[this.i]||e([])},barTops:function(){return this.controls.bar.x.ths()},barTopParent:function(){return this.controls.bar.x.parent[this.i]||e([])},barHandleFreezeTop:function(){return this.controls.bar.x.handleFreeze[this.i]||e([])},barMenuParentTop:function(){return this.controls.bar.x.menuParent[this.i]||e([])},barMenuTop:function(){return this.controls.bar.x.menu[this.i]||e([])},tdActive:function(){return null!==this.cellLast?this.cellLast.td:null},cellActive:function(){return this.cellLast},menu:function(){return this.controls.menu[this.i]||e([])},cellsEdited:function(){return this.controls.cellsEdited!==v?this.controls.cellsEdited:this.controls.cellsEdited=[]},chart:function(){return this.controls.chart[this.i]||e([])},enclosure:function(){return this.controls.enclosures[this.i]||[]},enclosures:function(){return this.controls.enclosures||[]},formula:function(){return this.controls.formula||e([])},header:function(){return this.controls.header||e([])},highlighted:function(){return this.highlighter.last||e([])},inPlaceEdit:function(){return this.controls.inPlaceEdit[this.i]||e([])},inputs:function(){return this.controls.inputs[this.i]||e([])},label:function(){return this.controls.label||e([])},menus:function(){return this.controls.menus[this.i]||e([])},headerMenu:function(){return this.controls.headerMenu[this.i]||e([])},pane:function(){return this.controls.pane[this.i]||{}},panes:function(){return this.controls.panes||e([])},element:function(){return this.settings.element},scrolls:function(){return this.controls.scrolls||e([])},sheetAdder:function(){return this.controls.sheetAdder||e([])},tab:function(){return this.controls.tab[this.i]||e([])},tabs:function(){return this.controls.tabs||e([])},tabContainer:function(){return this.controls.tabContainer||e([])},title:function(){return this.controls.title||e([])},kill:function(){var n=p.instances.indexOf(this),i=this.element,r=e(i);return!(n<0)&&(e(t).unbind("keydown"),this.fullScreen.kill(),(this.inPlaceEdit().destroy||f)(),r.trigger("sheetKill").removeClass(this.theme.element).html(""),this.menus().remove(),p.events.forEach(r.unbind),p.instances.splice(n,1),!0)},trigger:function(e,t){return t=t||[],this.$element.triggerHandler(e,[this].concat(t)),this},getCell:function(e,t,n){var i,r,l;if((i=this.spreadsheets[e])!==v&&(r=i[t])!==v&&(l=r[n])!==v||(l=this.loader.jitCell(e,t,n)),l===v||null===l)return null;if("WickedGrid.Cell"!==l.typeName)throw new u("Wrong Constructor");return l.sheetIndex=e,l.rowIndex=t,l.columnIndex=n,l},cellFromTd:function(e){if(e.thisCell!==v&&null!==e._cell)return e._cell;for(var t,n,i,r=this.locationFromTd(e),l=this.spreadsheets[this.i],s=l.length,o=r.row,a=r.col;s<=o&&l[s]===v;)l[s++]=[];for(t=l[r.row],n=t.length,a=r.col;n<a&&t[n]===v;)t[n++]=null;return i=t[n]=new p.Cell(this.i,e,this),i.columnIndex=r.col,i.rowIndex=r.row,i},getCellById:function(e,t,n){var i,r=this.loader;return"function"==typeof t?(i=-1,n=t):(i=t,"string"==typeof i&&(i=r.getSpreadsheetIndexByTitle(i))),this.isBusy()?this.whenNotBusy(function(){r.jitCellById(e,i,n)}):r.jitCellById(e,i,n),this},getCells:function(e,t,n){var i,r,l,s,o=0,a=e.length,h=[],c=0;return"function"==typeof t?(s=-1,n=t):(s=t,"string"==typeof s&&(s=loader.getSpreadsheetIndexByTitle(s))),this.whenNotBusy(function(){for(;o<a;o++)i=e[o],"string"==typeof i?!function(e){this.getCellById(i,s,function(t){h[e]=t,c++,c===a&&n.apply(this,h)})}(o):(r=i,l=this.getCell(r.sheet,r.rowIndex,r.columnIndex),null!==l&&(h[o]=l,c++,c===a&&n.apply(jS,h)))}),this},updateCells:function(e,t,n){var i;return"function"==typeof t?(i=-1,n=t):(i=t,"string"==typeof i&&(i=loader.getSpreadsheetIndexByTitle(i))),this.getCells(e,i,function(){for(var e=arguments,t=e.length,i=t-1,r=[],l=0;l<t;l++)!function(t){e[t].updateValue(function(e){i--,r[t]=e,i<0&&n.apply(jS,r)})}(l)}),this},nav:!1,setNav:function(e){for(var t=p.instances,n=0;n<t.length;n++)(t[n]||{}).nav=!1;this.nav=e},addRowMulti:function(e,t,n){function i(t){var i=0;if(t>0){for(;i<t;i++)r.addColumn(e,n,!0);r.trigger("sheetAddRow",[e,n,t])}}var r=this;t?i(t):this.settings.prompt(this.msg.addRowMulti,i)},addColumnMulti:function(e,t,n){function i(t){var i=0;if(t>0){for(;i<t;i++)r.addColumn(e,n,!0);r.trigger("sheetAddColumn",[e,n,t])}}var r=this;t?i(t):this.settings.prompt(this.msg.addColumnMulti,i)},addRow:function(e,t,n){var i=this.loader,r=0,l=i.size(this.i),s=l.cols,o=this.spreadsheets[this.i],a=[],h=this.i,c=this.pane();for(t===d&&(t=l.rows-1),e&&t++;r<s;r++)a.push(new p.Cell(h,null,this));o.splice(t,0,a),i.addRow(this.i,t,a),c.actionUI.redrawRows(),n!==!0&&this.trigger("sheetAddRow",[t,e,1])},addColumn:function(e,t,n){var i,r,l=this.loader,s=0,o=l.size(this.i),a=o.rows,h=[],c=this.spreadsheets[this.i],u=this.i,f=this.pane();for(t===d&&(t=o.cols-1),e&&t++;s<a;s++)r=new p.Cell(u,null,this),h.push(r),i=c[s],i.splice(t,0,r);l.addColumn(this.i,t,h),f.actionUI.redrawColumns(),n!==!0&&this.trigger("sheetAddColumn",[t,e,1])},autoFillerNotGroup:!0,updateCellsAfterPasteToFormula:function(e){var t=0,n=this.formula(),i=this.cellLast;e=e||n.val();var r=n.val(),l=r;if(0==i.rowIndex&&0==i.columnIndex||0===r.length)return!1;var s=this.tsv.parse(r);if(s.constructor!==Array)return n.val(s),this.fillUpOrDown(!1,s),!0;for(var o,a,h,c,u=0;u<s.length;u++)i.isEdit=!0,o=s[u],o.forEach(function(e,n){t++,(a=this.spreadsheets[this.i])&&(h=a[u+i.rowIndex])&&(c=h[n+i.columnIndex])&&c&&(this.resolveCell(c,function(){"="==(e+"").charAt(0)?(c.formula=e.substring(1),c.value=""):(c.formula="",c.value=e)}),0==u&&0==n&&(l=e))});return r!=l&&n.val(l),this.fillUpOrDown(!1,l),this.cellEditDone(!0),!0},refreshColumnLabels:function(t){t=t||0;var n=this.barMenuParentTop();if(n&&n.length){var i=n.get(0);e.isFunction(i.destroy)&&i.destroy()}var r,l=this.controls.bar.x.th[this.i];if(l)for(var s=h.max(t,0);s<l.length;s++)s>0&&(r=l[s],r.innerHTML=r.label=this.cellHandler.columnLabelString(r.cellIndex))},refreshRowLabels:function(e,t){e=e||0;var n,i=this.controls.bar.y.th[this.i];if(i){t=t||i.length;for(var r=e;r<t;r++)r>0&&(n=i[r])!==v&&(n.innerHTML=n.label=n.parentNode.rowIndex)}},isCell:function(e){return"TD"===e.nodeName&&e.parentNode.parentNode.parentNode.parentNode===this.pane()&&e.hasOwnProperty("_cell")},isBar:function(e){return"TH"===e.tagName},readOnly:[],isSheetEditable:function(e){return e=e||this.i,1==this.settings.editable&&!this.readOnly[e]},isFormulaEditable:function(e){return!this.settings.lockFormulas||e.data("formula")===v},toggleFullScreen:function(){this.controls.fullscreen||(this.controls.fullscreen=new p.FullScreen(this)),this.controls.fullscreen.toggle()},renameSheet:function(e){return!n(e)&&(e>-1&&this.sheetTab(),!0)},switchSheet:function(e){return!n(e)&&(e==-1?this.addSheet():e!=this.i&&(this.setActiveSheet(e),null===this.loader&&this.calc(e)),!0)},toggleHideRow:function(e){if(e===d&&(e=this.rowLast),e!==d){var t=this.pane().actionUI;t.hiddenRows.indexOf(e)>-1?t.showRow(e):t.hideRow(e),this.autoFillerGoToTd()}},toggleHideRowRange:function(e,t){var n=this.pane().actionUI;n.hiddenRows.indexOf(e)>-1?n.showRowRange(e,t):n.hideRowRange(e,t),this.autoFillerGoToTd()},toggleHideColumn:function(e){if(e===d&&(e=this.colLast),e!==d){var t=this.pane().actionUI;t.hiddenColumns.indexOf(e)>-1?t.showColumn(e):t.hideColumn(e),this.autoFillerGoToTd()}},toggleHideColumnRange:function(e,t){var n=this.pane().actionUI;n.hiddenColumns.indexOf(e)>-1?n.showColumnRange(e,t):n.hideColumnRange(e,t),this.autoFillerGoToTd()},rowShowAll:function(){this.pane().actionUI.rowShowAll()},columnShowAll:function(){this.pane().actionUI.columnShowAll()},hideMenus:function(){return this.columnMenu.hide(),this.columnContextMenu.hide(),this.rowContextMenu.hide(),this},merge:function(t){if(t=t||this.highlighted(),t.length){var n,i,r,l,s=[],o=t[0],a=t[t.length-1],h=this.getTdLocation(o),c=this.getTdLocation(a),u={},d={},f=0,p=0,m=t.length-1,g=(this.settings.element,this);if(h.row){if(this.setDirty(!0),this.setChanged(!0),h.row<c.row?(u.row=h.row,d.row=c.row,r=o):(u.row=c.row,d.row=h.row,r=a),r.hasAttribute("rowSpan")||r.hasAttribute("colSpan"))return!1;h.col<c.col?(u.col=h.col,d.col=c.col):(u.col=c.col,d.col=h.col),p=d.row-u.row+1,f=d.col-u.col+1,l=this.getTdLocation(r),t.forEach(function(){i=t[m],n=i._cell,(n.formula||n.value)&&s.unshift(n.formula?"("+n.formula.substring(1)+")":n.value),g.resolveCell(n,function(){i.cellIndex==l.col&&i.parentNode.rowIndex==l.row||(n.formula="",n.value="",n.defer=r._cell,i.innerHTML="",i.style.visibility="collapse")})}),r._cell.value=e.trim(s.join(" ")),r._cell.formula=e.trim(r._cell.formula?s.join(" "):""),r.setAttribute("rowSpan",p),r.setAttribute("colSpan",f),r.style.display="",r.style.visibility="",r.style.position="",r.style.height=r.clientHeight+"px",r.style.width=r.clientWidth+"px",r.style.position="absolute",this.resolveCell(r._cell),this.cellEvents.done(),this.autoFillerGoToTd(r),this.cellSetActive(r,l)}return!0}},unmerge:function(e){if(e=e||this.highlighted()){var t,n,i=this.getTdLocation(e),r=h.max(1*e.getAttribute("rowSpan"),1)-1,l=h.max(1*e.getAttribute("colSpan"),1)-1,s=r+i.row,o=[];if(0==r&&0==l)return!1;do{t=i.col+l;do n=this.getTd(-1,s,t),null!==n&&(n.style.display="",n.style.visibility="",n.removeAttribute("colSpan"),n.removeAttribute("rowSpan"),n._cell.defer=null,this.resolveCell(n._cell),o.push(n));while(t-- >i.col)}while(s-- >i.row);return this.cellEvents.done(),this.autoFillerGoToTd(e),this.cellSetActive(e,i),this.highlighter.set(o),!0}},fillUpOrDown:function(e,t,i){if(this.cellEvents.done(),i=i||this.highlighted(!0),i.length<1)return!1;var r=this.tdActive();if(i.length<1)return!1;var l=this.getTdLocation(i[0].td),s=this.getTdLocation(i[i.length-1].td),o=this.getTdLocation(r),a={row:0,col:0},h=t||r._cell.value,c=!1,u=i.length-1,d=function(){},f=this.settings.$element;if(t=t||r._cell.value,u>=0){if(!t.charAt||"="!=t.charAt(0)){((c=!n(h))||h.length>0)&&c&&""!=h&&(h*=1,e&&(h-=i.length-1),d=function(){h++});do f.one("sheetPreCalculation",function(){i[u].formula="",i[u].value=h+""}),this.resolveCell(i[u]),d();while(u--);return!0}if(u>=0){do e?(a.row=o.row-l.row,a.col=o.col-l.col):(a.row=o.row-s.row,a.col=o.col-s.col),h=this.reparseFormula(t,a),f.one("sheetPreCalculation",function(){i[u].formula=h,i[u].value=""}),this.resolveCell(i[u]);while(u--);return!0}}return!1},toTsv:function(e,t,n){e=e||this.highlighted(!0),e.type&&(e=[e]),n=n||function(e,n){t&&(o.one("sheetPreCalculation",function(){n.formula="",n.value=""}),d.resolveCell(n))};var i,r,l,s,o=this.settings.$element,a=[],c={},u=e.length-1,d=this;if(u>=0){i=this.getTdLocation(e[0].td),r=this.getTdLocation(e[e.length-1].td),c.row=h.min(i.row,r.row),c.col=h.min(i.col,r.col);do{var f=this.getTdLocation(e[u].td),p=e[u].formula?"="+e[u].formula:e[u].value;l=h.abs(f.row-c.row),s=h.abs(f.col-c.col),a[l]||(a[l]=[]),(p+="").match(/\n/)&&(p='"'+p+'"'),a[l][s]=p||"",n.call(e[u].td,f,e[u])}while(u-- >0);u=a.length-1;do a[u]=a[u].join("\t");while(u-- >0);return a.join("\n")}return""},offsetFormulas:function(e,t,n,i){var r=this,l=this.sheetSize(),s={first:{row:0,col:0},last:{row:l.rows,col:l.cols}},o=[];for(this.cycleCells(function(){var l=this;this.formula&&"string"==typeof this.formula&&r.isFormulaEditable(this.td)&&(this.formula=r.reparseFormula(this.formula,t,e,n,i)),o.push(function(){r.resolveCellWithoutUndo(l,!0)})},s.first,s.last);o.length;)o.pop()();r.cellEvents.done()},cellRegex:/(\$?[a-zA-Z]+|[#]REF[!])(\$?[0-9]+|[#]REF[!])/gi,reparseFormula:function(e,t,n,i,r){var l=this;return e.replace(this.cellRegex,function(e,s,o,a){if("SHEET"==s)return e;t=t||{loc:-1,row:-1};var h,c,u={row:1*o,col:l.cellHandler.columnLabelIndex(s)},d={row:o,col:s,use:!1};if(!n)return l.makeFormula(u,t);if(r){if(i?(u.col&&u.col==n.col-1&&(d.col="#REF!",d.use=!0),u.row&&u.row==n.row-1&&(d.row="#REF!",d.use=!0),u.col>=n.col&&(h=!0),u.row>=n.row&&(c=!0)):(n.col&&u.col==n.col&&(d.col="#REF!",d.use=!0),n.row&&u.row==n.row&&(d.row="#REF!",d.use=!0),n.col&&u.col>n.col&&(h=!0),n.row&&u.row>n.row&&(c=!0)),d.use)return d.col+d.row;if(h)return u.col+=t.col,l.makeFormula(u);if(c)return u.row+=t.row,l.makeFormula(u)}else{if(i?(n.col&&u.col>=n.col&&(h=!0),n.row&&u.row>=n.row&&(c=!0)):(n.col&&u.col>n.col&&(h=!0),n.row&&u.row>n.row&&(c=!0)),h)return u.col+=t.col,l.makeFormula(u);if(c)return u.row+=t.row,l.makeFormula(u)}return e})},makeFormula:function(t,n){return n=e.extend({row:0,col:0},n),t.col+=n.col,t.row+=n.row,t.col<0&&(t.col=0),t.row<0&&(t.row=0),self.cellHandler.parseCellName(t.col,t.row)},cycleCells:function(e,t,n,i){if(i=i||this.i,t=t||{rowIndex:0,col:0},!n){var r=this.sheetSize();n={row:r.rows,col:r.cols}}var l,s,o,a,h=this.spreadsheets[i];for(s=t.col;s<n.col;s++)for(l=t.row;l<n.row;l++)(o=h[l])!==v&&(a=o[s])!==v&&(a.rowIndex=l,a.columnIndex=s,e.call(a,i,l,s))},cycleCellsAll:function(e){var t,n,i,r=this.i;for(t=0;t<=this.sheetCount;t++)this.i=t,n=this.sheetSize(),i={row:n.rows,col:n.cols},this.cycleCells(e,{row:0,col:0},i,t);this.i=r},cycleCellArea:function(e,t){var n,i,r,l,s=this.i,o={cell:[],td:[]},a=this.spreadsheets[s];for(n=t.startRowIndex;n<=t.endRowIndex;n++)if((r=a[n])!==v)for(i=t.startColumnIndex;i<=t.endColumnIndex;i++)(l=r[i])!==v&&(o.cell.push(l),o.td.push(l.td));e&&e(o)},cycleTableArea:function(e,t,n,i){var r,l,s,o,a,h,c=this.pane().tBody.children,u=[],d=t.parentNode.rowIndex,f=t.cellIndex,p=n.parentNode.rowIndex,m=n.cellIndex;for(d<p?(s=d+0,a=p+0):(s=p+0,a=d+0);s<=a&&(r=c[s])!==v;){for(f<m?(o=f+0,h=m+0):(o=m+0,h=f+0);o<=h&&(l=r.children[o])!==v;)i?u.push(l):e(l),o++;s++}i&&e(u)},resizable:function(e,t){e.data("resizable")||e.resizable(t)},busy:[],setBusy:function(e){for(e?this.busy.push(e):this.busy.pop();this.busy.length<1&&this.whenNotBusyStack.length>0;)this.whenNotBusyStack.pop().call(this);return this},isBusy:function(){return this.busy.length>0},whenNotBusyStack:[],whenNotBusy:function(e){this.isBusy()?this.whenNotBusyStack.push(e):e.call(this)},draggable:function(e,t){e.data("jSdraggable")||e.data("jSdraggable",!0).draggable(t)},labelUpdate:function(e){if(e instanceof p.Cell){var t=this.cellHandler.parseCellName(e.columnIndex,e.rowIndex);this.label().text(t)}else this.label().text(e)},cellEdit:function(e,t,n){this.autoFillerNotGroup=!0,this.cellEvents.done();var i,r=e.td;e.uneditable||(this.cellLast=e,this.trigger("sheetCellEdit",[e]),null!==this.cellLast&&r!==this.cellLast.td?this.followMe(e.td):this.autoFillerGoToTd(r),this.labelUpdate(e),i=e.formula.length>0?"="+e.formula:e.value,this.formula().val(i).blur(),this.cellSetActive(e,t,!1,null,n))},cellSetActive:function(e,r,l,s,o){var a=e.td;this.cellLast=e,this.rowLast=e.rowIndex,this.colLast=e.columnIndex,o||this.highlighter.set(e.td).setStart(e).setEnd(e),this.highlighter.setBar("left",a.parentNode.children[0]).setBar("top",a.parentNode.parentNode.children[0].children[a.cellIndex]);var h,c,u=this,d=this.settings;switch(d.cellSelectModel){case p.excelSelectModel:case p.googleDriveSelectModel:h=function(){},c=function(){};break;case p.openOfficeSelectModel:h=function(e){this.isCell(e)&&this.cellEdit(e._cell)},c=function(){}}if(r){var f=this.pane(),m=this.highlighter,g=e.rowIndex,w=e.columnIndex;f.onmousemove=function(t){t=t||i.event;var r=t.target||t.srcElement;if(u.isBusy()||!u.isCell(r))return!1;var s=u.cellFromTd(r),o=!0;l&&(o=e.columnIndex===s.columnIndex||e.rowIndex===s.rowIndex),w===s.columnIndex&&g===s.rowIndex||!o||(h(r),u.cycleTableArea(function(e){m.set(e)},a,r,!0)),u.followMe(r);var c,d=t.clientY,p=t.clientX,y=f.$enclosure.offset(),v=r.cellIndex,b=r.parentNode.rowIndex,C=!1;if(n(v)||n(b))return!1;if(d>y.top&&(C=!0,v--),p>y.left&&(C=!0,b--),C){if(v<1||b<1)return!1;c=r.parentNode.parentNode.children[v].children[b],u.followMe(c,!0)}return w=s.columnIndex,g=s.rowIndex,!0},t.onmouseup=function(){f.onmousemove=null,f.onmousemove=null,f.onmouseup=null,t.onmouseup=null,s&&s()}}},colLast:0,rowLast:0,cellLast:null,orderedGrid:function(e){var t={startRowIndex:e.startRowIndex<e.endRowIndex?e.startRowIndex:e.endRowIndex,startColumnIndex:e.startColumnIndex<e.endColumnIndex?e.startColumnIndex:e.endColumnIndex,endRowIndex:e.endRowIndex>e.startRowIndex?e.endRowIndex:e.startRowIndex,endColumnIndex:e.endColumnIndex>e.startColumnIndex?e.endColumnIndex:e.startColumnIndex};return t},cellStyleToggle:function(t,n,i){if(i=i||this.highlighted(),i.length<1)return!1;this.setDirty(!0);var r,l,s,o=i.length-1,a=this.cellsEdited();if(o>=0){s=i[0].className.match(t);do r=i[o],l=e(r),n&&l.removeClass(n),s?l.removeClass(t):l.addClass(t),r._cell.edited||(r._cell.edited=!0,a.push(r._cell));while(o--);return!0}return!1},cellTypeToggle:function(e,t){if(t=t||this.highlighted(!0),!(t.length<1)){var n,i=t.length-1,r=t[i].cellType==e;if(i>=0)do n=t[i],r?n.cellType=null:n.cellType=e,n.updateValue();while(i--)}},fontReSize:function(t,n){if(n=n||this.highlighted(),n.length<1)return!1;var i=0;switch(t){case"up":i=1;break;case"down":i=-1}var r,l,s,o=n.length-1,a=this.cellsEdited();if(o>=0){do r=n[o],l=e(r),s=1*(l.css("font-size")+"").replace("px",""),l.css("font-size",(s||10)+i+"px"),r._cell.edited||(r._cell.edited=!0,a.push(r._cell));while(o--);return!0}return!1},cellHandler:null,calc:function(e,t){if(this.settings.calcOff)return!1;if(e=e===v?this.i:e,this.readOnly[e]||this.isChanged(e)===!1&&!t)return!1;var n,i=this.loader;return i.cycleCells(e,function(e,t,r){n=i.jitCell(e,t,r),n.updateValue()}),this.trigger("sheetCalculation",[{which:"spreadsheet",index:e}]),this.setChanged(!1),!0},calcAll:function(e){var t,n=0;for(t=this.settings.loader.count;n<t;n++)this.calc(n,e)},resolveCell:function(e,t){var n=!e.needsUpdated,i=this;this.undo.createCells([e],function(r){return i.trigger("sheetPreCalculation",[{which:"cell",cell:e}]).setDirty(!0).setChanged(!0),e.updateValue(function(){t&&t(e),i.trigger("sheetCalculation",[{which:"cell",cell:e}]),n&&e.updateDependencies()}),r})},resolveCellWithoutUndo:function(e,t){var n=this,i=!e.needsUpdated;this.trigger("sheetPreCalculation",[{which:"cell",cell:e}]).setDirty(!0).setChanged(!0),e.updateValue(function(){t&&t(e),n.trigger("sheetCalculation",[{which:"cell",cell:e}]),i&&e.updateDependencies()})},addSheet:function(){this.cellEvents.editAbandon(),this.setDirty(!0),this.loader.addSpreadsheet(null,this.sheetCount),p.sheetUI(this,this.ui,this.sheetCount),this.setActiveSheet(this.sheetCount),this.sheetCount++,this.sheetSyncSize();var e=this.pane();e.inPlaceEdit&&e.inPlaceEdit.goToTd(),this.trigger("sheetAdd",[this.i])},insertSheet:null,deleteSheet:function(t){var n,i=t||this.i,r=this.controls.enclosure;for(r.splice(i,1),this.barHelper().remove(),e(this.enclosure()).remove(),this.menus().remove(),this.tabContainer().children().eq(this.i).remove(),this.spreadsheets.splice(i,1),this.controls.autoFiller.splice(i,1),this.controls.bar.helper.splice(i,1),this.controls.bar.corner.splice(i,1),this.controls.bar.x.controls.splice(i,1),this.controls.bar.x.handleFreeze.splice(i,1),this.controls.bar.x.controls.splice(i,1),this.controls.bar.x.menu.splice(i,1),this.controls.bar.x.menuParent&&this.controls.bar.x.menuParent[i]&&this.controls.bar.x.menuParent.splice(i,1),this.controls.bar.x.parent.splice(i,1),this.controls.bar.x.th.splice(i,1),this.controls.bar.y.controls.splice(i,1),this.controls.bar.y.handleFreeze.splice(i,1),this.controls.bar.y.controls.splice(i,1),this.controls.bar.y.menu.splice(i,1),this.controls.bar.y.menuParent&&this.controls.bar.y.menuParent[i]&&this.controls.bar.y.menuParent.splice(i,1),this.controls.bar.y.parent.splice(i,1),this.controls.bar.y.th.splice(i,1),this.controls.barMenuLeft.splice(i,1),this.controls.barMenuTop.splice(i,1),this.controls.barLeft.splice(i,1),this.controls.barTop.splice(i,1),this.controls.barTopParent.splice(i,1),this.controls.chart.splice(i,1),this.controls.tdMenu.splice(i,1),this.controls.enclosure.splice(i,1),this.controls.inPlaceEdit.splice(i,1),this.controls.menus.splice(i,1),this.controls.menu.splice(i,1),this.controls.pane.splice(i,1),this.controls.tables.splice(i,1),this.controls.table.splice(i,1),n=i+1;n<this.controls.tab.length;++n){var l=this.controls.tab[n].get(0);l.i--}this.controls.tab.splice(i,1),this.controls.toggleHide.x.splice(i,1),this.controls.toggleHide.y.splice(i,1),this.readOnly.splice(i,1),this.i=0,this.sheetCount--,this.sheetCount=h.max(this.sheetCount,0),0==this.sheetCount&&this.addSheet(),this.setActiveSheet(this.i),this.setDirty(!0),this.setChanged(!0),this.trigger("sheetDelete",[i])},deleteRow:function(e){e=e||this.rowLast;var t,n=this.pane(),i=this.spreadsheets[this.i].splice(e,1)[0],r=0,l=i.length,s=this.settings.loader;for(this.setChanged(!0),this.offsetFormulas({row:e,col:0},{row:-1,col:0},!1,!0),s.deleteRow(this.i,e);r<l;r++)t=i[r],t.setNeedsUpdated(!1),t.updateDependencies();this.setDirty(!0),this.cellEvents.editAbandon(),n.inPlaceEdit&&n.inPlaceEdit.goToTd(),this.trigger("sheetDeleteRow",e)},deleteColumn:function(e){e=e||this.colLast;var t,n=this.pane(),i=0,r=this.spreadsheets[this.i],l=this.settings.loader,s=l.size(this.i);for(this.setChanged(!0),this.offsetFormulas({row:0,col:e},{row:-1,col:0},!1,!0),l.deleteColumn(this.i,e);i<s;i++)t=r[i].splice(e,1)[0],t.setNeedsUpdated(!1),t.updateDependencies();this.setDirty(!0),this.cellEvents.editAbandon(),n.inPlaceEdit&&n.inPlaceEdit.goToTd(),this.trigger("sheetDeleteColumn",e)},sheetTab:function(n,i){var r="",l=this;return n?(r=this.loader.title(this.i)||this.msg.sheetTitleDefault.replace(/[{]index[}]/gi,this.i+1),i&&i(r),r):this.isSheetEditable()&&this.settings.editableNames?(this.settings.prompt(this.msg.newSheetTitle,function(n){n?(l.setDirty(!0),l.table().attr("title",n),l.tab().html(n),r=n):(r=l.loader.title(l.i),n=r?r:l.msg.sheetTitleDefault.replace(/[{]index[}]/gi,l.i+1)),i&&i(e(t.createElement("div")).text(r).html())},l.sheetTab(!0)),null):void 0},followMe:function(e,t){if(e=e||this.tdActive(),null!==e){var n=this.pane();n.actionUI;this.setBusy(!0),this.setBusy(!1),t||this.autoFillerGoToTd(e)}},autoFillerGoToTd:function(t,n,i){if(!this.settings.autoFiller)return this;if(t===v&&null!==this.cellLast&&(t=this.cellLast.td),t&&"cell"==t.type){if(n=n||t.clientHeight,i=i||t.clientWidth,!(t.offsetHeight&&t.offsetWidth&&t.clientHeight&&t.clientWidth))return this.autoFillerHide(),this;var r=e(t).position();this.autoFillerShow(r.top+(n||t.clientHeight)-3+"px",r.left+(i||t.clientWidth)-3+"px")}return this},autoFillerHide:function(){if(!this.settings.autoFiller)return this;var e=this.autoFiller(),t=e.parentNode;return null!==t&&t.removeChild(e),this},autoFillerShow:function(e,t){if(!this.settings.autoFiller)return this;var n=this.autoFiller(),i=this.pane(),r=n.style;return r.top=e,r.left=t,i.insertBefore(n,i.firstChild),this},setActiveSheet:function(e,t){e=t!==v?t.i:e||0,null!==this.cellLast&&(this.cellLast.rowIndex>0||this.cellLast.columnIndex>0)&&(this.cellEvents.done(),this.formula().val(""));var n,i,r=this.panes(),l=0,s=r.length;for(this.autoFillerHide();l<s;l++)e!=l&&(n=r[l],n.actionUI.hide());this.i=e,i=this.enclosure(),this.highlighter.setTab(this.tab()),n=i.pane,n.actionUI.show(),n.inPlaceEdit&&n.inPlaceEdit.goToTd()},getSpreadsheetIndexByTitle:function(e){var t=this.settings.loader.getSpreadsheetIndexByTitle(e);return t},getSpreadsheetTitleByIndex:function(e){return this.settings.loader.json[e].title},openSheet:function(){var t=this,n=this.loader,i=this.element,r=this.$element,l=n.count,o=l-1,a=function(){t.setBusy(!0),t.loader=n;var a,h,c=p.header(t),u=p.ui(t),d=p.spreadsheetAdder(t),f=p.tabs(t),m={initChildren:function(e,n){p.sheetUI(t,e,n),t.trigger("sheetOpened",[n])},done:function(e){t.sheetSyncSize(),t.setActiveSheet(0),t.setDirty(!1),t.setBusy(!1),t.trigger("sheetAllOpened")},lastIndex:o};if(c.ui=u,c.tabContainer=f,u.header=c,u.sheetAdder=d,u.tabContainer=f,f.header=c,f.ui=u,i.appendChild(c),i.appendChild(u),i.appendChild(d),i.appendChild(f),t.resizableSheet(r,{minWidth:.1*i.clientWidth,minHeight:.1*i.clientHeight,start:function(){t.setBusy(!0),this.ui.removeChild(this.enclosure()),u.sheetAdder.hide(),u.tabContainer.hide()},stop:function(){this.ui.appendChild(this.enclosure()),u.sheetAdder.show(),u.tabContainer.show(),t.setBusy(!1).sheetSyncSize();var e=this.pane();e.inPlaceEdit&&e.inPlaceEdit.goToTd()}}),t.insertSheet=function(i,r,l){t.sheetCount++,i=i||null,l=l===v||l,r=r||t.sheetCount-1,null!==i&&t.settings.loader.addSpreadsheet(i);var o,a=function(){t.setBusy(!0);var e=new p.SpreadsheetUI(r,u,m);t.setActiveSheet(-1,e),t.setBusy(!1),t.sheetSyncSize()};return l?void a():(o=p.customTab(n.title(r)).mousedown(function(){return a(),this.tab().insertBefore(this),e(this).remove(),!1}),void(s.loader.isHidden(r)&&o.hide()))},h=new p.SpreadsheetUI(0,u,m),t.sheetCount++,l>0){for(a=1;a<l;a++)t.insertSheet(null,a,!1);t.i=0,h.loaded()}};return this.isDirty?this.settings.confirm(p.msg.openSheet,a):a(),this},newSheet:function(){this.settings.element.html(this.makeTable()).sheet(this.settings)},sheetSyncSize:function(){var e,t,n,r,l,s,o,a,h,c=this.settings.element,u=this.settings.$element,d=c.clientHeight,f=c.clientWidth,m=this.tabContainer(),g=m[0],w=g.style,y=i.scrollBarSize.width,v=this.ui.style;return d?d<200&&(d=200,u.height(d)):(d=400,u.height(d)),h=g.scrollLeft,w.width="",e=g.clientWidth,t=f-(this.settings.colMargin+y),n=f-2*this.settings.colMargin+"px",r=this.settings.colMargin+y+"px",e>t?(w.height=r,m.addClass(p.cl.tabContainerScrollable),d-=y):(w.height=null,m.removeClass(p.cl.tabContainerScrollable)),w.width=n,g.scrollLeft=h,d-=this.header().outerHeight()+this.settings.boxModelCorrection,d-=g.clientHeight+this.settings.boxModelCorrection,l=d-i.scrollBarSize.height-this.settings.boxModelCorrection+"px",s=f-i.scrollBarSize.width+"px",o=d+"px",a=f+"px",this.panes().each(function(){var e=this.style,t=this.scroll.style,n=this.enclosure.style;e.height=l,e.width=s,n.height=t.height=o,n.width=t.width=a}),v.height=o,v.width=a,this},showSheets:function(){var t=this.settings.loader;this.tabContainer().children().each(function(n){e(this).show(),t.setHidden(n,!1)})},showSheet:function(e){var t=this.settings.loader;this.tabContainer().children().eq(e).show(),t.setHidden(e,!1)},hideSheet:function(e){var t=this.settings.loader;this.tabContainer().children().eq(e).hide(),t.setHidden(e,!0)},cellChangeStyle:function(e,t,n){if(n=n||this.highlighted(!0),n.length<1)return!1;this.setDirty(this);var i=n.length-1;return i>=0&&(this.undo.createCells(n,function(n){do n[i].td.css(e,t);while(i--);return n}),!0)},cellFind:function(e){function t(e){var t=this.table().children("tbody").children("tr");if(e){var r=t.children('td:contains("'+e+'")');r.length<1&&(r=t.children('td:contains("'+e.toLowerCase()+'")')),r.length<1&&(r=t.children('td:contains("'+e.toUpperCase()+'")')),r=r.eq(0),r.length>0?this.cellEdit(r._cell):n.alert(i.cellNoFind)}}var n=this.settings,i=this.msg;e?t(e):n.prompt(i.cellFind,t)},cellSetActiveBar:function(e,t,n){var i,r,l,s,o,a,h=this,c=this.settings,u=this.loader.size(),d={},f={},m=function(e){switch(c.cellSelectModel){case p.openOfficeSelectModel:this.row=e.startRowIndex,this.col=e.startColumnIndex,this.td=h.getTd(-1,h.row,h.col),null!==this.td&&null!==h.cellLast&&this.td!==h.cellLast.td&&h.cellEdit(h.td._cell,!1,!0);
break;default:this.row=e.endRowIndex,this.col=e.endColumnIndex,this.td=h.getTd(-1,this.row,this.col),null!==this.td&&null!==h.cellLast&&this.td!==h.cellLast.td&&h.cellEdit(this.td._cell,!1,!0)}},g=[],w=this.pane().actionUI.scrolledArea,y=this.highlighter;switch(e){case"column":for(d.row=w.row,f.row=w.row,t<n?(y.startColumnIndex=s=i=d.col=t,y.endColumnIndex=r=f.col=n):(l=!0,y.startColumnIndex=s=i=d.col=n,y.endColumnIndex=r=f.col=t),y.startRowIndex=0,y.endRowIndex=u.rows,g.push(this.col(t+1));s<r;s++)g.push(g[g.length-1].nextSibling);break;case"row":d.row=t,d.col=w.col,f.row=n,f.col=w.col,y.startRowIndex=t,y.startColumnIndex=0,y.endRowIndex=n,y.endColumnIndex=u.cols,o=t;do a=this.getTd(-1,o,0),null!==a&&g.push(a.parentNode);while(o-- >t);break;case"corner":d.row=0,d.col=0,f.col=u.cols,f.row=u.rows,g.push(sheet[0])}new m(y),this.highlighter.set(g)},getTdRange:function(n,i,r,l){this.cellLast.isEdit=!0;var s,o,a,h=this,c=function(e){return e.first.col>e.last.col||e.first.row>e.last.row?{first:this.cellHandler.parseCellName(e.last.col,e.last.row),last:this.cellHandler.parseCellName(e.first.col,e.first.row)}:{first:this.cellHandler.parseCellName(e.first.col,e.first.row),last:this.cellHandler.parseCellName(e.last.col,e.last.row)}},u=function(e){var t=c(e),n=i+"";n=n.match(/=/)?n:"="+n,(r||"("!=n.charAt(n.length-1))&&(n=n+(r?r:"")+"(");var l,s="";return l=t.first!=t.last?t.first+":"+t.last:t.first,"("==n.charAt(n.length-1)&&(s=")"),n+l+s},d="";return n?(s={first:this.getTdLocation([n.target])},o=this.table().mousemove(function(e){s.last=this.getTdLocation([e.target]),d=u(s),l||(h.formula().val(d),h.inPlaceEdit().val(d))}),e(t).one("mouseup",function(){return o.unbind("mousemove"),d}),""):(a=this.highlighted().not(this.tdActive()),a.length?(s={first:this.getTdLocation(a.first()),last:this.getTdLocation(a.last())},d=u(s),l||(this.formula().val(d),this.inPlaceEdit().val(d)),d):"")},getTd:function(e,t,n){e<0&&(e=this.i);var i=this.settings.loader.jitCell(e,t,n);return null===i?i:i.td||null},locationFromTd:function(e){var t=this.pane().actionUI.scrolledArea;return{row:t.row+e.parentNode.rowIndex,col:t.col+e.cellIndex}},getTdLocation:function(e){var t={col:0,row:0},n=0;this.pane();return e===v||null===e?t:e.parentNode===v||e.parentNode.rowIndex+n<0?t:{col:e.cellIndex,row:e.parentNode.rowIndex+n}},changed:[],isChanged:function(e){return this.changed[e||this.i]},setChanged:function(e){this.changed[this.i]=e},isDirty:!1,setDirty:function(e){return this.dirty=e,this},appendToFormula:function(e){var t=this.formula(),n=t.val();"="!==n.charAt(0)&&(n="="+n),t.val(n+e)},cols:function(e){return e=e||this.table()[0],e&&e.colGroup&&e.colGroup.children?e.colGroup.children:[]},tables:function(n,i){n=n||this.tables();var r,l,s,o,a,h,c,u,d,f=[],p=n.length-1;do{if(l=i?t.body.removeChild(n[p]):n[p].cloneNode(!0),(o=l.children[0])&&(a=o.children[0])&&o.removeChild(a),s=l.children[1]){u=s.children,c=u[0],s.removeChild(c),r=u.length-1;do d=u[r],h=d.children[0],d.removeChild(h);while(r-- >0)}f[p]=l}while(p-- >0);return this.sheetDecorateRemove(!1,e(f))},col:function(e){return this.pane().actionUI.megaTable.col(e)},rowTds:function(e,t){e=e||this.table();var n=this.rows(e);return n.length?(t==v&&(t=n.length-1),n[t]&&n[t].children?n[t].children:[]):[]},rows:function(e){return e=e||this.table()[0],e===v?[]:e.tBody===v?[]:e.tBody.children===v?[]:e.tBody.children},highlighted:function(t){var n,i,r=this.highlighter.last||e([]),l=[];if(!((n=r)&&r.length&&(n=n[0])&&n.tagName))return t?l:e(l);switch(n.tagName){case"TD":i=r.length-1;do l.unshift(t?r[i]._cell:r[i]);while(i-- >0);break;case"TR":i=r.length-1;do r[i].tds&&(l=l.concat(t?r[i]._cells:r[i].tds));while(i-- >0);break;case"COL":r=r.filter("col"),i=r.length-1;do r[i].tds&&(l=l.concat(t?r[i]._cells:r[i].tds));while(i-- >0);break;case"TABLE":l=t?n._cells:n.tds}return t?l:e(l)},sheetSize:function(e){return e===d&&(e=this.i),this.settings.loader.size(e)},sortVerticalSelectAscending:function(){return confirm("Do you want to extend your selection?")?(this.sortVertical(),!0):(this.sortVerticalSingle(!1),!0)},sortVerticalSelectDescending:function(){return confirm("Do you want to extend your selection?")?(this.sortVertical(),!1):(this.sortVerticalSingle(!0),!1)},sortVertical:function(e){for(var t,n,i,s,a=this.highlighted(!0),h=a[0].td.parent().prev(),c=a.length,u=(new r,!0),d=[],f=[],p=0;p<c;)n=a[p],s=n.td,isNaN(n.value)?(u=!1,i=new l(n.value.valueOf())):i=new o(n.value.valueOf()),i.loc=this.getTdLocation(s),i.row=s.parentNode,i.col=s,i.cell=n,d.push(i),p++;for(e?0==u?d.sort(function(e,t){return t-e}):(d.sort(),d.reverse()):1==u?d.sort(function(e,t){return e-t}):d.sort(),this.undo.createCells(a);t=d.length;)i=d.pop(),f=this.spreadsheets[this.i].splice(i.row.rowIndex,1),n=i.cell,n.value=i.valueOf(),i.row.parentNode.removeChild(i.row),h.after(i.row),i.row.children[0].innerHTML=h[0].rowIndex+t,this.spreadsheets[this.i].splice(h[0].rowIndex+1,0,f[0]),this.track.call(n,!0);this.undo.createCells(a)},sortVerticalSingle:function(e){for(var t,n=this.highlighted(!0),i=n.length,r=0,l=[];r<i;)l.push(n[r].value),r++;for(e?l.sort(function(e,t){return t-e}):l.sort(function(e,t){return e-t});n.length;)t=n.pop(),t.value=l[n.length],t.updateValue()},sortHorizontalSelectAscending:function(){return confirm("Do you want to extend your selection?")?(this.sortHorizontal(),!0):(this.sortHorizontalSingle(!1),!0)},sortHorizontalSelectDescending:function(){return confirm("Do you want to extend your selection?")?(this.sortHorizontal(),!1):(this.sortHorizontalSingle(!0),!1)},sortHorizontal:function(e){for(var t,n,i,r,s,a=this.highlighted(!0),h=this.pane(),c=h.table,u=a[0].td,n=u._cell,d=n.cellIndex,f=c.colGroup,p=this.sheetSize().rows,m=a.length,g=!0,w=[],y=0;y<m;){for(t=0,n=a[y],s=n.td,isNaN(n.value)?(g=!1,i=new l(n.value.valueOf())):i=new o(n.value.valueOf()),i.tds=[],i.loc=this.getTdLocation(s),i.tr=s.parentNode,i.td=s,i.cell=n;t<=p;)i.tds.push(this.pane().table.children[1].children[t].children[s.cellIndex]),t++;w.push(i),y++}for(e?0==g?w.sort(function(e,t){return t-e}):(w.sort(),w.reverse()):1==g?w.sort(function(e,t){return e-t}):w.sort(),this.undo.createCells(a);w.length;)for(i=w.pop();i.tds.length>1;)s=i.tds.pop(),r=s.parentNode,n=this.spreadsheets[this.i][r.rowIndex].splice(s.cellIndex,1),r.insertBefore(s,r.children[d]),s.col=f.children[w.length+s.cellIndex-1],s.barTop=s.col.bar,n.value=s._cell.value,this.spreadsheets[this.i][r.rowIndex].splice(s.cellIndex,0,n[0]),this.resolveCell(n);this.undo.createCells(a)},sortHorizontalSingle:function(e){for(var t,n=this.highlighted(!0),i=n.length,r=0,l=[];r<i;)l.push(n[r].value),r++;for(e?l.sort(function(e,t){return t-e}):l.sort(function(e,t){return e-t});n.length;)t=n.pop(),t.value=l[n.length],t.updateValue()},tableSize:function(e,t){var n,i,r,l,s,o=(e.pane,0),a=0,h=0;return e=e||this.table()[0],(n=e.tBody)===v||(i=n.children)===v||(r=i[i.length-1])===v||(l=r.children)===v||(s=l[l.length-1])===v?{}:(o=t===!0?r.rowIndex:r.rowIndex+h,a=s.cellIndex,{cols:a,rows:o})},toggleState:function(e){var t=this.settings;if(t.allowToggleState){var n=e||this.tables();t.editable&&(this.evt.cellEditAbandon(),this.trigger("sheetSave",[n])),this.setDirty(!1),this.setChanged(!0),t.editable=!t.editable,this.kill(),t.element.html(n).sheet(t),t=null}},setCellRef:function(e){function t(e){e&&(n.settings.formulaVariables[e]=r.updateValue())}var n=this,i=this.tdActive(),r=i._cell;e?t(e):this.settings.prompt(this.msg.setCellRef,t)},parseFormula:null,print:function(t,n){t=t||this.i;var r,l=i.open();l!==v&&(r=l.document,r.write('<html>    <head id="head"></head>    <body>      <div id="entry" class="'+p.cl.element+'" style="overflow: show;">      </div>    </body>  </html>'),n!==!0&&e(r.getElementById("head")).append(e("style,link").clone()),e(r.getElementById("entry")).append(this.pane().cloneNode(!0)),r.close(),l.focus(),l.print())},preLoad:function(n,i){n=n||"",i=e.extend({skip:["globalizeCultures"],thirdPartyDirectory:"bower_components/"},i);var r=e("script:first"),l=function(){var e;this.script!==d&&(e=t.createElement("script"),e.src=n+(this.thirdParty?i.thirdPartyDirectory:"")+this.script,r.after(e)),this.css!==d&&(e=t.createElement("link"),e.rel="stylesheet",e.type="text/css",e.href=n+(this.thirdParty?i.thirdPartyDirectory:"")+this.css,r.after(e))};e.each(this.dependencies,l),e.each(this.optional,l)},makeTable:function(e,n,i){e=e||{rows:25,cols:10},n=n||120,i=i||15;var r,l,s,o,a=t.createElement("table"),h=t.createElement("colgroup"),c=t.createElement("tbody"),u="width:"+n+"px;",d="height:"+i+"px;";s=e.cols;do l=t.createElement("col"),l.setAttribute("style",u),h.appendChild(l);while(s-- >1);s=e.rows;do{r=t.createElement("tr"),r.setAttribute("style",d),o=e.cols;do r.appendChild(t.createElement("td"));while(o-- >1);c.appendChild(r)}while(s-- >1);return a.appendChild(h),a.appendChild(c),a},killAll:function(){var e=p.instances;if(e){for(var t=0;t<e.length;t++)e[t]&&e[t].kill&&e[t].kill();p.instances=[]}},scrollLocker:function(t){var n=p.instances;n[t].panes().each(function(t){var i;e(i=this.scrollUI).scroll(function(e){var r,l=n.length-1;if(l>-1)do r=n[l].controls.enclosures[t].scrollUI,this!==r&&(r.scrollLeft=i.scrollLeft,r.scrollTop=i.scrollTop);while(l--)})})},switchSheetLocker:function(e){p.instance.forEach(function(){this.$element.bind("sheetSwitch",function(e,t,n){p.instance.forEach(function(e){e.setActiveSheet(n)})})})},I:function(){var e=0;return this.instance?e=0===this.instance.length?0:this.instance.length-1:this.instance=[],e},formulaParser:function(){var e,t=p.calcStack;return t>-1?(e=p.spareFormulaParsers[t],e===d&&(e=p.spareFormulaParsers[t]=Formula())):e=p.defaultFormulaParser,e.yy.types=[],e},parseFormulaSync:function(e,t){null===p.defaultFormulaParser&&(p.defaultFormulaParser=Formula());var n=this.formulaParser();t(n.parse(e))},parseFormulaAsync:function(e,t){var n=p.thread();n.busy?n.stash.push(function(){n.busy=!0,n.parseFormula(e,function(e){n.busy=!1,t(e),n.stash.length>0&&n.stash.shift()()})}):(n.busy=!0,n.parseFormula(e,function(e){n.busy=!1,t(e),n.stash.length>0&&n.stash.shift()()}))}},p.event={},p.loader={},p.plugin={},p.calcStack=0,p.instances=[],p.defaultTheme=0,p.themeRollerTheme=0,p.bootstrapTheme=1,p.customTheme=2,p.excelSelectModel=0,p.googleDriveSelectModel=1,p.openOfficeSelectModel=2,p.defaultColumnWidth=120,p.defaultRowHeight=20,p.domRows=40,p.domColumns=35,p.formulaParserUrl="../parser/formula/formula.js",p.threadScopeUrl="../Sheet/threadScope.js",p.defaultFormulaParser=null,p.spareFormulaParsers=[],p.cornerEntity="corner",p.columnEntity="column",p.rowEntity="row",p.events=["sheetAddRow","sheetAddColumn","sheetSwitch","sheetRename","sheetTabSortStart","sheetTabSortUpdate","sheetCellEdit","sheetCellEdited","sheetCalculation","sheetAdd","sheetDelete","sheetDeleteRow","sheetDeleteColumn","sheetOpen","sheetAllOpened","sheetSave","sheetFullScreen","sheetFormulaKeydown"],p.msg={addRowMulti:"How many rows would you like to add?",addColumnMulti:"How many columns would you like to add?",cellFind:"What are you looking for in this spreadsheet?",cellNoFind:"No results found.",dragToFreezeCol:"Drag to freeze column",dragToFreezeRow:"Drag to freeze row",addSheet:"Add a spreadsheet",openSheet:"Are you sure you want to open a different sheet?  All unsaved changes will be lost.",toggleHideRow:"No row selected.",toggleHideColumn:"No column selected.",loopDetected:"Loop Detected",newSheetTitle:"What would you like the sheet's title to be?",notFoundColumn:"Column not found",notFoundRow:"Row not found",notFoundSheet:"Sheet not found",setCellRef:"Enter the name you would like to reference the cell by.",sheetTitleDefault:"Spreadsheet {index}",cellLoading:"Loading..."},p.dependencies={coreCss:{css:"wickedgrid.css"},jQueryUI:{script:"jquery-ui/jquery-ui.min.js",thirdParty:!0},jQueryUIThemeRoller:{css:"jquery-ui/themes/smoothness/jquery-ui.min.css",thirdParty:!0},globalize:{script:"globalize/lib/globalize.js",thirdParty:!0},nearest:{script:"jquery-nearest/src/jquery.nearest.min.js",thirdParty:!0},mousewheel:{script:"MouseWheel/MouseWheel.js",thirdParty:!0},operative:{script:"operative/dist/operative.js",thirdParty:!0},megatable:{script:"megaTable.js/megatable.js",thirdParty:!0},infiniscroll:{script:"infiniscroll.js/infinitescroll.js",thirdParty:!0}},p.optional={advancedFn:{script:"src/Plugin/advanced.js"},financeFn:{script:"src/Plugin/finance.js"},colorPicker:{css:"really-simple-color-picker/css/colorPicker.css",script:"really-simple-color-picker/js/jquery.colorPicker.min.js",thirdParty:!0},elastic:{script:"jquery-elastic/jquery.elastic.source.js",thirdParty:!0},globalizeCultures:{script:"globalize/lib/cultures/globalize.cultures.js",thirdParty:!0},raphael:{script:"raphael/raphael.js",thirdParty:!0},gRaphael:{script:"graphael/g.raphael.js",thirdParty:!0},gRaphaelBar:{script:"graphael/g.bar.js",thirdParty:!0},gRaphaelDot:{script:"graphael/g.dot.js",thirdParty:!0},gRaphaelLine:{script:"graphael/g.line.js",thirdParty:!0},gRaphaelPie:{script:"graphael/g.pie.js",thirdParty:!0},thaw:{script:"thaw.js/thaw.js",thirdParty:!0},undoManager:{script:"Javascript-Undo-Manager/lib/undomanager.js",thirdParty:!0},zeroClipboard:{script:"zeroclipboard/dist/ZeroClipboard.min.js",thirdParty:!0}},p.autoFiller=function(e,n){if(!e.settings.autoFiller)return!1;var i=t.createElement("div"),r=t.createElement("div"),l=t.createElement("div");return i.i=e.i,i.className=p.cl.autoFiller+" "+e.theme.autoFiller,r.className=p.cl.autoFillerHandle,l.className=p.cl.autoFillerCover,i.onmousedown=function(){var t=this.tdActive();if(t){var n=e.getTdLocation(t);e.cellSetActive(t,n,!0,p.autoFillerNotGroup,function(){var i=e.highlighted(),r=e.getTdLocation(i.last());e.fillUpOrDown(r.row<n.row||r.col<n.col),e.autoFillerGoToTd(t),e.autoFillerNotGroup=!1})}return!1},n.autoFiller=e.controls.autoFiller[e.i]=i,n.appendChild(i),!0},p.cellTypeHandlers={percent:function(e,t){if(t!==t)return 0;var n,i=isNaN(t)?Globalize.parseFloat(t):1*t;return isNaN(i)?t:(n=new o(i),n.html=Globalize.format(i,"p"),n)},date:function(e,t){if(t!==t)return 0;var n=Globalize.parseDate(t);return null===n?t:(e.valueOverride=n,e.html=Globalize.format(n,"d"),t)},time:function(e,t){if(t!==t)return 0;var n=Globalize.parseDate(t);return null===n?t:(n.html=Globalize.format(n,"t"),n)},currency:function(e,t){if(t!==t)return 0;var n,i=isNaN(t)?Globalize.parseFloat(t):1*t;return isNaN(i)?t:(n=new o(i),n.html=Globalize.format(i,"c"),n)},number:function(e,t){if(t!==t)return 0;var n,i;return CellTypeHandlers.endOfNumber||(n=Globalize.culture().numberFormat["."],CellTypeHandlers.endOfNumber=new c("(["+("."==n?".":n)+"])([0-9]*?[1-9]+)?(0)*$")),isNaN(t)?t:(i=new o(t),i.html=Globalize.format(t+"","n10").replace(CellTypeHandlers.endOfNumber,function(e,t,n){return(n?t:"")+(n||"")}),i)}},p.cl={list:function(e){var t=[],n=p.cl;return e.forEach(function(e){if(!n.hasOwnProperty(e))throw new u("prop "+e+" not found on WickedGrid.cl");t.push(n[e])}),t.join(" ")},autoFiller:"wg-auto-filler",autoFillerHandle:"wg-auto-filler-handle",autoFillerCover:"wg-auto-filler-cover",corner:"wg-corner",barController:"wg-bar-controller",barControllerChild:"wg-bar-controller-child",barHelper:"wg-bar-helper",row:"wg-row",rowFreezeHandle:"wg-row-freeze-handle",column:"wg-column",columnHelper:"wg-column-helper",columnFocus:"wg-column-focus",columnButton:"wg-column-button",columnFreezeHandle:"wg-column-freeze-handle",chart:"wg-chart",formula:"wg-formula",formulaParent:"wg-formula-parent",header:"wg-header",fullScreen:"wg-full-screen",inPlaceEdit:"wg-in-place-edit",headerMenu:"wg-header-menu",menuFixed:"wg-menu-fixed",element:"wg-element",scroll:"wg-scroll",sheetAdder:"wg-sheet-adder",table:"wg-table",label:"wg-loc",pane:"wg-edit-pane",tab:"wg-tab",tabContainer:"wg-tab-container",tabContainerScrollable:"wg-tab-container-scrollable",menu:"wg-menu",menuButton:"wg-menu-button",title:"wg-title",enclosure:"wg-enclosure",ui:"wg-ui"},p.columnFreezer=function(n){if(!n.settings.freezableCells)return!1;if(n.isBusy())return!1;var r=n.pane(),l=r.actionUI,s=r.tBody,o=l.frozenAt,a=l.scrolledArea;if(!(a.col<=o.col+1))return!1;n.barHelper().remove();var c,u=s.children[0].children[o.col+1],d=r.getBoundingClientRect(),f=d.top+t.body.scrollTop,p=d.left+t.body.scrollLeft,m=t.createElement("div"),g=r.freezeHandleTop=e(m).appendTo(r).addClass(n.theme.columnFreezeHandle+" "+n.cl.barHelper+" "+n.cl.columnFreezeHandle).height(u.clientHeight-1).css("left",u.offsetLeft-m.clientWidth+"px").attr("title",n.msg.dragToFreezeCol);return n.controls.bar.helper[n.i]=n.barHelper().add(m),n.controls.bar.x.handleFreeze[n.i]=g,n.draggable(g,{axis:"x",start:function(){n.setBusy(!0),c=e(t.createElement("div")).css("position","absolute").addClass(n.theme.barFreezeIndicator+" "+n.cl.barHelper).height(u.clientHeight-1).fadeTo(0,.33).appendTo(r)},drag:function(){var e=g.nearest(u.parentNode.children).prev();e.length>0&&"function"==typeof e.position&&c.width(e.position().left+e.width())},stop:function(t,i){c.remove(),n.setBusy(!1),n.setDirty(!0);var r=e.nearest(g,u.parentNode.children);n.barHelper().remove(),a.col=l.frozenAt.col=h.max(n.getTdLocation(r[0]).col-1,0),n.autoFillerHide()},containment:[p,f,p+r.clientWidth-i.scrollBarSize.width,f]}),!0},p.columnResizer=function(n,i){n.barTopControls().remove();var r,l=t.createElement("div"),s=e(l).addClass(n.cl.barController+" "+n.theme.barResizer).width(i.clientWidth).prependTo(i),o=n.pane();n.controls.bar.x.controls[n.i]=n.barTopControls().add(s),n.resizableCells(s,{handles:"e",start:function(e,t){n.autoFillerHide(),n.setBusy(!0),o.freezeHandleTop&&o.freezeHandleTop.remove()},resize:function(e,t){i.col.style.width=t.size.width+"px",o.inPlaceEdit&&o.inPlaceEdit.goToTd()},stop:function(e,t){n.setBusy(!1),o.inPlaceEdit&&o.inPlaceEdit.goToTd(),n.followMe(),n.setDirty(!0)},minWidth:32}),r=l.children[0],r.style.height=i.clientHeight+"px"},p.customTab=function(n){var i=t.createElement("span"),r=e(i).appendTo(n.tabContainer());return i.setAttribute("class",n.cl.tab+" "+n.theme.tab),i.innerHTML=title,r},p.defaults=function(){var e={editable:!0,editableNames:!0,barMenus:!0,freezableCells:!0,allowToggleState:!0,headerMenu:null,newColumnWidth:120,title:null,calcOff:!1,lockFormulas:!1,parent:null,colMargin:20,boxModelCorrection:2,formulaFunctions:{},formulaVariables:{},cellSelectModel:p.excelSelectModel,autoAddCells:!0,resizableCells:!0,resizableSheet:!0,autoFiller:!0,error:function(e){return e.error},endOfNumber:!1,frozenAt:[],columnMenuButtons:null,columnContextMenuButtons:{"Insert column after":function(){return this.addColumn(!1,this.colLast),!1},"Insert column before":function(){return this.addColumn(!0,this.colLast),!1},"Add column to end":function(){return this.addColumn(!0),!1},"Delete this column":function(){return this.deleteColumn(),!1},"Hide column":function(){return this.toggleHideColumn(this.colLast),!1},"Show all columns":function(){this.columnShowAll()},"Toggle freeze columns to here":function(){var e=this.getTdLocation(this.tdActive()).col,t=this.pane().actionUI;t.frozenAt.col=t.frozenAt.col==e?0:e}},rowContextMenuButtons:{"Insert row after":function(){return this.addRow(!0,this.rowLast),!1},"Insert row before":function(){return this.addRow(!1,this.rowLast),!1},"Add row to end":function(){return this.addRow(!0),!1},"Delete this row":function(){return this.deleteRow(),!1},"Hide row":function(){return this.toggleHideRow(this.rowLast),!1},"Show all rows":function(){this.rowShowAll()},"Toggle freeze rows to here":function(){var e=this.getTdLocation(this.tdActive()).row,t=this.pane().actionUI;t.frozenAt.row=t.frozenAt.row==e?0:e}},cellContextMenuButtons:{"Insert row after":function(){return this.addRow(!0,this.rowLast),!1},"Insert row before":function(){return this.addRow(!1,this.rowLast),!1},"Add row to end":function(){return this.addRow(!0),!1},"Delete this row":function(){return this.deleteRow(),!1},line2:"line","Insert column after":function(){return this.addColumn(!0,this.colLast),!1},"Insert column before":function(){return this.addColumn(!1,this.colLast),!1},"Add column to end":function(){return this.addColumn(!0),!1},"Delete this column":function(){return this.deleteColumn(),!1},line3:"line","Add spreadsheet":function(){this.addSheet()},"Delete spreadsheet":function(){this.deleteSheet()}},alert:function(e){alert(e)},prompt:function(e,t,n){t(prompt(e,n))},confirm:function(e,t,n){confirm(e)?t():n&&n()},loader:null,useStack:!0,useMultiThreads:!0};return e.columnMenuButtons=e.columnContextMenuButtons,e}(),p.enclosure=function(n){var i=t.createElement("div"),r=e(i),l=new p.ActionUI(n,i,this.cl.scroll,n.settings.frozenAt[n.i]),s=l.pane;return s.className=p.cl.pane+" "+n.theme.pane,i.className=p.cl.enclosure,i.pane=s,s.enclosure=i,s.$enclosure=r,n.controls.pane[n.i]=s,n.controls.panes=n.panes().add(s),n.controls.enclosures[n.i]=i,i},p.formulaEditor=function(n,i){var r=t.createElement("td");r.className=n.cl.label+" "+n.theme.control,n.controls.label=e(r);var l=t.createElement("textarea");l.className=n.cl.formula+" "+n.theme.controlTextBox,l.onkeydown=function(e){return n.formulaEvents.keydown(e)},l.onkeyup=function(){n.inPlaceEdit().value=l.value},l.onchange=function(){n.inPlaceEdit().value=l.value},l.onpaste=function(e){return n.pasteOverCells(e)},l.onfocus=function(){n.setNav(!1)},l.onfocusout=function(){n.setNav(!0)},l.onblur=function(){n.setNav(!0)},n.controls.formula=e(l);var s=t.createElement("span");s.appendChild(l);var o=t.createElement("table"),a=t.createElement("tr");o.appendChild(a),i.appendChild(o);var h=t.createElement("td");h.className=n.cl.formulaParent,h.appendChild(s),a.appendChild(r),a.appendChild(h),a.appendChild(t.createElement("td")),n.resizableSheet(e(s),{minHeight:n.controls.formula.height(),maxHeight:78,handles:"s",resize:function(e,t){n.controls.formula.height(t.size.height)},stop:function(){n.sheetSyncSize()}});for(var c=p.instances,u=0;u<c.length;u++)(c||{}).nav=!1;return n.setNav(!0),e(t).keydown(function(e){return n.documentEvents.keydown(e)}),l},p.functions=function(n){function i(n){function i(e,t){return e=e?t?C.toNumbers(e):C.flatten(e):t?0:""}var r,l=this.wickedGrid,s=l.settings.loader,o=t.createElement("div"),a=this.td,h=t.body;h.appendChild(o),n=e.extend({x:{legend:"",data:[0]},y:{legend:"",data:[0]},title:"",data:[0],legend:""},n),o.className=p.cl.chart,o.onmousedown=function(){e(a).mousedown()},o.onmousemove=function(){return e(a).mousemove(),!1},n.data=i(n.data,!0),n.x.data=i(n.x.data,!0),n.y.data=i(n.y.data,!0),n.legend=i(n.legend),n.x.legend=i(n.x.legend),n.y.legend=i(n.y.legend),n.legend=n.legend?n.legend:n.data;var c=s.getWidth(this.sheetIndex,this.columnIndex),u=s.getHeight(this.sheetIndex,this.rowIndex),d=Raphael(o);switch(n.title&&d.text(c/2,10,n.title).attr({"font-size":20}),n.type){case"bar":r=d.barchart(c/8,u/8,.8*c,.8*u,n.data,n.legend).hover(function(){this.flag=d.popup(this.bar.x,this.bar.y,this.bar.value||"0").insertBefore(this)},function(){this.flag.animate({opacity:0},300,function(){this.remove()})});break;case"hbar":r=d.hbarchart(c/8,u/8,.8*c,.8*u,n.data,n.legend).hover(function(){this.flag=d.popup(this.bar.x,this.bar.y,this.bar.value||"0").insertBefore(this)},function(){this.flag.animate({opacity:0},300,function(){this.remove()})});break;case"line":r=d.linechart(c/8,u/8,.8*c,.8*u,n.x.data,n.y.data,{nostroke:!1,axis:"0 0 1 1",symbol:"circle",smooth:!0}).hoverColumn(function(){if(this.tags=d.set(),this.symbols.length)for(var e=0,t=this.y.length;e<t;e++)this.tags.push(d.tag(this.x,this.y[e],this.values[e],160,10).insertBefore(this).attr([{fill:"#fff"},{fill:this.symbols[e].attr("fill")}]))},function(){this.tags&&this.tags.remove()});break;case"pie":r=d.piechart(c/2,u/2,(c<u?c:u)/2,n.data,{legend:n.legend}).hover(function(){this.sector.stop(),this.sector.scale(1.1,1.1,this.cx,this.cy),this.label&&(this.label[0].stop(),this.label[0].attr({r:7.5}),this.label[1].attr({"font-weight":800}))},function(){this.sector.animate({transform:"s1 1 "+this.cx+" "+this.cy},500,"bounce"),this.label&&(this.label[0].animate({r:5},500,"bounce"),this.label[1].attr({"font-weight":400}))});break;case"dot":r=d.dotchart(c/8,u/8,.8*c,.8*u,n.x.data,n.y.data,n.data,{symbol:"o",max:10,heat:!0,axis:"0 0 1 1",axisxstep:n.x.data.length-1,axisystep:n.y.data.length-1,axisxlabels:n.x.legend?n.x.legend:n.x.data,axisylabels:n.y.legend?n.y.legend:n.y.data,axisxtype:" ",axisytype:" "}).hover(function(){this.marker=this.marker||d.tag(this.x,this.y,this.value,0,this.r+2).insertBefore(this),this.marker.show()},function(){this.marker&&this.marker.hide()})}return r.mousedown(function(){e(a).mousedown().mouseup()}),h.removeChild(o),o}n=n||function(){};var s={ISNUMBER:function(e){var t;return isNaN(e.valueOf())?(t=new a((!1)),t.html="FALSE",t):(t=new a((!0)),t.html="TRUE",t)},N:function(e){return null==e?0:e instanceof r?e.getTime():("object"==typeof e&&(e=e.toString()),"string"==typeof e&&(e=parseFloat(e.replace(/[\$,\s]/g,""))),isNaN(e)?0:"number"==typeof e?e:1==e?1:0)},ABS:function(e){return h.abs(s.N(e))},CEILING:function(e,t){return t=t||1,parseInt(e/t)*t+t},EVEN:function(e){e=h.round(e);var t=e%2==0;return t||(e>0?e++:e--),e},EXP:function(e){return h.exp(e)},FLOOR:function(e,t){if(t=t||1,e<0&&t>0||e>0&&t<0){var n=new o(0);return n.html="#NUM",n}return e>=0?h.floor(e/t)*t:h.ceil(e/t)*t},INT:function(e){return h.floor(s.N(e))},LN:function(e){return h.log(e)},LOG:function(e,t){return t=t||10,h.log(e)/h.log(t)},LOG10:function(e){return s.LOG(e)},MOD:function(e,t){var n=e%t;return t<0&&(n*=-1),n},ODD:function(e){var t=!1;e>0?(e=h.floor(h.round(e)),t=!0):e=h.ceil(e);var n=h.abs(e);return n%2==0&&n++,t?n:-n},PI:function(){return h.PI},POWER:function(e,t){return h.pow(e,t)},SQRT:function(e){return h.sqrt(e)},RAND:function(){return h.random()},RND:function(){return h.random()},ROUND:function(e,t){var n=h.pow(10,t||0);return h.round(e*n)/n},ROUNDDOWN:function(e,t){var n=e<0;return e=h.abs(e),t=t||0,e=h.floor(e*h.pow(10,t))/h.pow(10,t),n?-e:e},ROUNDUP:function(e,t){var n=e<0;return e=h.abs(e),t=t||0,e=h.ceil(e*h.pow(10,t))/h.pow(10,t),n?-e:e},SUM:function(){for(var e,t=0,n=C.flatten(arguments),i=0,r=n.length,l=isNaN;i<r;i++)if(e=n[i],null!==e&&e!==d&&(e=e.valueOf(),!l(e)))switch(typeof e){case"string":t+=1*e;break;default:t+=e}return t},TRUNC:function(e,t){return t=t||0,e+="",0==t?e.split(".").shift():(e.match(".")&&(1==t?e=e.substr(0,e.length-1):t==-1&&(e=e.split(".").shift(),e=e.substr(0,e.length-1)+"0")),e)},AVERAGE:function(){return s.SUM.apply(this,arguments)/s.COUNT.apply(this,arguments)},AVG:function(){return s.AVERAGE.apply(this,arguments)},COUNT:function(){var e=0,t=C.toNumbers(arguments),n=t.length-1;if(n<0)return e;do null!==t[n]&&e++;while(n--);return e},COUNTA:function(){var e=0,t=C.flatten(arguments),n=t.length-1;if(n<0)return e;do t[n]&&e++;while(n--);return e},MAX:function(){var e=C.toNumbers(arguments),t=e[0],n=e.length-1;if(n<0)return 0;do t=e[n]>t?e[n]:t;while(n--);return t},MIN:function(){var e=C.toNumbers(arguments),t=e[0],n=e.length-1;if(n<0)return 0;do t=e[n]<t?e[n]:t;while(n--);return t},ASC:function(e){return e.charCodeAt(0)},CHAR:function(e){return l.fromCharCode(e)},CLEAN:function(e){var t=new c("[cGcLcJcMcIcK\f\n\r\t\x0B]","g");return e.replace(t,"")},CODE:function(e){return s.ASC(e)},CONCATENATE:function(){var e=C.flatten(arguments),t="";return jQuery.each(e,function(n){t+=e[n]}),t},DOLLAR:function(e,t,n){t=t||2,n=n||"$";var i=new o(e),r=s.FIXED(e,t,!1);return e>=0?i.html=n+r:i.html="("+n+r.slice(1)+")",i},FIXED:function(e,t,n){t=t===d?2:t;var i,r=h.pow(10,t),e=h.round(e*r)/r;return i=new l(e.toFixed(t)),i.html=Globalize.format(e,"n"+t),n&&(i.html=i.html.replace(Globalize.culture().numberFormat[","],"")),i},LEFT:function(e,t){return e=e.valueOf().toString(),t=t||1,e.substring(0,t)},LEN:function(e){return e?e.length:0},LOWER:function(e){return e.toLowerCase()},MID:function(e,t,n){if(!e||!t||!n){var i=new o(0);return i.html="ERROR",i}return e.substring(t-1,n+t-1)},REPLACE:function(e,t,n,i){if(!(e&&t&&n&&i)){var r=new l("");return r.html="ERROR",r}var r=e.split("");return r.splice(t-1,n),r.splice(t-1,0,i),r.join("")},REPT:function(e,t){for(var n="",i=0;i<t;i++)n+=e;return n},RIGHT:function(e,t){return t=t||1,e.substring(e.length-t,e.length)},SEARCH:function(e,t,n){n=n||0,n&&(t=t.split(""),t.splice(0,n-1),t=t.join(""));var i=t.search(e);if(i<0){var r=new l("");return r.html="#VALUE!",r}return n+(n?0:1)+i},SUBSTITUTE:function(e,t,n,i){i=i||0,t=new c(t,"g");var r=1;return e=e.replace(t,function(e,t,l,s){var o=e;return i?r>=i&&(o=n):o=n,r++,o})},TEXT:function(e,t){return e},UPPER:function(e){return e.toUpperCase()},VALUE:function(e){if(jQuery.isNumeric(e))return e*=1;var t=new l("");return t.html="#VALUE!",t},NOW:function(){var e=new r;return e.html=x.toString(e),e},TODAY:function(){var e=new r,t=new o(x.toCentury(e)-1);return t.html=x.toString(e,"d"),t},WEEKENDING:function(e){var t=new r;return t=new r(t.getFullYear(),t.getMonth(),t.getDate()+5-t.getDay()-7*(e||0)),t.html=x.toString(t,"d"),t},WEEKDAY:function(e,t){e=x.get(e);var n=e.getDay();switch(t=t?t:1){case 3:switch(n){case 0:return 7;case 1:return 1;case 2:return 2;case 3:return 3;case 4:return 4;case 5:return 5;case 6:return 6}break;case 2:switch(n){case 0:return 6;case 1:return 0;case 2:return 1;case 3:return 2;case 4:return 3;case 5:return 4;case 6:return 5}break;case 1:n++}return n},WEEKNUM:function(e){return e=x.get(e),x.week(e)+1},YEAR:function(e){return e=x.get(e),e.getFullYear()},DAYSFROM:function(e,t,n){return h.floor((new r-new r(e,t-1,n))/x.dayDiv)},DAYS:function(e,t){var n=x.get(e),i=x.get(t),r=864e5;return h.round(h.abs(n.getTime()-i.getTime())/r)},DAY:function(e){return e=x.get(e),e.getDate()},DAYS360:function(e,t,n){e=x.get(e),t=x.get(t);var i=e.getDate(),r=t.getDate(),l=x.isLastDayOfMonth(e),s=x.isLastDayOfMonth(t),o=x.diffMonths(e,t);return n?(i=h.min(i,30),r=h.min(r,30)):(l&&(i=30),s&&(i<30?(o++,r=1):r=30)),30*o+(r-i)},DATE:function(e,t,n){var i=new r(e,t-1,n),l=new o(x.toCentury(i));return l.html=x.toString(i,"d"),l},DATEVALUE:function(e){e=x.get(e);var t=new o(x.toCentury(e));return t.html=x.toString(e,"d"),t},EDATE:function(e,t){e=x.get(e),e.setMonth(e.getMonth()+t);var n=new o(x.toCentury(e));return n.html=x.toString(e,"d"),n},EOMONTH:function(e,t){e=x.get(e),e.setMonth(e.getMonth()+t+1),e=new r(e.getFullYear(),e.getMonth(),0);var n=new o(x.toCentury(e));return n.html=x.toString(e,"d"),n},HOUR:function(e){return e=E.fromMath(e),e.hour},MINUTE:function(e){return E.fromMath(e).minute},MONTH:function(e){return e=x.get(e),e.getMonth()+1},SECOND:function(e){return E.fromMath(e).second},TIME:function(e,t,n){if(n=n?n:0,t=t?t:0,e=e?e:0,n&&n>60){var i=1*(n/60+"").split(".")[0];n-=60*i,t+=i}if(t&&t>60){var r=1*(t/60+"").split(".")[0];t-=60*r,e+=r}var l=60*e*60*1e3+60*t*1e3+1e3*n;return l/x.dayDiv},TIMEVALUE:function(e){return isNaN(e)?/([0]?[1-9]|1[0-2])[:][0-5][0-9]([:][0-5][0-9])?[ ]?(AM|am|aM|Am|PM|pm|pM|Pm)/.test(e)?E.fromString(e,!0):/([0]?[0-9]|1[0-9]|2[0-3])[:][0-5][0-9]([:][0-5][0-9])?/.test(e)?E.fromString(e):0:e},WORKDAY:function(e,t,n){var i,l={1:!0,2:!0,3:!0,4:!0,5:!0},e=x.get(e),t=t&&!isNaN(t)?t:0,s=0,a=0,h=e;if(n){jQuery.isArray(n)||(n=[n]),n=C.flatten(n);var c={};jQuery.each(n,function(e){n[e]&&(c[x.toString(x.get(n[e]),"d")]=!0)}),n=c}else n={};for(;a<t;)h=new r(h.setDate(h.getDate()+1)),l[h.getDay()]&&(n[x.toString(h,"d")]||a++),s++;return i=new o(x.toCentury(h)),i.html=x.toString(h,"d"),i},YEARFRAC:function(e,t,n){if(e=x.get(e),t=x.get(t),!e||!t){var i=new l("");return i.html="#VALUE!",i}n=n?n:0,this.html=[];var r=x.diff(e,t,n),s=x.calcAnnualBasis(e,t,n);return r/s},AND:function(){for(var e,t=0,n=arguments.length;t<n;t++)if(e=arguments[t],e===d||e.valueOf!==d&&1!=e.valueOf()||1!=e)return s.FALSE();return s.TRUE()},FALSE:function(){var e=new a((!1));return e.html="FALSE",e},IF:function(e,t,n){var i,r=e.valueOf();switch(typeof r){case"boolean":return r===!0?t:n;case"number":return 0!==r?t:n;case"string":if(i=r.toUpperCase(),"TRUE"===i)return t;if("FALSE"===i)return n;if(i.replace(/ /g,"").length>0)return t;
}return r?t:t},NOT:function(e){var t;return e.valueOf()?(t=new a((!1)),t.html="FALSE"):(t=new a((!0)),t.html="TRUE"),t},OR:function(){var e,t,n=arguments,i=n.length-1;if(i>-1)do if(t=n[i].valueOf())return e=new a((!0)),e.html="TRUE",e;while(i--);return e=new a((!1)),e.html="FALSE",e},TRUE:function(){var e=new a((!0));return e.html="TRUE",e},GREATER:function(e,t){var n;return e>t?(n=new a((!0)),n.html="TRUE"):(n=new a((!1)),n.html="FALSE"),n},LESS:function(e,t){var n;return e<t?(n=new a((!0)),n.html="TRUE"):(n=new a((!1)),n.html="FALSE"),n},EQUAL:function(e,t){var n,i,r;return e!==d&&null!==e||(e=""),t!==d&&null!==t||(t=""),i=e+"",r=t+"",i==r?(n=new a((!0)),n.html="TRUE"):(n=new a((!1)),n.html="FALSE"),n},GREATER_EQUAL:function(e,t){var n;return e>=t?(n=new a((!0)),n.html="TRUE"):(n=new a((!1)),n.html="FALSE"),n},LESS_EQUAL:function(e,t){var n;return e<=t?(n=new a((!0)),n.html="TRUE"):(n=new a((!1)),n.html="FALSE"),n},IMG:function(n){var i=new l("");return i.html=e(t.createElement("img")).attr("src",n),i},TRIM:function(t){return"string"==typeof t&&(t=e.trim(t)),t},HYPERLINK:function(e,n){n=n||"LINK";var i=new l(n.valueOf()),r=t.createElement("a");return r.setAttribute("href",e),r.setAttribute("target","_new"),r.innerText=r.textContent=n,i.html=r,i},DROPDOWN:function(){var n,i,r,s,o,a,h,c=this,u=this.wickedGrid,f=this.td,p=0;if(null!==f&&(e(f).children().detach(),r=c.value.html),r===d||c.needsUpdated||r.length<1){for(i=C.flatten(arguments),i=C.unique(i),null!==this.id?o=this.id+"-dropdown":null!==f&&(o="dropdown"+this.sheetIndex+"_"+this.rowIndex+"_"+this.columnIndex+"_"+u.I),s=t.createElement("select"),s.setAttribute("name",o),s.setAttribute("id",o),s.className="wg-dropdown",s.cell=this,s.onmouseup=function(){null!==this.cell.td&&u.cellEdit(this.cell)},s.onchange=function(){n=new l(this.value),n.html=s,n.cell=c,c.value=n,c.setNeedsUpdated(!1),u.resolveCell(c),u.trigger("sheetCellEdited",[c])},h=i.length<=50?i.length:50;p<h;p++)if(i[p]){var m=t.createElement("option");m.setAttribute("value",i[p]),m.text=m.innerText=i[p],s.appendChild(m)}u.settings.editable?u.settings.$element.bind("sheetKill",function(){f.innerText=f.textContent=c.value.valueOf()}):s.setAttribute("disabled",!0),s.value=c.value||i[0]}return a="object"!=typeof c.value?new l(c.value):c.value,a.html=s,a},RADIO:function(){var n,i,r,s,o,a=this,h=this.wickedGrid,c=this.td;if(null!==c&&(r=a.value.html,e(c).children().detach()),r===d||r.length<1||a.needsUpdated){n=C.flatten(arguments),n=C.unique(n),null!==this.id?s=this.id+"-radio":null!==c&&(s="radio"+this.sheetIndex+"_"+this.rowIndex+"_"+this.columnIndex+"_"+h.I),r=t.createElement("span"),r.className="wg-radio",r.onmousedown=function(){null!==this.cell.td&&h.cellEdit(a)},r.cell=a;for(var u=0;u<(n.length<=25?n.length:25);u++)if(n[u]){var f=t.createElement("input"),p=t.createElement("span");f.setAttribute("type","radio"),f.setAttribute("name",s),f.className=s,f.value=n[u],h.settings.editable||f.setAttribute("disabled","disabled"),f.onchange=function(){i=new l(this.value),i.html=r,i.cell=a,a.value=i,a.setNeedsUpdated(!1),h.resolveCell(a),h.trigger("sheetCellEdited",[a])},n[u].valueOf()===a.value.valueOf()&&(f.checked=!0),p.textContent=p.innerText=n[u],r.appendChild(f),p.input=f,p.onmousedown=function(){e(this.input).click()},r.appendChild(p),r.appendChild(t.createElement("br"))}h.settings.$element.bind("sheetKill",function(){c.textContent=c.innerText=a.value.valueOf()})}return o="object"!=typeof a.value?new l(a.value):a.value,o.html=r,o},CHECKBOX:function(n){e.isArray(n)&&(n=n[0]);var i,r,s,o,a,h,c=this,u=this.wickedGrid,f=this.td;if(null!==f&&(i=c.value.html,e(f).children().detach()),i===d||i.length<1||c.needsUpdated)switch(null!==this.id?o=this.id+"-checkbox":null!==f&&(o="checkbox"+this.sheetIndex+"_"+this.rowIndex+"_"+this.columnIndex+"_"+u.I),s=t.createElement("input"),s.setAttribute("type","checkbox"),s.setAttribute("name",o),s.setAttribute("id",o),s.className=o,s.value=n,s.onchange=function(){a=new l(this.checked?n:""),a.html=i,a.cell=c,c.value=a,c.setNeedsUpdated(!1),u.resolveCell(c),u.trigger("sheetCellEdited",[c])},u.settings.editable?u.settings.$element.bind("sheetKill",function(){c.value="true"==c.value||s.checked?n:"",null!==c.td&&(c.td.innerText=c.td.textContent=c.value.valueOf())}):s.setAttribute("disabled","true"),i=t.createElement("span"),i.className="wg-checkbox",i.appendChild(s),r=t.createElement("span"),r.textContent=r.innerText=n,i.appendChild(r),i.appendChild(t.createElement("br")),i.onmousedown=function(){null!==this.cell.td&&u.cellEdit(this.cell)},i.cell=c,c.value.valueOf()){case n.valueOf():case"true":s.checked=!0}return h=new l("true"===c.value||s.checked?n:""),h.html=i,h},BARCHART:function(e,t,n){var r=new l("");return r.html=i.call(this,{type:"bar",data:e,legend:t,title:n}),r},HBARCHART:function(e,t,n){var r=new l("");return r.html=i.call(this,{type:"hbar",data:e,legend:t,title:n}),r},LINECHART:function(e,t){var n=new l("");return n.html=i.call(this,{type:"line",x:{data:e},y:{data:t},title:""}),n},PIECHART:function(e,t,n){var r=new l("");return r.html=i.call(this,{type:"pie",data:e,legend:t,title:n}),r},DOTCHART:function(e,t,n,r,s,o){var a=new l("");return a.html=i.call(this,{type:"dot",data:n?n:e,x:{data:e,legend:r},y:{data:t?t:e,legend:s?s:r},title:o}),a},CELLREF:function(e){var t=this.wickedGrid;return t.spreadsheets[e]?t.spreadsheets[e]:"Cell Reference Not Found"},HLOOKUP:function(e,t,n,i){if(e===d)return null;var r,s,o=this.wickedGrid,a="",h=0,c=t.length;if(n=n||1,i=i===d||i,e!==d||isNaN(e)&&"#REF!"!=e||0===e.length){for(;h<c;h++)if(t[h].toString()==e){r=t[h];break}}else C.getClosestNum(e,t,function(t,n){i?r=t:t==e&&(r=t)});return r!==d?(s=r.cell,s=o.getCell(s.sheetIndex,n,s.columnIndex),a=null!==s?s.updateValue():""):(a=new l,a.html="#N/A"),a},VLOOKUP:function(e,t,n,i){if(e===d)return null;var r,s,o,a=this.wickedGrid,h=0,c=t.length;if(i=i===d||i,isNaN(e)&&"#REF!"!=e||0===e.length){for(;h<c;h++)if(t[h].toString()==e){r=t[h];break}}else C.getClosestNum(e,t,function(t,n){i?r=t:t==e&&(r=t)});return r!==d?(s=r.cell,s=a.getCell(s.sheetIndex,s.rowIndex,n),o=null!==s?s.value:""):(o=new l,o.html="#N/A"),o},TRANSPOSE:function(e){for(var t,n,i,r,s,o,a=0,h=this.wickedGrid,c=(this.sheetIndex,e[0]),u=c.cell,d=e[e.length-1],f=(d.cell,u.rowIndex),p=u.columnIndex,m=[],g=[],w=e.length,y=!1;a<w;a++)s=e[a],i=s.cell,t=this.rowIndex+(i.columnIndex-p),n=this.columnIndex+(i.rowIndex-f),r=h.getCell(this.sheetIndex,t,n),null!==r&&r!==this&&(""!=r.value&&(y=!0),g.push(r),m.push(i));if(y)return o=new l(""),o.html="#REF!",o;for(a=0,w=g.length;a<w;a++)r=g[a],r!==this&&(i=m[a],r.setNeedsUpdated(),r.defer=i,r.updateValue(),r.addDependency(this));return c.valueOf()},THISROWCELL:function(e){var t=this.wickedGrid;return isNaN(e)&&(e=t.cellHandler.columnLabelIndex(e)),t.getCell(this.sheetIndex,this.rowIndex,e).updateValue()},THISCOLCELL:function(e){var t=this.wickedGrid;return t.getCell(this.sheetIndex,e,this.columnIndex).updateValue()}};return s}(i.Raphael),p.header=function(n){n.header().remove(),n.sheetAdder().remove(),n.tabContainer().remove();var i,r,l=n.settings,s=t.createElement("div"),o=t.createElement("h4");return s.className=n.cl.header+" "+n.theme.control,n.controls.header=e(s),l.title?(e.isFunction(l.title)&&(l.title=n.title(I)),o.className=n.cl.title,n.controls.title=e(o).html(l.title)):o.style.display="none",s.appendChild(o),n.isSheetEditable()&&(l.headerMenu&&(i=t.createElement("div"),r=e(i),i.className=n.cl.headerMenu+" "+n.cl.menuFixed+" "+n.theme.menuFixed,s.appendChild(i),n.controls.headerMenu[n.i]=r.append(l.headerMenu).children().addClass(n.theme.menuFixed),r.find("img").load(function(){n.sheetSyncSize()})),p.formulaEditor(n,s)),s},p.inPlaceEdit=function(n,r,l){if(r=r||n.cellActive().td||null,null===r&&(r=n.rowTds(null,1)[1],n.cellEdit(r._cell)),null!==r){(n.inPlaceEdit().destroy||f)();var s,o,a=n.formula(),h=a.val(),c=n.pane();s=t.createElement("textarea"),o=e(s),c.inPlaceEdit=s,s.i=n.i,s.className=n.cl.inPlaceEdit+" "+n.theme.inPlaceEdit,s.td=r,s.table=r.parentNode.parentNode.parentNode,s.goToTd=function(){s.offset=e(r).position(),s.offset.left||s.offset.right?s.setAttribute("style","left:"+(s.offset.left-1)+"px;top:"+(s.offset.top-1)+"px;width:"+s.td.clientWidth+"px;height:"+s.td.clientHeight+"px;min-width:"+s.td.clientWidth+"px;min-height:"+s.td.clientHeight+"px;"):e(s).hide()},s.goToTd(),s.onkeydown=function(e){switch(e=e||i.event,n.trigger("sheetFormulaKeydown",[!0]),e.keyCode){case b.ENTER:return n.formulaEvents.keydown(e);case b.TAB:return n.formulaEvents.keydown(e);case b.ESCAPE:return n.cellEvents.editAbandon(),!1}},s.onchange=s.onkeyup=function(){a[0].value=s.value},s.onfocus=function(){n.setNav(!1)},s.onblur=s.onfocusout=function(){n.setNav(!0)},s.onpaste=function(e){n.cellEvents.paste(e)},s.destroy=function(){c.inPlaceEdit=null,null!==n.cellLast&&(n.cellLast.isEdit=s.value!=h),s.parentNode.removeChild(s),n.controls.inPlaceEdit[s.i]=!1},c.appendChild(s),s.onfocus(),n.controls.inPlaceEdit[n.i]=s,o.focus().val("").val(a[0].value),l&&o.select(),e.fn.elastic&&e(s).elastic()}},p.menu=function(e,n){if("undefined"==typeof n)throw new u("no menuEntities defined");var i=t.createElement("div"),r=e.theme.menuHover.split(" ");i.className=e.theme.menu+" "+e.cl.menu,y(i),i.onmouseleave=function(){i.parentNode.removeChild(i)},i.oncontextmenu=function(){return!1},i.onscroll=function(){return!1};for(var l in n)n.hasOwnProperty(l)&&!function(n,l){switch(typeof l){case"function":var s=t.createElement("div");s.className=e.cl.menuButton,s.textContent=n,s.onclick=function(t){return l.call(e,t),i.parentNode.removeChild(i),!1},r.length>0&&(s.onmouseover=function(){for(var e=0,t=i.children.length;e<t;e++)r.forEach(function(t){i.children[e].classList.remove(t)});r.forEach(function(e){s.classList.add(e)})}),i.appendChild(s);break;case"string":if("line"===l){i.appendChild(t.createElement("hr"));break}default:throw new u("Unknown menu type")}}(l,n[l]);return i},p.rowFreezer=function(n,r,l){if(n.isBusy())return!1;var l=n.pane(),s=l.actionUI,o=(l.table,l.tBody),a=s.frozenAt,c=s.scrolledArea;if(!(c.row<=a.row+1))return!1;n.barHelper().remove();var u,d=o.children[a.row+1].children[0],f=l.getBoundingClientRect(),p=f.top+t.body.scrollTop,m=f.left+t.body.scrollLeft,g=t.createElement("div"),w=l.freezeHandleLeft=e(g).appendTo(l).addClass(n.theme.rowFreezeHandle+" "+n.cl.barHelper+" "+n.cl.rowFreezeHandle).width(d.clientWidth).css("top",d.offsetTop-g.clientHeight+1+"px").attr("title",n.msg.dragToFreezeRow);return n.controls.bar.helper[n.i]=n.barHelper().add(g),n.controls.bar.y.handleFreeze[n.i]=w,n.draggable(w,{axis:"y",start:function(){n.setBusy(!0),u=e(t.createElement("div")).appendTo(l).css("position","absolute").addClass(n.theme.barFreezeIndicator+" "+n.cl.barHelper).width(g.clientWidth).fadeTo(0,.33)},drag:function(){var e=w.nearest(d.parentNode.parentNode.children).prev();e.length&&e.position&&u.height(e.position().top+e.height())},stop:function(t,i){u.remove(),n.setBusy(!1).setDirty(!0);var r=e.nearest(w,d.parentNode.parentNode.children);n.barHelper().remove(),c.row=s.frozenAt.row=h.max(n.getTdLocation(r.children(0)[0]).row-1,0),n.autoFillerHide()},containment:[m,p,m,p+l.clientHeight-i.scrollBarSize.height]}),!0},p.rowResizer=function(n,i,r,l){n.barLeftControls().remove();var s,o=i.getBoundingClientRect(),a=o.top+t.body.scrollTop,h=o.left+t.body.scrollLeft,c=t.createElement("div"),u=e(c).addClass(n.cl.barController+" "+n.theme.barResizer).offset({top:a,left:h}).prependTo(i),d=i.parentNode,f=t.createElement("div"),p=e(f).addClass(n.cl.barControllerChild).height(i.clientHeight).prependTo(u);n.controls.bar.y.controls[n.i]=n.barLeftControls().add(u),n.resizableCells(p,{handles:"s",start:function(){n.autoFillerHide(),n.setBusy(!0),l.freezeHandleLeft&&l.freezeHandleLeft.remove()},resize:function(e,t){c.style.height=i.style.height=d.style.height=t.size.height+"px",l.inPlaceEdit&&l.inPlaceEdit.goToTd()},stop:function(e,t){n.setBusy(!1),l.inPlaceEdit&&l.inPlaceEdit.goToTd(),n.followMe(),n.setDirty(!0)},minHeight:15}),s=f.children[0],s.style.width=i.offsetWidth+"px"},p.sheetUI=function(t,n,r){t.i=r;var l=p.enclosure(t),s=l.pane,o=e(s),a=s.actionUI,h=function(e){e=e||i.event;var n=e.target,r=n.parentNode;if(t.isBusy())return!1;if(t.isCell(e.target))return t.cellContextMenu.show(e.pageX,e.pageY),!1;if(t.isBar(n)&&(0!==n.cellIndex||0!==r.rowIndex))return 0===r.rowIndex?t.columnContextMenu.show(e.pageX,e.pageY):t.rowContextMenu.show(e.pageX,e.pageY),!1};if(n.appendChild(l),t.isSheetEditable()&&p.autoFiller(t,s),t.isSheetEditable()){var c=(t.formula(),"");o.mousedown(function(e){return t.setNav(!0),!t.isBusy()&&(t.isCell(e.target)?2==e.button?(h.call(this,e),t.cellEvents.mouseDown(e),!0):(t.cellEvents.mouseDown(e),!1):!t.isBar(e.target)||(2==e.button&&h.call(this,e),c=e.target.entity,a.selectBar(e.target),!1))}),s.onmouseup=function(){c=""},s.onmouseover=function(e){if(e=e||i.event,t.isBusy())return!1;if(!t.isBar(e.target))return!1;var n=e.target||e.srcElement,r=n.index,l=n.entity;if(r<0)return!1;switch(l){case p.columnEntity:a.columnCache.selecting&&n===c?(a.columnCache.last=r,t.cellSetActiveBar(p.columnEntity,a.columnCache.first,a.columnCache.last)):(p.columnResizer(t,n,r,s),t.isSheetEditable()&&(p.columnFreezer(t,r,s),t.columnMenu.setColumn(n).show(e.pageX,e.pageY)));break;case p.rowEntity:a.rowCache.selecting&&n===c?(a.rowCache.last=r,t.cellSetActiveBar(p.rowEntity,a.rowCache.first,a.rowCache.last)):(p.rowResizer(t,n,r,s),t.isSheetEditable()&&p.rowFreezer(t,r,s))}return!0},s.ondblclick=function(e){return t.cellEvents.dblClick(e)},s.oncontextmenu=h,o.disableSelectionSpecial().bind("cellEdit",function(e){if(e.target._cell)return t.cellEvents.edit(e.target._cell)})}p.tab(t),t.setChanged(!0)},p.spreadsheetAdder=function(n){var i=t.createElement("span");return n.isSheetEditable()&&(i.setAttribute("class",p.cl.sheetAdder+" "+p.cl.tab+" "+n.theme.tab),i.setAttribute("title",p.msg.addSheet),i.innerHTML="+",i.onmousedown=function(){return n.addSheet(),!1},i.i=-1),n.controls.sheetAdder=e(i),i},p.tab=function(n){var i=t.createElement("span"),r=n.controls.tab[n.i]=e(i).appendTo(n.tabContainer());return i.setAttribute("class",p.cl.tab+" "+n.theme.tab),n.sheetTab(!0,function(e){i.innerHTML=e}),i.i=n.i,n.controls.tabs=n.tabs().add(r),i},p.tabs=function(n){var r,l=t.createElement("span"),s=e(l);return n.controls.tabContainer=s,l.setAttribute("class",p.cl.tabContainer),l.onmousedown=function(e){e=e||i.event;var t=(e.target||e.srcElement).i;return t>=0&&n.trigger("sheetSwitch",[t]),!1},l.ondblclick=function(e){e=e||i.event;var t=(e.target||e.srcElement).i;return t>=0&&n.trigger("sheetRename",[t]),!1},n.isSheetEditable()&&e.fn.sortable&&s.sortable({placeholder:"ui-state-highlight",axis:"x",forceHelperSize:!0,forcePlaceholderSize:!0,opacity:.6,start:function(e,t){r=t.item.index(),n.trigger("sheetTabSortStart",[e,t])},update:function(e,t){n.trigger("sheetTabSortUpdate",[e,t,r])}}),l},p.thread=function(e){function t(){var e=i[n],r=t.limit;return e=e===d?i[n]=t.create():i[n],n++,n>r&&(n=0),e}var n=0,i=[];return t.limit=10,t.create=function(){var t=e({parseFormula:function(e){return formulaParser.yy.types=[],formulaParser.parse(e)},streamJSONSheet:function(e,t,n){Promise.all([gR(e+t)]).then(function(e){var t,i,r=e[0],l=JSON.parse(r),s=0;for(l.pop!==d&&(l=l[0]),t=l.rows,i=t.length,l.rows=[],n("sheet",JSON.stringify(l));s<i;s++)n("row",JSON.stringify(t[s]));n()},function(e){n("error",e)})},streamJSONRows:function(e,t,n){var i=0,r=t.length,l=[];if("string"==typeof t)l.push(gR(e+t));else for(;i<r;i++)l.push(gR(e+t[i]));Promise.all(l).then(function(e){for(var t,i,r,l,s=0,o=e,a=o.length;s<a;s++)for(r=JSON.parse(o[s]),l=r.length,t=0;t<l;t++)i=r[t],n("row",JSON.stringify(i));n()},function(e){n("error",e)})},streamJSONSheetRows:function(e,t,n,i){var r=0,l=n.length,s=[gR(e+t)];if("string"==typeof n)s.push(gR(e+n));else for(;r<l;r++)s.push(gR(e+n[r]));Promise.all(s).then(function(e){i("sheet",e[0]);for(var t,n,r,l,s=1,o=e,a=o.length;s<a;s++)for(r=JSON.parse(o[s]),l=r.length,t=0;t<l;t++)n=r[t],i("row",JSON.stringify(n));i()},function(e){i("error",e)})}},[p.formulaParserUrl,p.threadScopeUrl]);return t.stash=[],t.busy=!1,t},t.kill=function(){for(var e=0,t=i.length;e<t;e++)i[e].terminate()},t}(i.operative),p.ui=function(e){var n=t.createElement("div");return n.setAttribute("class",p.cl.ui),e.ui=n,n};var b={BACKSPACE:8,CAPS_LOCK:20,COMMA:188,CONTROL:17,ALT:18,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,INSERT:45,LEFT:37,NUMPAD_ADD:107,NUMPAD_DECIMAL:110,NUMPAD_DIVIDE:111,NUMPAD_ENTER:108,NUMPAD_MULTIPLY:106,NUMPAD_SUBTRACT:109,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SHIFT:16,SPACE:32,TAB:9,UP:38,C:67,F:70,V:86,X:88,Y:89,Z:90,UNKNOWN:229},C=i.arrHelpers={math:h,toNumbers:function(t){t=this.flatten(t);var n=t.length-1;if(n<0)return[];do t[n]?(t[n]=e.trim(t[n]),isNaN(t[n])?t[n]=0:t[n]=1*t[n]):t[n]=0;while(n--);return t},unique:function(e){var t,n={},i=e.length,r=[];for(t=0;t<i;t+=1)n[e[t]]=e[t];for(t in n)r.push(n[t]);return r},flatten:function(e){for(var t,n=[],i=0,r=e.length;i<r;i++)t=e[i],n=t instanceof Array?n.concat(this.flatten(t)):n.concat(t);return n},insertAt:function(t,n,i){return e(n).each(function(){i>-1&&i<=t.length&&t.splice(i,0,this)}),t},indexOfNearestLessThan:function(e,t){if(0===e.length)return-1;var n,i,r=e.length-1,l=0,s=-1;if(e[r]<t)return r;for(;l<=r;)if(n=l+r>>1,i=e[n],i>t)r=n-1;else{if(!(i<t)){s=l;break}s=n,l=n+1}return s},ofSet:function(e,t){if(0===e.length)return null;var n,i,r,l=e.length-1,s=l,o=e[l],a=e[0],h=0,c=-1,u=-1,d=-1;if(e[l]<t||e[0]>t)return null;for(;h<=l;)if(n=h+l>>1,i=e[n],i>t)c=n,l=n-1;else{if(!(i<t)){c=l;break}h=n+1}if(c>-1){for(r=c;r<=s;){if(e[r]+1!==e[r+1]){u=e[r];break}r++}for(u===-1&&(u=o),r=c;r>=0;){if(e[r]-1!==e[r-1]){d=e[r];break}r--}d===-1&&(d=a)}return{start:d,end:u}},closest:function(e,t,n,i){n=n||0,i=i||e.length-1;for(var r,l;;){if(r=n+i>>1,l=e[r],(r===i||r===n)&&l!==t)return l;if(l>t)i=r;else{if(!(l<t))return l;n=r}}},getClosestNum:function(e,t,n){var i,r,l,s,o=0;if(t.length){for(r=t[0],i=o,o;o<t.length;o++)l=h.abs(e-r),s=h.abs(e-t[o]),s<l&&(i=o,r=t[o]),l=null,s=null;return n?n(r,i):r}return!1},levenshtein:function(){var e=[];return function(t,n){if(t===n)return 0;var i=t.length,r=n.length;if(i&&r){for(var l,s,o,a,h=0,c=0,u=e;h<i;)u[h]=++h;for(;c<r;)for(a=n.charCodeAt(c),l=c,++c,s=c,h=0;h<i;++h)o=l+(t.charCodeAt(h)===a?0:1),l=u[h],s=s<l?s<o?s+1:o:l<o?l+1:o,u[h]=s;return s}return i+r}}(),lSearch:function(e,t){for(var n,i,r=0,l=e.length,s=-1;r<l;r++)n=e[r],i=new o(this.levenshtein(n,t)),i.item=n,i<s&&(s=i);return i!==d?i.item:null}},x={dayDiv:864e5,math:h,toCentury:function(e,t){return t=t||864e5,this.math.round(this.math.abs(new r(1900,0,(-1))-e)/t)},get:function(e,t){if(t=t||864e5,e.getMonth)return e;if(isNaN(e))return new r(Globalize.parseDate(e));e*=t;var n=1*new r(1900,0,(-1));return e+=n,e=new r(e)},week:function(e,t){t=t||864e5;var n=new r(e.getFullYear(),0,1);return this.math.ceil(((e-n)/t+n.getDay()+1)/7)},toString:function(e,t){return t?Globalize.format(e,Globalize.culture().calendar.patterns[t]):Globalize.format(e)},diff:function(e,t,n,i){switch(i=i||864e5,n){case 0:return this.days360Nasd(e,t,0,!0);case 1:case 2:case 3:var r=this.math.abs(t-e)/i;return r;case 4:return this.days360Euro(e,t)}return 0},diffMonths:function(e,t){var n;return n=12*(t.getFullYear()-e.getFullYear()),n-=e.getMonth()+1,n+=t.getMonth()+1},days360:function(e,t,n,i,r,l){return 360*(t-e)+30*(i-n)+(l-r)},days360Nasd:function(e,t,n,i){var r=e.getDate(),l=e.getMonth(),s=e.getFullYear(),o=t.getDate(),a=t.getMonth(),h=t.getFullYear();return 2==a&&this.isEndOfMonth(o,a,h)&&(2==l&&this.isEndOfMonth(r,l,s)||3==n)&&(o=30),31==o&&(r>=30||3==n)&&(o=30),31==r&&(r=30),i&&2==l&&this.isEndOfMonth(r,l,s)&&(r=30),this.days360(s,h,l,a,r,o)},days360Euro:function(e,t){var n=e.getDate(),i=e.getMonth(),r=e.getFullYear(),l=t.getDate(),s=t.getMonth(),o=t.getFullYear();return 31==n&&(n=30),31==l&&(l=30),this.days360(r,o,i,s,n,l)},isEndOfMonth:function(e,t,n){return e==new r(n,t+1,0,23,59,59).getDate()},isLeapYear:function(e){return 1==new r(e,1,29).getMonth()},calcAnnualBasis:function(e,t,n){switch(n){case 0:case 2:case 4:return 360;case 3:return 365;case 1:var i=e.getDate(),r=e.getMonth(),l=e.getFullYear(),s=t.getDate(),o=t.getMonth(),a=t.getFullYear(),h=0;if(l==a)h=this.isLeapYear(l)?366:365;else if(a-1==l&&(r>o||r==o&&i>=s))h=this.isLeapYear(l)?r<2||2==r&&i<=29?366:365:this.isLeapYear(a)&&(o>2||2==o&&29==s)?366:365;else{for(var c=l;c<=a;c++)h+=this.isLeapYear(c)?366:365;h/=a-l+1}return h}return 0},lastDayOfMonth:function(e){return e.setDate(0),e.getDate()},isLastDayOfMonth:function(e){return e.getDate()==this.lastDayOfMonth(e)}},E=i.times={math:h,fromMath:function(e){var t={},n=this;return t.hour=1*(24*e+"").split(".")[0],t.minute=function(e){e=n.math.round(24*e*100)/100,e=(e+"").split(".");var t=0;return e[1]&&(e[1].length<2&&(e[1]+="0"),t=.6*e[1]),n.math.round(t)}(e),t.second=function(e){e=n.math.round(24*e*1e4)/1e4,e=(e+"").split(".");var t=0;if(e[1]){for(var i=0;i<4;i++)e[1].charAt(i)||(e[1]+="0");var r=(.006*e[1]+"").split(".");if(r[1])return r[1]&&r[1].length>2&&(r[1]=r[1].substr(0,2)),n.math.round(.6*r[1])}return t}(e),t},fromString:function(e,t){var n,i,l,s,o=(new r,e);return t&&(s=o.substr(-2).toLowerCase(),o=o.replace(/(am|pm)/i,"")),o=o.split(":"),n=1*o[0],i=1*o[1],l=1*(o[2]?o[2]:0),t&&"pm"==s&&(n+=12),jFN.TIME(n,i,l)}};return e.extend(h,{log10:function(e){return h.log(e)/2.302585092994046},signum:function(e){return e/h.abs(e)||e},log1p:function(e){var t=0,n=50;if(e<=-1)return"-INF";if(e<0||e>1)return h.log(1+e);for(var i=1;i<n;i++)i%2===0?t-=h.pow(e,i)/i:t+=h.pow(e,i)/i;return t}}),e.printSource=function(e){var t=win.open();t.document.write("<html><body><xmp>"+e+"\n</xmp></body></html>"),t.document.close()},p.event.Cell=function(){function t(e){this.wickedGrid=e}return t.prototype={done:function(t){var n,i=this.wickedGrid,r=i.inPlaceEdit(),l=e(r).is(":focus"),s=i.cellLast,o=i.settings.$element;if((r.destroy||f)(),null!==s&&(s.isEdit||t)){n=i.getCell(s.sheetIndex,s.rowIndex,s.columnIndex);var a=l?e(r):i.formula(),h=n.td;if(i.isFormulaEditable(h)&&null!==h&&n.rowIndex>0&&n.columnIndex>0){var c,u=a.val(),d=i.loader;n.edited||(n.edited=!0,i.cellsEdited().push(n)),o.one("sheetPreCalculation",function(){n.parsedFormula=null,"="==u.charAt(0)?n.formula=u=u.substring(1):(n.value=u,n.formula="",null!==(c=n.loadedFrom)&&d.setCellAttributes(c,{cache:v,formula:"",value:u,parsedFormula:null})),n.setNeedsUpdated()}),i.resolveCell(n),n.isEdit=!1,i.trigger("sheetCellEdited",[n])}}},editAbandon:function(e){var t=this.wickedGrid,n=t.cellLast;return(t.inPlaceEdit().destroy||f)(),t.highlighter.clearBar().clear(),e||null===n||n.updateValue(),t.cellLast=null,t.rowLast=0,t.colLast=0,t.highlighter.startRowIndex=0,t.highlighter.startColumnIndex=0,t.highlighter.endRowIndex=0,t.highlighter.endColumnIndex=0,t.labelUpdate(""),t.formula().val("").blur(),t.autoFillerHide(),!1},setHighlightFromKeyCode:function(e){var t=this.wickedGrid,n=t.orderedGrid(t.highlighter),i=t.sheetSize(),r=t.cellActive,l=t.highlighter;if(null===r)return!1;switch(e.keyCode){case b.UP:if(n.startRowIndex<r.rowIndex){n.startRowIndex--,n.startRowIndex=n.startRowIndex>0?n.startRowIndex:1;break}n.endRowIndex--,n.endRowIndex=n.endRowIndex>0?n.endRowIndex:1;break;case b.DOWN:if(n.startRowIndex===n.endRowIndex){n.startRowIndex++,n.startRowIndex=n.startRowIndex<i.rows?n.startRowIndex:i.rows;break}if(n.startRowIndex<cell.rowIndex){n.startRowIndex++,n.startRowIndex=n.startRowIndex>0?n.startRowIndex:1;break}n.endRowIndex++,n.endRowIndex=n.endRowIndex<i.rows?n.endRowIndex:i.rows;break;case b.LEFT:if(n.startColumnIndex<cell.columnIndex){n.startColumnIndex--,n.startColumnIndex=n.startColumnIndex>0?n.startColumnIndex:1;break}n.endColumnIndex--,n.endColumnIndex=n.endColumnIndex>0?n.endColumnIndex:1;break;case b.RIGHT:if(n.startColumnIndex<cell.columnIndex){n.startColumnIndex++,n.startColumnIndex=n.startColumnIndex<i.cols?n.startColumnIndex:i.cols;break}n.endColumnIndex++,n.endColumnIndex=n.endColumnIndex<i.cols?n.endColumnIndex:i.cols}return l.startRowIndex=n.startRowIndex,l.startColumnIndex=n.startColumnIndex,l.endRowIndex=n.endRowIndex,l.endColumnIndex=n.endColumnIndex,t.cycleCellArea(function(e){l.set(e.td)},n),!1},setActiveFromKeyCode:function(e,t){if(null===this.cellLast)return!1;var n,i,r,l,s=this.wickedGrid,o=s.cellLast,a={rowIndex:o.rowIndex,columnIndex:o.columnIndex},h=!1,c=!1;switch(e.keyCode){case b.UP:a.rowIndex--;break;case b.DOWN:a.rowIndex++;break;case b.LEFT:a.columnIndex--;break;case b.RIGHT:a.columnIndex++;break;case b.ENTER:a=s.cellEvents.incrementAndStayInGrid(s.orderedGrid(s.highlighter),a,!0,e.shiftKey),h=!0,l=s.highlighted(),l.length>1?c=!0:t||(a.rowIndex+=e.shiftKey?-1:1);break;case b.TAB:a=s.cellEvents.incrementAndStayInGrid(s.orderedGrid(s.highlighter),a,!1,e.shiftKey),h=!0,l=s.highlighted(),l.length>1?c=!0:t||(a.columnIndex+=e.shiftKey?-1:1);break;case b.HOME:a.columnIndex=1;break;case b.END:a.columnIndex=this.tdActive().parentNode.children.length-2}if(a.columnIndex=a.columnIndex||1,a.rowIndex=a.rowIndex||1,!o.isEdit||h){if((n=s.spreadsheets[s.i])===v)return!1;if((i=n[a.rowIndex])===v)return!1;if((r=i[a.columnIndex])===v)return!1;if(null!==r)return s.cellEdit(r,null,c),!1}return!0},incrementAndStayInGrid:function(e,t,n,i){return n?i?(t.rowIndex--,t.rowIndex<e.startRowIndex&&(t.rowIndex=e.endRowIndex,t.columnIndex--),t.columnIndex<e.startColumnIndex&&(t.columnIndex=e.endColumnIndex)):(t.rowIndex++,t.rowIndex>e.endRowIndex&&(t.rowIndex=e.startRowIndex,t.columnIndex++),t.columnIndex>e.endColumnIndex&&(t.columnIndex=e.startColumnIndex)):i?(t.columnIndex--,t.columnIndex<e.startColumnIndex&&(t.columnIndex=e.endColumnIndex,t.rowIndex--),t.rowIndex<e.startRowIndex&&(t.rowIndex=e.endRowIndex)):(t.columnIndex++,t.columnIndex>e.endColumnIndex&&(t.columnIndex=e.startColumnIndex,t.rowIndex++),t.rowIndex>e.endRowIndex&&(t.rowIndex=e.startRowIndex)),t},mouseDown:function(e){var t=this.wickedGrid;t.formula().blur(),e.shiftKey?t.getTdRange(e,t.formula().val()):e.target._cell&&this.edit(e.target._cell,!0)},dblClick:function(e){return!this.wickedGrid.isBusy()&&(p.inPlaceEdit(this.wickedGrid),!0)},edit:function(e){var t=this.wickedGrid;return!t.isBusy()&&(t.cellEdit(e),!0)},paste:function(e){if(e=e||i.event,e.ctrlKey||"paste"==e.type){var t=function(){wickedGrid.updateCellsAfterPasteToFormula()},n=$document.one("keyup",function(){t(),t=function(){},n.mouseup()}).one("mouseup",function(){t(),t=function(){},n.keyup()});return wickedGrid.setDirty(!0),wickedGrid.setChanged(!0),!0}return!1}},t}(),p.event.Document=function(){function t(e){this.wickedGrid=e}return t.prototype={enter:function(t){return this.wickedGrid.cellLast.isEdit||t.ctrlKey||e(this.wickedGrid.tdActive()).dblclick(),!1},tab:function(e){this.wickedGrid.cellEvents.setActiveFromKeyCode(e)},findCell:function(e){return!e.ctrlKey||(this.wickedGrid.cellFind(),!1)},redo:function(e){return!(e.ctrlKey&&!this.wickedGrid.cellLast.isEdit)||(this.wickedGrid.undo.manager.redo(),!1)},undo:function(e){return!(e.ctrlKey&&!this.wickedGrid.cellLast.isEdit)||(this.wickedGrid.undo.manager.undo(),!1)},copy:function(e,t){var n=this.wickedGrid.highlighted(!0),i=this.wickedGrid.formula(),r=i.val(),l=this.wickedGrid.toTsv(n,t);return i.val(l).focus().select(),$document.one("keyup",function(){t?i.val(""):i.val(r)}),!0},cut:function(e){return this.copy(e,!0)},pageUpDown:function(t){var n,i,r=this.wickedGrid.sheetSize(),l=this.wickedGrid.pane(),s=l.clientHeight,o=0;if(t)for(i=this.wickedGrid.cellLast.rowIndex;i>0&&o<s;i--)n=this.wickedGrid.getTd(-1,i,1),null!==n&&!n.getAttribute("data-hidden")&&e(n).is(":hidden")&&e(n).show(),o+=n.parentNode.clientHeight;else for(i=this.wickedGrid.cellLast.rowIndex;i<r.rows&&o<s;i++)n=this.wickedGrid.getTd(-1,i,1),null!==n&&(o+=n.parentNode.clientHeight);return this.wickedGrid.cellEdit(n),!1},keydown:function(t){t=t||i.event;var n=this.wickedGrid;if(n.readOnly[n.i])return!1;if(null!==n.cellLast){if(n.cellLast.rowIndex<0||n.cellLast.columnIndex<0)return!1;var r=n.cellLast.td;if(n.nav){switch(t.keyCode){case b.DELETE:n.toTsv(null,!0),n.formula().val(""),n.cellLast.isEdit=!0;break;case b.TAB:this.tab(t);break;case b.ENTER:n.cellEvents.setActiveFromKeyCode(t);break;case b.LEFT:case b.UP:case b.RIGHT:case b.DOWN:t.shiftKey?n.cellEvents.setHighlightFromKeyCode(t):n.cellEvents.setActiveFromKeyCode(t);break;case b.PAGE_UP:this.pageUpDown(!0);break;case b.PAGE_DOWN:this.pageUpDown();break;case b.HOME:case b.END:n.cellEvents.setActiveFromKeyCode(t);break;case b.V:return t.ctrlKey?n.formulaEvents.If(!n.cellEvents.paste(t),t):(e(r).trigger("cellEdit"),!0);case b.Y:return t.ctrlKey?(this.redo(t),!1):(e(r).trigger("cellEdit"),!0);case b.Z:return t.ctrlKey?(this.undo(t),!1):(e(r).trigger("cellEdit"),!0);case b.ESCAPE:n.cellEvents.editAbandon();break;case b.F:return t.ctrlKey?n.formulaEvents.If(this.findCell(t),t):(e(r).trigger("cellEdit"),!0);case b.CAPS_LOCK:case b.SHIFT:case b.ALT:break;case b.CONTROL:return n.formula().focus().select(),!0;default:return n.inPlaceEdit().td!==r&&e(r).trigger("cellEdit"),!0}return!1}}}},t}(),p.event.Formula=function(){function t(e){this.wickedGrid=e}return t.prototype={keydown:function(e){e=e||i.event;var t=this.wickedGrid;if(t.readOnly[t.i])return!1;if(null===t.cellLast)return!1;if(t.cellLast.rowIndex<0||t.cellLast.columnIndex<0)return!1;switch(t.trigger("sheetFormulaKeydown",[!1]),e.keyCode){case b.C:if(e.ctrlKey)return t.documentEvents.copy(e);case b.X:if(e.ctrlKey)return t.documentEvents.cut(e);case b.Y:if(e.ctrlKey)return t.documentEvents.redo(e),!1;break;case b.Z:if(e.ctrlKey)return t.documentEvents.undo(e),!1;break;case b.ESCAPE:return t.cellEvents.editAbandon(),!0;case b.ENTER:return t.cellEvents.setActiveFromKeyCode(e,!0),!1;case b.UNKNOWN:return!1}t.cellLast.isEdit=!0},If:function(t,n){return!!t&&(e(this.wickedGrid.tdActive()).dblclick(),!0)}},t}(),p.loader.HTML=function(e,t,n){function i(e){e!==d?(this.tables=e,this.count=e.length):(this.tables=[],this.count=0),this.cellIds={},this.wickedGrid=null,this.handler=null}return i.prototype={bindWickedGrid:function(e){return this.wickedGrid=e,this},bindHandler:function(e){return this.handler=e,this},bindActionUI:function(e,t){t.loadedFrom=this.tables[e]},size:function(e){var t,n,i,r,l={cols:0,rows:0},s=this.tables;return(t=s[e])===d?l:(n=t.querySelectorAll("tr"))===d?l:(i=n[0])===d?l:(r=i.children)===d?l:{rows:n.length,cols:r.length}},getWidth:function(e,t){var n,i,r=this.tables,l=r[e];return n=l.querySelectorAll("col"),n.length>t?(i=n[t].style.width.replace("px","")||p.defaultColumnWidth,1*i):p.defaultColumnWidth},getHeight:function(e,t){var n,i,r,l=this.tables,s=l[e];return n=s.querySelectorAll("tr"),n.length>t?(i=n[t],r=i.style.height.replace("px","")||p.defaultRowHeight,1*r):p.defaultRowHeight},isHidden:function(e){var t=this.tables,n=t[e];return"none"===n.style.display},setHidden:function(e,t){var n=this.tables,i=n[e];return t?i.style.display="none":i.style.display="",this},addRow:function(e,n,i){var r,l,s=this.tables[e],o=0,a=this.size(e),h=a.cols,c=a.rows,u=t.createElement("tr");if(s===d)return this;for(l=s.querySelector("tBody")||s,r=l.children;o<h;o++)u.appendChild(i[o].loadedFrom=t.createElement("td"));return n===d?l.appendChild(u):n<c&&l.insertBefore(u,r[n+1]),this},addColumn:function(e,n,i){var r,l,s,o,a=this.tables[e],h=0,c=this.size(e),u=c.rows,f=c.cols;if(a===d)return this;if(o=a.querySelector("tBody"),r=o.children,n===d)for(;h<u;h++)l=r[h],s=t.createElement("td"),i[h].loadedFrom=s,l.append(s);else if(n<f)for(;h<u;h++)l=r[h],s=t.createElement("td"),i[h].loadedFrom=s,l.insertBefore(s,l.children[n+1]);return this},deleteRow:function(e,t){var n,i,r,l,s=this.tables[e];return s===d?this:(l=s.querySelector("tBody"),n=l.children,n.length>t&&l.removeChild(n[t]),s.hasAttribute("data-hiddenrows")(i=s.getAttribute("data-hiddenrows").split(","))&&(r=i.indexOf(t))>-1&&(i.splice(r,1),s.setAttribute("data-hiddenrows",i.join(","))),
this)},deleteColumn:function(e,t){var n,i,r,l,s,o,a,h=this.tables[e],c=0;if(h===d)return this;for(a=h.querySelector("tBody"),n=a.children,l=n.length;c<l;c++)i=n[c],r=i.children,t.length>t&&i.removeChild(r[t]);return h.hasAttribute("data-hiddencolumns")&&(s=h.getAttribute("data-hiddencolumns").split(","))&&(o=s.indexOf(t))>-1&&(s.splice(o,1),h.setAttribute("data-hiddencolumns",s.join(","))),this},setupTD:function(e,t){if(e.covered)return t.style.visibility="hidden",this;var n,i,r,l,s,o=this.wickedGrid,a=e.loadedFrom,h=!1,c=0,u=0,f=e.rowIndex,p=e.columnIndex;if(a.hasAttribute("class")&&(t.className=e.className),a.hasAttribute("style")&&t.setAttribute("style",a.getAttribute("style")),a.hasAttribute("rowspan")&&(t.setAttribute("rowspan",n=a.getAttribute("rowspan")),r=f+1*n,h=!0),a.hasAttribute("colspan")&&(t.setAttribute("colspan",i=a.getAttribute("colspan")),l=p+1*i,h=!0),h){for(r===d&&(r=f+1),l===d&&(l+=1),t.style.position="absolute",t.style.borderBottomWidth=t.style.borderRightWidth="1px";f<r;f++)c+=this.getHeight(e.sheetIndex,f)+2,e.rowIndex!==f&&null!==(s=o.getCell(e.sheetIndex,f,e.columnIndex))&&(s.covered=!0,s.defer=e);for(;p<l;p++)u+=this.getWidth(e.sheetIndex,p),e.columnIndex!==p&&null!==(s=o.getCell(e.sheetIndex,e.rowIndex,p))&&(s.covered=!0,s.defer=e);c-=1,u-=1,t.style.width=u+"px",t.style.height=c+"px"}return this},getCell:function(e,t,n){var i,r,l,s,o=this.tables;return(i=o[e])===d?null:(r=i.querySelectorAll("tr"))===d?null:(l=r[t])===d?null:(s=l.children[n])===d?null:s},jitCell:function(e,t,i){var r=this.getCell(e,t,i);if(null===r)return null;if(r.getCell!==d)return r.getCell();var l,s,o,a,h,c,u,f,m,g,w;return s=r.getAttribute("id"),o=r.innerHTML,a=r.getAttribute("data-formula"),h=r.getAttribute("data-celltype"),c=r.getAttribute("data-uneditable"),u=null!==s,f=o.length>0,m=null!==a,g=null!==h,w=null!==c,l=new p.Cell(e,null,this.wickedGrid,this.handler),l.rowIndex=t,l.columnIndex=i,l.loadedFrom=r,l.loader=this,u&&(l.id=s),m&&(l.formula=a),g&&(l.cellType=h),w&&(l.uneditable=c),f?l.value=new n(o):l.value=new n,l.value.cell=l,r.getCell=function(){return l},l},jitCellById:function(e,t,n){switch(this.cellIds[e]){case d:break;case null:return this;default:n(this.cellIds[e].requestCell())}var i,r,l,s,o,a,h,c,u,f,p=this,m=this.tables,g=t<0?m.length-1:t+1;for(t<0&&(t=0);t<g;t++)if(i=m[t],s=i.querySelectorAll("tr"),!(s.length<1))for(r=0,l=s.length;r<l;r++)for(o=s[r],c=o.children,a=0,h=c.length;a<h;a++)u=c[a],null!==u&&null!==u.id&&u.id.length>0&&(this.cellIds[u.id]={cell:u,sheetIndex:t,rowIndex:r,columnIndex:a,requestCell:function(){return p.jitCell(this.sheetIndex,this.rowIndex,this.columnIndex)}});return this.cellIds[e]!==d?(f=this.cellIds[e].requestCell(),n(f)):this.cellIds[e]=null,this},title:function(e){var t,n=this.tables;return(t=n[e])===d?"":t.getAttribute("title")},hideRow:function(e,t){var n,i=e.loadedFrom;return n=i.hasAttribute("data-hiddenrows")?C.toNumbers(i.getAttribute("data-hiddenrows").split(",")):[],n.indexOf(t)<0&&(n.push(t),n.sort(function(e,t){return e-t})),i.setAttribute("data-hiddenrows",n.join(",")),n},hideColumn:function(e,t){var n,i=e.loadedFrom;return n=i.hasAttribute("data-hiddencolumns")?C.toNumbers(i.getAttribute("data-hiddencolumns").split(",")):[],n.indexOf(t)<0&&(n.push(t),n.sort(function(e,t){return e-t})),i.setAttribute("data-hiddencolumns",n.join(",")),n},showRow:function(e,t){var n,i,r=e.loadedFrom;return n=r.hasAttribute("data-hiddenrows")?C.toNumbers(r.getAttribute("data-hiddenrows").split(",")):[],(i=n.indexOf(t))>-1&&n.splice(i,1),r.setAttribute("data-hiddenrows",n.join(",")),n},showColumn:function(e,t){var n,i,r=e.loadedFrom;return n=r.hasAttribute("data-hiddencolumns")?C.toNumbers(r.getAttribute("data-hiddencolumns").split(",")):[],(i=n.indexOf(t))>-1&&n.splice(i,1),r.setAttribute("data-hiddencolumns",n.join(",")),n},hiddenRows:function(e){var t=e.loadedFrom.getAttribute("data-hiddenrows"),n=null;return n=null!==t?C.toNumbers(t.split(",")):[]},hiddenColumns:function(e){var t=e.loadedFrom.getAttribute("data-hiddencolumns"),n=null;return n=null!==t?C.toNumbers(t.split(",")):[]},hasSpreadsheetAtIndex:function(e){return this.tables[e]!==d},getSpreadsheetIndexByTitle:function(e){var t,n=this.tables,i=this.count,r=0;for(e=e.toLowerCase();r<i;r++)if(n[r]!==d&&(t=n[r].getAttribute("title"),t!==d&&null!==t&&t.toLowerCase()==e))return r;return-1},addSpreadsheet:function(e,n){e=e||t.createElement("table"),n===d?this.tables.push(e):this.tables.splice(n,0,e),this.count=this.tables.length},getCellAttribute:function(e,t){return e.getAttribute(t)},setCellAttribute:function(e,t,n){e.setAttribute(t,n)},setCellAttributes:function(e,t){var n;for(n in t)n!==d&&t.hasOwnProperty(n)&&e.setAttribute(n,t[n]);return this},setDependencies:function(e){return this},addDependency:function(e,t){return this},cycleCells:function(e,t){var n,i,r,l,s,o,a,h=this.tables;if((n=h[e])!==d&&!((o=(i=n.querySelectorAll("tr")).length)<1||i[0].children.length<1)){o--;do{s=i[o],r=s.children,a=r.length;do l=r[a],t.call(l,e,o,a);while(a-- >0)}while(o-- >0);return this}},cycleCellsAll:function(e){var t=this.tables,n=t.length;if(!(n<0)){do this.cycleCells(n,e);while(n-- >0);return this}},toTables:function(){return this.tables},fromSheet:function(n){n=n!=d&&n;var i,r,l,s,o,a,h,c,u,f,p,m,g,w,y,v,b,C=[],x=this.wickedGrid,E=1*x.i,I=x.spreadsheets.length-1;if(I<0)return C;do{y=!1,x.i=I,x.evt.cellEditDone(),i=x.obj.pane(),l=t.createElement("table"),s=t.createElement("tBody"),o=t.createElement("colGroup"),l.setAttribute("title",x.obj.table().attr("title")),l.setAttribute("data-frozenatrow",i.action.frozenAt.row),l.setAttribute("data-frozenatcol",i.action.frozenAt.col),l.appendChild(o),l.appendChild(s),C.unshift(l),r=x.spreadsheets[I],h=r.length;do{v=r[h][1].td.parentNode,b=v.style.height,u=t.createElement("tr"),u.style.height=b?b:x.s.colMargin+"px",c=r[h].length;do p=r[h][c],f=t.createElement("td"),m=p.td.attributes,(n||y||m["class"]||p.formula||p.value||m.style)&&(y=!0,g=m["class"]?e.trim((m["class"].value||"").replace(x.cl.uiCellActive,"").replace(x.cl.uiCellHighlighted,"")):"",w=p.td.parentNode,u.insertBefore(f,u.firstChild),u.style.height||(u.style.height=w.style.height?w.style.height:x.settings.colMargin+"px"),p.formula&&f.setAttribute("data-formula",p.formula),p.cellType&&f.setAttribute("cellType",p.cellType),p.value&&f.setAttribute("value",p.value),p.uneditable&&f.setAttribute("uneditable",p.uneditable),p.cache&&f.setAttribute("cache",p.cache),p.id&&f.setAttribute("id",p.id),m.style&&m.style.value&&f.setAttribute("style",m.style.value),g.length&&(f.className=g),m.rowspan&&(f.rowspan=m.rowspan.value),m.colspan&&(f.colspan=m.colspan.value),1*h==1&&(a=t.createElement("col"),a.style.width=e(x.col(c)).css("width"),o.insertBefore(a,o.firstChild)));while(c-- >1);y&&s.insertBefore(u,s.firstChild)}while(h-- >1)}while(I--);return x.i=E,this.json=C},type:i,typeName:"WickedGrid.loader.HTML",clearCaching:function(){return this}},i.maxStoredDependencies=100,i}(jQuery,t,l),p.loader.JSON=function(e,t,n){function r(e){e!==d?(this.json=e,this.count=e.length):(this.json=[],this.count=0),this.cellIds={},this.wickedGrid=null,this.handler=null}return r.prototype={bindWickedGrid:function(e){return this.wickedGrid=e,this},bindHandler:function(e){return this.handler=e,this},bindActionUI:function(e,t){t.loadedFrom=this.json[e]},size:function(e){var t,n,i,r,l={cols:0,rows:0},s=this.json;return(t=s[e])===d?l:(n=t.rows)===d?l:(i=n[0])===d?l:(r=i.columns)===d?l:{rows:n.length,cols:r.length}},getWidth:function(e,t){var n=this.json,i=n[e]||{},r=i.metadata||{},l=r.widths||[],s=l[t]||p.defaultColumnWidth;return 1*s},getHeight:function(e,t){var n=this.json,i=n[e]||{},r=i.rows||[],l=r[t]||{},s=l.height||p.defaultRowHeight;return 1*s},isHidden:function(e){var t=this.json,n=t[e]||{},i=n.metadata||{};return i.hidden===!0},setHidden:function(e,t){var n=this.json,i=n[e]||{},r=i.metadata||{};return r.hidden=t,this},addRow:function(e,t,n){var i,r,l=this.json[e],s=0,o=this.size(e).cols,a={columns:[]},h=a.columns;if(l===d)return this;for(i=l.rows;s<o;s++)r={},n[s]=r,h.push(r);return t===d?i.push(a):t<i.length&&i.splice(t,0,a),this},addColumn:function(e,t,n){var i,r,l=this.json[e],s=0,o=this.size(e),a=o.rows,h=o.cols;if(l===d)return this;if(i=l.rows,t===d)for(;s<a;s++)r={},n[s].loadedFrom=r,i[s].columns.push(r);else if(t<h)for(;s<a;s++)r={},n[s].loadedFrom=r,i[s].columns.splice(t,0,r);return this},deleteRow:function(e,t){var n,i,r,l,s=this.json[e];return s===d?this:(n=s.rows,n.length>t&&n.splice(t,1),(i=s.metadata)!==d&&(r=i.hiddenRows)!==d&&(l=r.indexOf(t))>-1&&r.splice(l,1),this)},deleteColumn:function(e,t){var n,i,r,l,s,o,a,h=this.json[e],c=0;if(h===d)return this;for(n=h.rows,l=n.length;c<l;c++)i=n[c],r=i.columns,t.length>t&&r.splice(t,1);return(s=h.metadata)!==d&&(o=s.hiddenColumns)!==d&&(a=o.indexOf(t))>-1&&o.splice(a,1),this},setupTD:function(e,t){if(e.covered)return t.style.visibility="hidden",this;var n,i,r,l,s,o=this.wickedGrid,a=e.loadedFrom,h=!1,c=0,u=0,f=e.rowIndex,p=e.columnIndex;if(a["class"]!==d&&(t.className=a["class"]),a.id!==d&&t.setAttribute("id",a.id),a.style!==d&&t.setAttribute("style",a.style),a.rowspan!==d&&(t.setAttribute("rowspan",n=a.rowspan),r=f+1*n,h=!0),a.colspan!==d&&(t.setAttribute("colspan",i=a.colspan),l=p+1*i,h=!0),h){for(r===d&&(r=f+1),l===d&&(l+=1),t.style.position="absolute",t.style.borderBottomWidth=t.style.borderRightWidth="1px";f<r;f++)c+=this.getHeight(e.sheetIndex,f)+2,e.rowIndex!==f&&null!==(s=o.getCell(e.sheetIndex,f,e.columnIndex))&&(s.covered=!0,s.defer=e);for(;p<l;p++)u+=this.getWidth(e.sheetIndex,p),e.columnIndex!==p&&null!==(s=o.getCell(e.sheetIndex,e.rowIndex,p))&&(s.covered=!0,s.defer=e);c-=1,u-=1,t.style.width=u+"px",t.style.height=c+"px"}return this},getCell:function(e,t,n){var i,r,l,s,o=this.json;if((i=o[e])!==d&&(r=i.rows)!==d&&(l=r[t])!==d&&(s=l.columns[n])!==d)return null===s&&(s=l.columns[n]={}),s},jitCell:function(e,t,i){var r=this.getCell(e,t,i);if(r===d)return null;if(r.getCell!==d)return r.getCell();var l,s,o,a,h,c,u,f,m,g,w,y,v,b,C,x,E,I,T,A,k;if(o=r.id,h=r.value,c=r.cache,u=r.formula,f=r.parsedFormula,m=r.cellType,g=r.uneditable,y=r.dependencies,b=o!==d&&null!==o,C=h!==d&&null!==h,x=c!==d&&null!==c&&(c+"").length>0,E=u!==d&&null!==u&&""!==u,I=f!==d&&null!==f,T=m!==d&&null!==m,A=g!==d&&null!==g,k=y!==d&&null!==y,l=new p.Cell(e,null,this.wickedGrid,this.handler),l.rowIndex=t,l.columnIndex=i,l.loadedFrom=r,l.loader=this,b&&(l.id=o),E&&(l.formula=u),I&&(l.parsedFormula=f),T&&(l.cellType=m),A&&(l.uneditable=g),C?l.value=new n(h):l.value=new n,x?(l.value.html=c,l.needsUpdated=!1):l.needsUpdated=E||T||l.hasOperator.test(h),k)for(a=y.length,s=0;s<a;s++)v=y[s],w=this.jitCell(v.s,v.r,v.c),null!==w?l.dependencies.push(w):(l.dependencies=[],r.dependencies=[],l.setNeedsUpdated(!0),l.value=new n);return l.value.cell=l,r.getCell=function(){return l},l},jitCellById:function(e,t,n){switch(this.cellIds[e]){case d:break;case null:return this;default:n(this.cellIds[e].requestCell())}var i,r,l,s,o,a,h,c,u,f,p=this,m=this.json,g=t<0?m.length-1:t+1;for(t<0&&(t=0);t<g;t++)if(i=m[t],s=i.rows,!(s.length<1))for(r=0,l=s.length;r<l;r++)for(o=s[r],c=o.columns,a=0,h=c.length;a<h;a++)u=c[a],null!==u&&"string"==typeof u.id&&(this.cellIds[u.id]={cell:u,sheetIndex:t,rowIndex:r,columnIndex:a,requestCell:function(){return p.jitCell(this.sheetIndex,this.rowIndex,this.columnIndex)}});return this.cellIds[e]!==d?(f=this.cellIds[e].requestCell(),n(f)):this.cellIds[e]=null,this},title:function(e){var t,n=this.json;return(t=n[e])===d?"":t.title||""},hideRow:function(e,t){var n=e.loadedFrom,i=n.metadata||(n.metadata={}),r=i.hiddenRows||(i.hiddenRows=[]);return r.indexOf(t)<0&&(r.push(t),r.sort(function(e,t){return e-t})),r},hideColumn:function(e,t){var n=e.loadedFrom,i=n.metadata||(n.metadata={}),r=i.hiddenColumns||(i.hiddenColumns=[]);return r.indexOf(t)<0&&(r.push(t),r.sort(function(e,t){return e-t})),r},showRow:function(e,t){var n,i=e.loadedFrom,r=i.metadata||(i.metadata={}),l=r.hiddenRows||(r.hiddenRows=[]);return(n=l.indexOf(t))>-1&&l.splice(n,1),l},showColumn:function(e,t){var n,i=e.loadedFrom,r=i.metadata||(i.metadata={}),l=r.hiddenColumns||(r.hiddenColumns=[]);return(n=l.indexOf(t))>-1&&l.splice(n,1),l},hiddenRows:function(e){for(var t=e.loadedFrom,n=t.metadata||(t.metadata={}),i=n.hiddenRows||(n.hiddenRows=[]),r=i.length,l=[],s=0;s<r;s++)l.push(i[s]);return l},hiddenColumns:function(e){for(var t=e.loadedFrom,n=t.metadata||(t.metadata={}),i=n.hiddenColumns||(n.hiddenColumns=[]),r=i.length,l=[],s=0;s<r;s++)l.push(i[s]);return l},hasSpreadsheetAtIndex:function(e){return this.json[e]!==d},getSpreadsheetIndexByTitle:function(e){var t,n=this.json,i=this.count,r=0;for(e=e.toLowerCase();r<i;r++)if(n[r]!==d&&(t=n[r].title,t!==d&&null!==t&&t.toLowerCase()==e))return r;return-1},addSpreadsheet:function(e,t){e=e||{},t===d?this.json.push(e):this.json.splice(t,0,e),this.count=this.json.length},getCellAttribute:function(e,t){return e[t]},setCellAttribute:function(e,t,n){e[t]=n},setCellAttributes:function(e,t){var n;for(n in t)n!==d&&t.hasOwnProperty(n)&&(e[n]=t[n]);return this},setDependencies:function(e){if(e.dependencies.length>r.maxStoredDependencies)return delete e.loadedFrom.dependencies,this;for(var t,n=0,i=e.loadedFrom,l=e.dependencies,s=l.length,o=i.dependencies=[];n<s;n++)t=l[n],o.push({s:t.sheetIndex,r:t.rowIndex,c:t.columnIndex});return this},addDependency:function(e,t){var n=e.loadedFrom;return n.dependencies===d&&(n.dependencies=[]),n.dependencies.push({s:t.sheetIndex,r:t.rowIndex,c:t.columnIndex}),this},cycleCells:function(e,t){var n,i,r,l,s,o,a,h=this.json;if((n=h[e])!==d&&!((o=(i=n.rows).length)<1||i[0].columns.length<1)){do{s=i[o],r=s.columns,a=r.length-1;do l=r[a],t.call(l,e,o,a);while(a-- >=0)}while(o-- >=0);return this}},cycleCellsAll:function(e){var t=this.json,n=t.length-1;if(!(n<0)){do this.cycleCells(n,e);while(n-- >0);return this}},toTables:function(){for(var n,i,r,l,s,o,a,h,c,u,d,f,p,m,g,w,y,v,b,C=this.json,x=this.count,E=e([]),I=0;I<x;I++){for(n=C[I],p=e(t.createElement("table")),n.title&&p.attr("title",n.title||""),E=E.add(p),i=n.rows,v=0;v<i.length;v++)for(r=i[v],(f=(r.height+"").replace("px",""))&&(w=e(t.createElement("tr")).attr("height",f).css("height",f+"px").appendTo(p)),l=r.columns,b=0;b<l.length;b++)s=l[b],y=e(t.createElement("td")).appendTo(w),s["class"]&&y.attr("class",s["class"]||""),s.style&&y.attr("style",s.style||""),s.formula&&y.attr("data-formula",s.formula?"="+s.formula:""),s.cellType&&y.attr("data-celltype",s.cellType||""),s.value&&y.html(s.value||""),s.uneditable&&y.html(s.uneditable||""),s.rowspan&&y.attr("rowspan",s.rowspan||""),s.colspan&&y.attr("colspan",s.colspan||""),s.id&&y.attr("id",s.id||""),s.cache&&y.html(s.cache);if(o=n.metadata){if(a=o.widths)for(m=e(t.createElement("colgroup")).prependTo(p),b=0;b<a.length;b++)h=(a[b]+"").replace("px",""),g=e(t.createElement("col")).attr("width",h).css("width",h+"px").appendTo(m);(c=o.frozenAt)&&(c.row&&p.attr("data-frozenatrow",c.row),c.col&&p.attr("data-frozenatcol",c.col)),(u=o.hiddenRows)&&p.attr("data-hiddenrows",u.join(",")),(d=o.hiddenColumns)&&p.attr("data-hiddencolumns",d.join(","))}}return E},fromSheet:function(t){t=t!=d&&t;var n,i,r,l,s,o,a,h,c,u,f,p,m,g,w=[],y=this.wickedGrid,v=1*y.i,b=y.spreadsheets.length-1;if(b<0)return w;do{p=!1,y.i=b,y.evt.cellEditDone(),n=y.obj.pane(),i={title:y.obj.table().attr("title")||"",rows:[],metadata:{widths:[],frozenAt:{row:n.actionUI.frozenAt.row,col:n.actionUI.frozenAt.col}}},w.unshift(i),r=y.spreadsheets[b],l=r.length-1;do{m=r[l][1].td.parentNode,g=m.style.height,o={columns:[],height:g?g.replace("px",""):y.s.colMargin},s=r[l].length-1;do h=r[l][s],a={},c=h.td.attributes,(t||p||c["class"]||h.formula||h.value||c.style)&&(p=!0,u=c["class"]?e.trim((c["class"].value||"").replace(y.cl.uiCellActive,"").replace(y.cl.uiCellHighlighted,"")):"",f=h.td.parentNode,o.columns.unshift(a),o.height||(o.height=f.style.height?f.style.height.replace("px",""):y.s.colMargin),h.formula&&(a.formula=h.formula),h.cellType&&(a.cellType=h.cellType),h.value&&(a.value=h.value),h.uneditable&&(a.uneditable=h.uneditable),h.cache&&(a.cache=h.cache),h.id&&(a.id=h.id),c.style&&c.style.value&&(a.style=c.style.value),u.length&&(a["class"]=u),c.rowspan&&(a.rowspan=c.rowspan.value),c.colspan&&(a.colspan=c.colspan.value),1*l==1&&i.metadata.widths.unshift(e(y.col(s)).css("width").replace("px","")));while(s-- >1);p&&i.rows.unshift(o)}while(l-- >1)}while(b--);return y.i=v,this.json=w},type:r,typeName:"WickedGrid.loader.JSON",clearCaching:function(){for(var e,t,n,i,r,l,s,o,a,h=this.json,c=0,u=h.length;c<u;c++)for(e=h[c],n=e.rows,o=n.length,l=0;l<o;l++)for(t=n[l],r=t.columns,a=r.length,s=0;s<a;s++)i=r[s],null!==i&&(delete i.cache,delete i.dependencies,delete i.parsedFormula);return this},download:function(n){n=n||500;var r,l,s,o=i.open(),a=this.json,h=0,c=a.length-1;if(o!==d){for(r=o.document,r.write('<html>\t<head id="head"></head>\t<body>\t\t<div id="entry">\t\t</div>\t</body></html>'),l=e(r.getElementById("entry"));h<=c;){if(s=a[h],s.rows.length>n){var u={title:s.title,metadata:s.metadata,rows:[]},f=[],p=0,m=s.rows,g=m.length,w=1,y=0,v=function(n,i){l.append(t.createElement("br")),l.append(e(t.createElement("a")).attr("download",s.title+"-part"+i+".json").attr("href",URL.createObjectURL(new Blob([JSON.stringify(n)],{type:"application/json"}))).text(s.title+" - part "+i))};for(v(u,w);p<g;)y===n&&(y=0,w++,v(f,w),f=[]),f.push(m[p]),y++,p++;f.length>0&&(w++,v(f,w))}else l.append(t.createElement("br")).append(e(t.createElement("a")).attr("download",s.title+".json").attr("href",URL.createObjectURL(new Blob([JSON.stringify(s)],{type:"application/json"}))).text(s.title));h++}r.close(),o.focus()}}},r.maxStoredDependencies=100,r}(jQuery,t,l),p.loader.XML=function(e,t){function n(t){t!==d?(this.xml=e.parseXML(t),this.spreadsheets=this.xml.getElementsByTagName("spreadsheets")[0].getElementsByTagName("spreadsheet"),this.count=this.xml.length):(this.xml=null,this.spreadsheets=null,this.count=0)}return n.prototype={size:function(e){var t=this.xml[e],n=t.rows,i=n[0],r=i.columns;return{rows:n.length,cols:r.length}},setWidth:function(e,t,n){var i=this.spreadsheets,r=i[e],l=r.getElementsByTagName("metadata")[0]||{},s=l.getElementsByTagName("width")||[],o=s[t],a=o.textContent||o.text;n.style.width=a+"px"},setRowHeight:function(e,t,n){var i,r,l,s,o=this.spreadsheets;(i=o[e])!==d&&(r=i.getElementsByTagName("rows")[0].getElementsByTagName("row"))!==d&&(l=r[t])!==d&&(s=l.attributes.height.nodeValue)!==d&&(n.style.height=s+"px")},setupCell:function(e,t,n,i,r){var l,s,o,a,h=this.spreadsheets;return(l=h[e])!==d&&((s=l.getElementsByTagName("rows")[0].getElementsByTagName("row")[t-1])!==d&&((o=s.getElementsByTagName("columns")[0].getElementsByTagName("column")[n-1])!==d&&(i.cellType=o.attributes.cellType.nodeValue||"",(a=o.jitCell)!==d&&(i.html=a.html,i.state=a.state,i.cellType=a.cellType,i.value=a.value,i.uneditable=a.uneditable,i.sheet=a.sheet,i.dependencies=a.dependencies),o.attributes.formula?(i.formula=o.attributes.formula.nodeValue||"",r.setAttribute("data-formula",o.attributes.formula.nodeValue||"")):r.innerHTML=i.value=o.attributes.value.nodeValue||"",r.className=o.attributes["class"].nodeValue||"",r.setAttribute("style",o.attributes.style.nodeValue||""),o.attributes.rowspan&&r.setAttribute("rowspan",o.attributes.rowspan.nodeValue||""),o.attributes.colspan&&r.setAttribute("colspan",o.attributes.colspan.nodeValue||""),!0)))},getCell:function(e,t,n){return null},jitCell:function(e,t,n){var i,r,l,s=this.spreadsheets;return(i=s[e])!==d&&((r=i.getElementsByTagName("rows")[0].getElementsByTagName("row")[t-1])!==d&&((l=r.getElementsByTagName("columns")[0].getElementsByTagName("column")[n-1])!==d&&{td:{cellIndex:n,parentNode:{rowIndex:t},html:function(){}},html:[],state:[],cellType:l.attributes.cellType.nodeValue||"",formula:l.attributes.formula.nodeValue||"",value:l.attributes.value.nodeValue||"",type:"cell",sheet:e,id:null}))},title:function(e){var t,n=this.spreadsheets;return(t=n[e])===d?"":t.attributes.title?t.attributes.title.nodeValue:""},getSpreadsheetIndexByTitle:function(e){},addSpreadsheet:function(e,t){t===d?this.spreadsheets.append.push(jsonSpreadsheet):this.json.splice(t,0,jsonSpreadsheet),this.count=this.json.length},setCellAttribute:function(e,t,n){},toTables:function(){for(var n,i,r,l,s,o,a,h,c,u,d,f,p=this.xml,m=e([]),g=p.getElementsByTagName("spreadsheets")[0].getElementsByTagName("spreadsheet"),w=0;w<g.length;w++){n=g[w];var y=e(t.createElement("table")).attr("title",n.attributes.title?n.attributes.title.nodeValue:""),v=e(t.createElement("colgroup")).appendTo(y),b=e(t.createElement("tbody")).appendTo(y);m=m.add(y),i=n.getElementsByTagName("rows")[0].getElementsByTagName("row"),o=n.getElementsByTagName("metadata")[0];for(var C=0;C<i.length;C++){r=i[C];var x=e(t.createElement("tr")).appendTo(b);(f=r.attributes.height)&&(f=(f.nodeValue||"").replace("px",""),x.css("height",f).attr("height",f+"px")),l=r.getElementsByTagName("columns")[0].getElementsByTagName("column");for(var E=0;E<l.length;E++){s=l[E];var I=e(t.createElement("td")).appendTo(x),T=s.getElementsByTagName("formula")[0],A=s.getElementsByTagName("cellType")[0],k=s.getElementsByTagName("value")[0],S=s.getElementsByTagName("style")[0],N=s.getElementsByTagName("class")[0],R=s.getElementsByTagName("rowspan")[0],F=s.getElementsByTagName("colspan")[0],L=s.getElementsByTagName("id")[0];T&&I.attr("data-formula","="+(T.textContent||T.text)),A&&I.attr("data-celltype",A.textContent||A.text),k&&I.html(k.textContent||k.text),S&&I.attr("style",S.textContent||S.text),N&&I.attr("class",N.textContent||N.text),R&&I.attr("rowspan",R.textContent||R.text),F&&I.attr("colspan",F.textContent||F.text),L&&I.attr("id",L.textContent||L.text)}}u=o.getElementsByTagName("width");for(var C=0;C<u.length;C++)d=(u[C].textContent||u[C].text).replace("px",""),e(t.createElement("col")).attr("width",d).css("width",d+"px").appendTo(v);a=o.getElementsByTagName("frozenAt")[0],a&&(c=a.getElementsByTagName("col")[0],h=a.getElementsByTagName("row")[0],c&&y.attr("data-frozenatcol",1*(c.textContent||c.text)),h&&y.attr("data-frozenatrow",1*(h.textContent||h.text)))}return m},fromSheet:function(t,n,i){n=n!=d&&n;var r,l,s,o,a,h,c,u,f,p,m,g,w,y,v,b="",C=1*t.i,x=t.spreadsheets.length-1;if(x<0)return b;do{g=!1,t.i=x,t.evt.cellEditDone(),m=e.extend({},t.obj.pane().actionUI.frozenAt),w=[],l=t.spreadsheets[x],s=l.length-1,a="";do{c="",o=l[s].length-1;do h="",u=l[s][o],f=u.td[0].attributes,p=f["class"]?e.trim((f["class"].value||"").replace(t.cl.uiCellActive,"").replace(t.cl.uiCellHighlighted,"")):"",(n||g||p||u.formula||u.value||f.style)&&(g=!0,h+="<column>",u.formula&&(h+="<formula>"+u.formula+"</formula>"),u.cellType&&(h+="<cellType>"+u.cellType+"</cellType>"),u.value&&(h+="<value>"+u.value+"</value>"),f.style&&(h+="<style>"+f.style.value+"</style>"),p&&(h+="<class>"+p+"</class>"),f.rowspan&&(h+="<rowspan>"+f.rowspan.value+"</rowspan>"),f.colspan&&(h+="<colspan>"+f.colspan.value+"</colspan>"),f.id&&(h+="<id>"+f.id.value+"</id>"),h+="</column>",c=h+c,1*s==1&&(w[o]="<width>"+e(t.col(o)).css("width").replace("px","")+"</width>"));while(o-- >1);c&&(y=l[s][1].td[0].parentNode,v=y.style.height,a='<row height="'+(v?v.replace("px",""):t.s.colMargin)+'"><columns>'+c+"</columns></row>"+a)}while(s-- >1);r='<spreadsheet title="'+(t.obj.table().attr("title")||"")+'"><rows>'+a+"</rows><metadata>"+(m.row||m.col?"<frozenAt>"+(m.row?"<row>"+m.row+"</row>":"")+(m.col?"<col>"+m.col+"</col>":"")+"</frozenAt>":"")+"<widths>"+w.join("")+"</widths></metadata></spreadsheet>",b=r+b}while(x--);return t.i=C,b='<?xml version="1.0" encoding="UTF-8"?><spreadsheets xmlns="http://www.w3.org/1999/xhtml">'+b+"</spreadsheets>",i!==!0&&(this.xml=e.parseXML(b)),b},type:n,typeName:"WickedGrid.XMLLoader"},n}(jQuery,t),p.ActionUI=function(e,t,n,i,r){var l=r(e),s=function(t,i,r,l){this.wickedGrid=t,this.enclosure=i,this.pane=e.createElement("div"),this.active=!0,this.rowCache={last:null,first:null,selecting:!1},this.columnCache={last:null,first:null,selecting:!1},i.appendChild(this.pane),(this.frozenAt=l)||(this.frozenAt={row:0,col:0}),this.frozenAt.row=n.max(this.frozenAt.row,0),this.frozenAt.col=n.max(this.frozenAt.col,0),t.loader.bindActionUI(t.i,this),this.hiddenRows=t.loader.hiddenRows(this),this.visibleRows=[],this.hiddenColumns=t.loader.hiddenColumns(this),this.visibleColumns=[],this.loader=t.loader,this.setupVisibleRows().setupVisibleColumns();var s=this,o=this.loader,a=this.pane,h=this.scrolledArea={row:n.max(this.frozenAt.row,1),col:n.max(this.frozenAt.col,1)},c=this.megaTable=new MegaTable({columns:p.domColumns,rows:p.domRows,element:a,updateCell:this._updateCell=function(e,n,i){var r,l=0===s.visibleRows.length?e:s.visibleRows[e],a=0===s.visibleColumns?n:s.visibleColumns[n];"object"==typeof i._cell&&null!==i._cell&&(i._cell.td=null);var h=t.getCell(t.i,l,a);if(null!==h){var c=t.spreadsheets[t.i]||(t.spreadsheets[t.i]=[]),u=c[l]||(c[l]=[]);if(u[a]||(u[a]=h),r=h.td,null!==r)for(;null!==r.lastChild;)r.removeChild(r.lastChild);h.td=i,i._cell=h,o.setupTD(h,i),h.updateValue()}},updateCorner:this._updateCorner=function(e,n){e.index=-1,e.entity="corner",e.col=n,e.className=t.cl.corner+" "+t.theme.bar},updateRowHeader:this._updateRowHeader=function(n,i){var r,l;0===s.visibleRows.length?(r=n,l=e.createTextNode(r+1)):(r=n>=s.visibleRows.length?n+s.hiddenRows.length:s.visibleRows[n],l=e.createTextNode(r+1)),i.index=r,i.entity="row",i.className=t.cl.row+" "+t.theme.bar,i.appendChild(l),i.parentNode.style.height=i.style.height=o.getHeight(t.i,r)+"px"},updateColumnHeader:this._updateColumnHeader=function(n,i,r){var l,a;0===s.visibleColumns.length?(l=n,a=e.createTextNode(t.cellHandler.columnLabelString(l))):(l=n>=s.visibleColumns.length?n+s.hiddenColumns.length:s.visibleColumns[n],a=e.createTextNode(t.cellHandler.columnLabelString(l))),i.index=l,i.th=i,i.col=r,i.entity="column",i.className=t.cl.column+" "+t.theme.bar,i.appendChild(a),r.style.width=o.getWidth(t.i,l)+"px"}}),u=this.infiniscroll=new Infiniscroll(a,{scroll:function(e,t){setTimeout(function(){h.col=e,h.row=t,c.update(t,e)},0)},verticalScrollDensity:15,horizontalScrollDensity:25});new MouseWheel(a,u._out),c.table.className+=" "+p.cl.table+" "+t.theme.table,c.table.setAttribute("cellSpacing","0"),c.table.setAttribute("cellPadding","0"),a.scroll=u._out,a.actionUI=this,a.table=c.table,a.tBody=c.tBody};return s.prototype={putTdInView:function(e){for(var t,n,i=0,r=0,l=0;null!==(t=this.directionToSeeTd(e))&&(n=this.scrolledArea,t.left?(r--,this.scrollTo("x",0,n.col-1)):t.right&&(r++,this.scrollTo("x",0,n.col+1)),t.up?(l--,this.scrollTo("y",0,n.row-1)):t.down&&(l++,this.scrollTo("y",0,n.row+1)),i++,!(i<25)););},directionToSeeTd:function(e){var t=this.pane,n={top:0,bottom:t.clientHeight,left:0,right:t.clientWidth},i=e.clientWidth,r=e.clientHeight,l={top:e.offsetTop,bottom:e.offsetTop+r,left:e.offsetLeft,right:e.offsetLeft+i},s=e.parentNode,o=this.scrolledArea;if(!e.col)return null;var a=e.barTop.cellIndex<o.col,h=s.rowIndex<o.row,c={up:h,down:l.bottom>n.bottom&&r<=t.clientHeight,left:a,right:l.right>n.right&&i<=t.clientWidth};return c.up||c.down||c.left||c.right?c:null},hide:function(){var e=this.wickedGrid,t=e.ui,n=this.pane,i=n.parentNode,r=this.infiniscroll;return n!==d&&null!==i.parentNode&&(this.deactivate(),r.saveLT(),t.removeChild(n.parentNode)),this},show:function(){var e=this.wickedGrid,t=e.ui,n=this.pane,i=n.parentNode,r=this.infiniscroll;return n!==d&&null===i.parentNode&&(t.appendChild(n.parentNode),r.applyLT(),this.activate()),this},deactivate:function(){var e=this.megaTable;return this.active=!1,e.updateCell=e.updateCorner=e.updateRowHeader=e.updateColumnHeader=function(){},this},activate:function(){var e=this.megaTable;return this.active=!0,e.updateCell=this._updateCell,e.updateCorner=this._updateCorner,e.updateRowHeader=this._updateRowHeader,e.updateColumnHeader=this._updateColumnHeader,this},hideRow:function(e){this.hiddenRows=this.loader.hideRow(this,e);var t;return(t=this.visibleRows.indexOf(e))>-1&&this.visibleRows.splice(t,1),this.megaTable.forceRedrawRows(),this},showRow:function(e){return this.hiddenRows=this.loader.showRow(this,e),this.visibleRows.indexOf(e)<0&&(this.visibleRows.push(e),this.visibleRows.sort(function(e,t){return e-t})),this.megaTable.forceRedrawRows(),this},hideRowRange:function(e,t){for(var n,i=this.loader;e<=t;e++)this.hiddenRows=i.hideRow(this,e),(n=this.visibleRows.indexOf(e))>-1&&this.visibleRows.splice(n,1);return this.megaTable.forceRedrawRows(),this},showRowRange:function(e,t){for(var n=this.loader;e<=t;e++)this.hiddenRows=n.showRow(this,e),this.visibleRows.indexOf(e)<0&&this.visibleRows.push(e);return this.visibleRows.sort(function(e,t){return e-t}),this.megaTable.forceRedrawRows(),this},rowShowAll:function(){return this.hiddenRows=[],this.visibleRows=[],this.megaTable.forceRedrawRows(),this},hideColumn:function(e){this.hiddenColumns=this.loader.hideColumn(this,e);var t;return(t=this.hiddenColumns.indexOf(e))>-1&&this.hiddenColumns.splice(t,1),this.megaTable.forceRedrawRows(),this},showColumn:function(e){return this.hiddenColumns=this.loader.showColumn(this,e),this.visibleColumns.indexOf(e)<0&&(this.visibleColumns.push(e),this.visibleColumns.sort(function(e,t){return e-t})),this.megaTable.forceRedrawColumns(),this},hideColumnRange:function(e,t){for(var n,i=this.loader;e<=t;e++)this.hiddenColumns=i.hideColumn(this,e),(n=this.visibleColumns.indexOf(e))>-1&&this.visibleColumns.splice(n,1);return this.megaTable.forceRedrawColumns(),this},showColumnRange:function(e,t){for(var n=this.loader;e<=t;e++)this.hiddenColumns=n.showColumn(this,e),this.visibleColumns.indexOf(e)<0&&this.visibleColumns.push(e);return this.visibleColumns.sort(function(e,t){return e-t}),this.megaTable.forceRedrawColumns(),this},columnShowAll:function(){return this.hiddenColumns=[],this.visibleColumns=[],this.megaTable.forceRedrawColumns(),this},remove:function(){throw new u("Not yet implemented")},scrollToCell:function(e,t){throw new u("Not yet implemented")},setupVisibleRows:function(){for(var e=0,t=this.visibleRows=[],n=this.hiddenRows,i=this.loader.size(this.wickedGrid.i).rows;e<i;e++)n.indexOf(e)<0&&t.push(e);return this},setupVisibleColumns:function(){for(var e=0,t=this.visibleColumns=[],n=this.hiddenColumns,i=this.loader.size(this.wickedGrid.i).cols;e<i;e++)n.indexOf(e)<0&&t.push(e);return this},redrawRows:function(){this.megaTable.forceRedrawRows()},redrawColumns:function(){this.megaTable.forceRedrawColumns()},selectBar:function(e){switch(e.entity){case p.columnEntity:return this.selectColumn(e);case p.rowEntity:return this.selectRow(e)}return null},selectColumn:function(e){if(!e)return this;if("bar"!==e.type)return this;var t=this.columnCache,n=e.index;return n<0?this:(t.last=t.first=n,this.wickedGrid.cellSetActiveBar("column",t.first,t.last),t.selecting=!0,l.one("mouseup",function(){t.selecting=!1}),this)},selectRow:function(e){if(e&&"bar"===e.type){var t=this.rowCache,n=e,i=n.index;return!(i<0)&&(t.last=t.first=i,this.wickedGrid.cellSetActiveBar("row",t.first,t.last),t.selecting=!0,l.one("mouseup",function(){t.selecting=!1}),!1)}},pixelScrollDensity:30,maximumVisibleRows:65,maximumVisibleColumns:35},s}(t,i,h,o,e),p.Cell=function(){function e(t,n,i){null===e.cellLoading&&(e.cellLoading=p.msg.cellLoading),n!==d&&null!==n?(this.td=n,n.cell=this):this.td=null,this.dependencies=[],this.formula="",this.cellType=null,this.value="",this.valueOverride=null,this.calcCount=0,this.sheetIndex=t,this.rowIndex=null,this.columnIndex=null,this.wickedGrid=i,this.state=[],this.needsUpdated=!0,this.uneditable=!1,this.id=null,this.loader=null,this.loadedFrom=null,this.cellHandler=i.cellHandler,this.waitingCallbacks=[],this.parsedFormula=null,this.defer=null,this.isEdit=!1,this.edited=!1,this.covered=!1}var n=d;return e.prototype={clone:function(){var t,n=new e(this.sheetIndex,this.td,this.wickedGrid,this.cellHandler);for(t in this)t!==d&&this.hasOwnProperty(t)&&(null!==this[t]&&this[t].call===d?n[t]=this[t]:null===this[t]&&(n[t]=this[t]));
return n},addDependency:function(t){if(t!==d&&null!==t){if(t.type!==e)throw new u("Wrong Type");this.dependencies.indexOf(t)<0&&this!==t&&(this.dependencies.push(t),null!==this.loader&&this.loader.addDependency(this,t))}},updateValue:function(i){if(this.needsUpdated||this.value.cell===n||null!==this.defer)if(null===this.cellType&&null===this.defer&&this.formula.length<1&&this.value!==d&&((this.value+"").length<1||!this.hasOperator.test(this.value))){if(null!==this.td&&(this.td.innerHTML=this.encode(this.value)),this.value=new l(this.value),this.value.cell=this,this.needsUpdated=!1,this.updateDependencies(),i!==n&&i.call(this,this.value),this.waitingCallbacks.length>0)for(;this.waitingCallbacks.length>0;)this.waitingCallbacks.pop().call(this,this.value)}else{var r,s,h,c,u=this,f=this.value,m=this.formula,g=this.cellType,w=this.defer,y=function(e){u.parsedFormula=e,u.resolveFormula(e,function(e){e!==n&&null!==e?(e.cell!==n&&e.cell!==u&&(e=e.valueOf()),p.calcStack--,null!==g&&(h=p.CellTypeHandlers[g])!==n&&(e=h(u,e)),v.call(u,e)):v.call(u,null)})},v=function(e){if(e!==n&&null!==e||(e=new l),e.cell===n){switch(typeof e){case"object":break;case"undefined":e=new l;break;case"number":e=new o(e);break;case"boolean":e=new a(e);break;case"string":default:e=new l(e)}e.cell=u}if(u.value=e,s=u.displayValue().valueOf(),u.state.shift(),null!==u.loader&&u.loader.setCellAttributes(u.loadedFrom,{cache:"object"!=typeof s?s:null,formula:u.formula,parsedFormula:u.parsedFormula,value:u.value+"",cellType:u.cellType,uneditable:u.uneditable}).setDependencies(u),u.needsUpdated=!1,c=null!==u.valueOverride?u.valueOverride:u.value,i!==n&&i.call(u,c),u.waitingCallbacks.length>0)for(;u.waitingCallbacks.length>0;)u.waitingCallbacks.pop().call(u,c);u.updateDependencies()};if(this.state.length>0)return void(i!==n&&this.waitingCallbacks.push(i));if(null!==w)return void w.updateValue(function(e){switch(e=e.valueOf(),typeof e){case"object":break;case"undefined":e=new l;break;case"number":e=new o(e);break;case"boolean":e=new a(e);break;case"string":default:e=new l(e)}if(e.cell=u,u.value=e,u.updateDependencies(),u.needsUpdated=!1,u.displayValue(),i!==n&&i.call(u,e),u.waitingCallbacks.length>0)for(;u.waitingCallbacks.length>0;)u.waitingCallbacks.pop().call(u,e)});if(this.oldValue=f,this.state.unshift("updating"),this.fnCount=0,this.valueOverride=null,this.calcCount++,m.length>0){if("="===m.charAt(0)&&(u.formula=m=m.substring(1)),null!==u.td){for(;null!==u.td.lastChild;)u.td.removeChild(u.td.lastChild);u.td.appendChild(t.createTextNode(e.cellLoading))}p.calcStack++,null!==this.parsedFormula?y(this.parsedFormula):this.wickedGrid.parseFormula(m,y)}else if(f!==n&&null!==f&&null!==g&&(h=p.CellTypeHandlers[g])!==n)f=h(u,f),v(f);else{switch(typeof f.valueOf()){case"string":r=u.startOperators[f.charAt(0)],r!==n?u.valueOverride=r.call(u,f):(r=u.endOperators[f.charAt(f.length-1)],r!==n&&(u.valueOverride=r.call(u,f)));break;case"undefined":f=""}v(f)}}else{var b=null!==this.valueOverride?this.valueOverride:this.value;if(this.displayValue(),i!==n&&i.call(this,b),this.waitingCallbacks.length>0)for(;this.waitingCallbacks.length>0;)this.waitingCallbacks.pop().call(this,b)}},updateDependencies:function(){var e,t,n;if(e=this.dependencies,this.dependencies=[],n=e.length-1,n>-1){this.state.unshift("updatingDependencies");do t=e[n],t.updateValue();while(n-- >0);this.state.shift()}0===this.dependencies.length&&(this.dependencies=e)},displayValue:function(){var e=this.value,i=this.td,r=typeof e,l=e.html;if(l===n&&(l="string"===r||null!==e&&"object"===r&&e.toUpperCase!==n&&e.length>0?this.encode(e):e),i===n||null===i)return l;switch(typeof l){case"object":if(null===l)for(;null!==i.lastChild;)i.removeChild(i.lastChild);else if(l.appendChild!==n){if(null===l.parentNode){for(;null!==i.lastChild;)i.removeChild(i.lastChild);i.appendChild(l)}return""}case"string":default:for(;null!==i.lastChild;)i.removeChild(i.lastChild);i.appendChild(t.createTextNode(l))}return i.innerHTML},resolveFormula:function(t,i){"string"==typeof t&&i(t);var r,l,s=this,o=[],a=0,h=t.length,c=this.cellHandler,d=[],f=function(e,t){var n,i=[],r=t.length-1;if(!(r<0)){do switch(n=t[r],typeof n){case"number":i[r]=d[n];break;case"string":i[r]=n;break;case"object":if(n instanceof Array){i[r]=p(n);break}default:i[r]=n}while(r-- >0);return i.unshift(e),i}},p=function(e){var t,n=[],i=e.length-1;if(!(i<0)){do switch(t=e[i],typeof t){case"number":n[i]=d[t];break;case"string":n[i]=t;break;case"object":if(t.hasOwnProperty("args")){n[i]=t,n[i].a=p(t.a);break}if(t instanceof Array){n[i]=p(t);break}default:n[i]=t}while(i-- >0);return n}};for(l=s.wickedGrid.settings.useStack?function(t){var r,l=e.thawIndex,a=e.thaws,h="undefined"==typeof a[l];r=h?e.thaws[l]=new Thaw([]):a[l],e.thawIndex++,e.thawIndex>e.thawLimit&&(e.thawIndex=0),r.add(function(){o.length>0?o.shift()():i(s.value=t!==n?t:null)})}:function(e){o.length>0?o.shift()():i(s.value=e!==n?e:null)};a<h;a++)switch(r=t[a],r.t){case"m":!function(e,t){o.push(function(){l(d[t]=c[e.m].apply(c,f(s,e.a)))})}(r,a);break;case"l":!function(e,t){o.push(function(){var n=f(s,e.a);n.push(function(e){l(d[t]=e)}),c[e.m].apply(c,n)})}(r,a);break;case"v":!function(e,t){o.push(function(){l(d[t]=e.v)})}(r,a);break;case"cell":!function(e,t){o.push(function(){d[t]=e,l()})}(r,a);break;case n:d[a]=r;break;default:throw d[a]=null,new u("Not implemented:"+r.t)}l()},recurseDependencies:function(t,n){if(n>e.maxRecursion)return this.recurseDependenciesFlat(t),this;var i,r=0,l=this.dependencies,s=l.length;for(n===d&&(n=0);r<s;r++)i=l[r],t.call(i),i.recurseDependencies(t,n);return this},recurseDependenciesFlat:function(e){var t,n,i=this.dependencies,r=i.length-1,l=[];if(!(r<0)){do l.push(i[r]);while(r-- >0);do if(t=l[l.length-1],l.length--,e.call(t),n=t.dependencies,r=n.length-1,r>-1)do l.push(n[r]);while(r-- >0);while(l.length>0)}},getAllDependencies:function(){var e=[];return this.recurseDependencies(function(){e.push(this)}),e},setNeedsUpdated:function(e){e!==n?this.needsUpdated=e:this.needsUpdated=!0,this.recurseDependencies(function(){this.needsUpdated=!0})},encode:function(e){switch(typeof e){case"object":return e.getMonth!==n?globalize.format(e,"d"):e}return e&&e.replace?e.replace(/&/gi,"&amp;").replace(/>/gi,"&gt;").replace(/</gi,"&lt;").replace(/\t/g,"&nbsp;&nbsp;&nbsp ").replace(/  /g,"&nbsp; "):e||""},setAttribute:function(e,t){var i=this.td;return i!==n&&(i[e]=t),this.loader.setCellAttribute(this.loadedFrom,e,t),this},setAttributes:function(e){var t,i=this.td;if(i!==n)for(t in e)e.hasOwnProperty(t)&&(i[e]=e[t]);return this.loader.setCellAttributes(this.loadedFrom,e),this},addClass:function(e){var t,i,r=this.td,l=this.loadedFrom;return r!==n&&(r.classList?r.classList.add(e):r.className+=" "+e),l!==n&&(t=this.loader.getCellAttribute(l,"class")||"",i=t.split(" ").indexOf(e),i<0&&(t+=" "+e,this.loader.setCellAttribute(l,"class",t))),this},removeClass:function(e){var t,i,r=this.td,l=this.loadedFrom;return r!==n&&(r.classList?r.classList.remove(e):(t=(r.className+"").split(" "),i=t.indexOf(e),i>-1&&(t.splice(i,1),r.className=t.join(" ")))),l!==n&&(t=(this.loader.getCellAttribute(l,"class")||"").split(" "),i=t.indexOf(e),i>-1&&(t.splice(i,1),this.loader.setCellAttribute(l,"class",t.join(" ")))),this},hasOperator:/(^[$])|([%]$)/,startOperators:{$:function(e,t){return this.cellHandler.fn.DOLLAR.call(this,e.substring(1).replace(Globalize.culture().numberFormat[","],""),2,t||"$")},"":function(e){return this.startOperators.$.call(this,e,"")}},endOperators:{"%":function(e){return e.substring(0,this.value.length-1)/100}},type:e,typeName:"WickedGrid.Cell"},e.thaws=[],e.thawLimit=500,e.thawIndex=0,e.cellLoading=null,e.maxRecursion=10,e}(),p.CellContextMenu=function(){function e(e,t){this.wickedGrid=e,this.menu=t}return e.prototype={show:function(e,t){var n=this.wickedGrid,i=this.menu,r=i.style;return r.left=e-5+"px",r.top=t-5+"px",n.hideMenus(),n.pane().appendChild(i),this},hide:function(){return null===this.menu.parentNode?this:(this.menu.parentNode.removeChild(this.menu),this)}},e}(),p.CellHandler=function(e){function t(e){return!isNaN(e)}function n(e,t){this.wickedGrid=e,this.fn=t}var i=d,r=NaN;return n.prototype={variable:function(e,t){if(arguments.length){var n,i,r=t[0],l=t[1],s=this.wickedGrid.s.formulaVariables;switch(r.toLowerCase()){case"true":return i=new a((!0)),i.html="TRUE",i.cell=e,i;case"false":return i=new a((!1)),i.html="FALSE",i.cell=e,i}return(n=s[r]&&!l)?n:n&&l?n[l]:""}},time:function(e,t,n){return E.fromString(t,n)},number:function(e,n){switch((isNaN(n)||null===n)&&(n=0),typeof n){case"number":return n;case"string":if(t(n))return 1*n;case"object":if(n.getMonth)return x.toCentury(n)}return n},invertNumber:function(e,t){isNaN(t)&&(t=0);var n=this.number(e,t),i=new o(n.valueOf()*-1);return n.html&&(i.html=n.html),i},performMath:function(n,l,s,o){s!==i&&null!==s||(s=0),o!==i&&null!==o||(o=0);var a,h,c,u=!0,d=!0,f=[],p=function(e){return e};switch(s.hasOwnProperty("cell")&&s.cell.addDependency(n),o.hasOwnProperty("cell")&&o.cell.addDependency(n),a=typeof s.valueOf()){case"number":break;case"string":t(s)?s*=1:u=!1;break;case"object":s.getMonth?(s=x.toCentury(s),p=x.get):u=!1;break;default:u=!1}switch(h=typeof o.valueOf()){case"number":break;case"string":t(o)?o*=1:d=!1;break;case"object":o.getMonth?o=x.toCentury(o):d=!1;break;default:d=!1}switch(u||"+"===l||(f.push("not a number: "+s),s=0),d||(f.push("not a number: "+o),o=0),f.length,l){case"+":c=s+o;break;case"-":c=s-o;break;case"/":c=s/o,c!=1/0&&c!=r||(c=0);break;case"*":c=s*o;break;case"^":c=e.pow(s,o)}return p(c)},not:function(e,t,n){var i;return t.valueOf()!=n.valueOf()?(i=new a((!0)),i.html="TRUE",i.cell=e):(i=new a((!1)),i.html="FALSE",i.cell=e),i},concatenate:function(e,t,n){return null===t&&(t=""),null===n&&(n=""),t.toString()+n.toString()},cellValue:function(e,t,n){var r,l=this.wickedGrid,s=this.parseLocation(t.c,t.r);return r=l.getCell(e.sheetIndex,s.row,s.col),null!==r?(r.addDependency(e),r.updateValue(n)):n!==i&&n.call(e,0),this},cellRangeValue:function(e,t,n,i){return this.remoteCellRangeValue(e,e.sheetIndex,t,n,i)},remoteCellValue:function(e,t,n,r){var l,s=this.wickedGrid,o=this.parseLocation(n.c,n.r),a=this.parseSheetLocation(t);return a<0&&(a=s.getSpreadsheetIndexByTitle(t)),l=s.getCell(a,o.row,o.col),null!==l?(l.addDependency(e),l.updateValue(r)):r!==i&&r.call(e,0),this},remoteCellRangeValue:function(e,t,r,s,o){var a,h,c,u,d,f,p,m="string"==typeof t?this.parseSheetLocation(t):t,g=this.parseLocation(r.c,r.r),w=this.parseLocation(s.c,s.r),y=g.row<w.row?g.row:w.row,v=g.row<w.row?w.row:g.row,b=g.col<w.col?g.col:w.col,C=b,x=g.col<w.col?w.col:g.col,E=(x-(b-1))*(v-(y-1)),I=0,T=this.wickedGrid,A=[],k=0;if(m<0&&(m=T.getSpreadsheetIndexByTitle(t)),m<0)return A=new l(""),A.html="#NAME?",o.call(e,A),this;if(d=m+"!"+r.c+r.r+":"+s.c+s.r,a=n.cellRangeCache[d],a!==i){for(h=!0,f=a.length,k=0;k<f;k++)a[k].needsUpdated&&(h=!1);if(h)return o.call(e,n.cellRangeCache[d]),this}for(p=T.spreadsheets[m],p===i&&(T.spreadsheets[m]=p=[]),A.rowCount=v-y+1,A.columnCount=x-C+1;y<=v;y++)for(C=b,u=p[y]!==i?p[y]:null;C<=x;C++)null===u||(c=u[C])===i?c=T.getCell(m,y,C):(c.sheetIndex=m,c.rowIndex=y,c.columnIndex=C),null!==c&&(c.addDependency(e),function(t){c.updateValue(function(i){A[t]=i,I++,I===E&&(n.cellRangeCache[d]=A,o.call(e,A))})}(k++));return this},callFunction:function(e,t,n){t=t.toUpperCase(),n=n||[];var r,s=this.fn[t];return s!==i?(e.fnCount++,r=s.apply(e,n)):(r=new l,r.html="Function "+t+" Not Found"),r},formulaParser:function(e){var t;return e>-1?(t=p.spareFormulaParsers[e],t===i&&(t=p.spareFormulaParsers[e]=Formula(this))):t=this.wickedGrid.formulaParser,t},parseLocation:function(e,t){return{row:t-1,col:this.columnLabelIndex(e)}},parseSheetLocation:function(e){var t=1*(e+"").replace(/SHEET/i,"")-1;return isNaN(t)?-1:t},parseCellName:function(e,t){var n="";return t!==d&&(t++,n=t.toString()),this.columnLabelString(e)+n},alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ".split(""),columnLabels:{},columnLabelIndex:function(e){return this.columnLabels[e.toUpperCase()]},columnIndexes:[],columnLabelString:function(e){if(!this.columnIndexes.length){var t,n,i,r,l="";for(t=n=i=-1,r=0;r<16385;++r)l="",++i,26==i&&(i=0,++n,26==n&&(n=0,++t)),t>=0&&(l+=this.alphabet[t]),n>=0&&(l+=this.alphabet[n]),i>=0&&(l+=this.alphabet[i]),this.columnIndexes[r]=l,this.columnLabels[l]=r}return this.columnIndexes[e]||""}},n.cellRangeCache={},n}(h),p.CellRange=function(){function e(e){this.cells=e||[]}return e.prototype={clone:function(){for(var t,n,i=[],r=this.cells,l=r.length,s=0;s<l;s++)t=r[s],n=t.clone(),i.push(n);return new e(i)},type:e,typeName:"WickedGrid.CellRange"},e}(),p.ColumnMenu=function(){function e(e,t){this.wickedGrid=e,this.menu=t,this.index=-1,this.column=null;var n=this,i=this.barHelper=w('<div class="'+e.cl.barHelper+" "+e.cl.columnHelper+'">            <span class="'+e.cl.columnButton+" "+e.theme.columnMenu+" "+e.theme.columnMenuIcon+'"></span>          </div>'),r=i.children[0];r.onmousedown=function(){n.showMenu()}}return e.prototype={setColumn:function(e,t){return null!==this.column&&this.column.classList.remove(this.wickedGrid.cl.columnFocus),this.hideMenu(),this.column=e,this.index=t,this},kill:function(){return this.hide(),this.column=null,this.index=-1,this},show:function(){return this.wickedGrid.hideMenus(),this.column.appendChild(this.barHelper),this.column.classList.add(this.wickedGrid.cl.columnFocus),this},hide:function(){return null===this.barHelper.parentNode?this:(this.barHelper.parentNode.removeChild(this.barHelper),this)},showMenu:function(){return this.barHelper.appendChild(this.menu),this},hideMenu:function(){return null===this.menu.parentNode?this:(this.menu.parentNode.removeChild(this.menu),this)}},e}(),p.ColumnContextMenu=function(){function e(e,t){this.wickedGrid=e,this.menu=t}return e.prototype={kill:function(){return null!==this.menu.parentNode&&this.menu.parentNode.removeChild(this.menu),this},show:function(e,t){this.wickedGrid.hideMenus();var n=this.wickedGrid,i=this.menu,r=i.style;return r.left=e-5+"px",r.top=t-5+"px",n.pane().appendChild(i),this},hide:function(){return null===this.menu.parentNode?this:(this.menu.parentNode.removeChild(this.menu),this)}},e}(),p.Highlighter=function(e,t,n){var i=function(e,t,i,r){this.cssClass=e,this.cssClassBars=t,this.cssClassTabs=i,this.callBack=r||function(){},this.last=n([]),this.lastTop=n([]),this.lastLeft=n([]),this.lastTab=n([]),this.startRowIndex=0,this.startColumnIndex=0,this.endRowIndex=0,this.endColumnIndex=0};return i.prototype={set:function(e){e.parentNode!==d&&(e=[e]);var t,n,i=this.last;if(i&&i.length>0){t=i.length-1;do i[t].isHighlighted=!1;while(t-- >0)}if(e.length>0){t=e.length-1;do n=e[t],n.isHighlighted||(n.isHighlighted=!0,n.className.match(this.cssClass)||(n.className+=" "+this.cssClass));while(t-- >0)}return this.clear(i),this.last=e,this.callBack(),this},is:function(){return this.last.length>0},clear:function(e){if(this.is()&&(e=e||this.last,e&&e.length)){var t=e.length-1;do e[t].isHighlighted||(e[t].className=e[t].className.replace(this.cssClass,""),e[t].isHighlighted=!1);while(t-- >0)}return this.last=n([]),this},setBar:function(e,t){switch(e){case"top":this.lastTop.removeClass(this.cssClassBars),this.lastTop=n(t).addClass(this.cssClassBars);break;case"left":this.lastLeft.removeClass(this.cssClassBars),this.lastLeft=n(t).addClass(this.cssClassBars)}return this},clearBar:function(){return this.lastTop.removeClass(this.cssClassBars),this.lastTop=n([]),this.lastLeft.removeClass(this.cssClassBars),this.lastLeft=n([]),this},setTab:function(e){return this.clearTab(),this.lastTab=e.addClass(this.cssClassTabs),this},clearTab:function(){return this.lastTab.removeClass(this.cssClassTabs),this},setStart:function(e){return this.startRowIndex=e.rowIndex+0,this.startColumnIndex=e.columnIndex+0,this},setEnd:function(e){return this.endRowIndex=e.rowIndex+0,this.endColumnIndex=e.columnIndex+0,this}},i}(t,i,jQuery),p.SpreadsheetUI=function(){function e(e,t,n){n=n||{},this.i=e,this.ui=t,this.isLast=n.lastIndex===e,this.enclosure=null,this.pane=null,this.spreadsheet=null,this.initChildren=n.initChildren||function(){},this.done=n.done||function(){},this.load()}var t=[];return e.prototype={load:function(e,n,i){this.initChildren(this.ui,this.i),this.enclosure=e,this.pane=n,this.spreadsheet=i,t.push(this.i),this.isLast&&this.loaded()},loaded:function(){this.done(t,this)}},e}(),p.RowContextMenu=function(){function e(e,t){this.wickedGrid=e,this.menu=t}return e.prototype={show:function(e,t){this.wickedGrid.hideMenus();var n=this.wickedGrid,i=this.menu,r=i.style;return r.left=e-5+"px",r.top=t-5+"px",n.pane().appendChild(i),this},hide:function(){var e=this.menu;return null===e.parentNode?this:(e.parentNode.removeChild(e),this)}},e}(),p.Theme=function(){function e(t){switch(t=t||p.defaultTheme){case p.customTheme:this.cl=e.customClasses;break;case p.bootstrapTheme:this.cl=e.bootstrapClasses;break;default:case p.themeRollerTheme:this.cl=e.themeRollerClasses}m(this,this.cl)}return e.themeRollerClasses={autoFiller:"ui-state-active",bar:"ui-widget-header",barHighlight:"ui-state-active",rowFreezeHandle:"ui-state-default",columnFreezeHandle:"ui-state-default",columnMenu:"ui-state-default",columnMenuIcon:"ui-icon ui-icon-triangle-1-s",tdActive:"ui-state-active",tdHighlighted:"ui-state-highlight",control:"ui-widget-header ui-corner-top",controlTextBox:"ui-widget-content",fullScreen:"ui-widget-content ui-corner-all",inPlaceEdit:"ui-state-highlight",menu:"ui-widget-header",menuFixed:"",menuUl:"ui-widget-header",menuLi:"ui-widget-header",menuHover:"ui-state-highlight",pane:"ui-widget-content",parent:"ui-widget-content ui-corner-all",table:"ui-widget-content",tab:"ui-widget-header",tabActive:"ui-state-highlight",barResizer:"ui-state-highlight",barFreezer:"ui-state-highlight",barFreezeIndicator:"ui-state-highlight"},e.bootstrapClasses={autoFiller:"btn-info",bar:"input-group-addon",barHighlight:"label-info",rowFreezeHandle:"bg-warning",columnFreezeHandle:"bg-warning",columnMenu:"",columnMenuIcon:"fa fa-sort-desc",tdActive:"active",tdHighlighted:"bg-info disabled",control:"panel-heading",controlTextBox:"form-control",fullScreen:"",inPlaceEdit:"form-control",menu:"panel panel-default",menuFixed:"nav navbar-nav",menuUl:"panel-info",menuLi:"active",menuHover:"bg-primary active",pane:"well",parent:"panel panel-default",table:"table-bordered table-condensed",tab:"btn-default btn-xs",tabActive:"active",barResizer:"bg-info",barFreezer:"bg-warning",barFreezeIndicator:"bg-warning"},e.customClasses={autoFiller:"",bar:"",barHighlight:"",rowFreezeHandle:"",columnFreezeHandle:"",columnMenu:"",columnMenuIcon:"",tdActive:"",tdHighlighted:"",control:"",controlTextBox:"",fullScreen:"",inPlaceEdit:"",menu:"",menuFixed:"",menuUl:"",menuLi:"",menuHover:"",pane:"",parent:"",table:"",tab:"",tabActive:"",barResizer:"",barFreezer:"",barFreezeIndicator:""},e}(),p.Undo=function(){function e(){}function t(t){this.wickedGrid=t,this.cells=[],this.id=-1,"undefined"!=typeof UndoManager?this.undoManager=new UndoManager:this.undoManager={add:e,undo:e,redo:e,register:e}}return t.prototype={createCells:function(e,t,n){"undefined"==typeof n&&(this.id++,n=this.id);var i=this,r=new p.CellRange(e).clone().cells,l="undefined"==typeof t?new p.CellRange(t(e)).clone().cells:r;return r.id=n,l.id=n,this.undoManager.add({undo:function(){i.removeCells(r,n)},redo:function(){i.createCells(l,null,n)}}),n!==this.id&&this.draw(l),!0},removeCells:function(e,t){var n=0,i=-1;e.id===t&&(i=n),i!==-1&&this.cells.splice(i,1),this.draw(e)},draw:function(e){var t,n,i,r,l,s=this.wickedGrid;for(t=0;t<e.length;t++)i=e[t],l=s.getTdLocation(i.td),r=s.spreadsheets[i.sheetIndex][l.row][l.col],r.value=i.value,r.formula=i.formula,n=r.td=i.td,r.dependencies=i.dependencies,r.needsUpdated=i.needsUpdated,r.calcCount=i.calcCount,r.sheetIndex=i.sheetIndex,r.rowIndex=l.row,r.columnIndex=l.col,r.state=i.state,r.jS=i.jS,n.setAttribute("style",i.style),n.setAttribute("class",i.cl),r.setNeedsUpdated(),r.updateValue()}},t}(),e.fn.extend({wickedGrid:function(t){t=t||{};for(var n in p.defaults)p.defaults.hasOwnProperty(n)&&(t[n]=t.hasOwnProperty(n)?t[n]:p.defaults[n]);return e(this).each(function(){var n=this,r=e(this),l=r.getWickedGrid();if(t.useStack=i.thaw!==d&&t.useStack,t.useMultiThreads=i.operative!==d&&t.useMultiThreads,l){var s=r.children().detach();l.kill(),r.html(s),p.events.forEach(r.unbind)}t.element=n,t.$element=r,null!=(this.className||"").match(/\bnot-editable\b/i)&&(t.editable=!1),p.events.forEach(function(e){r.bind(e,t[e])}),r.children().each(function(e){var n=1*this.getAttribute("data-frozenatrow"),i=1*this.getAttribute("data-frozenatcol");t.frozenAt[e]||(t.frozenAt[e]={row:0,col:0}),n&&(t.frozenAt[o.i].row=n),i&&(t.frozenAt[o.i].col=i)});var o=new p(t)}),this},disableSelectionSpecial:function(){return this.each(function(){this.onselectstart=function(){return!1},this.unselectable="on",this.style["-moz-user-select"]="none"}),this},getWickedGrid:function(){var e=null;return p.instances.forEach(function(t){e||t.parent!==parent||(e=t)}),e},getCellValue:function(t,n,i,r){var l,s=e(this).getWickedGrid();return s?(l=s.getCell(t,n,i),null!==l&&l.updateValue(r),this):this},setCellValue:function(t,n,i,r,l){var s,o=e(this).getWickedGrid();return o?(r=r||0,(s=o.getCell(r,n,i))?("string"==typeof t&&"="===t.charAt(0)?(s.valueOverride=s.value="",s.formula=t.substring(1)):(s.value=t,s.valueOverride=s.formula=""),s.updateValue(l),this):this):this},setCellFormula:function(t,n,i,r,l){var s,o=e(this).getWickedGrid();return r=r||0,o?(s=o.getCell(r,n,i),null===s?this:(s.formula=t,s.valueOverride=s.value="",s.updateValue(l),this)):this},isSheetFullScreen:function(){var t=e(this).getWickedGrid();return!!t&&t.fullScreen().is(":visible")},serializeCellInputs:function(t){var n=e(this).wickedGrid(),i=n.obj.tables().find(":input");return t?i.serializeArray():i.serialize()},viewSource:function(t){var n="";return e(this).each(function(){n+=t?e(this).toPrettySource():e(this).toCompactSource()}),e.printSource(n),n},toCompactSource:function(){var t=this[0],n="";if(1==t.nodeType){n+="<"+t.tagName.toLowerCase();for(var i=t.attributes.length,r=0;r<i;r++){var l=t.attributes[r].name,s=t.getAttribute(l);if(s){if("contentEditable"==l&&"inherit"==s)continue;"string"==typeof s?n+=" "+l+'="'+s.replace(/"/g,"'")+'"':"style"==l&&s.cssText&&(n+=' style="'+s.cssText+'"')}}if("COL"==t.tagName)n+="/>";else{n+=">";var o="";e(t.childNodes).each(function(){o+=e(this).toCompactSource()}),n+=o,n+="</"+t.tagName.toLowerCase()+">"}}else 3==t.nodeType&&(n+=t.data.replace(/^\s*(.*)\s*$/g,"$1"));return n},toPrettySource:function(t){var n,i,r=this[0],l="";if(t=t||"",1==r.nodeType){for(l+="\n"+t+"<"+r.tagName.toLowerCase(),n=r.attributes.length,i=0;i<n;i++){var s=r.attributes[i].name,o=r.getAttribute(s);if(o){if("contentEditable"==s&&"inherit"==o)continue;"string"==typeof o?l+=" "+s+'="'+e.trim(o.replace(/"/g,"'"))+'"':"style"==s&&o.cssText&&(l+=' style="'+e.trim(o.cssText)+'"')}}if(r.childNodes.length<=0)l+="COL"==r.tagName?"/>":"></"+r.tagName.toLowerCase()+">";else{l+=">";var a="";for(n=r.childNodes.length,i=0;i<n;i++)a+=e(r.childNodes[i]).toPrettySource(t+"  ");l+=a,a.indexOf("\n")>=0&&(l+="\n"+t),l+="</"+r.tagName.toLowerCase()+">"}}else 3==r.nodeType&&(l+=r.data.replace(/^\s*(.*)\s*$/g,"$1"));return l}}),Object.getPrototypeOf===d&&(Object.getPrototypeOf=function(e){return e||{}}),Array.prototype.indexOf===d&&(Array.prototype.indexOf=function(e,t){for(var n=t||0,i=this.length;n<i;n++)if(this[n]===e)return n;return-1}),p}(window.jQuery||{},document,window,Date,String,Number,Boolean,Math,RegExp,Error),parser=function(){function e(){this.yy={}}var t=function(e,t,n,i){for(n=n||{},i=e.length;i--;n[e[i]]=t);return n},n=[1,5],i=[1,6],r=[1,8],l=[1,9],s=[1,10],o=[1,13],a=[1,11],h=[1,12],c=[1,14],u=[1,15],d=[1,20],f=[1,18],p=[1,21],m=[1,22],g=[1,17],w=[1,24],y=[1,25],v=[1,26],b=[1,27],C=[1,28],x=[1,29],E=[1,30],I=[1,31],T=[1,32],A=[4,13,14,15,17,18,19,20,21,22,23,35,36],k=[1,35],S=[1,36],N=[1,37],R=[4,13,14,15,17,18,19,20,21,22,23,35,36,38],F=[4,13,14,15,17,18,19,20,21,22,23,35,36,39],L=[4,13,14,15,17,18,19,20,21,22,23,29,35,36],_=[4,14,15,17,18,19,20,35,36],O=[1,71],M=[4,14,17,18,19,35,36],H=[4,14,15,17,18,19,20,21,22,35,36],z=[17,35,36],P={trace:function(){},yy:{},symbols_:{error:2,expressions:3,EOF:4,expression:5,variableSequence:6,TIME_AMPM:7,TIME_24:8,number:9,STRING:10,ESCAPED_STRING:11,LETTERS:12,"&":13,"=":14,"+":15,"(":16,")":17,"<":18,">":19,"-":20,"*":21,"/":22,"^":23,E:24,FUNCTION:25,expseq:26,cellRange:27,cell:28,":":29,SHEET:30,"!":31,NUMBER:32,$:33,REF:34,";":35,",":36,VARIABLE:37,DECIMAL:38,"%":39,$accept:0,$end:1},terminals_:{2:"error",4:"EOF",7:"TIME_AMPM",8:"TIME_24",10:"STRING",11:"ESCAPED_STRING",12:"LETTERS",13:"&",14:"=",15:"+",16:"(",17:")",18:"<",19:">",20:"-",21:"*",22:"/",23:"^",24:"E",25:"FUNCTION",29:":",30:"SHEET",31:"!",32:"NUMBER",33:"$",34:"REF",35:";",36:",",37:"VARIABLE",38:"DECIMAL",39:"%"},productions_:[0,[3,1],[3,2],[5,1],[5,1],[5,1],[5,1],[5,1],[5,1],[5,1],[5,3],[5,3],[5,3],[5,3],[5,4],[5,4],[5,4],[5,3],[5,3],[5,3],[5,3],[5,3],[5,3],[5,2],[5,2],[5,1],[5,3],[5,4],[5,1],[27,1],[27,3],[27,3],[27,5],[28,2],[28,3],[28,3],[28,4],[28,1],[28,2],[28,2],[28,2],[28,3],[28,3],[28,3],[28,3],[28,3],[28,3],[28,4],[28,4],[28,4],[26,1],[26,2],[26,2],[26,3],[26,3],[6,1],[6,3],[9,1],[9,3],[9,2]],performAction:function(e,t,n,i,r,l,s){var o=l.length-1;switch(r){case 1:return null;case 2:var a=i.types;return i.types=[],a;case 3:var h={t:"m",m:"variable",a:[l[o]]};this.$=i.types.length,i.types.push(h);break;case 4:var h={t:"m",m:"time",a:[l[o],!0]};this.$=i.types.length,i.types.push(h);break;case 5:var h={t:"m",m:"time",a:[l[o]]};this.$=i.types.length,i.types.push(h);break;case 6:var h={t:"m",m:"number",a:[l[o]]};this.$=i.types.length,i.types.push(h);break;case 7:var h={t:"v",v:i.escape(l[o].substring(1,l[o].length-1))};this.$=i.types.length,i.types.push(h);break;case 8:var h={t:"v",v:i.escape(l[o].substring(2,l[o].length-2))};this.$=i.types.length,i.types.push(h);break;case 9:var h={t:"v",v:l[o]};i.types.push(h);break;case 10:var h={t:"m",m:"concatenate",a:[l[o-2],l[o]]};this.$=i.types.length,i.types.push(h);break;case 11:var h={t:"m",m:"callFunction",a:["EQUAL",[l[o-2],l[o]]]};this.$=i.types.length,i.types.push(h);break;case 12:var h={t:"m",m:"performMath",a:["+",l[o-2],l[o]]};this.$=i.types.length,i.types.push(h);break;case 13:this.$=l[o-1];break;case 14:var h={t:"m",m:"callFunction",a:["LESS_EQUAL",[l[o-3],l[o]]]};this.$=i.types.length,i.types.push(h);break;case 15:var h={t:"m",m:"callFunction",a:["GREATER_EQUAL",[l[o-3],l[o]]]};this.$=i.types.length,i.types.push(h);break;case 16:var h={t:"m",m:"not",a:[l[o-3],l[o]]};this.$=i.types.length,i.types.push(h);break;case 17:var h={t:"m",m:"callFunction",a:["GREATER",[l[o-2],l[o]]]};this.$=i.types.length,i.types.push(h);break;case 18:var h={t:"m",m:"callFunction",a:["LESS",[l[o-2],l[o]]]};this.$=i.types.length,i.types.push(h);break;case 19:var h={t:"m",m:"performMath",a:["-",l[o-2],l[o]]};this.$=i.types.length,i.types.push(h);break;case 20:var h={t:"m",m:"performMath",a:["*",l[o-2],l[o]]};this.$=i.types.length,i.types.push(h);break;case 21:var h={t:"m",m:"performMath",a:["/",l[o-2],l[o]]};this.$=i.types.length,i.types.push(h);break;case 22:var h={t:"m",m:"performMath",a:["^",l[o-2],l[o]]};this.$=i.types.length,i.types.push(h);break;case 23:var h={t:"m",m:"invertNumber",a:[l[o]]};this.$=i.types.length,i.types.push(h);break;case 24:var h={t:"m",m:"number",a:[l[o]]};this.$=i.types.length,i.types.push(h);break;case 25:break;case 26:var h={t:"m",m:"callFunction",a:[l[o-2]]};this.$=i.types.length,i.types.push(h);break;case 27:var h={t:"m",m:"callFunction",a:[l[o-3],l[o-1]]};this.$=i.types.length,i.types.push(h);break;case 29:var h={t:"l",m:"cellValue",a:[l[o]]};this.$=i.types.length,i.types.push(h);break;case 30:var h={t:"l",m:"cellRangeValue",a:[l[o-2],l[o]]};this.$=i.types.length,i.types.push(h);break;case 31:var h={t:"l",m:"remoteCellValue",a:[l[o-2],l[o]]};this.$=i.types.length,i.types.push(h);break;case 32:var h={t:"l",m:"remoteCellRangeValue",a:[l[o-4],l[o-2],l[o]]};this.$=i.types.length,i.types.push(h);break;case 33:var h={t:"cell",c:l[o-1],r:l[o]};this.$=i.types.length,i.types.push(h);break;case 34:var h={t:"cell",c:l[o-1],r:l[o]};this.$=i.types.length,i.types.push(h);break;case 35:case 36:var h={t:"cell",c:l[o-2],r:l[o]};this.$=i.types.length,i.types.push(h);break;case 37:case 38:case 39:case 40:case 41:case 42:case 43:case 44:case 45:case 46:case 47:case 48:case 49:return"#REF!";case 50:this.$=[l[o]];break;case 53:l[o-2].push(l[o]),this.$=l[o-2];break;case 54:l[o-2].push(l[o]),this.$=l[o-2];break;case 55:this.$=[l[o]];break;case 56:this.$=l[o-2]instanceof Array?l[o-2]:[l[o-2]],this.$.push(l[o]);break;case 57:this.$=l[o];break;case 58:this.$=l[o-2]+"."+l[o];break;case 59:this.$=.01*l[o-1]+""}},table:[{3:1,4:[1,2],5:3,6:4,7:n,8:i,9:7,10:r,11:l,12:s,15:o,16:a,20:h,24:c,25:u,27:16,28:19,30:d,32:f,33:p,34:m,37:g},{1:[3]},{1:[2,1]},{4:[1,23],13:w,14:y,15:v,18:b,19:C,20:x,21:E,22:I,23:T},t(A,[2,3],{38:[1,33]}),t(A,[2,4]),t(A,[2,5]),t(A,[2,6],{39:[1,34]}),t(A,[2,7]),t(A,[2,8]),t(A,[2,9],{32:k,33:S,34:N}),{5:38,6:4,7:n,8:i,9:7,10:r,11:l,12:s,15:o,16:a,20:h,24:c,25:u,27:16,28:19,30:d,32:f,33:p,34:m,37:g},{5:39,6:4,7:n,8:i,9:7,10:r,11:l,12:s,15:o,16:a,20:h,24:c,25:u,27:16,28:19,30:d,32:f,33:p,34:m,37:g},{5:40,6:4,7:n,8:i,9:7,10:r,11:l,12:s,15:o,16:a,20:h,24:c,25:u,27:16,28:19,30:d,32:f,33:p,34:m,37:g},t(A,[2,25]),{16:[1,41]},t(A,[2,28]),t(R,[2,55]),t(F,[2,57],{38:[1,42]}),t(A,[2,29],{29:[1,43]}),{31:[1,44]},{12:[1,45],34:[1,46]},t(L,[2,37],{32:[1,47],33:[1,49],34:[1,48]}),{1:[2,2]},{5:50,6:4,7:n,8:i,9:7,10:r,11:l,12:s,15:o,16:a,20:h,24:c,25:u,27:16,28:19,30:d,32:f,33:p,34:m,37:g},{5:51,6:4,7:n,8:i,9:7,10:r,11:l,12:s,15:o,16:a,20:h,24:c,25:u,27:16,28:19,30:d,32:f,33:p,34:m,37:g},{5:52,6:4,7:n,8:i,9:7,10:r,11:l,12:s,15:o,16:a,20:h,24:c,25:u,27:16,28:19,30:d,32:f,33:p,34:m,37:g},{5:55,6:4,7:n,8:i,9:7,10:r,11:l,12:s,14:[1,53],15:o,16:a,19:[1,54],20:h,24:c,25:u,27:16,28:19,30:d,32:f,33:p,34:m,37:g},{5:57,6:4,7:n,8:i,9:7,10:r,11:l,12:s,14:[1,56],15:o,16:a,20:h,24:c,25:u,27:16,28:19,30:d,32:f,33:p,34:m,37:g},{5:58,6:4,7:n,8:i,9:7,10:r,11:l,12:s,15:o,16:a,20:h,24:c,25:u,27:16,28:19,30:d,32:f,33:p,34:m,37:g},{5:59,6:4,7:n,8:i,9:7,10:r,11:l,12:s,15:o,16:a,20:h,24:c,25:u,27:16,28:19,30:d,32:f,33:p,34:m,37:g},{5:60,6:4,7:n,8:i,9:7,10:r,11:l,12:s,15:o,16:a,20:h,24:c,25:u,27:16,28:19,30:d,32:f,33:p,34:m,37:g},{5:61,6:4,7:n,8:i,9:7,10:r,11:l,12:s,15:o,16:a,20:h,24:c,25:u,27:16,28:19,30:d,32:f,33:p,34:m,37:g},{37:[1,62]},t(F,[2,59]),t(L,[2,33]),{32:[1,63],34:[1,64]},t(L,[2,39]),{13:w,14:y,15:v,17:[1,65],18:b,19:C,20:x,21:E,22:I,23:T},t(_,[2,23],{13:w,21:E,22:I,23:T}),t(_,[2,24],{13:w,21:E,22:I,23:T}),{5:68,6:4,7:n,8:i,9:7,10:r,11:l,12:s,15:o,16:a,17:[1,66],20:h,24:c,25:u,26:67,27:16,28:19,30:d,32:f,33:p,34:m,37:g},{32:[1,69]},{12:O,28:70,33:p,34:m},{12:O,28:72,33:p,34:m},{32:[1,73],33:[1,74],34:[1,75]},{32:[1,76],33:[1,78],34:[1,77]},t(L,[2,38]),t(L,[2,40]),{32:[1,79],34:[1,80]},t([4,17,35,36],[2,10],{13:w,14:y,15:v,18:b,19:C,20:x,21:E,22:I,23:T}),t([4,14,17,35,36],[2,11],{13:w,15:v,18:b,19:C,20:x,21:E,22:I,23:T}),t(_,[2,12],{13:w,21:E,22:I,23:T}),{5:81,6:4,7:n,8:i,9:7,10:r,11:l,12:s,15:o,16:a,20:h,24:c,25:u,27:16,28:19,30:d,32:f,33:p,34:m,37:g},{5:82,6:4,7:n,8:i,9:7,10:r,11:l,12:s,15:o,16:a,20:h,24:c,25:u,27:16,28:19,30:d,32:f,33:p,34:m,37:g},t(M,[2,18],{13:w,15:v,20:x,21:E,22:I,23:T}),{5:83,6:4,7:n,8:i,9:7,10:r,11:l,12:s,15:o,16:a,20:h,24:c,25:u,27:16,28:19,30:d,32:f,33:p,34:m,37:g},t(M,[2,17],{13:w,15:v,20:x,21:E,22:I,23:T}),t(_,[2,19],{13:w,21:E,22:I,23:T}),t(H,[2,20],{13:w,23:T}),t(H,[2,21],{13:w,23:T}),t([4,14,15,17,18,19,20,21,22,23,35,36],[2,22],{13:w}),t(R,[2,56]),t(L,[2,35]),t(L,[2,45]),t(A,[2,13]),t(A,[2,26]),{17:[1,84],35:[1,85],36:[1,86]},t(z,[2,50],{13:w,14:y,15:v,18:b,19:C,20:x,21:E,22:I,23:T}),t(F,[2,58]),t(A,[2,30]),{32:k,33:S,34:N},t(A,[2,31],{29:[1,87]}),t(L,[2,34]),{
32:[1,88]},t(L,[2,42]),t(L,[2,41]),t(L,[2,43]),{32:[1,89],34:[1,90]},t(L,[2,44]),t(L,[2,46]),t(M,[2,14],{13:w,15:v,20:x,21:E,22:I,23:T}),t(M,[2,16],{13:w,15:v,20:x,21:E,22:I,23:T}),t(M,[2,15],{13:w,15:v,20:x,21:E,22:I,23:T}),t(A,[2,27]),t(z,[2,51],{6:4,9:7,27:16,28:19,5:91,7:n,8:i,10:r,11:l,12:s,15:o,16:a,20:h,24:c,25:u,30:d,32:f,33:p,34:m,37:g}),t(z,[2,52],{6:4,9:7,27:16,28:19,5:92,7:n,8:i,10:r,11:l,12:s,15:o,16:a,20:h,24:c,25:u,30:d,32:f,33:p,34:m,37:g}),{12:O,28:93,33:p,34:m},t(L,[2,36]),t(L,[2,47]),t(L,[2,49]),t(z,[2,53],{13:w,14:y,15:v,18:b,19:C,20:x,21:E,22:I,23:T}),t(z,[2,54],{13:w,14:y,15:v,18:b,19:C,20:x,21:E,22:I,23:T}),t(A,[2,32])],defaultActions:{2:[2,1],23:[2,2]},parseError:function(e,t){if(!t.recoverable)throw new Error(e);this.trace(e)},parse:function(e){function t(e){l.length=l.length-2*e,s.length=s.length-e,o.length=o.length-e}function n(){var e;return e=g.lex()||p,"number"!=typeof e&&(e=r.symbols_[e]||e),e}function i(e){for(var t=l.length-1,n=0;;){if(f.toString()in a[e])return n;if(0===e||t<2)return!1;t-=2,e=l[t],++n}}var r=this,l=[0],s=[null],o=[],a=this.table,h="",c=0,u=0,d=0,f=2,p=1,m=o.slice.call(arguments,1),g=Object.create(this.lexer),w={yy:{}};for(var y in this.yy)Object.prototype.hasOwnProperty.call(this.yy,y)&&(w.yy[y]=this.yy[y]);g.setInput(e,w.yy),w.yy.lexer=g,w.yy.parser=this,"undefined"==typeof g.yylloc&&(g.yylloc={});var v=g.yylloc;o.push(v);var b=g.options&&g.options.ranges;"function"==typeof w.yy.parseError?this.parseError=w.yy.parseError:this.parseError=Object.getPrototypeOf(this).parseError;for(var C,x,E,I,T,A,k,S,N,R={};;){if(E=l[l.length-1],this.defaultActions[E]?I=this.defaultActions[E]:(null!==C&&"undefined"!=typeof C||(C=n()),I=a[E]&&a[E][C]),"undefined"==typeof I||!I.length||!I[0]){var F,L="";if(!d){F=i(E),N=[];for(A in a[E])this.terminals_[A]&&A>f&&N.push("'"+this.terminals_[A]+"'");return L=g.showPosition?"Parse error on line "+(c+1)+":\n"+g.showPosition()+"\nExpecting "+N.join(", ")+", got '"+(this.terminals_[C]||C)+"'":"Parse error on line "+(c+1)+": Unexpected "+(C==p?"end of input":"'"+(this.terminals_[C]||C)+"'"),this.parseError(L,{text:g.match,token:this.terminals_[C]||C,line:g.yylineno,loc:v,expected:N,recoverable:F!==!1})}if(x!==p&&(F=i(E)),3==d){if(C===p||x===p)throw new Error(L||"Parsing halted while starting to recover from another error.");u=g.yyleng,h=g.yytext,c=g.yylineno,v=g.yylloc,C=n()}if(F===!1)throw new Error(L||"Parsing halted. No suitable error recovery rule available.");t(F),x=C==f?null:C,C=f,E=l[l.length-1],I=a[E]&&a[E][f],d=3}if(I[0]instanceof Array&&I.length>1)throw new Error("Parse Error: multiple actions possible at state: "+E+", token: "+C);switch(I[0]){case 1:l.push(C),s.push(g.yytext),o.push(g.yylloc),l.push(I[1]),C=null,x?(C=x,x=null):(u=g.yyleng,h=g.yytext,c=g.yylineno,v=g.yylloc,d>0&&d--);break;case 2:if(k=this.productions_[I[1]][1],R.$=s[s.length-k],R._$={first_line:o[o.length-(k||1)].first_line,last_line:o[o.length-1].last_line,first_column:o[o.length-(k||1)].first_column,last_column:o[o.length-1].last_column},b&&(R._$.range=[o[o.length-(k||1)].range[0],o[o.length-1].range[1]]),T=this.performAction.apply(R,[h,u,c,w.yy,I[1],s,o].concat(m)),"undefined"!=typeof T)return T;k&&(l=l.slice(0,-1*k*2),s=s.slice(0,-1*k),o=o.slice(0,-1*k)),l.push(this.productions_[I[1]][0]),s.push(R.$),o.push(R._$),S=a[l[l.length-2]][l[l.length-1]],l.push(S);break;case 3:return!0}}return!0}},D=function(){var e=function(){};e.prototype=P.lexer;var t=function(){this.lexer=new e,this.yy={types:[],escape:function(e){return e.replace(/&/gi,"&amp;").replace(/>/gi,"&gt;").replace(/</gi,"&lt;").replace(/\n/g,"\n<br>").replace(/\t/g,"&nbsp;&nbsp;&nbsp ").replace(/  /g,"&nbsp; ")},parseError:function(e,t){this.done=!0;var n=new String;return n.html="<pre>"+e+"</pre>",n.hash=t,n}}};t.prototype=P;var n=new t;return n};"undefined"!=typeof window?window.Formula=D:P.Formula=D;var B=function(){var t={EOF:1,parseError:function(e,t){if(!this.yy.parser)throw new Error(e);this.yy.parser.parseError(e,t)},setInput:function(t,n){return this.yy=n||this.yy||{},this._input=new e.InputReader(t),this._more=this._backtrack=this.done=!1,this.yylineno=this.yyleng=0,this.yytext=this.match="",this.conditionStack=["INITIAL"],this.yylloc={first_line:1,first_column:0,last_line:1,last_column:0},this.options.ranges&&(this.yylloc.range=[0,0]),this.offset=0,this},input:function(){var e=this._input.ch();this.yytext+=e,this.yyleng++,this.offset++,this.match+=e;var t=e.match(/(?:\r\n?|\n).*/g);return t?(this.yylineno++,this.yylloc.last_line++):this.yylloc.last_column++,this.options.ranges&&this.yylloc.range[1]++,e},unput:function(e){var t=e.length,n=e.split(/(?:\r\n?|\n)/g);this._input.unCh(t,e),this.yytext=this.yytext.substr(0,this.yytext.length-t),this.offset-=t;var i=this.match.split(/(?:\r\n?|\n)/g);this.match=this.match.substr(0,this.match.length-1),n.length-1&&(this.yylineno-=n.length-1);var r=this.yylloc.range;return this.yylloc={first_line:this.yylloc.first_line,last_line:this.yylineno+1,first_column:this.yylloc.first_column,last_column:n?(n.length===i.length?this.yylloc.first_column:0)+i[i.length-n.length].length-n[0].length:this.yylloc.first_column-t},this.options.ranges&&(this.yylloc.range=[r[0],r[0]+this.yyleng-t]),this.yyleng=this.yytext.length,this},more:function(){return this._more=!0,this},reject:function(){return this.options.backtrack_lexer?(this._backtrack=!0,this):this.parseError("Lexical error on line "+(this.yylineno+1)+". You can only invoke reject() in the lexer when the lexer is of the backtracking persuasion (options.backtrack_lexer = true).\n"+this.showPosition(),{text:"",token:null,line:this.yylineno})},less:function(e){this.unput(this.match.slice(e))},pastInput:function(){var e=this._input.toString(),t=e.substr(0,e.length-this.match.length);return(t.length>20?"...":"")+t.substr(-20).replace(/\n/g,"")},upcomingInput:function(){var e=this._input.input.substr(this._input.position,this._input.input.length-1);return(e.substr(0,20)+(e.length>20?"...":"")).replace(/\n/g,"")},showPosition:function(){var e=this.pastInput(),t=new Array(e.length+1).join("-");return e+this.upcomingInput()+"\n"+t+"^"},test_match:function(e,t){var n,i,r,l;if(this.options.backtrack_lexer&&(r={yylineno:this.yylineno,yylloc:{first_line:this.yylloc.first_line,last_line:this.last_line,first_column:this.yylloc.first_column,last_column:this.yylloc.last_column},yytext:this.yytext,match:this.match,matches:this.matches,yyleng:this.yyleng,offset:this.offset,_more:this._more,yy:this.yy,conditionStack:this.conditionStack.slice(0),done:this.done},this.options.ranges&&(r.yylloc.range=this.yylloc.range.slice(0))),i=e.match(/(?:\r\n?|\n).*/g),i&&(this.yylineno+=i.length),this.yylloc={first_line:this.yylloc.last_line,last_line:this.yylineno+1,first_column:this.yylloc.last_column,last_column:null!==i?i[i.length-1].length-i[i.length-1].match(/\r?\n?/)[0].length:this.yylloc.last_column+e.length},this.yytext+=e,this.match+=e,this.matches=e,this.yyleng=this.yytext.length,this.options.ranges&&(this.yylloc.range=[this.offset,this.offset+=this.yyleng]),this._more=!1,this._backtrack=!1,this._input.addMatch(e),n=this.performAction.call(this,this.yy,this,t,this.conditionStack[this.conditionStack.length-1]),this.done&&!this._input.done&&(this.done=!1),n)return n;if(this._backtrack){for(l in r)r.hasOwnProperty(l)&&(this[l]=r[l]);return null}return null},next:function(){if(this.done)return this.EOF;this._input.done&&(this.done=!0);var e,t,n,i;this._more||(this.yytext="",this.match="");for(var r=this._currentRules(),l=0;l<r.length;l++)if(n=this._input.match(this.rules[r[l]]),null!==n&&(void 0===t||n[0].length>t.length)){if(t=n[0],i=l,this.options.backtrack_lexer){if(e=this.test_match(n[0],r[l]),null!==e)return e;if(this._backtrack){t=void 0;continue}return null}if(!this.options.flex)break}return void 0!==t?(e=this.test_match(t,r[i]),null!==e?e:null):this._input.done?this.EOF:this.parseError("Lexical error on line "+(this.yylineno+1)+". Unrecognized text.\n"+this.showPosition(),{text:"",token:null,line:this.yylineno})},lex:function(){var e=this.next();return null!==e?e:this.lex()},begin:function(e){this.conditionStack.push(e)},popState:function(){var e=this.conditionStack.length-1;return e>0?this.conditionStack.pop():this.conditionStack[0]},_currentRules:function(){return this.conditionStack.length&&this.conditionStack[this.conditionStack.length-1]?this.conditions[this.conditionStack[this.conditionStack.length-1]].rules:this.conditions.INITIAL.rules},topState:function(e){return e=this.conditionStack.length-1-Math.abs(e||0),e>=0?this.conditionStack[e]:"INITIAL"},pushState:function(e){this.begin(e)},stateStackSize:function(){return this.conditionStack.length},options:{},performAction:function(e,t,n,i){switch(n){case 0:break;case 1:return 25;case 2:return 7;case 3:return 8;case 4:return 30;case 5:return t.yytext=t.yytext.substring(1,t.yytext.length-1),30;case 6:return 10;case 7:return 10;case 8:return 11;case 9:return 11;case 10:return 12;case 11:return 37;case 12:return 37;case 13:return 32;case 14:return 33;case 15:return 13;case 16:return" ";case 17:return 38;case 18:return 29;case 19:return 35;case 20:return 36;case 21:return 21;case 22:return 22;case 23:return 20;case 24:return 15;case 25:return 23;case 26:return 16;case 27:return 17;case 28:return 19;case 29:return 18;case 30:return"PI";case 31:return 24;case 32:return'"';case 33:return"'";case 34:return'"';case 35:return"'";case 36:return"!";case 37:return 14;case 38:return 39;case 39:return 34;case 40:return"#";case 41:return 4}},rules:[/^(?:\s+)/,/^(?:([A-Za-z]{1,})([A-Za-z_0-9]+)?(?=[(]))/,/^(?:([0]?[1-9]|1[0-2])[:][0-5][0-9]([:][0-5][0-9])?[ ]?(AM|am|aM|Am|PM|pm|pM|Pm))/,/^(?:([0]?[0-9]|1[0-9]|2[0-3])[:][0-5][0-9]([:][0-5][0-9])?)/,/^(?:(([A-Za-z0-9]+))(?=[!]))/,/^(?:((['](\\[']|[^'])*['])|(["](\\["]|[^"])*["]))(?=[!]))/,/^(?:((['](\\[']|[^'])*['])))/,/^(?:((["](\\["]|[^"])*["])))/,/^(?:(([\\]['].+?[\\]['])))/,/^(?:(([\\]["].+?[\\]["])))/,/^(?:[A-Z]+(?=[0-9$]))/,/^(?:[A-Za-z]{1,}[A-Za-z_0-9]+)/,/^(?:[A-Za-z_]+)/,/^(?:[0-9]+)/,/^(?:\$)/,/^(?:&)/,/^(?: )/,/^(?:[.])/,/^(?::)/,/^(?:;)/,/^(?:,)/,/^(?:\*)/,/^(?:\/)/,/^(?:-)/,/^(?:\+)/,/^(?:\^)/,/^(?:\()/,/^(?:\))/,/^(?:>)/,/^(?:<)/,/^(?:PI\b)/,/^(?:E\b)/,/^(?:")/,/^(?:')/,/^(?:\\")/,/^(?:\\')/,/^(?:!)/,/^(?:=)/,/^(?:%)/,/^(?:#REF!)/,/^(?:[#])/,/^(?:$)/],conditions:{INITIAL:{rules:[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41],inclusive:!0}}};return t}();return P.lexer=B,e.prototype=P,e.InputReader=function(e,t,n){function i(e){this.done=!1,this.input=e,this.length=e.length,this.matches=[],this.position=0}var r,l,s,o,a=void 0!==RegExp.prototype.sticky;if(a)for(i.prototype={addMatch:function(e){this.matches.push(e),this.position+=e.length,this.done=this.position>=this.length},ch:function h(){var h=this.input[this.position];return this.addMatch(h),h},unCh:function(t){this.position-=t,this.position=e.max(0,this.position),this.done=this.position>=this.length},substring:function(e,t){return e=0!=e?this.position+e:this.position,t=0!=t?e+t:this.length,this.input.substring(e,t)},match:function c(e){var c;return e.lastIndex=this.position,null!==(c=e.exec(this.input))?c:null},toString:function(){return this.matches.join("")}},r=n.rules,s=r.length,o=0;o<s;o++)l=r[o],r[o]=new RegExp(l.source.substring(1),"y");else i.prototype={addMatch:function(e){this.input=this.input.slice(e.length),this.matches.push(e),this.position+=e.length,this.done=this.position>=this.length},ch:function u(){var u=this.input[0];return this.addMatch(u),u},unCh:function(t,n){this.position-=t,this.position=e.max(0,this.position),this.input=n+this.input,this.done=this.position>=this.length},substring:function(e,t){return e=0!=e?this.position+e:this.position,t=0!=t?e+t:this.length,this.input.substring(e,t)},match:function d(e){var d,t=this.input;return null!==(d=t.match(e))?d:null},toString:function(){return this.matches.join("")}};return i}(Math,P,B),P.Parser=e,new e}();"undefined"!=typeof require&&"undefined"!=typeof exports&&(exports.parser=parser,exports.Parser=parser.Parser,exports.parse=function(){return parser.parse.apply(parser,arguments)},exports.main=function(e){e[1]||(console.log("Usage: "+e[0]+" FILE"),process.exit(1));var t=require("fs").readFileSync(require("path").normalize(e[1]),"utf8");return exports.parser.parse(t)},"undefined"!=typeof module&&require.main===module&&exports.main(process.argv.slice(1)));var parser=function(){function e(){this.yy={}}var t=function(e,t,n,i){for(n=n||{},i=e.length;i--;n[e[i]]=t);return n},n=[1,10],i=[1,11],r=[1,12],l=[1,13],s=[5,7,8,9,10],o=[1,19],a=[1,20],h=[5,7,8,9,10,12,13],c=[1,21],u=[5,7,8,9,10,12,13,14,16],d={trace:function(){},yy:{},symbols_:{error:2,grid:3,rows:4,EOF:5,row:6,END_OF_LINE:7,END_OF_LINE_WITH_EMPTY_NEXT_FIRST_COLUMN:8,END_OF_LINE_WITH_NO_COLUMNS:9,END_OF_LINE_WITH_EMPTY_COLUMN:10,string:11,COLUMN_EMPTY:12,COLUMN_STRING:13,CHAR:14,QUOTE_ON:15,QUOTE_OFF:16,$accept:0,$end:1},terminals_:{2:"error",5:"EOF",7:"END_OF_LINE",8:"END_OF_LINE_WITH_EMPTY_NEXT_FIRST_COLUMN",9:"END_OF_LINE_WITH_NO_COLUMNS",10:"END_OF_LINE_WITH_EMPTY_COLUMN",12:"COLUMN_EMPTY",13:"COLUMN_STRING",14:"CHAR",15:"QUOTE_ON",16:"QUOTE_OFF"},productions_:[0,[3,2],[3,1],[4,1],[4,1],[4,1],[4,1],[4,1],[4,2],[4,2],[4,2],[4,2],[4,3],[4,3],[4,3],[4,3],[6,1],[6,1],[6,2],[6,3],[6,1],[6,2],[6,3],[11,1],[11,2],[11,3]],performAction:function(e,t,n,i,r,l,s){var o=l.length-1;switch(r){case 1:return l[o-1];case 2:return[[""]];case 3:this.$=[l[o]];break;case 4:this.$=[];break;case 5:this.$=[""];break;case 6:this.$=[""];break;case 7:this.$=[""];break;case 8:this.$=l[o-1];break;case 9:l[o-1].push([""]),this.$=l[o-1];break;case 10:l[o-1].push([""]),this.$=l[o-1];break;case 11:l[o-1][l[o-1].length-1].push(""),this.$=l[o-1];break;case 12:l[o-2].push(l[o]),this.$=l[o-2];break;case 13:l[o].unshift(""),l[o-2].push(l[o]),this.$=l[o-2];break;case 14:l[o-2].push([""]),l[o-2].push(l[o]),this.$=l[o-2];break;case 15:l[o-2][l[o-2].length-1].push(""),l[o-2].push(l[o]),this.$=l[o-2];break;case 16:this.$=[l[o].join("")];break;case 17:this.$=[""];break;case 18:l[o-1].push(""),this.$=l[o-1];break;case 19:l[o-2].push(""),l[o-2].push(l[o].join("")),this.$=l[o-2];break;case 20:break;case 21:break;case 22:l[o-2].push(l[o].join("")),this.$=l[o-2];break;case 23:this.$=[l[o]];break;case 24:l[o-1].push(l[o]),this.$=l[o-1];break;case 25:this.$=l[o-1]}},table:[{3:1,4:2,5:[1,3],6:4,7:[1,5],8:[1,6],9:[1,7],10:[1,8],11:9,12:n,13:i,14:r,15:l},{1:[3]},{5:[1,14],7:[1,15],8:[1,16],9:[1,17],10:[1,18]},{1:[2,2]},t(s,[2,3],{12:o,13:a}),t(s,[2,4]),t(s,[2,5]),t(s,[2,6]),t(s,[2,7]),t(h,[2,16],{14:c}),t(h,[2,17]),t(h,[2,20]),t(u,[2,23]),{11:22,14:r,15:l},{1:[2,1]},t(s,[2,8],{11:9,6:23,12:n,13:i,14:r,15:l}),t(s,[2,9],{11:9,6:24,12:n,13:i,14:r,15:l}),t(s,[2,10],{11:9,6:25,12:n,13:i,14:r,15:l}),t(s,[2,11],{11:9,6:26,12:n,13:i,14:r,15:l}),t(h,[2,18],{11:27,14:r,15:l}),t(h,[2,21],{11:28,14:r,15:l}),t(u,[2,24]),{14:c,16:[1,29]},t(s,[2,12],{12:o,13:a}),t(s,[2,13],{12:o,13:a}),t(s,[2,14],{12:o,13:a}),t(s,[2,15],{12:o,13:a}),t(h,[2,19],{14:c}),t(h,[2,22],{14:c}),t(u,[2,25])],defaultActions:{3:[2,2],14:[2,1]},parseError:function(e,t){if(!t.recoverable)throw new Error(e);this.trace(e)},parse:function(e){function t(){var e;return e=p.lex()||d,"number"!=typeof e&&(e=n.symbols_[e]||e),e}var n=this,i=[0],r=[null],l=[],s=this.table,o="",a=0,h=0,c=0,u=2,d=1,f=l.slice.call(arguments,1),p=Object.create(this.lexer),m={yy:{}};for(var g in this.yy)Object.prototype.hasOwnProperty.call(this.yy,g)&&(m.yy[g]=this.yy[g]);p.setInput(e,m.yy),m.yy.lexer=p,m.yy.parser=this,"undefined"==typeof p.yylloc&&(p.yylloc={});var w=p.yylloc;l.push(w);var y=p.options&&p.options.ranges;"function"==typeof m.yy.parseError?this.parseError=m.yy.parseError:this.parseError=Object.getPrototypeOf(this).parseError;for(var v,b,C,x,E,I,T,A,k,S={};;){if(C=i[i.length-1],this.defaultActions[C]?x=this.defaultActions[C]:(null!==v&&"undefined"!=typeof v||(v=t()),x=s[C]&&s[C][v]),"undefined"==typeof x||!x.length||!x[0]){var N="";k=[];for(I in s[C])this.terminals_[I]&&I>u&&k.push("'"+this.terminals_[I]+"'");N=p.showPosition?"Parse error on line "+(a+1)+":\n"+p.showPosition()+"\nExpecting "+k.join(", ")+", got '"+(this.terminals_[v]||v)+"'":"Parse error on line "+(a+1)+": Unexpected "+(v==d?"end of input":"'"+(this.terminals_[v]||v)+"'"),this.parseError(N,{text:p.match,token:this.terminals_[v]||v,line:p.yylineno,loc:w,expected:k})}if(x[0]instanceof Array&&x.length>1)throw new Error("Parse Error: multiple actions possible at state: "+C+", token: "+v);switch(x[0]){case 1:i.push(v),r.push(p.yytext),l.push(p.yylloc),i.push(x[1]),v=null,b?(v=b,b=null):(h=p.yyleng,o=p.yytext,a=p.yylineno,w=p.yylloc,c>0&&c--);break;case 2:if(T=this.productions_[x[1]][1],S.$=r[r.length-T],S._$={first_line:l[l.length-(T||1)].first_line,last_line:l[l.length-1].last_line,first_column:l[l.length-(T||1)].first_column,last_column:l[l.length-1].last_column},y&&(S._$.range=[l[l.length-(T||1)].range[0],l[l.length-1].range[1]]),E=this.performAction.apply(S,[o,h,a,m.yy,x[1],r,l].concat(f)),"undefined"!=typeof E)return E;T&&(i=i.slice(0,-1*T*2),r=r.slice(0,-1*T),l=l.slice(0,-1*T)),i.push(this.productions_[x[1]][0]),r.push(S.$),l.push(S._$),A=s[i[i.length-2]][i[i.length-1]],i.push(A);break;case 3:return!0}}return!0}};if("undefined"!=typeof GLOBAL&&(GLOBAL.window=GLOBAL),"undefined"==typeof window.TSV){var f=d.parse;d.parse=function(e){var t=this.lexer.setInput;return this.lexer.setInput=function(e){return t.call(this,e),this.begin("BOF"),this},this.parse=f,f.call(this,e)},window.TSV=function(e){var t=function(){};t.prototype=d.lexer;var n=function(){this.lexer=new t,this.yy={}};n.prototype=d;var i=new n;return i.setObj=function(e){i.yy.obj=e},i.yy.handler=e,i}}var p=function(){var e={EOF:1,parseError:function(e,t){if(!this.yy.parser)throw new Error(e);this.yy.parser.parseError(e,t)},setInput:function(e,t){return this.yy=t||this.yy||{},this._input=e,this._more=this._backtrack=this.done=!1,this.yylineno=this.yyleng=0,this.yytext=this.matched=this.match="",this.conditionStack=["INITIAL"],this.yylloc={first_line:1,first_column:0,last_line:1,last_column:0},this.options.ranges&&(this.yylloc.range=[0,0]),this.offset=0,this},input:function(){var e=this._input[0];this.yytext+=e,this.yyleng++,this.offset++,this.match+=e,this.matched+=e;var t=e.match(/(?:\r\n?|\n).*/g);return t?(this.yylineno++,this.yylloc.last_line++):this.yylloc.last_column++,this.options.ranges&&this.yylloc.range[1]++,this._input=this._input.slice(1),e},unput:function(e){var t=e.length,n=e.split(/(?:\r\n?|\n)/g);this._input=e+this._input,this.yytext=this.yytext.substr(0,this.yytext.length-t),this.offset-=t;var i=this.match.split(/(?:\r\n?|\n)/g);this.match=this.match.substr(0,this.match.length-1),this.matched=this.matched.substr(0,this.matched.length-1),n.length-1&&(this.yylineno-=n.length-1);var r=this.yylloc.range;return this.yylloc={first_line:this.yylloc.first_line,last_line:this.yylineno+1,first_column:this.yylloc.first_column,last_column:n?(n.length===i.length?this.yylloc.first_column:0)+i[i.length-n.length].length-n[0].length:this.yylloc.first_column-t},this.options.ranges&&(this.yylloc.range=[r[0],r[0]+this.yyleng-t]),this.yyleng=this.yytext.length,this},more:function(){return this._more=!0,this},reject:function(){return this.options.backtrack_lexer?(this._backtrack=!0,this):this.parseError("Lexical error on line "+(this.yylineno+1)+". You can only invoke reject() in the lexer when the lexer is of the backtracking persuasion (options.backtrack_lexer = true).\n"+this.showPosition(),{text:"",token:null,line:this.yylineno})},less:function(e){this.unput(this.match.slice(e))},pastInput:function(){var e=this.matched.substr(0,this.matched.length-this.match.length);return(e.length>20?"...":"")+e.substr(-20).replace(/\n/g,"")},upcomingInput:function(){var e=this.match;return e.length<20&&(e+=this._input.substr(0,20-e.length)),(e.substr(0,20)+(e.length>20?"...":"")).replace(/\n/g,"")},showPosition:function(){var e=this.pastInput(),t=new Array(e.length+1).join("-");return e+this.upcomingInput()+"\n"+t+"^"},test_match:function(e,t){var n,i,r;if(this.options.backtrack_lexer&&(r={yylineno:this.yylineno,yylloc:{first_line:this.yylloc.first_line,last_line:this.last_line,first_column:this.yylloc.first_column,last_column:this.yylloc.last_column},yytext:this.yytext,match:this.match,matches:this.matches,matched:this.matched,yyleng:this.yyleng,offset:this.offset,_more:this._more,_input:this._input,yy:this.yy,conditionStack:this.conditionStack.slice(0),done:this.done},this.options.ranges&&(r.yylloc.range=this.yylloc.range.slice(0))),i=e[0].match(/(?:\r\n?|\n).*/g),i&&(this.yylineno+=i.length),this.yylloc={first_line:this.yylloc.last_line,last_line:this.yylineno+1,first_column:this.yylloc.last_column,last_column:i?i[i.length-1].length-i[i.length-1].match(/\r?\n?/)[0].length:this.yylloc.last_column+e[0].length},this.yytext+=e[0],this.match+=e[0],this.matches=e,this.yyleng=this.yytext.length,this.options.ranges&&(this.yylloc.range=[this.offset,this.offset+=this.yyleng]),this._more=!1,this._backtrack=!1,this._input=this._input.slice(e[0].length),this.matched+=e[0],n=this.performAction.call(this,this.yy,this,t,this.conditionStack[this.conditionStack.length-1]),this.done&&this._input&&(this.done=!1),n)return n;if(this._backtrack){for(var l in r)this[l]=r[l];return!1}return!1},next:function(){if(this.done)return this.EOF;this._input||(this.done=!0);var e,t,n,i;this._more||(this.yytext="",this.match="");for(var r=this._currentRules(),l=0;l<r.length;l++)if(n=this._input.match(this.rules[r[l]]),n&&(!t||n[0].length>t[0].length)){if(t=n,i=l,this.options.backtrack_lexer){if(e=this.test_match(n,r[l]),e!==!1)return e;if(this._backtrack){t=!1;continue}return!1}if(!this.options.flex)break}return t?(e=this.test_match(t,r[i]),e!==!1&&e):""===this._input?this.EOF:this.parseError("Lexical error on line "+(this.yylineno+1)+". Unrecognized text.\n"+this.showPosition(),{text:"",token:null,line:this.yylineno})},lex:function(){var e=this.next();return e?e:this.lex()},begin:function(e){this.conditionStack.push(e)},popState:function(){var e=this.conditionStack.length-1;return e>0?this.conditionStack.pop():this.conditionStack[0]},_currentRules:function(){return this.conditionStack.length&&this.conditionStack[this.conditionStack.length-1]?this.conditions[this.conditionStack[this.conditionStack.length-1]].rules:this.conditions.INITIAL.rules},topState:function(e){return e=this.conditionStack.length-1-Math.abs(e||0),e>=0?this.conditionStack[e]:"INITIAL"},pushState:function(e){this.begin(e)},stateStackSize:function(){return this.conditionStack.length},options:{},performAction:function(e,t,n,i){switch(n){case 0:return 14;case 1:return this.popState(),16;case 2:return t.yytext==this.quoteChar?(this.popState(),this.begin("STRING"),16):14;case 3:return this.popState(),this.begin("STRING"),14;case 4:return this.popState(),this.quoteChar=t.yytext.substring(0),this.begin("QUOTE"),15;case 5:return this.quoteChar=t.yytext,this.popState(),this.begin("QUOTE"),15;case 6:return this.begin("PRE_QUOTE"),13;case 7:return this.begin("PRE_QUOTE"),7;case 8:return 14;case 9:return this.popState(),8;case 10:return this.popState(),9;case 11:return this.popState(),7;case 12:return this.popState(),13;case 13:return 14;case 14:this.popState();break;case 15:return"BUFFIN";case 16:return 9;case 17:return 10;case 18:return 12;case 19:return 7;case 20:return this.begin("STRING"),14;case 21:return 5}},rules:[/^(?:(\n|\\n))/,/^(?:([\'\"])(?=$))/,/^(?:([\'\"]))/,/^(?:(?=(\t)))/,/^(?:([\'\"]))/,/^(?:([\'\"]))/,/^(?:(\t|\\t)(?=[\'\"]))/,/^(?:(\n|\\n)(?=[\'\"]))/,/^(?:([a-zA-Z0-9_ ]+|.))/,/^(?:(\n\t|\\n\\t))/,/^(?:(\n\n|\\n\\n))/,/^(?:(\n|\\n))/,/^(?:(\t|\\t))/,/^(?:([a-zA-Z0-9_ ]+|.))/,/^(?:)/,/^(?:(\n\t|\\n\\t)(?=.))/,/^(?:(\n\n|\\n\\n))/,/^(?:(\t\n))/,/^(?:(\t))/,/^(?:(\n))/,/^(?:([a-zA-Z0-9_ ]+|.))/,/^(?:$)/],conditions:{BOF:{rules:[4,6,7,14,15,16,17,18,19,20,21],inclusive:!0},PRE_QUOTE:{rules:[5,6,7,15,16,17,18,19,20,21],inclusive:!0},QUOTE:{rules:[0,1,2,3,6,7,8,15,16,17,18,19,20,21],inclusive:!0},STRING:{rules:[6,7,9,10,11,12,13,15,16,17,18,19,20,21],inclusive:!0},INITIAL:{rules:[6,7,15,16,17,18,19,20,21],inclusive:!0}}};return e}();return d.lexer=p,e.prototype=d,d.Parser=e,new e}();"undefined"!=typeof require&&"undefined"!=typeof exports&&(exports.parser=parser,exports.Parser=parser.Parser,exports.parse=function(){return parser.parse.apply(parser,arguments)},exports.main=function(e){e[1]||(console.log("Usage: "+e[0]+" FILE"),process.exit(1));var t=require("fs").readFileSync(require("path").normalize(e[1]),"utf8");return exports.parser.parse(t)},"undefined"!=typeof module&&require.main===module&&exports.main(process.argv.slice(1)));